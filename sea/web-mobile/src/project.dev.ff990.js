window.__require = function e(t, n, r) {
  function s(o, u) {
    if (!n[o]) {
      if (!t[o]) {
        var b = o.split("/");
        b = b[b.length - 1];
        if (!t[b]) {
          var a = "function" == typeof __require && __require;
          if (!u && a) return a(b, !0);
          if (i) return i(b, !0);
          throw new Error("Cannot find module '" + o + "'");
        }
        o = b;
      }
      var f = n[o] = {
        exports: {}
      };
      t[o][0].call(f.exports, function(e) {
        var n = t[o][1][e];
        return s(n || e);
      }, f, f.exports, e, t, n, r);
    }
    return n[o].exports;
  }
  var i = "function" == typeof __require && __require;
  for (var o = 0; o < r.length; o++) s(r[o]);
  return s;
}({
  ActionCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "ee0ab3T6xFByK1GH1Bjwqs2", "ActionCtrl");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SingletonFactory_1 = require("../../Base/Utils/SingletonFactory");
    var GameModel_1 = require("../Match3/Model/GameModel");
    var Common_1 = require("./Common");
    var Util_1 = require("../../Base/Utils/Util");
    var TimeConfig_1 = require("../Data/Const/TimeConfig");
    var Constant_1 = require("../Data/Const/Constant");
    var ActionCtrl = function() {
      function ActionCtrl() {}
      ActionCtrl.prototype.runShowCross = function(target, gridViewPool) {
        return new Promise(function(resolve) {
          var fristViewNode = gridViewPool.get(0);
          var maxGridViewNode = gridViewPool.get(GameModel_1.default.ins.mapCount - 1);
          var a0 = cc.delayTime(.3);
          var a1 = cc.scaleTo(.5, .85);
          var a2 = cc.delayTime(.2);
          var a3 = cc.moveTo(1, cc.v2(.85 * -maxGridViewNode.x, 0));
          var a5 = cc.delayTime(1);
          var a6 = cc.moveTo(1 * GameModel_1.default.ins.mapCount, fristViewNode.position);
          var a4 = cc.scaleTo(.5, 1);
          target.runAction(cc.sequence(a0, a1, a2, a3, a5, a6, a4, cc.callFunc(resolve)));
        });
      };
      ActionCtrl.prototype.runShowRow = function(target, maskHeight) {
        return new Promise(function(resolve) {
          var gapDistance = (target.height - maskHeight + Common_1.default.GRID_H) / 2;
          target.y = gapDistance;
          var a0 = cc.delayTime(.5);
          var a1 = cc.moveTo(1.5, cc.v2(0, -gapDistance));
          var a2 = cc.callFunc(resolve);
          target.runAction(cc.sequence(a0, a1, a2));
        });
      };
      ActionCtrl.prototype.runMoveRow = function(target, distance) {
        return new Promise(function(resolve) {
          var a0 = cc.delayTime(.3);
          var a1 = cc.moveBy(1, cc.v2(0, distance));
          var a2 = cc.callFunc(resolve);
          target.runAction(cc.sequence(a0, a1, a2));
        });
      };
      ActionCtrl.prototype.runMoveCross = function(target) {
        return new Promise(function(resolve) {
          var a2 = cc.callFunc(resolve);
          var a1 = cc.moveBy(1, cc.v2(-cc.winSize.width, 0));
          target.runAction(cc.sequence(a1, a2));
        });
      };
      ActionCtrl.prototype.runCollectNormalCell = function(target, targetPos, elimateType) {
        void 0 === elimateType && (elimateType = Constant_1.ElimateType.Default);
        return new Promise(function(resolve) {
          target.scale = 1;
          var moveTime = target.position.sub(targetPos).mag() * (1.8 / TimeConfig_1.GapTime.CollectMoveSpeed);
          moveTime = moveTime < .5 ? 2 * moveTime : moveTime;
          var radians = Math.atan2(target.x - targetPos.x, target.y - targetPos.y);
          var degrees = -180 * radians / Math.PI;
          var bezierMY = 100 + Util_1.Util.Tool.rangeInt(0, 150);
          var a2 = cc.rotateTo(moveTime, degrees);
          var a3 = cc.callFunc(resolve);
          var finalAction = null;
          var a1 = cc.bezierTo(moveTime, [ target.getPosition(), cc.v2(0, Util_1.Util.Tool.rangeInt(0, 10) < 5 ? bezierMY : -bezierMY), targetPos ]);
          finalAction = cc.sequence(cc.spawn(a1, a2), a3);
          target.runAction(finalAction);
        });
      };
      ActionCtrl.prototype.runCollectGem = function(node, targetPos, newParent) {
        return new Promise(function(resolve) {
          var newPosition = node.parent.convertToWorldSpaceAR(node.position);
          var moveTime = .001 * newPosition.sub(targetPos).mag();
          node.setScale(1);
          var a1 = cc.scaleTo(.4, node.scale + .2);
          var a2 = cc.spawn(cc.moveTo(moveTime, newParent.convertToNodeSpaceAR(targetPos)), cc.scaleTo(moveTime, .1));
          var a3 = cc.callFunc(resolve);
          node.runAction(cc.sequence(a1, a2, a3));
        });
      };
      ActionCtrl.prototype.runCollectGnome = function(target, targetPos, newParent) {
        var _this = this;
        return new Promise(function(resolve) {
          var newPosition = target.parent.convertToWorldSpaceAR(target.position);
          var moveTime = .001 * newPosition.sub(targetPos).mag();
          var a0 = cc.delayTime(.5);
          var a1 = cc.spawn(cc.callFunc(function() {
            target.parent = newParent;
            target.setPosition(newParent.convertToNodeSpaceAR(newPosition));
            _this.convetGnomeAnchorPos(target);
          }), cc.scaleTo(.4, target.scale + .2), cc.rotateTo(.3, 0));
          var a2 = cc.rotateTo(.2, 15);
          var a3 = cc.rotateTo(.2, -15);
          var a4 = cc.rotateTo(.2, 0);
          var a5 = cc.spawn(cc.moveTo(moveTime, newParent.convertToNodeSpaceAR(targetPos)), cc.scaleTo(moveTime, .1));
          var a6 = cc.callFunc(resolve);
          target.runAction(cc.sequence(a0, a1, a2, a3, a4, a5, a6));
        });
      };
      ActionCtrl.prototype.convetGnomeAnchorPos = function(gn) {
        var x, y;
        if (0 != gn.angle) {
          x = gn.x + (.5 - gn.anchorX) * gn.height * gn.scaleX;
          y = gn.y - (.5 - gn.anchorY) * (gn.width + 20) * gn.scaleY;
        } else {
          x = gn.x + (.5 - gn.anchorX) * gn.width * gn.scaleX;
          y = gn.y + (.5 - gn.anchorY) * (gn.height + 20) * gn.scaleY;
        }
        gn.setPosition(cc.v2(x, y));
        gn.setAnchorPoint(cc.v2(.5, .5));
        gn.getChildByName("Sprite").setAnchorPoint(cc.v2(.5, .5));
      };
      ActionCtrl.ins = SingletonFactory_1.SingletonFactory.getInstance(ActionCtrl);
      return ActionCtrl;
    }();
    exports.default = ActionCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Utils/SingletonFactory": "SingletonFactory",
    "../../Base/Utils/Util": "Util",
    "../Data/Const/Constant": "Constant",
    "../Data/Const/TimeConfig": "TimeConfig",
    "../Match3/Model/GameModel": "GameModel",
    "./Common": "Common"
  } ],
  AdLogUtil: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "87a74WbzdhLY6E8ygYnS9de", "AdLogUtil");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var AdLogUtil = function() {
      function AdLogUtil() {}
      AdLogUtil.InitLogUtil = function(isOpenGameLog) {
        AdLogUtil.isOpenLg = isOpenGameLog;
      };
      AdLogUtil.Log = function(content) {
        if (!AdLogUtil.isOpenLg) return;
        var log = AdLogUtil.logTag + ":" + content;
        console.log(log);
      };
      AdLogUtil.LogObj = function() {
        var data = [];
        for (var _i = 0; _i < arguments.length; _i++) data[_i] = arguments[_i];
        if (!AdLogUtil.isOpenLg) return;
        console.log(data);
      };
      AdLogUtil.Error = function(content) {
        if (!AdLogUtil.isOpenLg) return;
        var log = AdLogUtil.logTag + ":" + content;
        console.error(log);
      };
      AdLogUtil.isOpenLg = false;
      AdLogUtil.logTag = "SDKWapper";
      return AdLogUtil;
    }();
    exports.AdLogUtil = AdLogUtil;
    cc._RF.pop();
  }, {} ],
  AdManager: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9dd13VL9tNADqN4S0brIYb+", "AdManager");
    "use strict";
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var KSADApi_1 = require("./KSPlatform/KSADApi");
    var AdsIdConfig_1 = require("./AdsIdConfig");
    var AdLogUtil_1 = require("./Util/AdLogUtil");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ResultEnum;
    (function(ResultEnum) {
      ResultEnum[ResultEnum["Success"] = 1] = "Success";
      ResultEnum[ResultEnum["Fail"] = 2] = "Fail";
    })(ResultEnum = exports.ResultEnum || (exports.ResultEnum = {}));
    var AdManager = function() {
      function AdManager() {
        this.platform = AdsIdConfig_1.EPlatform.Close;
        this.platformAdApi = null;
        this.AdCustomBanner_interval = 0;
        this.PassiveVideo_interval = 0;
        this.InsertAd_interval = 0;
        this.CustomAd_interval = 0;
        this.transactionId = 0x8ac5321e93309000;
        this.timingPos = [];
        this.timingInterval = null;
        this.ADNewInterval = [];
        this.ADNewAdAry = [];
        this.CustomType12_interval = [];
        this.ADNewNativeType12_interval = [];
      }
      AdManager_1 = AdManager;
      AdManager.getInstance = function() {
        null == this._adManager && (this._adManager = new AdManager_1());
        return this._adManager;
      };
      AdManager.prototype.onInit = function(_callBack) {
        var _this = this;
        switch (this.platform) {
         case AdsIdConfig_1.EPlatform.KS:
          this.platformAdApi = new KSADApi_1.default();
        }
        AdLogUtil_1.AdLogUtil.Log("current platform: " + this.platform);
        AdsIdConfig_1.default.getAdConfigWeb(function() {
          _this.startLoadAd(_callBack);
        });
      };
      AdManager.prototype.startLoadAd = function(_callBack) {
        if (null != AdsIdConfig_1.default.adConfig) {
          this.platformAdApi.ADNewConfig = [];
          this.setAllAdConfig();
        }
        this.initAdCountData();
        AdLogUtil_1.AdLogUtil.Log("\u83b7\u53d6server\u914d\u7f6e\u6210\u529f!");
        this.platformAdApi.onInit(_callBack);
      };
      AdManager.prototype.setAllAdConfig = function() {
        AdLogUtil_1.AdLogUtil.Log("setAllAdConfig!");
        var ad_Datas = AdsIdConfig_1.default.adConfig.data.positions;
        for (var i = 0; i < ad_Datas.length; i++) if (ad_Datas[i].vendor_position && ad_Datas[i].enabled) if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.Banner) this.platformAdApi.SystemBannerData = ad_Datas[i]; else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u63d2\u5c4f) this.platformAdApi.SystemIntersData = ad_Datas[i]; else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u6fc0\u52b1\u89c6\u9891) this.platformAdApi.VideoData = ad_Datas[i]; else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u539f\u751fBanner) this.platformAdApi.NativeBannerData = ad_Datas[i]; else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u539f\u751f\u63d2\u5c4f) this.platformAdApi.NativeIntersData = ad_Datas[i]; else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u7b56\u7565\u5b9a\u65f6) this.platformAdApi.TIMingData = ad_Datas[i]; else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u4e92\u63a8\u76d2\u5b50\u6a2a\u5e45) this.platformAdApi.BlockData = ad_Datas[i]; else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u539f\u751ficon) AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.VIVO && (this.platformAdApi.ADNewNativeAdData = ad_Datas[i]); else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u4e92\u63a8\u76d2\u5b50) this.platformAdApi.JGGBoxData = ad_Datas[i]; else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u539f\u751f\u6a21\u677f\u6e32\u67d3) 10146027 == ad_Datas[i].position_id && AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.VIVO ? this.platformAdApi.AdCustomTypeData[1] = ad_Datas[i] : 10146028 == ad_Datas[i].position_id && AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.VIVO ? this.platformAdApi.AdCustomTypeData[2] = ad_Datas[i] : 10132781 == ad_Datas[i].position_id && AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.OPPO ? this.platformAdApi.AdCustomTypeData[1] = ad_Datas[i] : 10132782 == ad_Datas[i].position_id && AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.OPPO ? this.platformAdApi.AdCustomTypeData[2] = ad_Datas[i] : AdsIdConfig_1.default.platform != AdsIdConfig_1.EPlatform.VIVO && AdsIdConfig_1.default.platform != AdsIdConfig_1.EPlatform.OPPO || (this.platformAdApi.AdCustomIntersData = ad_Datas[i]); else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u88ab\u52a8\u6fc0\u52b1) 10146023 == ad_Datas[i].position_id && AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.VIVO ? this.platformAdApi.PassiveVideoData = ad_Datas[i] : 10132777 == ad_Datas[i].position_id && AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.OPPO && (this.platformAdApi.PassiveVideoData = ad_Datas[i]); else if (ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u539f\u751f\u81ea\u6e32\u67d3) {
          if (10146025 == ad_Datas[i].position_id) this.platformAdApi.ADNewNativeTypeData[1] = ad_Datas[i]; else if (10146026 == ad_Datas[i].position_id) {
            this.platformAdApi.ADNewNativeTypeData[2] = ad_Datas[i];
            console.log(this.platformAdApi.ADNewNativeTypeData[2]);
            console.log("this.platformAdApi.ADNewNativeTypeData[2]3333333333333333333");
          }
        } else ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u7b56\u7565\u7279\u5f02\u6027\u70b9\u51fb || ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u7b56\u7565\u5176\u4ed6\u70b9\u51fb || ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u7b56\u7565\u8fc7\u5173\u975e\u5c4f\u853d\u5730\u533a || ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u7b56\u7565\u8fc7\u5173\u5c4f\u853d\u5730\u533a || ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95 || ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u7b56\u7565banner || ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u6807\u8bc6\u975e\u5c4f\u853d\u5730\u533a || ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u6837\u5f0f\u539f\u751ficon || ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u6837\u5f0f\u4fe1\u606f\u6d41banner ? this.platformAdApi.ADNewConfig[ad_Datas[i].ad_type] = ad_Datas[i] : ad_Datas[i].ad_type == AdsIdConfig_1.AdType.\u4fe1\u606f\u6d41banner && 10146021 == ad_Datas[i].position_id && AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.VIVO && (this.platformAdApi.AdCustomBannerData = ad_Datas[i]);
        console.log("999999999999999999999999999999999999999");
        console.log(this.platformAdApi.ADNewConfig);
        console.log("999999999999999999999999999999999999999");
      };
      AdManager.prototype.initAdCountData = function() {};
      AdManager.prototype.setGroup = function(group) {
        this.platformAdApi && this.platformAdApi.setGroup(group);
      };
      AdManager.prototype.onLogin = function(_callback) {
        this.platformAdApi && this.platformAdApi.onLogin(_callback);
      };
      AdManager.prototype.onShare = function(_callback) {
        this.platformAdApi && this.platformAdApi.onShare(_callback);
      };
      AdManager.prototype.showBanner = function(playSuccessCall) {
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close) return;
        this.platformAdApi && this.platformAdApi.showBanner(playSuccessCall);
      };
      AdManager.prototype.hideBanner = function() {
        this.platformAdApi && this.platformAdApi.hideBanner();
      };
      AdManager.prototype.showCustomBanner = function(playSuccessCall) {
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close) return;
        if (this.platformAdApi.AdCustomBannerData) {
          var Data = this.platformAdApi.AdCustomBannerData;
          var interval = Data.ad_interval;
          if (0 != interval && interval) {
            var isCanplay = this.getTimeInterval(this.AdCustomBanner_interval, interval, "\u539f\u751f\u6a21\u677fbanner");
            if (false == isCanplay) return;
            this.AdCustomBanner_interval = isCanplay;
          } else ;
        }
        this.platformAdApi && this.platformAdApi.showCustomBanner(playSuccessCall);
      };
      AdManager.prototype.hideCustomBanner = function() {
        this.platformAdApi && this.platformAdApi.hideCustomBanner();
      };
      AdManager.prototype.showVideo = function(_successCallback, isStop) {
        void 0 === isStop && (isStop = true);
        cc.director.pause();
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close) {
          cc.director.resume();
          this.platformAdApi && this.platformAdApi.showVideo(_successCallback);
          return;
        }
        if (cc.sys.isBrowser) {
          console.log("\u6d4f\u89c8\u5668");
          cc.director.resume();
          _successCallback && _successCallback(1);
          return;
        }
        if (!this.platformAdApi) {
          cc.director.resume();
          AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.WX ? _successCallback && _successCallback(1) : _successCallback && _successCallback("999");
          return;
        }
        this.platformAdApi.showVideo(function(_result, code) {
          isStop && cc.director.resume();
          _result ? _successCallback && _successCallback(1) : _successCallback && _successCallback(2, code);
        });
      };
      AdManager.prototype.showPassiveVideo = function(_successCallback, isStop) {
        void 0 === isStop && (isStop = true);
        cc.director.pause();
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close) {
          cc.director.resume();
          this.platformAdApi && this.platformAdApi.showPassiveVideo(_successCallback);
          return;
        }
        if (!this.platformAdApi) {
          cc.director.resume();
          _successCallback && _successCallback(1);
          return;
        }
        if (this.platformAdApi.PassiveVideoData) {
          var Data = this.platformAdApi.PassiveVideoData;
          var interval = Data.ad_interval;
          if (0 != interval && interval) {
            var isCanplay = this.getTimeInterval(this.PassiveVideo_interval, interval, "\u88ab\u52a8\u6fc0\u52b1\u89c6\u9891");
            if (false == isCanplay) return;
            this.PassiveVideo_interval = isCanplay;
          } else ;
        }
        this.platformAdApi.showPassiveVideo(function(_result, code) {
          isStop && cc.director.resume();
          _result ? _successCallback && _successCallback(1) : _successCallback && _successCallback(2, code);
        });
      };
      AdManager.prototype.showInsertAd = function(playSuccessCall) {
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close || !this.platformAdApi) return;
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.VIVO || AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.OPPO) {
          if (this.platformAdApi.SystemIntersData) {
            var Data = this.platformAdApi.SystemIntersData;
            var interval = Data.ad_interval;
            if (0 != interval && interval) {
              if (0 === this.InsertAd_interval) this.InsertAd_interval = Date.now(); else if (0 !== this.InsertAd_interval) {
                var elapsedTime = Date.now() - this.InsertAd_interval;
                var remainingTime = 1e3 * interval - elapsedTime;
                if (remainingTime > 0) return;
                this.InsertAd_interval = Date.now();
              }
            } else ;
          }
          AdManager_1.getInstance().hideCustomAd();
        }
        this.platformAdApi && this.platformAdApi.showInsertAd(playSuccessCall);
      };
      AdManager.prototype.showCustomAd = function() {
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close || !this.platformAdApi) return;
        if ((AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.VIVO || AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.OPPO) && this.platformAdApi.AdCustomIntersData) {
          var Data = this.platformAdApi.AdCustomIntersData;
          var interval = Data.ad_interval;
          if (0 != interval && interval) {
            if (0 === this.CustomAd_interval) this.CustomAd_interval = Date.now(); else if (0 !== this.CustomAd_interval) {
              var elapsedTime = Date.now() - this.CustomAd_interval;
              var remainingTime = 1e3 * interval - elapsedTime;
              if (remainingTime > 0) return;
              this.CustomAd_interval = Date.now();
            }
          } else ;
        }
        this.platformAdApi && this.platformAdApi.showCustomAd();
      };
      AdManager.prototype.hideCustomAd = function() {
        this.platformAdApi && this.platformAdApi.hideCustomAd();
      };
      AdManager.prototype.ShowGameIconAd = function() {
        if (AdsIdConfig_1.default.platform !== AdsIdConfig_1.EPlatform.WX || !this.platformAdApi) return;
        this.platformAdApi && this.platformAdApi.ShowGameIconAd();
      };
      AdManager.prototype.HideGameIconAd = function() {
        this.platformAdApi && this.platformAdApi.HideGameIconAd();
      };
      AdManager.prototype.showNativeImageAd = function() {
        return this.platformAdApi.getNativeAdInfo(0);
      };
      AdManager.prototype.showXMNativeImageAd = function(_infoCallback) {
        return this.platformAdApi.getNativeAdInfo(_infoCallback);
      };
      AdManager.prototype.showHWNativeImageAd = function(_infoCallback) {
        return this.platformAdApi.getHWNativeAdInfo(_infoCallback);
      };
      AdManager.prototype.onNativeAdClick = function(_id) {
        this.platformAdApi && this.platformAdApi.reportNativeImageClick(_id);
      };
      AdManager.prototype.onNativeReportAdShow = function(_id) {
        this.platformAdApi && this.platformAdApi.reportNativeImageShow(_id);
      };
      AdManager.prototype.loadNativeImage = function() {
        this.platformAdApi && this.platformAdApi.loadNativeImage();
      };
      AdManager.prototype.showNativeIconAd = function() {
        return this.platformAdApi.getNativeIconAdInfo(0);
      };
      AdManager.prototype.reportNativeIconClick = function(_id) {
        this.platformAdApi && this.platformAdApi.reportNativeIconClick(_id);
      };
      AdManager.prototype.reportNativeIconShow = function(_id) {
        this.platformAdApi && this.platformAdApi.reportNativeIconShow(_id);
      };
      AdManager.prototype.loadNativeIcon = function() {
        this.platformAdApi && this.platformAdApi.loadNativeIcon();
      };
      AdManager.prototype.showNavigateBoxPortal = function() {
        this.platformAdApi && this.platformAdApi.showNavigateBoxPortal();
      };
      AdManager.prototype.showNavigateBoxBanner = function() {
        this.platformAdApi && this.platformAdApi.showNavigateBoxBanner();
      };
      AdManager.prototype.hideNavigateBoxBanner = function() {
        this.platformAdApi && this.platformAdApi.hideNavigateBoxBanner();
      };
      AdManager.prototype.addDesktop = function(_callback) {
        console.log("addDesktop");
        this.platformAdApi && this.platformAdApi.addDesktop(_callback);
      };
      AdManager.prototype.hasShortcutInstalled = function(_callback) {
        this.platformAdApi && this.platformAdApi.hasShortcutInstalled(function(_result) {
          _callback(_result ? ResultEnum.Success : ResultEnum.Fail);
        });
      };
      AdManager.prototype.ShareVideo = function(_title, templateId, _callback) {
        this.platformAdApi && this.platformAdApi.ShareVideo(_title, templateId, _callback);
      };
      AdManager.prototype.StartRecorder = function(_duration) {
        void 0 === _duration && (_duration = 300);
        this.platformAdApi && this.platformAdApi.StartRecorder(_duration);
      };
      AdManager.prototype.recordClipRecorder = function(data) {
        this.platformAdApi && this.platformAdApi.recordClipRecorder(data);
      };
      AdManager.prototype.pauseGameVideo = function() {
        this.platformAdApi && this.platformAdApi.pauseGameVideo();
      };
      AdManager.prototype.resumeGameVideo = function() {
        this.platformAdApi && this.platformAdApi.resumeGameVideo();
      };
      AdManager.prototype.stopRecordScreen = function() {
        this.platformAdApi && this.platformAdApi.stopRecordScreen();
      };
      AdManager.prototype.createMoreGamesBtn = function() {
        this.platformAdApi && this.platformAdApi.createMoreGamesBtn();
      };
      AdManager.prototype.showMoreGamesBtn = function() {
        this.platformAdApi && this.platformAdApi.showMoreGamesBtn();
      };
      AdManager.prototype.jumpToGame = function(_packageName) {
        this.platformAdApi && this.platformAdApi.jumpToGame(_packageName);
      };
      AdManager.prototype.addColorBookmark = function(_callback) {
        this.platformAdApi && this.platformAdApi.addColorBookmark(_callback);
      };
      AdManager.prototype.addSubscribeApp = function(_callback) {
        this.platformAdApi && this.platformAdApi.addSubscribeApp(_callback);
      };
      AdManager.prototype.phoneVibrate = function(isLong) {
        console.log("zzzzz\u9707\u52a8 " + isLong);
        this.platformAdApi && this.platformAdApi.phoneVibrate(isLong);
      };
      AdManager.prototype.exitApplication = function() {
        switch (AdsIdConfig_1.default.platform) {
         case AdsIdConfig_1.EPlatform.VIVO:
         case AdsIdConfig_1.EPlatform.OPPO:
          qg.exitApplication({});
          break;

         case AdsIdConfig_1.EPlatform.HUAWEI:
          hbs.exitApplication({});
          break;

         case AdsIdConfig_1.EPlatform.WX:
          wx.exitMiniProgram({});
          break;

         case AdsIdConfig_1.EPlatform.KS:
          wx.exitMiniProgram();
          break;

         case AdsIdConfig_1.EPlatform.TikTok:
          tt.exitMiniProgram({
            success: function(res) {
              console.log("\u8c03\u7528\u6210\u529f");
            },
            fail: function(res) {
              console.log("\u8c03\u7528\u5931\u8d25");
            }
          });
        }
      };
      AdManager.prototype.submitPlayerEvent = function(type) {
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.HUAWEI) {
          var eventId = this.transactionId;
          var eventType_1 = "GAMEBEGIN";
          type || (eventType_1 = "GAMEEND");
          qg.submitPlayerEvent({
            eventId: eventId,
            eventType: eventType_1,
            success: function(res) {
              if ("GAMEBEGIN" == eventType_1) {
                console.log("\u63d0\u4ea4\u73a9\u5bb6\u4fe1\u606f\u6210\u529f,transactionId ===> ", res.transactionId);
                AdManager_1.getInstance().transactionId = res.transactionId;
              }
            }.bind(this),
            fail: function(data, code) {
              console.log("hide float window fail:" + data + ", code:" + code);
            }
          });
        }
      };
      AdManager.prototype.reportAnalytics = function(name, value) {
        this.platformAdApi && this.platformAdApi.reportAnalytics(name, value);
      };
      AdManager.prototype.showGameClubBtn = function() {
        AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.WX && window["wx"];
      };
      AdManager.prototype.hideGameClubBtn = function() {
        this.gameClubBtn && this.gameClubBtn.hide();
      };
      AdManager.prototype.SDKYM = function(event, obj) {
        switch (AdsIdConfig_1.default.platform) {
         case AdsIdConfig_1.EPlatform.VIVO:
          break;

         case AdsIdConfig_1.EPlatform.OPPO:
         case AdsIdConfig_1.EPlatform.HUAWEI:
          qg.uma.trackEvent(event, obj);
          break;

         case AdsIdConfig_1.EPlatform.WX:
         case AdsIdConfig_1.EPlatform.KS:
         case AdsIdConfig_1.EPlatform.TikTok:
        }
      };
      AdManager.prototype.clearTiming = function() {
        if (this.timingInterval) {
          AdLogUtil_1.AdLogUtil.Log("\u505c\u6b62\u64ad\u653e\u5b9a\u65f6\u5e7f\u544a\uff01\uff01\uff01 ");
          clearInterval(this.timingInterval);
        }
      };
      AdManager.prototype.timing = function() {
        var _this = this;
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.VIVO || AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.OPPO) {
          if (!this.platformAdApi || !this.platformAdApi.TIMingData) return;
          var Data = this.platformAdApi.TIMingData;
          var type_1 = Data.vendor_position;
          var interval = Data.ad_interval;
          if (!type_1 || 0 == interval || !interval) {
            console.log("timing 666   " + interval);
            return;
          }
          console.log("timing 333    " + interval);
          this.timingInterval = setInterval(function() {
            console.log("type 333    " + type_1);
            _this.timingPos && 0 != _this.timingPos.length || (_this.timingPos = AdsIdConfig_1.default.stringGetAD(type_1));
            var firstValue = _this.timingPos.shift();
            console.log("\u64ad\u653e  \u5b9a\u65f6\u5e7f\u544a\u5566\uff01\uff01\uff01 " + firstValue);
            _this.playTypeAd(firstValue, AdsIdConfig_1.AdType.\u7b56\u7565\u5b9a\u65f6);
          }, 1e3 * interval);
        }
      };
      AdManager.prototype.navigateToScene = function(_succeedcallback, _failcallback) {
        this.platformAdApi && this.platformAdApi.navigateToScene(_succeedcallback, _failcallback);
      };
      AdManager.prototype.Share = function(_succeedcallback, _failcallback) {
        this.platformAdApi && this.platformAdApi.Share(_succeedcallback, _failcallback);
      };
      AdManager.prototype.showNewNativeAd = function() {
        this.platformAdApi && this.platformAdApi.showNewNativeAd();
      };
      AdManager.prototype.hideNewNativeAd = function() {
        this.platformAdApi && this.platformAdApi.hideNewNativeAd();
      };
      AdManager.prototype.playNewAd = function(type) {
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close || !this.platformAdApi) return;
        if (this.playAbnormalAD()) ; else if (type != AdsIdConfig_1.AdType.\u7b56\u7565\u8fc7\u5173\u5c4f\u853d\u5730\u533a) {
          AdLogUtil_1.AdLogUtil.Log(".......................\u5c4f\u853d\u5730\u533a\u4e0d\u80fd\u6709\u7c7b\u578b\uff1a......................." + type);
          return;
        }
        AdLogUtil_1.AdLogUtil.Log(JSON.stringify(this.platformAdApi.ADNewConfig[type]));
        AdLogUtil_1.AdLogUtil.Log(" ........................................\u64ad\u653e  " + type);
        switch (type) {
         case AdsIdConfig_1.AdType.\u7b56\u7565banner:
         case AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95:
         case AdsIdConfig_1.AdType.\u7b56\u7565\u7279\u5f02\u6027\u70b9\u51fb:
         case AdsIdConfig_1.AdType.\u7b56\u7565\u5176\u4ed6\u70b9\u51fb:
         case AdsIdConfig_1.AdType.\u7b56\u7565\u8fc7\u5173\u975e\u5c4f\u853d\u5730\u533a:
         case AdsIdConfig_1.AdType.\u7b56\u7565\u8fc7\u5173\u5c4f\u853d\u5730\u533a:
          var data = this.platformAdApi.ADNewConfig[type];
          var temp = type;
          if (data) {
            var interval = data.ad_interval;
            if (0 != interval && interval) if (this.ADNewInterval[temp] && 0 != this.ADNewInterval[temp]) {
              if (0 != this.ADNewInterval[temp]) {
                var elapsedTime = Date.now() - this.ADNewInterval[temp];
                var remainingTime = 1e3 * interval - elapsedTime;
                if (remainingTime > 0) {
                  AdLogUtil_1.AdLogUtil.Log(data.ad_type + " \u7c7b\u578b  \u8fd8\u6ca1\u8fbe\u5230\u9650\u5236\u7684\u95f4\u9694\u65f6\u95f4 \u8fd8\u5269  " + remainingTime);
                  return;
                }
                this.ADNewInterval[temp] = Date.now();
                if ("" == data.vendor_position) {
                  AdLogUtil_1.AdLogUtil.Log("\u672a\u914d\u7f6e  \u7c7b\u578b\u662f  " + data.ad_type);
                  return;
                }
              }
            } else this.ADNewInterval[temp] = Date.now(); else ;
            if (!this.ADNewAdAry[temp] || 0 == this.ADNewAdAry[temp].length) {
              AdLogUtil_1.AdLogUtil.Log("data.vendor_position  " + data.vendor_position);
              this.ADNewAdAry[temp] = AdsIdConfig_1.default.stringGetAD(data.vendor_position);
            }
            var firstValue = this.ADNewAdAry[temp].shift();
            console.log("\u64ad\u653e  " + firstValue);
            this.playTypeAd(firstValue, type);
          }
          break;

         case AdsIdConfig_1.AdType.\u6837\u5f0f\u539f\u751ficon:
         case AdsIdConfig_1.AdType.\u6837\u5f0f\u4fe1\u606f\u6d41banner:
          break;

         default:
          console.log("\u6ca1\u6709\u5339\u914d\u5230\u5f53\u524d\u7c7b\u578b \uff1a " + type);
          AdLogUtil_1.AdLogUtil.Log("\u6ca1\u6709\u5339\u914d\u5230\u5f53\u524d\u7c7b\u578b \uff1a " + type);
        }
      };
      AdManager.prototype.playAbnormalAD = function() {
        if (this.platformAdApi && this.platformAdApi.ADNewConfig[AdsIdConfig_1.AdType.\u6807\u8bc6\u975e\u5c4f\u853d\u5730\u533a]) {
          AdLogUtil_1.AdLogUtil.Log("\u975e\u5c4f\u853d\u5730\u533a");
          return true;
        }
        AdLogUtil_1.AdLogUtil.Log("\u5c4f\u853d\u5730\u533a");
        return false;
      };
      AdManager.prototype.playTypeAd = function(strKey, type) {
        if (strKey.includes("+")) {
          var arr = strKey.split("+");
          this.playNumAD(arr, type);
        } else this.playAd(strKey, type);
      };
      AdManager.prototype.playNumAD = function(arr, type) {
        var Value = arr.shift();
        this.playAd(Value, type);
        arr.length > 0 && this.playNumAD(arr, type);
      };
      AdManager.prototype.playAd = function(strKey, type) {
        var _this = this;
        AdLogUtil_1.AdLogUtil.Log("\u64ad\u653e:  XXXXX  " + strKey);
        var playdoudi = true;
        if (type && AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95 == type) {
          AdLogUtil_1.AdLogUtil.Log("\u64ad\u653e:  \u7b56\u7565\u515c\u5e95  ");
          playdoudi = false;
        }
        switch (strKey) {
         case "n":
          this.showCustomType12(2, function(isSucceed) {
            isSucceed || playdoudi && _this.playNewAd(AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95);
          });
          break;

         case "m":
          this.showCustomType12(1, function(isSucceed) {
            isSucceed || playdoudi && _this.playNewAd(AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95);
          });
          break;

         case "t":
          this.showADNewNativeType12(2, function(isSucceed) {
            isSucceed || playdoudi && _this.playNewAd(AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95);
          });
          break;

         case "s":
          this.showADNewNativeType12(1, function(isSucceed) {
            isSucceed || playdoudi && _this.playNewAd(AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95);
          });
          break;

         case "c":
          this.showInsertAd(function(isSucceed) {
            isSucceed || playdoudi && _this.playNewAd(AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95);
          });
          break;

         case "j":
          this.showPassiveVideo(function(isSucceed, code) {
            isSucceed && 1 === isSucceed || code && playdoudi && _this.playNewAd(AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95);
          });
          break;

         case "h":
          this.showCustomBanner(function(isSucceed) {
            isSucceed || playdoudi && _this.playNewAd(AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95);
          });
          break;

         case "b":
          this.showBanner(function(isSucceed) {
            isSucceed || playdoudi && _this.playNewAd(AdsIdConfig_1.AdType.\u7b56\u7565\u515c\u5e95);
          });
          break;

         default:
          console.log("\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55 case \u7c7b\u578b\u7684\u60c5\u51b5");
          AdLogUtil_1.AdLogUtil.Log("\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55 case \u7c7b\u578b\u7684\u60c5\u51b5");
        }
      };
      AdManager.prototype.closeAd = function(strKey, type) {};
      AdManager.prototype.showCustomType12 = function(type, playSuccessCall) {
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close || !this.platformAdApi) return;
        if (this.platformAdApi.AdCustomTypeData && this.platformAdApi.AdCustomTypeData[type]) {
          var Data = this.platformAdApi.AdCustomTypeData[type];
          var interval = Data.ad_interval;
          if (0 != interval && interval) {
            var isCanplay = this.getTimeInterval(this.CustomType12_interval[type], interval, "\u539f\u751f\u6a21\u677f\u6e32\u67d3" + type);
            if (false == isCanplay) return;
            this.CustomType12_interval[type] = isCanplay;
          } else ;
        }
        this.platformAdApi && this.platformAdApi.showCustomType12(type, playSuccessCall);
      };
      AdManager.prototype.showADNewNativeType12 = function(type, playSuccessCall) {
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.Close || !this.platformAdApi) return;
        if (this.platformAdApi.ADNewNativeTypeData && this.platformAdApi.ADNewNativeTypeData[type]) {
          var Data = this.platformAdApi.ADNewNativeTypeData[type];
          var interval = 10;
          if (0 != interval && interval) {
            var isCanplay = this.getTimeInterval(this.ADNewNativeType12_interval[type], interval, "\u539f\u751f\u81ea\u6e32\u67d3" + type);
            if (false == isCanplay) return;
            this.ADNewNativeType12_interval[type] = isCanplay;
          } else ;
        }
        this.platformAdApi && this.platformAdApi.showADNewNativeType12(type, playSuccessCall);
      };
      AdManager.prototype.getTimeInterval = function(objNum, interval, type) {
        var time = Date.now();
        if (!objNum || 0 === objNum) return time;
        if (0 !== objNum) {
          var elapsedTime = Date.now() - objNum;
          var remainingTime = 1e3 * interval - elapsedTime;
          if (remainingTime > 0) {
            console.log(type + "  \u8fd8\u6ca1\u8fbe\u5230\u9650\u5236\u7684\u95f4\u9694\u65f6\u95f4  " + remainingTime / 1e3);
            AdLogUtil_1.AdLogUtil.Log(type + "  \u8fd8\u6ca1\u8fbe\u5230\u9650\u5236\u7684\u95f4\u9694\u65f6\u95f4  " + remainingTime / 1e3);
            return false;
          }
          objNum = Date.now();
          return time;
        }
      };
      var AdManager_1;
      AdManager._adManager = null;
      AdManager = AdManager_1 = __decorate([ ccclass ], AdManager);
      return AdManager;
    }();
    exports.default = AdManager;
    exports.ADEvent = {
      First_Start_Game: "First_Start_Game",
      First_Start_Level: "First_Enter_Level",
      Enter_Level: "Level",
      Game_Time: "Time_Analytics",
      Video: "ADAnalytics"
    };
    exports.ADVideoEvent = {
      Video_Tip: "Video_Tip",
      Video_yanshi: "Video_yanshi",
      Video_Jump: "Video_Jump",
      Video_unlock: "Video_unlock",
      Video_unlockAll: "Video_unlockAll"
    };
    exports.ADVideoState = {
      video_Click: "video_Click",
      video_Success: "video_Success",
      video_Fail: "video_Fail"
    };
    cc._RF.pop();
  }, {
    "./AdsIdConfig": "AdsIdConfig",
    "./KSPlatform/KSADApi": "KSADApi",
    "./Util/AdLogUtil": "AdLogUtil"
  } ],
  AdsIdConfig: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b0ba5pcSFhGs7LIG7l4b4lh", "AdsIdConfig");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var AdManager_1 = require("./AdManager");
    var EPlatform;
    (function(EPlatform) {
      EPlatform[EPlatform["test"] = 0] = "test";
      EPlatform[EPlatform["VIVO"] = 10007207] = "VIVO";
      EPlatform[EPlatform["OPPO"] = 10006750] = "OPPO";
      EPlatform[EPlatform["TikTok"] = 10006744] = "TikTok";
      EPlatform[EPlatform["QQ"] = 4] = "QQ";
      EPlatform[EPlatform["WX"] = 10007467] = "WX";
      EPlatform[EPlatform["KS"] = 10007737] = "KS";
      EPlatform[EPlatform["HUAWEI"] = 10002722] = "HUAWEI";
      EPlatform[EPlatform["XiaoMi"] = 10003494] = "XiaoMi";
      EPlatform[EPlatform["UC"] = 1] = "UC";
      EPlatform[EPlatform["Close"] = 2] = "Close";
      EPlatform[EPlatform["Android"] = 88888] = "Android";
    })(EPlatform = exports.EPlatform || (exports.EPlatform = {}));
    var AdType;
    (function(AdType) {
      AdType[AdType["\u5f00\u5c4f"] = 1] = "\u5f00\u5c4f";
      AdType[AdType["Banner"] = 2] = "Banner";
      AdType[AdType["\u63d2\u5c4f"] = 3] = "\u63d2\u5c4f";
      AdType[AdType["\u6fc0\u52b1\u89c6\u9891"] = 4] = "\u6fc0\u52b1\u89c6\u9891";
      AdType[AdType["\u5168\u5c4f\u89c6\u9891"] = 5] = "\u5168\u5c4f\u89c6\u9891";
      AdType[AdType["\u539f\u751f\u63d2\u5c4f"] = 12] = "\u539f\u751f\u63d2\u5c4f";
      AdType[AdType["\u6d6e\u6807"] = 13] = "\u6d6e\u6807";
      AdType[AdType["\u539f\u751fBanner"] = 14] = "\u539f\u751fBanner";
      AdType[AdType["\u539f\u751f\u5f00\u5c4f"] = 24] = "\u539f\u751f\u5f00\u5c4f";
      AdType[AdType["\u539f\u751f\u6a21\u677f"] = 25] = "\u539f\u751f\u6a21\u677f";
      AdType[AdType["\u88ab\u52a8\u6fc0\u52b1"] = 44] = "\u88ab\u52a8\u6fc0\u52b1";
      AdType[AdType["\u4e92\u63a8\u76d2\u5b50\u6a2a\u5e45"] = 83] = "\u4e92\u63a8\u76d2\u5b50\u6a2a\u5e45";
      AdType[AdType["\u4e2d\u53f0\u6e38\u620f\u5bc6\u94a5"] = 81] = "\u4e2d\u53f0\u6e38\u620f\u5bc6\u94a5";
      AdType[AdType["\u4e2d\u53f0\u6e38\u620fCODE"] = 80] = "\u4e2d\u53f0\u6e38\u620fCODE";
      AdType[AdType["\u5e73\u53f0\u6570\u636e\u6e90ID"] = 82] = "\u5e73\u53f0\u6570\u636e\u6e90ID";
      AdType[AdType["\u6837\u5f0f\u539f\u751ficon"] = 79] = "\u6837\u5f0f\u539f\u751ficon";
      AdType[AdType["\u6837\u5f0f\u4fe1\u606f\u6d41banner"] = 77] = "\u6837\u5f0f\u4fe1\u606f\u6d41banner";
      AdType[AdType["\u7b56\u7565banner"] = 78] = "\u7b56\u7565banner";
      AdType[AdType["\u7b56\u7565\u515c\u5e95"] = 75] = "\u7b56\u7565\u515c\u5e95";
      AdType[AdType["\u7b56\u7565\u7279\u5f02\u6027\u70b9\u51fb"] = 68] = "\u7b56\u7565\u7279\u5f02\u6027\u70b9\u51fb";
      AdType[AdType["\u7b56\u7565\u5176\u4ed6\u70b9\u51fb"] = 67] = "\u7b56\u7565\u5176\u4ed6\u70b9\u51fb";
      AdType[AdType["\u7b56\u7565\u5b9a\u65f6"] = 74] = "\u7b56\u7565\u5b9a\u65f6";
      AdType[AdType["\u7b56\u7565\u8fc7\u5173\u975e\u5c4f\u853d\u5730\u533a"] = 66] = "\u7b56\u7565\u8fc7\u5173\u975e\u5c4f\u853d\u5730\u533a";
      AdType[AdType["\u7b56\u7565\u8fc7\u5173\u5c4f\u853d\u5730\u533a"] = 73] = "\u7b56\u7565\u8fc7\u5173\u5c4f\u853d\u5730\u533a";
      AdType[AdType["\u6807\u8bc6\u975e\u5c4f\u853d\u5730\u533a"] = 72] = "\u6807\u8bc6\u975e\u5c4f\u853d\u5730\u533a";
      AdType[AdType["\u4e92\u63a8\u76d2\u5b50"] = 60] = "\u4e92\u63a8\u76d2\u5b50";
      AdType[AdType["\u539f\u751ficon"] = 76] = "\u539f\u751ficon";
      AdType[AdType["\u539f\u751f\u6a21\u677f\u6e32\u67d3"] = 62] = "\u539f\u751f\u6a21\u677f\u6e32\u67d3";
      AdType[AdType["\u539f\u751f\u81ea\u6e32\u67d3"] = 59] = "\u539f\u751f\u81ea\u6e32\u67d3";
      AdType[AdType["\u4fe1\u606f\u6d41banner"] = 49] = "\u4fe1\u606f\u6d41banner";
    })(AdType = exports.AdType || (exports.AdType = {}));
    var AdsIdConfig = function() {
      function AdsIdConfig() {}
      Object.defineProperty(AdsIdConfig, "platform", {
        get: function() {
          return this._platform;
        },
        set: function(v) {
          this._platform = v;
        },
        enumerable: true,
        configurable: true
      });
      AdsIdConfig.getAdConfigWeb = function(callback) {
        AdsIdConfig.platform == EPlatform.test || AdsIdConfig.platform == EPlatform.Close ? AdsIdConfig.serverRootUrl += "10005842" : AdsIdConfig.serverRootUrl += AdsIdConfig.platform;
        this.httpCall({
          url: AdsIdConfig.serverRootUrl,
          callback: callback
        });
      };
      AdsIdConfig.httpCall = function(data) {
        return __awaiter(this, void 0, void 0, function() {
          var ADData;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              return [ 4, AdsIdConfig.httpSend({
                url: data.url
              }) ];

             case 1:
              ADData = _a.sent();
              console.log("ad====>", ADData);
              AdsIdConfig.adConfig = ADData;
              data.callback && data.callback();
              return [ 2 ];
            }
          });
        });
      };
      AdsIdConfig.httpSend = function(options) {
        return new Promise(function(resolve, reject) {
          var xhr = new XMLHttpRequest();
          xhr.onreadystatechange = function() {
            if (4 === xhr.readyState && xhr.status >= 200 && xhr.status < 300) {
              var res = JSON.parse(xhr.responseText);
              resolve(res);
            }
          };
          xhr.timeout = options.timeout || 5e4;
          var method = options.method || "GET";
          var url = options.url;
          options.data = options.data || {};
          if ("get" == method || "GET" == method) {
            console.log("url===>", url);
            xhr.open(method, url, true);
            xhr.send();
          } else {
            xhr.open(method, options.url, true);
            xhr.setRequestHeader("Content-type", "application/json;charset=utf-8");
            xhr.send(JSON.stringify(options.data));
          }
        });
      };
      AdsIdConfig.stringHasSpace = function(str) {
        if (null == str) return true;
        var num = str.indexOf(" ");
        return -1 != num;
      };
      AdsIdConfig.stringGetAD = function(str) {
        var myStr = str;
        var result = [];
        str.includes(" ") && (myStr = str.replace(/\s/g, ""));
        if (myStr.includes("|")) {
          var arr = myStr.split("|");
          result = this.expandArray(arr);
        } else result = this.expandArray([ myStr ]);
        return result;
      };
      AdsIdConfig.expandArray = function(arr) {
        var expandedArr = [];
        arr.forEach(function(item) {
          var _a = item.split(/(?=\d)/), str = _a[0], count = _a[1];
          count && void 0 != count || (count = "1");
          var num = parseInt(count, 10);
          for (var i = 0; i < num; i++) expandedArr.push(str);
        });
        return expandedArr;
      };
      AdsIdConfig.getVendor_posAry = function(str) {
        var _a;
        var myStr = str;
        var result = [];
        str.includes(" ") && (myStr = str.replace(/\s/g, ""));
        if (myStr.includes(",")) {
          var arr = myStr.split(",");
          for (var i = arr.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            _a = [ arr[j], arr[i] ], arr[i] = _a[0], arr[j] = _a[1];
          }
          result = arr;
        } else result = [ myStr ];
        return result;
      };
      AdsIdConfig.gePosAndWidthCfg = function(cfgStr, width, height, kindWHAry) {
        var config = cfgStr;
        var pAdApi = AdManager_1.default.getInstance().platformAdApi;
        if (!pAdApi) {
          console.log("pt\u5e73\u53f0\u4e0d\u5b58\u5728");
          return;
        }
        var arr = [];
        config.includes("|") && (arr = config.split("|"));
        if (5 != arr.length) {
          console.log("\u914d\u7f6e \u4e0d\u6b63\u786e");
          return;
        }
        var leftRight = 0;
        var topBottom = 0;
        arr && arr[3] && (leftRight = Number(arr[3]));
        arr && arr[4] && (topBottom = Number(arr[4]));
        var widthNum = 0;
        var heightNum = 0;
        if (arr && arr[1]) {
          widthNum = Number(arr[1]) / 100 * width;
          widthNum -= leftRight;
        }
        if (!(kindWHAry[0] && kindWHAry[1] && kindWHAry[2] && kindWHAry[3])) {
          console.log("\u914d\u7f6e \u4e0d\u5b58\u5728");
          return;
        }
        if (widthNum < kindWHAry[0] || widthNum > kindWHAry[1]) {
          console.error("\u914d\u7f6e \u4e0d\u5728\u8303\u56f4\u5185   \u6309\u9ed8\u8ba4\u663e\u793a\u4e86 widthNum:" + widthNum);
          console.error(kindWHAry[0] + "  \u914d\u7f6e:  " + kindWHAry[1]);
          widthNum = kindWHAry[2];
          heightNum = kindWHAry[3];
        } else heightNum = widthNum / (kindWHAry[2] / kindWHAry[3]);
        console.log(width);
        console.log("widthNum==================================================height\uff1a" + height);
        console.log(widthNum);
        console.log(heightNum);
        var leftN = 0;
        var topN = 0;
        var styleMy = {};
        if (arr && arr[0]) switch (arr[0]) {
         case "A":
         case "a":
          styleMy = {
            left: leftRight,
            top: topBottom,
            width: widthNum
          };
          break;

         case "B":
         case "b":
          styleMy = {
            top: topBottom,
            width: widthNum,
            gravity: "center"
          };
          break;

         case "C":
         case "c":
          styleMy = {
            left: width - leftRight - widthNum,
            top: topBottom,
            width: widthNum
          };
          break;

         case "D":
         case "d":
          styleMy = {
            left: leftRight,
            top: height - topBottom - heightNum,
            width: widthNum
          };
          break;

         case "E":
         case "e":
          styleMy = {
            top: height - topBottom - heightNum,
            width: widthNum,
            gravity: "center"
          };
          break;

         case "F":
         case "f":
          styleMy = {
            left: width - leftRight - widthNum,
            top: height - topBottom - heightNum,
            width: widthNum
          };
        }
        return styleMy;
      };
      AdsIdConfig.serverRootUrl = "https://api.iweisesz.com/api/client/mini?pid=";
      AdsIdConfig.adConfig = null;
      return AdsIdConfig;
    }();
    exports.default = AdsIdConfig;
    cc._RF.pop();
  }, {
    "./AdManager": "AdManager"
  } ],
  Apps: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b8271REATBDrqYiVEv4BxE0", "Apps");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Util_1 = require("./Utils/Util");
    var Apps = function() {
      function Apps() {}
      Apps.Version = "1.0.2";
      Apps.country = "cn";
      Apps.isEncode = false;
      Apps.isDebug = !Util_1.Util.Tool.isWechatGame();
      Apps.isLog = true;
      Apps.isOpenNet = true;
      Apps.isOpenGM = true;
      return Apps;
    }();
    exports.default = Apps;
    cc._RF.pop();
  }, {
    "./Utils/Util": "Util"
  } ],
  AudioCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "4ec03k12YxAbZFH3kjlD1Zo", "AudioCtrl");
    "use strict";
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../Base/Manager/EventMgr");
    var Event_1 = require("../Data/Const/Event");
    var Paths_1 = require("../../Base/Utils/Paths");
    var Constant_1 = require("../Data/Const/Constant");
    var StorageMgr_1 = require("../../Base/Manager/StorageMgr");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var AudioID;
    (function(AudioID) {
      AudioID[AudioID["BGM1"] = 100] = "BGM1";
      AudioID[AudioID["Click1"] = 101] = "Click1";
      AudioID[AudioID["Elimate"] = 102] = "Elimate";
      AudioID[AudioID["BGM2"] = 103] = "BGM2";
      AudioID[AudioID["GameWin"] = 104] = "GameWin";
      AudioID[AudioID["GameFail"] = 105] = "GameFail";
      AudioID[AudioID["GameShowTarget"] = 106] = "GameShowTarget";
      AudioID[AudioID["Octopus"] = 107] = "Octopus";
      AudioID[AudioID["AddThree"] = 108] = "AddThree";
      AudioID[AudioID["Hammer"] = 109] = "Hammer";
      AudioID[AudioID["Reset"] = 110] = "Reset";
      AudioID[AudioID["OpenBox"] = 111] = "OpenBox";
      AudioID[AudioID["CellFall"] = 112] = "CellFall";
      AudioID[AudioID["Bomb"] = 113] = "Bomb";
      AudioID[AudioID["GetStar"] = 114] = "GetStar";
      AudioID[AudioID["StartGame"] = 115] = "StartGame";
      AudioID[AudioID["partytime_shoot"] = 116] = "partytime_shoot";
      AudioID[AudioID["partytime_change"] = 117] = "partytime_change";
      AudioID[AudioID["merge_boom"] = 118] = "merge_boom";
    })(AudioID = exports.AudioID || (exports.AudioID = {}));
    var AudioCtrl = function() {
      function AudioCtrl() {
        this._isPauseMusic = false;
        this._playingId = 0;
        this.opt = null;
        var soundNode = new cc.Node("sound");
        cc.game.addPersistRootNode(soundNode);
        this.registerEvent();
        this.opt = StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.Sound, {
          eff: true,
          bgm: true
        });
        this.syncOpt2Native();
      }
      AudioCtrl_1 = AudioCtrl;
      Object.defineProperty(AudioCtrl, "ins", {
        get: function() {
          null == this.instance && (this.instance = new AudioCtrl_1());
          return this.instance;
        },
        enumerable: true,
        configurable: true
      });
      AudioCtrl.prototype.registerEvent = function() {
        EventMgr_1.default.ins.register(Event_1.Event.Sound.PlaySoundEff, this.onPlayEff, this);
        EventMgr_1.default.ins.register(Event_1.Event.Sound.PlayBGM, this.onPlayBGM, this);
        EventMgr_1.default.ins.register(Event_1.Event.Sound.StopBGM, this.onStopBGM, this);
        EventMgr_1.default.ins.register(Event_1.Event.Sound.UpdateOpt, this.onUpdateOpt, this);
      };
      AudioCtrl.prototype.unRegisterEvent = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Sound.PlaySoundEff, this.onPlayEff, this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.Sound.PlayBGM, this.onPlayBGM, this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.Sound.StopBGM, this.onStopBGM, this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.Sound.UpdateOpt, this.onUpdateOpt, this);
      };
      AudioCtrl.prototype.syncOpt2Native = function() {
        StorageMgr_1.StorageMgr.Storage.setObject(Constant_1.NativeKey.Sound, this.opt);
      };
      AudioCtrl.prototype.onUpdateOpt = function(type, opt) {
        this.opt[type] = opt;
        "bgm" == type && !cc.audioEngine.isMusicPlaying() && this._playingId && this.onPlayBGM();
        this.syncOpt2Native();
      };
      AudioCtrl.prototype.onPlayEff = function(id) {
        this.opt.eff && this.play(id);
      };
      AudioCtrl.prototype.onPlayBGM = function(id) {
        void 0 === id && (id = null);
        if (this.opt.bgm) if (!this._isPauseMusic || null != id && this._playingId != id) {
          if (!cc.audioEngine.isMusicPlaying() || this._playingId != id) {
            this._playingId != id && this.onStopBGM();
            this.play(id || AudioID.BGM1, true);
            this._playingId = id;
          }
        } else this.onResumeMusic(); else this.onPauseBGM();
      };
      AudioCtrl.prototype.onResumeMusic = function() {
        if (this._playingId) {
          this._isPauseMusic = false;
          cc.audioEngine.resumeMusic();
        }
      };
      AudioCtrl.prototype.onPauseBGM = function() {
        if (!this._isPauseMusic) {
          this._isPauseMusic = true;
          cc.audioEngine.pauseMusic();
        }
      };
      AudioCtrl.prototype.onStopBGM = function() {
        cc.audioEngine.stopAll();
      };
      AudioCtrl.prototype.getAudioPathById = function(id) {
        var name = null;
        switch (id) {
         case AudioID.BGM1:
          name = "bgm1";
          break;

         case AudioID.BGM2:
          name = "bgm2";
          break;

         case AudioID.Click1:
          name = "click";
          break;

         case AudioID.GameWin:
          name = "game_win";
          break;

         case AudioID.GameFail:
          name = "game_fail";
          break;

         case AudioID.GameShowTarget:
          name = "dlg_gamestart";
          break;

         case AudioID.Octopus:
          name = "bomb_oct";
          break;

         case AudioID.AddThree:
          name = "prop_add3";
          break;

         case AudioID.Hammer:
          name = "prop_hammer";
          break;

         case AudioID.Reset:
          name = "prop_reset";
          break;

         case AudioID.OpenBox:
          name = "openbox";
          break;

         case AudioID.CellFall:
          name = "cellfall";
          break;

         case AudioID.GetStar:
          name = "getstar";
          break;

         case AudioID.Bomb:
          name = "bomb_fish";
          break;

         case AudioID.StartGame:
          name = "start_game";
          break;

         case AudioID.partytime_shoot:
          name = "partytime_shoot";
          break;

         case AudioID.partytime_change:
          name = "partytime_change";
          break;

         case AudioID.merge_boom:
          name = "merge_boom";
        }
        return name ? "" + Paths_1.default.SoundPath + name : null;
      };
      AudioCtrl.prototype.play = function(id, isloop, volume) {
        void 0 === isloop && (isloop = false);
        void 0 === volume && (volume = .5);
        var audioPath = this.getAudioPathById(id);
        if (!audioPath) return;
        cc.loader.loadRes(audioPath, cc.AudioClip, function(err, res) {
          if (err) return;
          if (id == AudioID.BGM1 || id == AudioID.BGM2) {
            cc.audioEngine.getMusicVolume() != volume && cc.audioEngine.setMusicVolume(volume);
            cc.audioEngine.playMusic(res, isloop);
          } else {
            cc.audioEngine.getEffectsVolume() != volume && cc.audioEngine.setEffectsVolume(volume);
            cc.audioEngine.playEffect(res, isloop);
          }
        });
      };
      var AudioCtrl_1;
      AudioCtrl = AudioCtrl_1 = __decorate([ ccclass ], AudioCtrl);
      return AudioCtrl;
    }();
    exports.default = AudioCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/EventMgr": "EventMgr",
    "../../Base/Manager/StorageMgr": "StorageMgr",
    "../../Base/Utils/Paths": "Paths",
    "../Data/Const/Constant": "Constant",
    "../Data/Const/Event": "Event"
  } ],
  BagCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "60dfc/kJmZIuI3jKnCdvbZc", "BagCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var UIMgr_1 = require("../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Data/Interface/UIData");
    var M_1 = require("../../../Base/Manager/M");
    var BagGridItemCtrl_1 = require("./BagGridItemCtrl");
    var Constant_1 = require("../../Data/Const/Constant");
    var Event_1 = require("../../Data/Const/Event");
    var BaseConst_1 = require("../../../Base/BaseConst");
    var Common_1 = require("../Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BagCtrl = function(_super) {
      __extends(BagCtrl, _super);
      function BagCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.itemPrefab = null;
        _this.content = null;
        _this.tipsNode = null;
        _this.propFrams = [];
        _this._selectType = null;
        return _this;
      }
      BagCtrl.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
        M_1.default.event.register(Event_1.Event.UI.ShowBagTips, this.showTips, this);
      };
      BagCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.ShowBagTips, this.showTips, this);
      };
      BagCtrl.prototype.onInit = function() {
        var data = M_1.default.runtime.getPropData();
        this.content.destroyAllChildren();
        this.tipsNode.active = false;
        for (var id in data) {
          var type = Number(id);
          var item = M_1.default.nodePool.createItem(this.itemPrefab);
          item.getComponent(BagGridItemCtrl_1.default).init(type, data[id], this.propFrams[type - 100]);
          item.parent = this.content;
        }
      };
      BagCtrl.prototype.onCloseClick = function() {
        UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.Bag);
      };
      BagCtrl.prototype.onHideTips = function() {
        this.tipsNode.active = false;
        this._selectType = null;
      };
      BagCtrl.prototype.showTips = function(type, pos, count) {
        var info = M_1.default.table.PropInfo.getByPrimaryKey(type);
        pos = this.node.convertToNodeSpaceAR(pos);
        this.tipsNode.getChildByName("name").getComponent(cc.Label).string = info.name;
        this.tipsNode.getChildByName("detail").getComponent(cc.Label).string = info.detail;
        var button = this.tipsNode.getChildByName("useBtn").getComponent(cc.Button);
        pos.x = pos.x - 50;
        pos.y = pos.y + 40;
        this.tipsNode.setPosition(pos);
        this.tipsNode.active = true;
        var wpos = Common_1.default.getWorldPos(this.tipsNode);
        if (wpos.x + this.tipsNode.width * (1 - this.tipsNode.anchorX) > cc.winSize.width) {
          this.tipsNode.x -= .4 * this.tipsNode.width;
          this.tipsNode.getChildByName("bg").scaleX = -1;
        } else this.tipsNode.getChildByName("bg").scaleX = 1;
        if (info.isBagUse && count > 0) {
          this._selectType = type;
          button.interactable = true;
        } else button.interactable = false;
      };
      BagCtrl.prototype.useProps = function() {
        switch (this._selectType) {
         case Constant_1.PropType.PowerBottle1:
         case Constant_1.PropType.PowerBottle2:
          var info = M_1.default.table.PropInfo.getByPrimaryKey(this._selectType);
          if (M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power) >= Constant_1.MaxPowerCount) M_1.default.tips.show(Constant_1.WaringTips.PowerMax); else {
            M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, info.value);
            M_1.default.event.send(Event_1.Event.GameCMD.PropUsed);
            M_1.default.runtime.updatePropCount(this._selectType, -1);
          }
        }
      };
      __decorate([ property(cc.Prefab) ], BagCtrl.prototype, "itemPrefab", void 0);
      __decorate([ property(cc.Node) ], BagCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Node) ], BagCtrl.prototype, "tipsNode", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], BagCtrl.prototype, "propFrams", void 0);
      BagCtrl = __decorate([ ccclass ], BagCtrl);
      return BagCtrl;
    }(UIBase_1.default);
    exports.default = BagCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/BaseConst": "BaseConst",
    "../../../Base/Manager/M": "M",
    "../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Interface/UIData": "UIData",
    "../Common": "Common",
    "./BagGridItemCtrl": "BagGridItemCtrl"
  } ],
  BagGridItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "ad0e8kmbSFK3arO+Qs17gWK", "BagGridItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var Event_1 = require("../../Data/Const/Event");
    var Common_1 = require("../Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BagGridItemCtrl = function(_super) {
      __extends(BagGridItemCtrl, _super);
      function BagGridItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.icon = null;
        _this.count = null;
        _this._type = null;
        _this._data = null;
        return _this;
      }
      BagGridItemCtrl.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.UI.PropCount, this.updatePorpCount, this);
      };
      BagGridItemCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.PropCount, this.updatePorpCount, this);
      };
      BagGridItemCtrl.prototype.init = function(type, data, frame) {
        this.icon.spriteFrame = frame;
        this._type = type;
        this._data = data;
        this.count.string = data.count.toString();
        this.icon.enabled = data.count > 0;
      };
      BagGridItemCtrl.prototype.onClick = function() {
        M_1.default.event.send(Event_1.Event.UI.ShowBagTips, this._type, Common_1.default.getWorldPos(this.node), this._data.count);
      };
      BagGridItemCtrl.prototype.updatePorpCount = function(type) {
        if (type === this._type) {
          this.count.string = M_1.default.runtime.getPropData(type).count;
          this.icon.enabled = M_1.default.runtime.getPropData(type).count > 0;
        }
      };
      __decorate([ property(cc.Sprite) ], BagGridItemCtrl.prototype, "icon", void 0);
      __decorate([ property(cc.Label) ], BagGridItemCtrl.prototype, "count", void 0);
      BagGridItemCtrl = __decorate([ ccclass ], BagGridItemCtrl);
      return BagGridItemCtrl;
    }(cc.Component);
    exports.default = BagGridItemCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../Data/Const/Event": "Event",
    "../Common": "Common"
  } ],
  BaseConst: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "df9e4bIlQBOGLN7g6bVfllT", "BaseConst");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var PlatformType;
    (function(PlatformType) {
      PlatformType[PlatformType["Web"] = 100] = "Web";
      PlatformType[PlatformType["WxGame"] = 101] = "WxGame";
      PlatformType[PlatformType["QQ"] = 102] = "QQ";
      PlatformType[PlatformType["QQZone"] = 103] = "QQZone";
      PlatformType[PlatformType["Oppo"] = 104] = "Oppo";
      PlatformType[PlatformType["Vivo"] = 105] = "Vivo";
      PlatformType[PlatformType["WanBa"] = 106] = "WanBa";
      PlatformType[PlatformType["Uc"] = 107] = "Uc";
    })(PlatformType = exports.PlatformType || (exports.PlatformType = {}));
    var CurrencyId;
    (function(CurrencyId) {
      CurrencyId[CurrencyId["Coin"] = 0] = "Coin";
      CurrencyId[CurrencyId["Diamond"] = 1] = "Diamond";
      CurrencyId[CurrencyId["Power"] = 2] = "Power";
      CurrencyId[CurrencyId["TaskKey"] = 3] = "TaskKey";
    })(CurrencyId = exports.CurrencyId || (exports.CurrencyId = {}));
    exports.PlatformEvenType = {
      OnShow: "OnShow",
      OnHide: "OnHide",
      OnNetWorkChanged: "OnNetWorkChanged",
      OnMemoryWarning: "OnMemoryWarning"
    };
    cc._RF.pop();
  }, {} ],
  BaseItemView: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "34a4cLF1UpPlKOTUJ4WfmLg", "BaseItemView");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BaseItemView = function(_super) {
      __extends(BaseItemView, _super);
      function BaseItemView() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.model = null;
        return _this;
      }
      BaseItemView.prototype.init = function(model) {
        this.model = model;
      };
      BaseItemView = __decorate([ ccclass ], BaseItemView);
      return BaseItemView;
    }(cc.Component);
    exports.default = BaseItemView;
    cc._RF.pop();
  }, {} ],
  BaseTable: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b0419LwSphOIbTyanvd2RyF", "BaseTable");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BytesTable_1 = require("./BytesTable");
    var Util_1 = require("../../Utils/Util");
    var Log_1 = require("../../Utils/Log");
    var BaseTable = function(_super) {
      __extends(BaseTable, _super);
      function BaseTable(key, clsName, VOClass, afpb) {
        var _this = _super.call(this, afpb) || this;
        _this.KEY = null;
        _this._maxKey = 0;
        _this.KEY = key;
        _this.CLS = clsName;
        _this._VOClass = VOClass;
        return _this;
      }
      BaseTable.prototype.readyOK = function(data) {
        var _this = this;
        var _data = [];
        null != this._VOClass ? data.forEach(function(d) {
          var c = new _this._VOClass(d);
          _data.push(c);
        }) : _data = data;
        this._data = _data;
        this._tables = new Map();
        if (null != this.KEY && this.KEY.length > 0) {
          var k_1;
          _data.forEach(function(item) {
            k_1 = _this._createKey(item);
            if (null != k_1 && void 0 != k_1) {
              Util_1.Util.Tool.isNumber(k_1) && (_this._maxKey = Math.max(_this._maxKey, k_1));
              _this._tables.set(k_1, item);
            }
          });
        }
        this._isReady = true;
        Log_1.Log.i("\u6570\u636e\u8868[" + this.CLS + "] \u52a0\u8f7d\u6210\u529f");
      };
      BaseTable.prototype._createKey = function(item) {
        var k = "";
        if (this.KEY instanceof Array) {
          var karr_1 = [];
          this.KEY.forEach(function(KEY) {
            karr_1.push(item[KEY]);
          });
          k = karr_1.join("_");
        } else k = item[this.KEY];
        return k;
      };
      BaseTable.prototype.getByPrimaryKey = function(key) {
        return this._tables ? this._tables.get(key) : null;
      };
      BaseTable.prototype.getByPrimaryKeys = function() {
        var keys = [];
        for (var _i = 0; _i < arguments.length; _i++) keys[_i] = arguments[_i];
        var k = keys.join("_");
        return this._tables.get(k);
      };
      BaseTable.prototype.getData = function() {
        return this._data;
      };
      BaseTable.prototype.getMaxPrimaryKey = function() {
        return this._maxKey;
      };
      return BaseTable;
    }(BytesTable_1.BytesTable);
    exports.BaseTable = BaseTable;
    cc._RF.pop();
  }, {
    "../../Utils/Log": "Log",
    "../../Utils/Util": "Util",
    "./BytesTable": "BytesTable"
  } ],
  BaseView: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "cf3118QWelOdLbX9t5uL9dl", "BaseView");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BaseView = function(_super) {
      __extends(BaseView, _super);
      function BaseView() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.ItemPrefab = null;
        _this.models = null;
        return _this;
      }
      BaseView.prototype.initView = function(models) {
        this.models = models;
      };
      __decorate([ property(cc.Prefab) ], BaseView.prototype, "ItemPrefab", void 0);
      BaseView = __decorate([ ccclass ], BaseView);
      return BaseView;
    }(cc.Component);
    exports.default = BaseView;
    cc._RF.pop();
  }, {} ],
  BasicCellViewCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b9492O7mupLb59YQcC/vKJ2", "BasicCellViewCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var Constant_1 = require("../../Data/Const/Constant");
    var ItemBasicCellCtrl_1 = require("./ItemBasicCellCtrl");
    var BaseView_1 = require("./BaseView");
    var Event_1 = require("../../Data/Const/Event");
    var ActionCtrl_1 = require("../../Common/ActionCtrl");
    var GameModel_1 = require("../Model/GameModel");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BasicCellViewCtrl = function(_super) {
      __extends(BasicCellViewCtrl, _super);
      function BasicCellViewCtrl() {
        return null !== _super && _super.apply(this, arguments) || this;
      }
      BasicCellViewCtrl.prototype.initView = function(models) {
        _super.prototype.initView.call(this, models);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.Cell, this.ItemPrefab, 150);
        for (var y = models.length; y--; ) {
          var yItem = models[y];
          for (var x = yItem.length; x--; ) {
            var model = yItem[x];
            model && this.createNewCell(model, GameModel_1.CreateType.Initial);
          }
        }
      };
      BasicCellViewCtrl.prototype.createNewCell = function(model, createType) {
        var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.Cell, this.ItemPrefab);
        node.getComponent(ItemBasicCellCtrl_1.default).init(model, createType);
        model.extData = node;
        node.parent = this.node;
      };
      BasicCellViewCtrl.prototype.playCollectPower = function(parent, startCell, endCell) {
        var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.Cell, this.ItemPrefab);
        node.parent = parent;
        var pos = parent.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(startCell.getPosition()));
        node.setPosition(pos);
        node.getComponent(ItemBasicCellCtrl_1.default).easyInit(startCell.getType());
        var targetPos = parent.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(endCell.getPosition()));
        ActionCtrl_1.default.ins.runCollectNormalCell(node, targetPos).then(function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.Cell, node);
        });
      };
      BasicCellViewCtrl.prototype.playCollectAni = function(parent, type, pos, targetPos, elimateType, callback) {
        var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.Cell, this.ItemPrefab);
        node.parent = parent;
        var wpos = this.node.convertToWorldSpaceAR(pos);
        node.setPosition(parent.convertToNodeSpaceAR(wpos));
        node.getComponent(ItemBasicCellCtrl_1.default).easyInit(type);
        targetPos = parent.convertToNodeSpaceAR(targetPos);
        ActionCtrl_1.default.ins.runCollectNormalCell(node, targetPos, elimateType).then(function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.Cell, node);
          callback && callback();
          M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel, type);
          M_1.default.event.send(Event_1.Event.Effect.CollectOver, targetPos);
        });
      };
      BasicCellViewCtrl.prototype.playCollectStepAni = function(uictrl, cm) {
        var parent = uictrl.node;
        var centerPos = parent.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cm.getPosition()));
        var targetPos = parent.convertToNodeSpaceAR(uictrl.getStepPos());
        var label = cc.instantiate(cm.extCtrl.cellSprite.node.getChildByName("lv"));
        label.parent = parent;
        label.setPosition(centerPos);
        var a0 = cc.moveTo(1, targetPos);
        var a1 = cc.callFunc(function() {
          GameModel_1.default.ins.stepLimit += cm.getLv();
          M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel);
          label.destroy();
        });
        label.runAction(cc.sequence(a0, a1));
      };
      BasicCellViewCtrl = __decorate([ ccclass ], BasicCellViewCtrl);
      return BasicCellViewCtrl;
    }(BaseView_1.default);
    exports.default = BasicCellViewCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../Common/ActionCtrl": "ActionCtrl",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../Model/GameModel": "GameModel",
    "./BaseView": "BaseView",
    "./ItemBasicCellCtrl": "ItemBasicCellCtrl"
  } ],
  BombModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b24efieD1REkLqHDECJlMDw", "BombModel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var CellBase_1 = require("./CellBase");
    var GameModel_1 = require("./GameModel");
    var Common_1 = require("../../Common/Common");
    var RuntimeMgr_1 = require("../../Data/RuntimeMgr");
    var Constant_1 = require("../../Data/Const/Constant");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var EffLayerCtrl_1 = require("../View/EffLayerCtrl");
    var BombModel = function(_super) {
      __extends(BombModel, _super);
      function BombModel() {
        var _this = _super.call(this) || this;
        _this._tempGroupId = null;
        _this.type = null;
        return _this;
      }
      BombModel.prototype.init = function(type, x, y) {
        this.type = type;
      };
      BombModel.prototype.execBomb = function(bombCell, type, groupId) {
        void 0 === type && (type = null);
        void 0 === groupId && (groupId = null);
        return __awaiter(this, void 0, void 0, function() {
          var closeAry, keepTime, boomLevel;
          return __generator(this, function(_a) {
            if (bombCell.getType() == Constant_1.CellType.Bomb5 && null == type) return [ 2 ];
            closeAry = this.getBombCloseAry(bombCell.getType(), bombCell.pos, type);
            if (bombCell.isDeath && 0 == closeAry.size && bombCell.getType() != Constant_1.CellType.Bomb4) {
              bombCell.isBomb = false;
              bombCell.extCtrl.elimate(1, null);
              return [ 2 ];
            }
            keepTime = this.getBombDelayExecDestoryTime(bombCell.getType());
            boomLevel = this.getBombLv(this.type);
            GameModel_1.default.ins.execElimate(bombCell, closeAry, bombCell.getType(), boomLevel, keepTime, groupId);
            return [ 2 ];
          });
        });
      };
      BombModel.prototype._execOneBombByPos = function(type, pos) {
        if (Common_1.default.isBombType(type) && pos) {
          var closeAry = this.getBombCloseAry(type, pos, type);
          var keepTime = this.getBombDelayExecDestoryTime(type);
          var boomLevel = this.getBombLv(this.type);
          var centerCell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, pos);
          GameModel_1.default.ins.execElimate(centerCell, closeAry, type, boomLevel, keepTime);
        }
      };
      BombModel.prototype.onChangePos = function(pos) {};
      BombModel.prototype.onMsg = function(type) {};
      BombModel.prototype.onBind = function() {};
      BombModel.prototype.onUnBind = function() {};
      BombModel.prototype.getBombDelayExecDestoryTime = function(type) {
        var time = null;
        switch (type) {
         case Constant_1.CellType.Bomb1:
          time = TimeConfig_1.GapTime.NormalBombDelayElimate;
          break;

         case Constant_1.CellType.Bomb4:
          time = TimeConfig_1.GapTime.OctopusDelayElimate;
          break;

         case Constant_1.CellType.Fish:
          time = TimeConfig_1.GapTime.FishBombDelayElimate;
        }
        return time;
      };
      BombModel.prototype.getBombLv = function(type) {
        var lv = null;
        switch (type) {
         case Constant_1.CellType.Bomb1:
          lv = BOMBS_LEVEL[0];
          break;

         case Constant_1.CellType.Fish:
          lv = BOMBS_LEVEL[3];
          break;

         case Constant_1.CellType.Bomb2:
         case Constant_1.CellType.Bomb3:
          lv = type;
        }
        return lv;
      };
      BombModel.prototype.getBombCloseAry = function(type, pos, rainbowType) {
        void 0 === rainbowType && (rainbowType = null);
        var closeAry = null;
        switch (type) {
         case Constant_1.CellType.Bomb1:
          closeAry = this.getBombRangeCell(pos, 2);
          break;

         case Constant_1.CellType.Bomb2:
          closeAry = this.rowBomb(pos);
          break;

         case Constant_1.CellType.Bomb3:
          closeAry = this.colBomb(pos);
          break;

         case Constant_1.CellType.Bomb5:
          if (!rainbowType) {
            var chipset = GameModel_1.default.ins.getLvData().chipset;
            var tempItem_1 = null;
            chipset.forEach(function(item) {
              item && item.type < Constant_1.CellType.IceCream && (!tempItem_1 || item.percent > tempItem_1.percent) && (tempItem_1 = item);
            });
            rainbowType = tempItem_1.type;
          }
          closeAry = this.rainbow(rainbowType);
          break;

         case Constant_1.CellType.Bomb4:
          closeAry = this.getBombRangeCell(pos, 0);
          break;

         case Constant_1.CellType.Fish:
          closeAry = this.getBombRangeCell(pos, 1);
        }
        return closeAry;
      };
      BombModel.prototype.onBombMergeBomb = function(type1, type2, target, groupId) {
        this._tempGroupId = groupId;
        if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb5, Constant_1.CellType.Bomb1, type1, type2)) {
          console.error("\u5f69\u8679\u5706\u7206!");
          this.fireRainbow(target, Constant_1.CellType.Bomb1);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb5, Constant_1.CellType.Bomb2, type1, type2)) {
          console.error("\u5f69\u8679\u6a2a\u7206!");
          this.fireRainbow(target, Constant_1.CellType.Bomb2);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb5, Constant_1.CellType.Bomb3, type1, type2)) {
          console.error("\u5f69\u8679\u7ad6\u7206!");
          this.fireRainbow(target, Constant_1.CellType.Bomb3);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb5, Constant_1.CellType.Bomb4, type1, type2)) {
          console.error("\u5f69\u8679\u98de\u673a\u7206!");
          this._caihongZhangyu(target, Constant_1.CellType.Bomb4);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb5, Constant_1.CellType.Bomb5, type1, type2)) {
          console.error("\u5f69\u8679\u5f69\u8679\u7206!");
          this.fireRainbow(target, Constant_1.CellType.Bomb5);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb4, Constant_1.CellType.Bomb1, type1, type2)) {
          console.error("\u98de\u673a\u5706\u7206!");
          this.fireExecTypePlane(target, Constant_1.CellType.Bomb4, Constant_1.CellType.Bomb1);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb4, Constant_1.CellType.Bomb2, type1, type2)) {
          console.error("\u98de\u673a\u6a2a\u7206!");
          this.fireExecTypePlane(target, Constant_1.CellType.Bomb4, Constant_1.CellType.Bomb2);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb4, Constant_1.CellType.Bomb3, type1, type2)) {
          console.error("\u98de\u673a\u7ad6\u7206!");
          this.fireExecTypePlane(target, Constant_1.CellType.Bomb4, Constant_1.CellType.Bomb3);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb4, Constant_1.CellType.Bomb4, type1, type2)) {
          console.error("\u7ae0\u9c7c\u7ae0\u9c7c!");
          this.fireThreePlane(target);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb3, Constant_1.CellType.Bomb1, type1, type2)) {
          console.error("\u4e09\u884c\u5341\u5b57\u7206!");
          this.threeColAndRow(target, 1);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb3, Constant_1.CellType.Bomb2, type1, type2)) {
          console.error("\u5341\u5b57\u7206!");
          this.colAndRow(target);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb3, Constant_1.CellType.Bomb3, type1, type2)) {
          console.error("\u5341\u5b57\u7206!");
          this.colAndRow(target);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb2, Constant_1.CellType.Bomb1, type1, type2)) {
          console.error("\u4e09\u884c\u5341\u5b57\u7206!");
          this.threeColAndRow(target, 0);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb2, Constant_1.CellType.Bomb2, type1, type2)) {
          console.error("\u5341\u5b57\u7206!");
          this.colAndRow(target, 101);
        } else if (Common_1.default.isMergeBomb(Constant_1.CellType.Bomb1, Constant_1.CellType.Bomb1, type1, type2)) {
          console.error("\u5706\u7206\u5706\u7206!");
          this.doubleRoundBomb(target);
        }
        this._tempGroupId = null;
      };
      BombModel.prototype.doubleRoundBomb = function(target) {
        return __awaiter(this, void 0, void 0, function() {
          var groupId, closeAry, keepTime;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              groupId = this._tempGroupId;
              target.extCtrl.playBombSingleDestoryEff(0, TimeConfig_1.GapTime.BombMergeBombChangeTime, false, groupId);
              return [ 4, EffLayerCtrl_1.default.ins.playBombAndBomb(Common_1.default.convertCurWorldPos(target.extData.position)) ];

             case 1:
              _a.sent();
              closeAry = this.getBombRangeCell(target.pos, 3);
              keepTime = this.getBombDelayExecDestoryTime(Constant_1.CellType.Bomb1);
              target.forcedResetType(Constant_1.CellType.Bomb1);
              GameModel_1.default.ins.execElimate(target, closeAry, Constant_1.ElimateType.DoubleBomb, this.getBombLv(Constant_1.CellType.Bomb1), keepTime, groupId);
              return [ 2 ];
            }
          });
        });
      };
      BombModel.prototype.threeColAndRow = function(target, convertType) {
        return __awaiter(this, void 0, void 0, function() {
          var groupId, _closeAry, extInfo, i, dir, pos, type, closeAry, keepTime, i, type, closeAry, keepTime;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              groupId = this._tempGroupId;
              target.extCtrl.playBombSingleDestoryEff(0, TimeConfig_1.GapTime.BombMergeBombChangeTime, false, groupId);
              return [ 4, EffLayerCtrl_1.default.ins.playBombAndFish(Common_1.default.convertCurWorldPos(target.extData.position)) ];

             case 1:
              _a.sent();
              _closeAry = [];
              extInfo = [];
              for (i = Common_1.default.Dir4.length; i--; ) {
                dir = Common_1.default.Dir4[i];
                pos = target.pos.add(dir);
                type = null;
                type = 0 == dir.x ? Constant_1.CellType.Bomb2 : Constant_1.CellType.Bomb3;
                closeAry = this.getBombCloseAry(type, pos);
                keepTime = this.getBombDelayExecDestoryTime(type);
                extInfo.push({
                  pos: pos,
                  keepTime: keepTime,
                  closeAry: closeAry,
                  type: type
                });
                _closeAry = _closeAry.concat(Array.from(closeAry));
              }
              for (i = 2; i--; ) {
                type = i % 2 == 0 ? Constant_1.CellType.Bomb2 : Constant_1.CellType.Bomb3;
                closeAry = this.getBombCloseAry(type, target.pos);
                keepTime = this.getBombDelayExecDestoryTime(type);
                extInfo.push({
                  pos: target.pos,
                  keepTime: keepTime,
                  closeAry: closeAry,
                  type: type
                });
                _closeAry = _closeAry.concat(Array.from(closeAry));
              }
              target.extCtrl.preDestory();
              GameModel_1.default.ins.execElimate(target, new Set(_closeAry), Constant_1.ElimateType.ThreeRowAndCol, extInfo, null, groupId);
              return [ 2 ];
            }
          });
        });
      };
      BombModel.prototype.colAndRow = function(target, index, isShowAni, eType) {
        void 0 === index && (index = 0);
        void 0 === isShowAni && (isShowAni = true);
        void 0 === eType && (eType = Constant_1.ElimateType.RowAndCol);
        return __awaiter(this, void 0, void 0, function() {
          var groupId, cs;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              groupId = this._tempGroupId;
              if (!isShowAni) return [ 3, 2 ];
              target.extCtrl.playBombSingleDestoryEff(0, TimeConfig_1.GapTime.BombMergeBombChangeTime, false, groupId);
              return [ 4, EffLayerCtrl_1.default.ins.playFishAndFish(Common_1.default.convertCurWorldPos(target.extData.position)) ];

             case 1:
              _a.sent();
              _a.label = 2;

             case 2:
              cs = [ this.rowBomb(target.pos), this.colBomb(target.pos) ];
              cs.forEach(function(closeAry, index) {
                GameModel_1.default.ins.execElimate(target, closeAry, eType, 0 == index ? Constant_1.CellType.Bomb2 : Constant_1.CellType.Bomb3, null, groupId);
              });
              return [ 2 ];
            }
          });
        });
      };
      BombModel.prototype._caihongZhangyu = function(target, convertType) {
        return __awaiter(this, void 0, void 0, function() {
          var groupId;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              groupId = this._tempGroupId;
              target.extCtrl.playBombSingleDestoryEff(0, TimeConfig_1.GapTime.BombMergeBombChangeTime, false, groupId);
              return [ 4, EffLayerCtrl_1.default.ins.playHaimaAndZhangyu(Common_1.default.convertCurWorldPos(target.extData.position)) ];

             case 1:
              _a.sent();
              this.fireRainbow(target, convertType, groupId);
              return [ 2 ];
            }
          });
        });
      };
      BombModel.prototype.fireRainbow = function(target, convertType, groupId) {
        void 0 === groupId && (groupId = null);
        return __awaiter(this, void 0, void 0, function() {
          var timeline, count_1, _loop_1, i, state_1, chipset, closeAry, i, type;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              groupId || (groupId = this._tempGroupId);
              return [ 4, target.extCtrl.playComplexBombAni(null) ];

             case 1:
              _a.sent();
              if (!(convertType == Constant_1.CellType.Bomb5)) return [ 3, 3 ];
              target.extCtrl.playBombSingleDestoryEff(0, TimeConfig_1.GapTime.BombMergeBombChangeTime, false, groupId);
              return [ 4, EffLayerCtrl_1.default.ins.playHaimaAndHaima(Common_1.default.convertCurWorldPos(target.extData.position)) ];

             case 2:
              _a.sent();
              RuntimeMgr_1.default.ins.pauseGame();
              timeline = new gsap.TimelineMax();
              timeline.autoRemoveChildren = true;
              count_1 = 0;
              _loop_1 = function(i) {
                var ary = Common_1.default.getAroundCircleCells(target.pos, i, false);
                if (0 == ary.size) return "break";
                count_1++;
                timeline.add(gsap.TweenLite.delayedCall(TimeConfig_1.GapTime.DoubleRainbowWaves, function() {
                  count_1--;
                  GameModel_1.default.ins.execElimate(target, ary, Constant_1.ElimateType.All, count_1, null, groupId);
                }));
              };
              for (i = 0; i < 50; i++) {
                state_1 = _loop_1(i);
                if ("break" === state_1) break;
              }
              return [ 3, 9 ];

             case 3:
              target.extCtrl.playBombSingleDestoryEff(.2, .2, false, groupId);
              if (!(convertType == Constant_1.CellType.Bomb1)) return [ 3, 5 ];
              return [ 4, EffLayerCtrl_1.default.ins.playItemHeti(Common_1.default.convertCurWorldPos(target.extData.position), Constant_1.NodePoolKey.HaimaAndHetun, EffLayerCtrl_1.default.ins.haimaAndHetuanPrefab, "hetunHaima") ];

             case 4:
              _a.sent();
              return [ 3, 8 ];

             case 5:
              if (!(convertType == Constant_1.CellType.Bomb2)) return [ 3, 7 ];
              return [ 4, EffLayerCtrl_1.default.ins.playItemHeti(Common_1.default.convertCurWorldPos(target.extData.position), Constant_1.NodePoolKey.HaimaAndHetun, EffLayerCtrl_1.default.ins.haimaAndHetuanPrefab, "jianyuHaima") ];

             case 6:
              _a.sent();
              return [ 3, 8 ];

             case 7:
              convertType == Constant_1.CellType.Bomb4;
              _a.label = 8;

             case 8:
              chipset = GameModel_1.default.ins.getLvData().chipset;
              closeAry = null;
              for (i = chipset.length; i--; ) {
                type = chipset[i].type;
                if (type < Constant_1.CellType.Banana) {
                  closeAry = this.rainbow(type);
                  if (closeAry.size > 5) break;
                }
              }
              closeAry.forEach(function(cell) {
                if (cell && cell.extCtrl && !GameModel_1.default.ins.isHavaSpe(cell.pos)) {
                  cell.isExecBomb = true;
                  cell.GroupId = groupId;
                  cell.extCtrl.change2Bomb(convertType);
                }
              });
              _a.label = 9;

             case 9:
              return [ 2 ];
            }
          });
        });
      };
      BombModel.prototype.fireExecTypePlane = function(target, type1, execType) {
        return __awaiter(this, void 0, void 0, function() {
          var groupId, closeAry;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              groupId = this._tempGroupId;
              return [ 4, target.extCtrl.playComplexBombAni(null) ];

             case 1:
              _a.sent();
              execType == Constant_1.CellType.Bomb2 || execType == Constant_1.CellType.Bomb1;
              closeAry = this.getBombCloseAry(type1, target.pos);
              target.forcedResetType(type1);
              GameModel_1.default.ins.execElimate(target, closeAry, execType, execType, null, groupId);
              return [ 2 ];
            }
          });
        });
      };
      BombModel.prototype.fireThreePlane = function(target) {
        return __awaiter(this, void 0, void 0, function() {
          var groupId, timeline1, closeAry, i;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              groupId = this._tempGroupId;
              return [ 4, EffLayerCtrl_1.default.ins.playZhangyuAndZhangyu(Common_1.default.convertCurWorldPos(target.extData.position)) ];

             case 1:
              _a.sent();
              timeline1 = new gsap.TimelineMax();
              timeline1.autoRemoveChildren = true;
              closeAry = this.getBombCloseAry(target.getType(), target.pos);
              for (i = 3; i--; ) timeline1.add(gsap.TweenLite.delayedCall(TimeConfig_1.GapTime.ThreePlaneCreate, function() {
                GameModel_1.default.ins.execElimate(target, closeAry, Constant_1.ElimateType.ThreeOctopus, null, null, groupId);
              }));
              return [ 2 ];
            }
          });
        });
      };
      BombModel.prototype.getBombRangeCell = function(bombPos, level) {
        var closeAry = new Set();
        var range = BOMBS_RANGE[level];
        var cy = (range.length - 1) / 2;
        var cells = GameModel_1.default.ins.CellList;
        for (var i = -cy; i <= cy; i++) for (var j = -cy; j <= cy; j++) {
          if (0 == i && 0 == j) continue;
          if (1 == range[i + cy][j + cy]) {
            var cellPos = cc.v2(bombPos.x + j, bombPos.y + i);
            if (cellPos.x < 0 || cellPos.y < 0) continue;
            var cell = Common_1.default.safeGet2ArrayValue(cells, cellPos);
            if (cell && !cell.isDeath) {
              closeAry.add(cell);
              GameModel_1.default.ins.Lock.unLockFallPos(cellPos);
              GameModel_1.default.ins.Lock.unLockFallLockByKey(cellPos);
            }
          }
        }
        return closeAry;
      };
      BombModel.prototype.rowBomb = function(pos) {
        var cmList = GameModel_1.default.ins.CellList;
        var closeAry = new Set(cmList[pos.y]);
        return closeAry;
      };
      BombModel.prototype.colBomb = function(pos) {
        var cmList = GameModel_1.default.ins.CellList;
        var closeAry = new Set();
        for (var i = GameModel_1.default.GridSize.H; i--; ) {
          var cm = Common_1.default.safeGet2ArrayValue(cmList, cc.v2(pos.x, i));
          cm && closeAry.add(cm);
        }
        return closeAry;
      };
      BombModel.prototype.rainbow = function(rainType) {
        var cmList = GameModel_1.default.ins.CellList;
        var closeAry = new Set();
        for (var y = cmList.length; y--; ) {
          var xList = cmList[y];
          for (var x = xList.length; x--; ) {
            var cm = xList[x];
            cm && cm.getType() == rainType && !GameModel_1.default.ins.isHavaObs(cm.pos) && closeAry.add(cm);
          }
        }
        return closeAry;
      };
      return BombModel;
    }(CellBase_1.CellBase);
    exports.BombModel = BombModel;
    var BOMBS_LEVEL = [ 2, 2, 2, 1, 1, 1 ];
    var BOMBS_RANGE = [ [ [ 0, 1, 0 ], [ 1, 1, 1 ], [ 0, 1, 0 ] ], [ [ 1, 1, 1 ], [ 1, 1, 1 ], [ 1, 1, 1 ] ], [ [ 0, 1, 1, 1, 0 ], [ 1, 1, 1, 1, 1 ], [ 1, 1, 1, 1, 1 ], [ 1, 1, 1, 1, 1 ], [ 0, 1, 1, 1, 0 ] ], [ [ 0, 0, 1, 1, 1, 0, 0 ], [ 0, 1, 1, 1, 1, 1, 0 ], [ 1, 1, 1, 1, 1, 1, 1 ], [ 1, 1, 1, 1, 1, 1, 1 ], [ 1, 1, 1, 1, 1, 1, 1 ], [ 0, 1, 1, 1, 1, 1, 0 ], [ 0, 0, 1, 1, 1, 0, 0 ] ], [ [ 0, 0, 1, 1, 1, 1, 1, 0, 0 ], [ 0, 1, 1, 1, 1, 1, 1, 1, 0 ], [ 1, 1, 1, 1, 1, 1, 1, 1, 1 ], [ 1, 1, 1, 1, 1, 1, 1, 1, 1 ], [ 1, 1, 1, 1, 1, 1, 1, 1, 1 ], [ 1, 1, 1, 1, 1, 1, 1, 1, 1 ], [ 1, 1, 1, 1, 1, 1, 1, 1, 1 ], [ 0, 1, 1, 1, 1, 1, 1, 1, 0 ], [ 0, 0, 1, 1, 1, 1, 1, 0, 0 ] ] ];
    cc._RF.pop();
  }, {
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/TimeConfig": "TimeConfig",
    "../../Data/RuntimeMgr": "RuntimeMgr",
    "../View/EffLayerCtrl": "EffLayerCtrl",
    "./CellBase": "CellBase",
    "./GameModel": "GameModel"
  } ],
  BoxGiftCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "13dda3ki3pKDpr6c/KHY6a/", "BoxGiftCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var Common_1 = require("../Common");
    var Util_1 = require("../../../Base/Utils/Util");
    var UIData_1 = require("../../Data/Interface/UIData");
    var Event_1 = require("../../Data/Const/Event");
    var BoxTipsCtrl_1 = require("./BoxTipsCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var GapLv = 30;
    var BoxGiftCtrl = function(_super) {
      __extends(BoxGiftCtrl, _super);
      function BoxGiftCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.pointPath = null;
        _this.tipsPrefab = null;
        _this.dog = null;
        _this.lvLabels = [];
        _this.boxSprites = [];
        _this.boxFrame = [];
        _this.buoyFrame = [];
        _this._tips = null;
        _this._curShowLevel = null;
        _this._minLv = 0;
        _this._maxLv = 0;
        return _this;
      }
      BoxGiftCtrl.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.UI.updateBoxState, this._updateBoxState, this);
      };
      BoxGiftCtrl.prototype.onDestroy = function() {
        this._tips = null;
        M_1.default.event.unRegister(Event_1.Event.UI.updateBoxState, this._updateBoxState, this);
      };
      BoxGiftCtrl.prototype._initTips = function() {
        if (!this._tips) {
          var node = M_1.default.nodePool.createItem(this.tipsPrefab);
          node.parent = this.node;
          node.setPosition(0, 100);
          this._tips = node.getComponent(BoxTipsCtrl_1.default);
          this._tips.hide();
        }
      };
      BoxGiftCtrl.prototype.init = function(min, max) {
        void 0 === min && (min = null);
        void 0 === max && (max = null);
        min = min || 1;
        max = max || Math.floor(M_1.default.runtime.getMatch3Level() / 10);
        this._initTips();
        var fristBox = 0;
        for (var i = min; i <= max; i++) {
          var data = M_1.default.runtime.getBoxGiftDataByLv(10 * i);
          if (!data || data && !data.received) {
            fristBox = i - 1;
            break;
          }
        }
        this._curShowLevel = [];
        for (var i = 1; i <= 3; i++) {
          var base = (fristBox / 3 + 1 >> 0) - 1;
          this._curShowLevel.push(10 * (3 * base + i));
        }
        this._showView(this._curShowLevel);
      };
      BoxGiftCtrl.prototype.onBoxClick = function(event, index) {
        index = Number(index);
        var key = this._curShowLevel[index];
        var boxData = M_1.default.runtime.getBoxGiftDataByLv(key);
        if (boxData && !boxData.received) {
          var boxConfig = M_1.default.table.BoxRewardInfo.getByPrimaryKey(key);
          boxConfig && M_1.default.ui.showUI(UIData_1.UIHudDef.OpenBox, {
            config: boxConfig
          });
        } else boxData || this._showTips(index, key);
      };
      BoxGiftCtrl.prototype.updatePage = function(min, max) {
        this._minLv = min;
        this._maxLv = max;
        this.init(Math.floor(min / 10) + 1, Math.floor(max / 10));
      };
      BoxGiftCtrl.prototype.onOtherClick = function() {
        this._tips && this._tips.hide();
      };
      BoxGiftCtrl.prototype._updateBoxState = function(lv) {
        if (this._curShowLevel) {
          var index = this._curShowLevel.indexOf(lv);
          this._showBox(index, lv);
        }
      };
      BoxGiftCtrl.prototype._showView = function(fillData) {
        for (var i = 0; i < fillData.length; i++) {
          var lv = fillData[i];
          this._showLvLabel(i, lv);
          this._showBox(i, lv);
        }
        this._showDog();
      };
      BoxGiftCtrl.prototype._showLvLabel = function(index, level) {
        this.lvLabels[index].string = "\u7b2c <color=#fff841>" + level + "</color> \u5173";
      };
      BoxGiftCtrl.prototype._showBox = function(index, lv) {
        var box = this.boxSprites[index];
        var data = M_1.default.runtime.getBoxGiftDataByLv(lv);
        if (!box) return;
        box.node.stopAllActions();
        if (data && data.received) box.spriteFrame = this.boxFrame[1]; else {
          box.spriteFrame = this.boxFrame[0];
          data && !data.received && this._shakingBox(box.node);
        }
      };
      BoxGiftCtrl.prototype._showTips = function(index, lv) {
        if (this._tips) {
          var config = M_1.default.table.BoxRewardInfo.getByPrimaryKey(lv);
          this._tips.show(config.rewards, cc.v2(this.boxSprites[index].node.x, this._tips.node.y));
        }
      };
      BoxGiftCtrl.prototype._shakingBox = function(node) {
        var a0 = cc.moveBy(.05, cc.v2(Util_1.Util.Tool.rangeInt(2, 5), Util_1.Util.Tool.rangeInt(2, 5)));
        var a1 = a0.reverse();
        node.runAction(cc.repeatForever(cc.sequence(a0, a1)));
      };
      BoxGiftCtrl.prototype._showDog = function() {
        var maxLength = this.pointPath.children.length;
        var curLv = M_1.default.runtime.getMatch3Level();
        var pointIndex = curLv % GapLv * (maxLength / GapLv) - 1;
        var dogPoint = null;
        curLv >= this._maxLv && (pointIndex = maxLength);
        curLv <= this._minLv && (pointIndex = 0);
        for (var i = 0; i < maxLength; i++) {
          var node = this.pointPath.children[i];
          if (i <= pointIndex) {
            "point" == node.name ? node.getChildByName("y").active = true : node.getComponent(cc.Sprite).spriteFrame = this.buoyFrame[0];
            dogPoint = node;
          } else "point" == node.name ? node.getChildByName("y").active = false : node.getComponent(cc.Sprite).spriteFrame = this.buoyFrame[1];
        }
        dogPoint && (this.dog.x = this.dog.parent.convertToNodeSpaceAR(Common_1.default.getWorldPos(dogPoint)).x);
      };
      __decorate([ property(cc.Node) ], BoxGiftCtrl.prototype, "pointPath", void 0);
      __decorate([ property(cc.Prefab) ], BoxGiftCtrl.prototype, "tipsPrefab", void 0);
      __decorate([ property(cc.Node) ], BoxGiftCtrl.prototype, "dog", void 0);
      __decorate([ property([ cc.RichText ]) ], BoxGiftCtrl.prototype, "lvLabels", void 0);
      __decorate([ property([ cc.Sprite ]) ], BoxGiftCtrl.prototype, "boxSprites", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], BoxGiftCtrl.prototype, "boxFrame", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], BoxGiftCtrl.prototype, "buoyFrame", void 0);
      BoxGiftCtrl = __decorate([ ccclass ], BoxGiftCtrl);
      return BoxGiftCtrl;
    }(cc.Component);
    exports.default = BoxGiftCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../../Base/Utils/Util": "Util",
    "../../Data/Const/Event": "Event",
    "../../Data/Interface/UIData": "UIData",
    "../Common": "Common",
    "./BoxTipsCtrl": "BoxTipsCtrl"
  } ],
  BoxOpenCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "7fd5eMSFxVE16nSQK7Pnnts", "BoxOpenCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var M_1 = require("../../../Base/Manager/M");
    var UIData_1 = require("../../Data/Interface/UIData");
    var Event_1 = require("../../Data/Const/Event");
    var GuideUtils_1 = require("../../../../GodGuide/GuideUtils");
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var AudioCtrl_1 = require("../AudioCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BoxOpenCtrl = function(_super) {
      __extends(BoxOpenCtrl, _super);
      function BoxOpenCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.content = null;
        _this.boxNode = null;
        _this.titleLab = null;
        _this.rewardNode = null;
        _this.frames = [];
        _this._isOpened = false;
        _this._info = null;
        return _this;
      }
      BoxOpenCtrl.prototype.onInit = function(data) {
        var _this = this;
        this._isOpened = false;
        this.content.destroyAllChildren();
        if (data.text) this.titleLab.string = data.text; else {
          this.titleLab.string = "\u606d\u559c\u4f60\u5f00\u542f\u4e86\u5b9d\u7bb1 , \u83b7\u5f97\u4ee5\u4e0b\u5956\u52b1:";
          EventMgr_1.default.ins.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.OpenBox);
        }
        data.config.rewards.forEach(function(item) {
          _this._setItem(item, _this.rewardNode, _this.frames);
        });
        this._info = data.config;
        M_1.default.runtime.setBoxGiftData(this._info.id, true);
        this.boxNode.active = !data.isHideBox;
      };
      BoxOpenCtrl.prototype._setItem = function(item, prefab, frames) {
        var type = Number(item.type);
        var node = M_1.default.nodePool.createItem(prefab);
        node.getChildByName("count").getComponent(cc.Label).string = "x" + item.count;
        node.getChildByName("icon").getComponent(cc.Sprite).spriteFrame = this._getRewardIcon(frames, type);
        node.parent = this.content;
        type >= 100 ? M_1.default.runtime.updatePropCount(type, item.count) : M_1.default.runtime.addCurrency(type, item.count);
      };
      BoxOpenCtrl.prototype._getRewardIcon = function(frames, type) {
        var result = null;
        result = type >= 100 ? frames[type - 100] : frames[type + 20];
        return result;
      };
      BoxOpenCtrl.prototype.onShow = function() {
        this._isOpened = true;
      };
      BoxOpenCtrl.prototype.onCloseClick = function() {
        if (this._isOpened) {
          M_1.default.ui.hideUI(UIData_1.UIHudDef.OpenBox);
          M_1.default.event.send(Event_1.Event.UI.updateBoxState, this._info.id);
          this._info = null;
          GuideUtils_1.GuideUtils.checkGuide();
        }
      };
      __decorate([ property(cc.Node) ], BoxOpenCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Node) ], BoxOpenCtrl.prototype, "boxNode", void 0);
      __decorate([ property(cc.Label) ], BoxOpenCtrl.prototype, "titleLab", void 0);
      __decorate([ property(cc.Prefab) ], BoxOpenCtrl.prototype, "rewardNode", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], BoxOpenCtrl.prototype, "frames", void 0);
      BoxOpenCtrl = __decorate([ ccclass ], BoxOpenCtrl);
      return BoxOpenCtrl;
    }(UIBase_1.default);
    exports.default = BoxOpenCtrl;
    cc._RF.pop();
  }, {
    "../../../../GodGuide/GuideUtils": "GuideUtils",
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/Manager/M": "M",
    "../../../Base/UI/UIBase": "UIBase",
    "../../Data/Const/Event": "Event",
    "../../Data/Interface/UIData": "UIData",
    "../AudioCtrl": "AudioCtrl"
  } ],
  BoxRewardInfo: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "6cd130NXqFLU4hAMc94Ahik", "BoxRewardInfo");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BoxRewardInfo = function() {
      function BoxRewardInfo(data) {
        this.id = null;
        this.content = null;
        this.rewards = null;
        this.id = data.id;
        this.content = data.content;
        this._parseRewardInfo();
      }
      BoxRewardInfo.prototype._parseRewardInfo = function() {
        var _this = this;
        if (this.content) {
          this.rewards = [];
          this.content.forEach(function(item) {
            if (item) {
              var sc = item.split("|");
              var type = Number(sc[0]);
              null != type && void 0 != type && _this.rewards.push({
                type: type,
                count: Number(sc[1])
              });
            }
          });
        }
      };
      return BoxRewardInfo;
    }();
    exports.default = BoxRewardInfo;
    cc._RF.pop();
  }, {} ],
  BoxTipsCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e169fjqJrJFoJcxdsYoFPFC", "BoxTipsCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var Constant_1 = require("../../Data/Const/Constant");
    var BaseConst_1 = require("../../../Base/BaseConst");
    var Common_1 = require("../Common");
    var Util_1 = require("../../../Base/Utils/Util");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BoxTipsCtrl = function(_super) {
      __extends(BoxTipsCtrl, _super);
      function BoxTipsCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.content = null;
        _this.title = null;
        _this.rewardPrefab = null;
        _this.rewardIconFrames = [];
        _this.isReady = false;
        return _this;
      }
      BoxTipsCtrl.prototype.onLoad = function() {};
      BoxTipsCtrl.prototype.updateData = function(title, contentSize) {
        this.title.string = title;
        contentSize && this.node.setContentSize(contentSize);
      };
      BoxTipsCtrl.prototype.show = function(data, pos) {
        var _this = this;
        if (data) {
          this.content.destroyAllChildren();
          data.forEach(function(item) {
            var node = M_1.default.nodePool.createItem(_this.rewardPrefab);
            var count = item.count.toString();
            node.parent = _this.content;
            node.setScale(.8);
            var icon = node.getChildByName("icon");
            item.type < Constant_1.PropType.BeikeBomb && icon.setScale(1);
            item.type == BaseConst_1.CurrencyId.Coin && (count = Common_1.default.bytesToSize(item.count));
            icon.getComponent(cc.Sprite).spriteFrame = _this._getRewardIcon(item.type);
            node.getChildByName("count").getComponent(cc.Label).string = "x" + count;
          });
          pos && this.node.setPosition(pos);
          this.node.active = true;
          this.scheduleOnce(function() {
            _this.isReady = true;
          }, .5);
          Util_1.Util.Tool.OpenUITween(this.node, null);
        }
      };
      BoxTipsCtrl.prototype.hide = function() {
        this.node.active = false;
        this.isReady = false;
        Util_1.Util.Tool.CloseUITween(this.node, null);
      };
      BoxTipsCtrl.prototype._getRewardIcon = function(type) {
        var result = null;
        result = type >= Constant_1.PropType.BeikeBomb ? this.rewardIconFrames[type - Constant_1.PropType.BeikeBomb] : this.rewardIconFrames[20 + type];
        return result;
      };
      __decorate([ property(cc.Node) ], BoxTipsCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Label) ], BoxTipsCtrl.prototype, "title", void 0);
      __decorate([ property(cc.Prefab) ], BoxTipsCtrl.prototype, "rewardPrefab", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], BoxTipsCtrl.prototype, "rewardIconFrames", void 0);
      BoxTipsCtrl = __decorate([ ccclass ], BoxTipsCtrl);
      return BoxTipsCtrl;
    }(cc.Component);
    exports.default = BoxTipsCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/BaseConst": "BaseConst",
    "../../../Base/Manager/M": "M",
    "../../../Base/Utils/Util": "Util",
    "../../Data/Const/Constant": "Constant",
    "../Common": "Common"
  } ],
  BuildCloud: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "664b3LoSHhG2ZlVBqJNvOLf", "BuildCloud");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../../../Base/Manager/M");
    var MapIslandUtils_1 = require("../MapIslandUtils");
    var Util_1 = require("../../../../../Base/Utils/Util");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BuildCloud = function(_super) {
      __extends(BuildCloud, _super);
      function BuildCloud() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.cloudId = -1;
        _this.buildingIds = [];
        return _this;
      }
      BuildCloud.prototype.onLoad = function() {
        var _this = this;
        if (this.buildingIds.length <= 0) return;
        var show = true;
        var star = M_1.default.runtime.getStarCount();
        for (var i = 0; i < this.buildingIds.length; ++i) {
          var iconfig = MapIslandUtils_1.default.getBuildConfigById(this.buildingIds[i]);
          if (iconfig && star >= iconfig.starlv) {
            show = false;
            break;
          }
        }
        this.node.active = show;
        show && Util_1.Util.Loader.loadSpriteFrame("texture/map/cloud/map_cloud_" + this.cloudId, function(err, texture) {
          var Sprite = _this.node.getComponent(cc.Sprite);
          Sprite && (Sprite.spriteFrame = texture);
        });
      };
      __decorate([ property(cc.Integer) ], BuildCloud.prototype, "cloudId", void 0);
      __decorate([ property([ cc.Integer ]) ], BuildCloud.prototype, "buildingIds", void 0);
      BuildCloud = __decorate([ ccclass ], BuildCloud);
      return BuildCloud;
    }(cc.Component);
    exports.default = BuildCloud;
    cc._RF.pop();
  }, {
    "../../../../../Base/Manager/M": "M",
    "../../../../../Base/Utils/Util": "Util",
    "../MapIslandUtils": "MapIslandUtils"
  } ],
  BuildSuccess: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e56c0hF9vpMv6xpLUngHk9M", "BuildSuccess");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../../Base/UI/UIBase");
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var Util_1 = require("../../../../Base/Utils/Util");
    var ShareMgr_1 = require("../../../../Base/Manager/ShareMgr");
    var HotelData_1 = require("../../../Hotel/HotelData");
    var CloudView_1 = require("./CloudView");
    var Constant_1 = require("../../../Data/Const/Constant");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BuildSuccess = function(_super) {
      __extends(BuildSuccess, _super);
      function BuildSuccess() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.photo = null;
        _this.buildName = null;
        _this.labelShareTip = null;
        _this.labelButton = null;
        _this._buildingId = null;
        _this._isShare = false;
        return _this;
      }
      BuildSuccess.prototype.onInit = function(buildingId) {
        this._buildingId = buildingId;
      };
      BuildSuccess.prototype.onStart = function() {
        this.initRoomData();
      };
      BuildSuccess.prototype.initRoomData = function() {
        var _this = this;
        var nextRoomConfig = HotelData_1.HotelData.getHotelRoomConfig(this._buildingId + 1);
        null == nextRoomConfig && console.error("\u6ca1\u6709\u4e0b\u4e00\u4e2a\u623f\u95f4\u53ef\u4ee5\u89e3\u9501\u4e86");
        var roomConfig = HotelData_1.HotelData.getHotelRoomConfig(this._buildingId);
        if (roomConfig) {
          Util_1.Util.Loader.loadSpriteFrame("texture/hotel/shareIcon/room_share_" + this._buildingId, function(err, resource) {
            _this.photo.spriteFrame = resource;
          });
          this.buildName.string = roomConfig.roomName;
          var openShare = this._isShare = true;
          var shareData = ShareMgr_1.default.ins.getConfig(this._buildingId, "buildId");
          if (openShare && shareData) {
            this.labelButton.string = "\u70ab \u8000";
            this.labelShareTip.node.active = true;
            this.labelShareTip.string = Util_1.Util.Tool.stringFormat(Constant_1.WaringTips.ShareTip, shareData.reward[0].num);
          } else {
            this.labelButton.string = "\u786e \u5b9a";
            this.labelShareTip.node.active = false;
          }
        }
      };
      BuildSuccess.prototype.close = function() {
        var _this = this;
        if (this._isShare) ShareMgr_1.default.ins.doShareBuild(this._buildingId, function(result) {
          UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.BuildSuccess);
          if (result) {
            var shareData = ShareMgr_1.default.ins.getConfig(_this._buildingId, "buildId");
            UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.CommonReward, shareData.reward[0], null, _this.doCloseCallback.bind(_this));
          } else _this.doCloseCallback();
        }); else {
          UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.BuildSuccess);
          UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.CloudView, CloudView_1.ICloudData.RoomRefresh);
        }
      };
      BuildSuccess.prototype.doCloseCallback = function() {
        var nextRoomConfig = HotelData_1.HotelData.getHotelRoomConfig(this._buildingId + 1);
        if (null == nextRoomConfig) {
          console.error("\u6ca1\u6709\u4e0b\u4e00\u4e2a\u623f\u95f4\u53ef\u4ee5\u89e3\u9501\u4e86");
          return;
        }
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.CloudView, CloudView_1.ICloudData.RoomRefresh);
      };
      __decorate([ property(cc.Sprite) ], BuildSuccess.prototype, "photo", void 0);
      __decorate([ property(cc.Label) ], BuildSuccess.prototype, "buildName", void 0);
      __decorate([ property(cc.RichText) ], BuildSuccess.prototype, "labelShareTip", void 0);
      __decorate([ property(cc.Label) ], BuildSuccess.prototype, "labelButton", void 0);
      BuildSuccess = __decorate([ ccclass ], BuildSuccess);
      return BuildSuccess;
    }(UIBase_1.default);
    exports.BuildSuccess = BuildSuccess;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/ShareMgr": "ShareMgr",
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../../Base/UI/UIBase": "UIBase",
    "../../../../Base/Utils/Util": "Util",
    "../../../Data/Const/Constant": "Constant",
    "../../../Data/Interface/UIData": "UIData",
    "../../../Hotel/HotelData": "HotelData",
    "./CloudView": "CloudView"
  } ],
  BuildTool: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "55c8a+uqO9Ih4FhatZOUC6i", "BuildTool");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Data/Const/Event");
    var MapIslandManager_1 = require("./MapIslandManager");
    var MapIslandUtils_1 = require("./MapIslandUtils");
    var MoneyManager_1 = require("../../../Data/MoneyManager");
    var M_1 = require("../../../../Base/Manager/M");
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var ReportMgr_1 = require("../../../../Base/Manager/ReportMgr");
    var Common_1 = require("../../../Common/Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BuildTool = function(_super) {
      __extends(BuildTool, _super);
      function BuildTool() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.content = null;
        _this.item = null;
        _this.arrow = null;
        _this.exchange = null;
        _this.exchangeBtn = null;
        _this.unlock = null;
        _this.fix = null;
        _this.upgrade = null;
        _this.iconBg = [];
        _this.curExchange = null;
        _this.lastNode = null;
        _this._buildingId = null;
        _this._buildingLockPos = null;
        return _this;
      }
      BuildTool.prototype.onLoad = function() {
        EventMgr_1.default.ins.register(Event_1.Event.Map.ShowTool, this.showTool, this);
        EventMgr_1.default.ins.register(Event_1.Event.Map.HideTool, this.hideTool, this);
        this.node.active = false;
      };
      BuildTool.prototype.onDestroy = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.ShowTool, this.showTool, this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.HideTool, this.hideTool, this);
      };
      BuildTool.prototype.onDisable = function() {
        this.lastNode = null;
        this.curExchange = null;
      };
      BuildTool.prototype.showTool = function(buildingId, position, exchange) {
        this._buildingId = buildingId;
        this.curExchange = exchange;
        this._buildingLockPos = position;
        var buildFixed = MapIslandUtils_1.default.getBuildFixed(buildingId);
        buildFixed ? this.showExchenge(exchange) : this.showUnlock(buildingId, position);
      };
      BuildTool.prototype.showUnlock = function(buildingId, position) {
        this.exchange.active = false;
        this.unlock.active = true;
        this.fix.active = false;
        this.upgrade.active = false;
        this.node.active = true;
        var buildingConfig = MapIslandManager_1.MapIslandManager.getBuildConfigById(buildingId);
        if (buildingConfig) {
          position && (this.unlock.position = this.getToolPos(position).sub(cc.v2(0, -170)));
          this.unlock.getChildByName("name").getComponent(cc.Label).string = buildingConfig.desc;
          this.unlock.getChildByName("price").getComponent(cc.Label).string = "x" + Common_1.default.bytesToSize(buildingConfig.price[0].num);
        }
      };
      BuildTool.prototype.getToolPos = function(buildPos) {
        var out = cc.v2();
        var mapScale = MapIslandUtils_1.default.MapScale;
        var lockPosition = cc.v2();
        buildPos.scale(new cc.Vec2(mapScale, mapScale), lockPosition);
        MapIslandUtils_1.default.cameraGetWorldToScreenPoint(lockPosition, out);
        this.node.setPosition(MapIslandUtils_1.default.mapCamera.node.position);
        return out;
      };
      BuildTool.prototype.showExchenge = function(curExchange) {
        this.fix.active = false;
        this.unlock.active = false;
        this.exchange.active = true;
        this.upgrade.active = false;
        this.content.children.forEach(function(node) {
          node.active = false;
        });
        this.node.active = true;
        this._buildingLockPos && (this.exchange.position = this.getToolPos(this._buildingLockPos).sub(cc.v2(0, -190)));
        this.content.getComponent(cc.ToggleContainer).allowSwitchOff = !curExchange.state;
        var _loop_1 = function() {
          var item = null;
          if (i <= this_1.content.childrenCount) item = this_1.content.children[i - 1]; else {
            item = cc.instantiate(this_1.item);
            this_1.content.addChild(item);
          }
          item.getComponent(cc.Toggle).checkEvents[0].customEventData = i.toString();
          item.getChildByName("bg").getComponent(cc.Sprite).spriteFrame = this_1.iconBg[i - 1];
          cc.loader.loadRes(MapIslandUtils_1.default.getBuildIcon(this_1._buildingId, i), cc.SpriteFrame, function(err, texture) {
            item.getChildByName("icon").getComponent(cc.Sprite).spriteFrame = texture;
          });
          item.active = true;
          item.getComponent(cc.Toggle).isChecked = false;
        };
        var this_1 = this;
        for (var i = 1; i < 3; ++i) _loop_1();
        this.exchangeBtn.active = false;
      };
      BuildTool.prototype.hideTool = function() {
        this.curExchange && this.curExchange.setState(false);
        this.node.active = false;
      };
      BuildTool.prototype.selectItem = function(toggle, customEventData) {
        if (toggle.isChecked) {
          this.content.getComponent(cc.ToggleContainer).allowSwitchOff = false;
          this.curExchange.loadBuilding(Number(customEventData), false);
          this.exchangeBtn.active = true;
        }
        this.content.emit(cc.Node.EventType.TOUCH_END);
      };
      BuildTool.prototype.closeTool = function() {
        this.curExchange && this.curExchange.setState(true);
        this.node.active = false;
      };
      BuildTool.prototype.upgradeBuilding = function() {
        this.curExchange.loadBuilding(this.curExchange.state + 1, true);
        this.node.active = false;
      };
      BuildTool.prototype.onClickUnlock = function() {
        var _buildingConfig = MapIslandManager_1.MapIslandManager.getBuildConfigById(this._buildingId);
        if (_buildingConfig) {
          var moneyCheck = MoneyManager_1.MoneyManager.CheckMoneyJson(_buildingConfig.price[0], true);
          if (moneyCheck) {
            MapIslandUtils_1.default.setBuildFixed(this._buildingId);
            ReportMgr_1.default.ins.reportDecorate(this._buildingId.toString());
            if (0 == _buildingConfig.choose) {
              M_1.default.tips.show(_buildingConfig.desc + " \u4fee\u590d\u6210\u529f\u4e86!");
              this.curExchange.unLock();
              this.hideTool();
            } else {
              M_1.default.tips.show(_buildingConfig.desc + "\u89e3\u9501\u6210\u529f\u4e86!");
              this.showExchenge(this.curExchange);
            }
          } else UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.SelectShowTarget, {
            type: UIData_1.UIHudDef.SelectShowTarget,
            data: null
          });
        }
      };
      BuildTool.prototype.fixBuilding = function() {
        this.curExchange.loadBuilding(1, true);
        this.node.active = false;
      };
      __decorate([ property(cc.Node) ], BuildTool.prototype, "content", void 0);
      __decorate([ property(cc.Node) ], BuildTool.prototype, "item", void 0);
      __decorate([ property(cc.Node) ], BuildTool.prototype, "arrow", void 0);
      __decorate([ property(cc.Node) ], BuildTool.prototype, "exchange", void 0);
      __decorate([ property(cc.Node) ], BuildTool.prototype, "exchangeBtn", void 0);
      __decorate([ property(cc.Node) ], BuildTool.prototype, "unlock", void 0);
      __decorate([ property(cc.Node) ], BuildTool.prototype, "fix", void 0);
      __decorate([ property(cc.Node) ], BuildTool.prototype, "upgrade", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], BuildTool.prototype, "iconBg", void 0);
      BuildTool = __decorate([ ccclass ], BuildTool);
      return BuildTool;
    }(cc.Component);
    exports.default = BuildTool;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Manager/ReportMgr": "ReportMgr",
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Common/Common": "Common",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData",
    "../../../Data/MoneyManager": "MoneyManager",
    "./MapIslandManager": "MapIslandManager",
    "./MapIslandUtils": "MapIslandUtils"
  } ],
  BuildingLock: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "daf244pS2NBn6h5f6yP/d+6", "BuildingLock");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../../Data/Const/Event");
    var Common_1 = require("../../../../Common/Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BuildingLock = function(_super) {
      __extends(BuildingLock, _super);
      function BuildingLock() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.icon = null;
        _this._iconId = 0;
        _this._buildingId = 0;
        _this._exchange = null;
        _this._roomId = -1;
        _this._slotId = -1;
        return _this;
      }
      BuildingLock.prototype.setData = function(iconId, buildingId, exchange) {
        this._iconId = iconId;
        this._buildingId = buildingId;
        this._exchange = exchange;
      };
      BuildingLock.prototype.onEnable = function() {
        this.setIcon();
      };
      BuildingLock.prototype.setIcon = function() {};
      BuildingLock.prototype.onIconClick = function() {
        var slotData = {
          roomId: this._roomId,
          slotId: this._slotId,
          subId: 1,
          state: 0
        };
        EventMgr_1.default.ins.send(Event_1.Event.Hotel.UIRoomUnlock, slotData, Common_1.default.getWorldPos(this.node));
      };
      BuildingLock.prototype.onDestroy = function() {
        this._exchange = null;
        this._buildingId = null;
        this._iconId = null;
      };
      BuildingLock.prototype.setHotelData = function(roomId, slotId) {
        this._roomId = roomId;
        this._slotId = this._iconId = slotId;
      };
      __decorate([ property(cc.Sprite) ], BuildingLock.prototype, "icon", void 0);
      BuildingLock = __decorate([ ccclass ], BuildingLock);
      return BuildingLock;
    }(cc.Component);
    exports.default = BuildingLock;
    cc._RF.pop();
  }, {
    "../../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../../Common/Common": "Common",
    "../../../../Data/Const/Event": "Event"
  } ],
  Button: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "112c0ssqxdIXac/9R15QICk", "Button");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../Manager/EventMgr");
    var Event_1 = require("../../Logic/Data/Const/Event");
    var AudioCtrl_1 = require("../../Logic/Common/AudioCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property, inspector = _a.inspector;
    var Button = function(_super) {
      __extends(Button, _super);
      function Button() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.soundName = 0;
        return _this;
      }
      Button.prototype._onTouchEnded = function(event) {
        _super.prototype["_onTouchEnded"].call(this, event);
        this.soundName && EventMgr_1.default.ins.send(Event_1.Event.Sound.PlaySoundEff, this.soundName);
      };
      __decorate([ property({
        type: cc.Enum(AudioCtrl_1.AudioID),
        displayName: "\u9009\u62e9\u89e6\u53d1\u97f3\u6548"
      }) ], Button.prototype, "soundName", void 0);
      Button = __decorate([ ccclass, inspector("packages://CustomComponent/button.js") ], Button);
      return Button;
    }(cc.Button);
    exports.default = Button;
    cc._RF.pop();
  }, {
    "../../Logic/Common/AudioCtrl": "AudioCtrl",
    "../../Logic/Data/Const/Event": "Event",
    "../Manager/EventMgr": "EventMgr"
  } ],
  BuyPowerCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "3870eslbRNDkLHbfHyHZpiE", "BuyPowerCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var Constant_1 = require("../../Data/Const/Constant");
    var BaseConst_1 = require("../../../Base/BaseConst");
    var Common_1 = require("../Common");
    var Event_1 = require("../../Data/Const/Event");
    var Util_1 = require("../../../Base/Utils/Util");
    var MoneyManager_1 = require("../../Data/MoneyManager");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BuyPowerCtrl = function(_super) {
      __extends(BuyPowerCtrl, _super);
      function BuyPowerCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.remainPowerCount = null;
        _this.countDown = null;
        _this.fillFullLabl = null;
        _this.littleMoney = null;
        _this.littlePrice = null;
        _this.littleCount = null;
        _this.bigPrice = null;
        _this.bigCount = null;
        _this.bigMoney = null;
        _this.fillallPrice = 0;
        _this.fullCount = 0;
        _this._animation = null;
        return _this;
      }
      BuyPowerCtrl.prototype.onLoad = function() {
        this._initView();
        this._animation = this.node.getComponent(cc.Animation);
        M_1.default.event.register(Event_1.Event.UI.UpdateRemainAddPowerTime, this.updateCountDown, this);
      };
      BuyPowerCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.UpdateRemainAddPowerTime, this.updateCountDown, this);
      };
      BuyPowerCtrl.prototype._initView = function() {
        this._updateFillFull();
        this._initTowBottle();
      };
      BuyPowerCtrl.prototype._updateFillFull = function() {
        var unityPrice = M_1.default.table.PropInfo.getByPrimaryKey(Constant_1.PropType.PowerUnitPrice).price;
        var curPower = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power);
        this.fullCount = Constant_1.MaxPowerCount - curPower;
        this.fillallPrice = unityPrice * this.fullCount;
        this.fillFullLabl.string = Common_1.default.bytesToSize(this.fillallPrice) + "\u8865\u6ee1\u7cbe\u529b";
        this.remainPowerCount.string = curPower + "/" + Constant_1.MaxPowerCount;
      };
      BuyPowerCtrl.prototype._initTowBottle = function() {
        var keys = [ Constant_1.PropType.PowerBottle1, Constant_1.PropType.PowerBottle2 ];
        var countLabs = [ this.littleCount, this.bigCount ];
        var moneyNodes = [ this.littleMoney, this.bigMoney ];
        var prices = [ this.littlePrice, this.bigPrice ];
        keys.forEach(function(key, index) {
          var info = M_1.default.table.PropInfo.getByPrimaryKey(key);
          var data = M_1.default.runtime.getPropData(key);
          if (info) if (data && data.count) {
            countLabs[index].node.active = true;
            countLabs[index].string = "x" + data.count;
            moneyNodes[index].active = false;
          } else {
            countLabs[index].node.active = false;
            moneyNodes[index].active = true;
            prices[index].string = Common_1.default.bytesToSize(info.price);
          }
        });
      };
      BuyPowerCtrl.prototype.show = function() {
        this.node.active = true;
        this._animation.play("ShowSelectLevel");
      };
      BuyPowerCtrl.prototype.onCloseBtnClick = function() {
        var _this = this;
        M_1.default.event.send(Event_1.Event.UI.UpdateRemainAddPowerTime);
        this._animation.play("HideSelectLevel");
        this.scheduleOnce(function() {
          _this.node.active = false;
        }, .3);
      };
      BuyPowerCtrl.prototype.updateCountDown = function(time) {
        if (this.node.active) {
          var currentPower = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power);
          var incremental = time % Constant_1.PowerConfig.NormalTime;
          var maxTime = (Constant_1.MaxPowerCount - currentPower) * Constant_1.PowerConfig.NormalTime;
          this.countDown.string = Util_1.Util.Timer.conversionTime(maxTime - incremental, false);
          this._updateFillFull();
        }
      };
      BuyPowerCtrl.prototype.onFillFullClick = function() {
        if (MoneyManager_1.MoneyManager.CheckMoney(BaseConst_1.CurrencyId.Coin, this.fillallPrice, true)) {
          M_1.default.tips.show(Constant_1.WaringTips.BuyOk);
          M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, this.fullCount);
          this._initView();
          this.onCloseBtnClick();
        }
      };
      BuyPowerCtrl.prototype.onLittleClick = function() {
        this._doBottle(Constant_1.PropType.PowerBottle1);
      };
      BuyPowerCtrl.prototype.onBigClick = function() {
        this._doBottle(Constant_1.PropType.PowerBottle2);
      };
      BuyPowerCtrl.prototype._doBottle = function(type) {
        var data = M_1.default.runtime.getPropData(type);
        var info = M_1.default.table.PropInfo.getByPrimaryKey(type);
        if (data && data.count > 0) {
          M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, info.value);
          M_1.default.runtime.updatePropCount(type, -1);
          M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power) >= Constant_1.MaxPowerCount && this.onCloseBtnClick();
        } else if (MoneyManager_1.MoneyManager.CheckMoney(BaseConst_1.CurrencyId.Coin, info.price, true)) {
          M_1.default.tips.show(Constant_1.WaringTips.BuyOk);
          M_1.default.runtime.updatePropCount(type, 1);
        }
        this._initView();
      };
      __decorate([ property(cc.Label) ], BuyPowerCtrl.prototype, "remainPowerCount", void 0);
      __decorate([ property(cc.Label) ], BuyPowerCtrl.prototype, "countDown", void 0);
      __decorate([ property(cc.Label) ], BuyPowerCtrl.prototype, "fillFullLabl", void 0);
      __decorate([ property(cc.Node) ], BuyPowerCtrl.prototype, "littleMoney", void 0);
      __decorate([ property(cc.Label) ], BuyPowerCtrl.prototype, "littlePrice", void 0);
      __decorate([ property(cc.Label) ], BuyPowerCtrl.prototype, "littleCount", void 0);
      __decorate([ property(cc.Label) ], BuyPowerCtrl.prototype, "bigPrice", void 0);
      __decorate([ property(cc.Label) ], BuyPowerCtrl.prototype, "bigCount", void 0);
      __decorate([ property(cc.Node) ], BuyPowerCtrl.prototype, "bigMoney", void 0);
      BuyPowerCtrl = __decorate([ ccclass ], BuyPowerCtrl);
      return BuyPowerCtrl;
    }(cc.Component);
    exports.default = BuyPowerCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/BaseConst": "BaseConst",
    "../../../Base/Manager/M": "M",
    "../../../Base/Utils/Util": "Util",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/MoneyManager": "MoneyManager",
    "../Common": "Common"
  } ],
  BuyPropPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "8cabarQ+shIy6lL3CnGjBw3", "BuyPropPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var Constant_1 = require("../../Data/Const/Constant");
    var M_1 = require("../../../Base/Manager/M");
    var Common_1 = require("../Common");
    var UIData_1 = require("../../Data/Interface/UIData");
    var ReportMgr_1 = require("../../../Base/Manager/ReportMgr");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var BuyPropPanel = function(_super) {
      __extends(BuyPropPanel, _super);
      function BuyPropPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.propName = null;
        _this.propDetail = null;
        _this.buyCount = null;
        _this.buyMoney = null;
        _this.havaCoinLab = null;
        _this.propIcon = null;
        _this.currencyIcon = null;
        _this.propFrames = [];
        _this.currencyFrames = [];
        _this._type = null;
        _this._buyCount = 1;
        _this._buyMaxCount = 10;
        _this._cfg = null;
        _this._content = null;
        _this._isRuning = false;
        _this._originY = null;
        return _this;
      }
      BuyPropPanel.prototype.onLoad = function() {
        var _this = this;
        _super.prototype.onLoad.call(this);
        this._content.on(cc.Node.EventType.POSITION_CHANGED, function() {
          if (!_this._originY) {
            _this._originY = _this._content.y;
            _this._playIn(null);
          }
        }, this);
      };
      BuyPropPanel.prototype.onInit = function(type) {
        this._buyCount = 1;
        this._content = this.node.getChildByName("content");
        this._initView(type);
      };
      BuyPropPanel.prototype.onShow = function() {
        this._originY && this._playIn(null);
      };
      BuyPropPanel.prototype._initView = function(type) {
        this._type = type;
        this._cfg = M_1.default.table.PropInfo.getByPrimaryKey(type);
        if (this._cfg) {
          this.propName.string = this._cfg.name;
          this.propDetail.string = this._cfg.detail;
          this.propIcon.spriteFrame = this.propFrames[this._type - 100];
          this.currencyIcon.spriteFrame = this.currencyFrames[this._cfg.currencyType];
          this._updateView();
          this._updateBuyCount();
        }
      };
      BuyPropPanel.prototype._updateView = function() {
        this.havaCoinLab.string = "\u5f53\u524d\u91d1\u5e01:" + M_1.default.runtime.getFormateCoin();
      };
      BuyPropPanel.prototype.onAdd = function() {
        this._buyCount++;
        this._buyCount > this._buyMaxCount && (this._buyCount = this._buyMaxCount);
        this._updateBuyCount();
      };
      BuyPropPanel.prototype.onSub = function() {
        this._buyCount--;
        this._buyCount < 1 && (this._buyCount = 1);
        this._updateBuyCount();
      };
      BuyPropPanel.prototype.onCloseBtnClick = function() {
        this._isRuning || this._playOut(function() {
          M_1.default.ui.hideUI(UIData_1.UIHudDef.BuyProp);
        });
      };
      BuyPropPanel.prototype.onBuy = function() {
        if (this._buyCount > 0) {
          var price = this._buyCount * this._cfg.price;
          var currency = this._cfg.currencyType;
          if (price <= M_1.default.runtime.getCurrency(currency)) {
            M_1.default.runtime.addCurrency(currency, -price);
            M_1.default.runtime.updatePropCount(this._type, this._buyCount);
            M_1.default.tips.show(Constant_1.WaringTips.BuyOk);
            this._updateView();
            ReportMgr_1.default.ins.reportBuyProp(this._type, this._buyCount, M_1.default.runtime.getMatch3Level());
          } else M_1.default.tips.show(Common_1.default.getCurrencyName(currency) + "\u4e0d\u591f!");
        }
      };
      BuyPropPanel.prototype._updateBuyCount = function() {
        this.buyCount.string = this._buyCount.toString();
        this.buyMoney.string = (this._buyCount * this._cfg.price).toString();
      };
      BuyPropPanel.prototype._playIn = function(callback) {
        var _this = this;
        if (!this._isRuning) {
          this._content.y = this._originY - this._content.height;
          var a0 = cc.delayTime(0);
          var a1 = cc.moveTo(.3, cc.v2(0, this._originY));
          var a2 = cc.callFunc(function() {
            callback && callback();
            _this._isRuning = false;
          }, this);
          this._isRuning = true;
          this._content.runAction(cc.sequence(a0, a1, a2));
        }
      };
      BuyPropPanel.prototype._playOut = function(callback) {
        var _this = this;
        if (!this._isRuning) {
          var a1 = cc.moveTo(.3, cc.v2(0, this._originY - this._content.height));
          var a2 = cc.callFunc(function() {
            callback && callback();
            _this._isRuning = false;
          }, this);
          this._isRuning = true;
          this._content.runAction(cc.sequence(a1, a2));
        }
      };
      __decorate([ property(cc.Label) ], BuyPropPanel.prototype, "propName", void 0);
      __decorate([ property(cc.Label) ], BuyPropPanel.prototype, "propDetail", void 0);
      __decorate([ property(cc.Label) ], BuyPropPanel.prototype, "buyCount", void 0);
      __decorate([ property(cc.Label) ], BuyPropPanel.prototype, "buyMoney", void 0);
      __decorate([ property(cc.Label) ], BuyPropPanel.prototype, "havaCoinLab", void 0);
      __decorate([ property(cc.Sprite) ], BuyPropPanel.prototype, "propIcon", void 0);
      __decorate([ property(cc.Sprite) ], BuyPropPanel.prototype, "currencyIcon", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], BuyPropPanel.prototype, "propFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], BuyPropPanel.prototype, "currencyFrames", void 0);
      BuyPropPanel = __decorate([ ccclass ], BuyPropPanel);
      return BuyPropPanel;
    }(UIBase_1.default);
    exports.default = BuyPropPanel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../../Base/Manager/ReportMgr": "ReportMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Interface/UIData": "UIData",
    "../Common": "Common"
  } ],
  BytesTable: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "db940Xdfw9ENI5/e0XRkq/F", "BytesTable");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Paths_1 = require("../../Utils/Paths");
    var HttpRequest_1 = require("../../Network/HttpRequest");
    var Common_1 = require("../../../Logic/Common/Common");
    var StorageMgr_1 = require("../StorageMgr");
    var BytesTable = function() {
      function BytesTable(afpb) {
        this.CLS = "";
        this._afpb = null;
        this._isReady = false;
        this._isLoading = false;
        this._afpb = afpb;
      }
      BytesTable.prototype.requestTableData = function(fileName) {
        var _this = this;
        return new Promise(function(resolve) {
          return __awaiter(_this, void 0, void 0, function() {
            var isWeb, tablePath, vKey, dKey, data, v, jsonAss, http;
            return __generator(this, function(_a) {
              switch (_a.label) {
               case 0:
                isWeb = true;
                tablePath = isWeb ? "" + Paths_1.default.NativeTablePath + fileName : "" + Paths_1.default.CDNTablePath + fileName;
                vKey = "__" + fileName + "_version_";
                dKey = "__" + fileName + "_data_";
                data = null;
                v = StorageMgr_1.StorageMgr.RingStorage.week().getValue(vKey, null);
                v && (data = StorageMgr_1.StorageMgr.RingStorage.week().getValue(dKey, null));
                if (!(!data || isWeb)) return [ 3, 4 ];
                if (!isWeb) return [ 3, 2 ];
                return [ 4, Common_1.default.getRes(tablePath, cc.JsonAsset) ];

               case 1:
                jsonAss = _a.sent();
                data = jsonAss.json;
                return [ 3, 4 ];

               case 2:
                http = new HttpRequest_1.HttpRequest(tablePath, HttpRequest_1.HttpRequest.METHOD.GET);
                return [ 4, http.execute() ];

               case 3:
                data = _a.sent();
                _a.label = 4;

               case 4:
                resolve(data);
                data;
                return [ 2 ];
              }
            });
          });
        });
      };
      Object.defineProperty(BytesTable.prototype, "isReady", {
        get: function() {
          this._isReady || this.loadTable();
          return this._isReady;
        },
        enumerable: true,
        configurable: true
      });
      BytesTable.prototype.loadTable = function() {
        return __awaiter(this, void 0, void 0, function() {
          var data;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              if (this._isLoading) return [ 2 ];
              this._isLoading = true;
              return [ 4, this.requestTableData(this.CLS) ];

             case 1:
              data = _a.sent();
              if (data) {
                data = "string" == typeof data ? JSON.parse(data) : data;
                this.readyOK(data);
              }
              this._isLoading = false;
              return [ 2 ];
            }
          });
        });
      };
      BytesTable.prototype.conversionData2pb = function(data) {
        var pbc = this._afpb[this.CLS];
        var c = pbc ? pbc["decode"](data) : null;
        if (c && c.Ary) return c.Ary;
      };
      BytesTable.prototype.splitAttribute = function(originalData) {
        return null;
      };
      return BytesTable;
    }();
    exports.BytesTable = BytesTable;
    cc._RF.pop();
  }, {
    "../../../Logic/Common/Common": "Common",
    "../../Network/HttpRequest": "HttpRequest",
    "../../Utils/Paths": "Paths",
    "../StorageMgr": "StorageMgr"
  } ],
  1: [ function(require, module, exports) {
    var process = module.exports = {};
    var cachedSetTimeout;
    var cachedClearTimeout;
    function defaultSetTimout() {
      throw new Error("setTimeout has not been defined");
    }
    function defaultClearTimeout() {
      throw new Error("clearTimeout has not been defined");
    }
    (function() {
      try {
        cachedSetTimeout = "function" === typeof setTimeout ? setTimeout : defaultSetTimout;
      } catch (e) {
        cachedSetTimeout = defaultSetTimout;
      }
      try {
        cachedClearTimeout = "function" === typeof clearTimeout ? clearTimeout : defaultClearTimeout;
      } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
      }
    })();
    function runTimeout(fun) {
      if (cachedSetTimeout === setTimeout) return setTimeout(fun, 0);
      if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
      }
      try {
        return cachedSetTimeout(fun, 0);
      } catch (e) {
        try {
          return cachedSetTimeout.call(null, fun, 0);
        } catch (e) {
          return cachedSetTimeout.call(this, fun, 0);
        }
      }
    }
    function runClearTimeout(marker) {
      if (cachedClearTimeout === clearTimeout) return clearTimeout(marker);
      if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
      }
      try {
        return cachedClearTimeout(marker);
      } catch (e) {
        try {
          return cachedClearTimeout.call(null, marker);
        } catch (e) {
          return cachedClearTimeout.call(this, marker);
        }
      }
    }
    var queue = [];
    var draining = false;
    var currentQueue;
    var queueIndex = -1;
    function cleanUpNextTick() {
      if (!draining || !currentQueue) return;
      draining = false;
      currentQueue.length ? queue = currentQueue.concat(queue) : queueIndex = -1;
      queue.length && drainQueue();
    }
    function drainQueue() {
      if (draining) return;
      var timeout = runTimeout(cleanUpNextTick);
      draining = true;
      var len = queue.length;
      while (len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) currentQueue && currentQueue[queueIndex].run();
        queueIndex = -1;
        len = queue.length;
      }
      currentQueue = null;
      draining = false;
      runClearTimeout(timeout);
    }
    process.nextTick = function(fun) {
      var args = new Array(arguments.length - 1);
      if (arguments.length > 1) for (var i = 1; i < arguments.length; i++) args[i - 1] = arguments[i];
      queue.push(new Item(fun, args));
      1 !== queue.length || draining || runTimeout(drainQueue);
    };
    function Item(fun, array) {
      this.fun = fun;
      this.array = array;
    }
    Item.prototype.run = function() {
      this.fun.apply(null, this.array);
    };
    process.title = "browser";
    process.browser = true;
    process.env = {};
    process.argv = [];
    process.version = "";
    process.versions = {};
    function noop() {}
    process.on = noop;
    process.addListener = noop;
    process.once = noop;
    process.off = noop;
    process.removeListener = noop;
    process.removeAllListeners = noop;
    process.emit = noop;
    process.prependListener = noop;
    process.prependOnceListener = noop;
    process.listeners = function(name) {
      return [];
    };
    process.binding = function(name) {
      throw new Error("process.binding is not supported");
    };
    process.cwd = function() {
      return "/";
    };
    process.chdir = function(dir) {
      throw new Error("process.chdir is not supported");
    };
    process.umask = function() {
      return 0;
    };
  }, {} ],
  CacheMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "63603frOBBDxLHcQmZID8Bb", "CacheMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Log_1 = require("../Utils/Log");
    var LRUCache_1 = require("../Utils/LRUCache");
    var EventMgr_1 = require("./EventMgr");
    var SingletonFactory_1 = require("../Utils/SingletonFactory");
    var Event_1 = require("../../Logic/Data/Const/Event");
    var CacheMgr = function() {
      function CacheMgr() {
        this.lru = new LRUCache_1.LRUCache(300);
        var self = this;
        cc.loader["_cache"] = new Proxy(cc.loader["_cache"], {
          get: function(target, property) {
            if (property in target) {
              self.getCache(property, target[property]);
              return target[property];
            }
          },
          set: function(target, property, value) {
            self.setCache(property, value);
            target[property] = value;
            return true;
          },
          deleteProperty: function(target, property) {
            self.deleteCache(property, target[property]) && delete target[property];
            return true;
          }
        });
      }
      CacheMgr.prototype.getCache = function(property, cache) {
        Log_1.Log.log(Log_1.LOG_TAG.CACHE, property);
        this.lru.get(property);
      };
      CacheMgr.prototype.setCache = function(property, cache) {
        Log_1.Log.log(Log_1.LOG_TAG.CACHE, property);
        var remove = this.lru.pack(property, cache);
        remove && EventMgr_1.default.ins.send(Event_1.Event.System.CacheWarning);
      };
      CacheMgr.prototype.deleteCache = function(property, cache) {
        Log_1.Log.log(Log_1.LOG_TAG.CACHE, property);
        this.lru.remove(property);
        return true;
      };
      CacheMgr.ins = SingletonFactory_1.SingletonFactory.getInstance(CacheMgr);
      return CacheMgr;
    }();
    exports.default = CacheMgr;
    cc._RF.pop();
  }, {
    "../../Logic/Data/Const/Event": "Event",
    "../Utils/LRUCache": "LRUCache",
    "../Utils/Log": "Log",
    "../Utils/SingletonFactory": "SingletonFactory",
    "./EventMgr": "EventMgr"
  } ],
  CellBase: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "79f6cWA/bZNkLJrtFnKbL1T", "CellBase");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var MsgType;
    (function(MsgType) {
      MsgType[MsgType["BesideElimate"] = 0] = "BesideElimate";
      MsgType[MsgType["ElimateAll"] = 1] = "ElimateAll";
      MsgType[MsgType["Elimate"] = 2] = "Elimate";
      MsgType[MsgType["Fall"] = 3] = "Fall";
      MsgType[MsgType["FallEnd"] = 4] = "FallEnd";
      MsgType[MsgType["UpGroundDone"] = 5] = "UpGroundDone";
      MsgType[MsgType["Bomb"] = 6] = "Bomb";
      MsgType[MsgType["Portal"] = 7] = "Portal";
      MsgType[MsgType["ComplexBomb"] = 8] = "ComplexBomb";
    })(MsgType = exports.MsgType || (exports.MsgType = {}));
    var CellBase = function() {
      function CellBase() {
        this._extData = null;
        this.lv = 0;
        this.type = null;
        this.data = null;
        this.mapIndex = 0;
        this.ctrlName = null;
        this._pos = null;
        this._isDeath = false;
        this.extCtrl = null;
      }
      Object.defineProperty(CellBase.prototype, "isDeath", {
        get: function() {
          return this._isDeath;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(CellBase.prototype, "pos", {
        get: function() {
          return this._pos;
        },
        set: function(p) {
          this.onChangePos(p);
          this._pos = p;
        },
        enumerable: true,
        configurable: true
      });
      CellBase.prototype.getPosition = function() {
        return Common_1.default.getPos(this._pos.x, this._pos.y, this.mapIndex);
      };
      CellBase.prototype.getLv = function() {
        return this.lv;
      };
      CellBase.prototype.setLv = function(num) {
        this.lv += num;
        this.lv = this.lv < 0 ? 0 : this.lv;
      };
      CellBase.prototype.getMapIndex = function() {
        return this.mapIndex;
      };
      CellBase.prototype.getType = function() {
        return this.type;
      };
      Object.defineProperty(CellBase.prototype, "gridData", {
        get: function() {
          return this.data;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(CellBase.prototype, "extData", {
        get: function() {
          return this._extData;
        },
        set: function(node) {
          this._extData = node;
          this.extCtrl = node.getComponent(this.ctrlName);
        },
        enumerable: true,
        configurable: true
      });
      CellBase.prototype.destory = function() {
        this.data = null;
        this._extData = null;
        this.extCtrl = null;
      };
      return CellBase;
    }();
    exports.CellBase = CellBase;
    cc._RF.pop();
  }, {
    "../../Common/Common": "Common"
  } ],
  CellModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "1bbd2gCHSlCbLAjoWunrV08", "CellModel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var GameModel_1 = require("./GameModel");
    var Girl_1 = require("./SpecialPlug/Girl");
    var BombModel_1 = require("./BombModel");
    var CellBase_1 = require("./CellBase");
    var Util_1 = require("../../../Base/Utils/Util");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var Constant_1 = require("../../Data/Const/Constant");
    var M_1 = require("../../../Base/Manager/M");
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var Event_1 = require("../../Data/Const/Event");
    var AudioCtrl_1 = require("../../Common/AudioCtrl");
    var CellModel = function(_super) {
      __extends(CellModel, _super);
      function CellModel() {
        var _this = _super.call(this) || this;
        _this.id = 0;
        _this.isRandom = false;
        _this.isCollect = false;
        _this.bindGModel = null;
        _this.bindUpGModel = null;
        _this.isEmpty = false;
        _this._isFall = false;
        _this.speed = cc.v2(0, 0);
        _this.fallDes = null;
        _this.fallDir = null;
        _this.isBomb = false;
        _this.isGround = false;
        _this.isPlaneSelected = false;
        _this.isExecBomb = false;
        _this.isBombReady = true;
        _this.isJustBombElimate = false;
        _this.isInvincible = false;
        _this.isDestoryed = false;
        _this.isPortaling = false;
        _this.GemLv = 0;
        _this.isRocket = false;
        _this._destoryGroup = null;
        _this.bombModel = null;
        _this._hp = 1;
        _this.type = Constant_1.CellType.Empty;
        _this.ctrlName = "ItemBasicCellCtrl";
        return _this;
      }
      CellModel.prototype.init = function(data, index, pos, isInit, sync2gm) {
        this.data = data;
        this.mapIndex = index;
        this.lv = 0;
        this._hp = 1;
        this.GemLv = 0;
        this._pos = pos;
        this.fallDir = null;
        this.bombModel = null;
        this._destoryGroup = null;
        this.isCollect = false;
        this._isDeath = false;
        this._isFall = false;
        this.isBomb = false;
        this.isGround = false;
        this.isInvincible = false;
        this.isExecBomb = false;
        this.isRocket = false;
        this.isBombReady = true;
        this.isDestoryed = false;
        this.isPlaneSelected = false;
        this.isJustBombElimate = false;
        this.speed = cc.v2(0, 0);
        sync2gm && Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.CellList, pos, this);
        this.data && this.initType(isInit);
      };
      CellModel.prototype.onBind = function() {};
      CellModel.prototype.onUnBind = function(pos) {
        this.bindGModel && this.bindGModel.onUnBind(pos);
        this.bindUpGModel && this.bindUpGModel.onUnBind(pos);
      };
      CellModel.prototype.initBindGround = function(gCell, upCell) {
        this.bindGround(gCell);
        this.bindGround(upCell, true);
      };
      CellModel.prototype.initBombModel = function(type) {
        void 0 === type && (type = null);
        this.isBomb = true;
        this.bombModel = new BombModel_1.BombModel();
        this.bombModel.init(type || this.type, this.pos.x, this.pos.y);
      };
      CellModel.prototype.initType = function(isInit) {
        this.isEmpty = false;
        if (this.data.ground) {
          this.lv = this.data.ground;
          this.isGround = true;
          this.GemLv = this.data.gem;
          this.GemLv && (GameModel_1.default.ins.isHaveGem = true);
          GameModel_1.default.ins.isHavaMoveGround = true;
          this.setNormalType(Constant_1.CellType.Ground);
        } else if (null != this.data.rocket_type && void 0 != this.data.rocket_type) {
          this.isRocket = true;
          this.setNormalType(this.data.rocket_type);
        } else if (this.data.empty || this.data.flowers || this.data.firefly || this.data.mushroom) {
          this.type = Constant_1.CellType.Empty;
          this.isEmpty = true;
        } else if (this.data.counter_level) {
          this.setNormalType(Constant_1.CellType.BottleCaps);
          this.setLv(this.data.counter_level);
        } else if (void 0 == this.data.type) this.setRandomType(isInit); else if (this.data.type < Constant_1.CellType.Bomb1) this.setNormalType(this.data.type); else if (Common_1.default.isBombType(this.data.type)) {
          this.type = this.data.type;
          this.initBombModel();
        }
        this.type == Constant_1.CellType.BrokenConch && (this._hp = Constant_1.BrokenConchHp);
      };
      CellModel.prototype.onMsg = function(type, parame) {
        switch (type) {
         case CellBase_1.MsgType.BesideElimate:
          this.execBesideElimate(parame);
          break;

         case CellBase_1.MsgType.Elimate:
          this.execElimate(parame);
          break;

         case CellBase_1.MsgType.Fall:
          break;

         case CellBase_1.MsgType.FallEnd:
          this.stopFall();
          this.checkIsExit(this.pos);
          this._updateGroundView();
          break;

         case CellBase_1.MsgType.Bomb:
          this.execBomb(parame);
          break;

         case CellBase_1.MsgType.Portal:
          this.execPortal();
          break;

         case CellBase_1.MsgType.ComplexBomb:
          this.execComplexBomb(parame);
          break;

         case CellBase_1.MsgType.UpGroundDone:
          if (this.isEmpty) {
            this.notifyRoundFall();
            GameModel_1.default.ins._isBorn(this.pos) && this.extCtrl && this.extCtrl.preDestory();
          } else this.continue2Fall();
          this.execPortal();
        }
      };
      CellModel.prototype.resetTypeAttribute = function() {
        switch (this.type) {
         case Constant_1.CellType.BrokenConch:
         case Constant_1.CellType.Banana:
         case Constant_1.CellType.Ground:
         case Constant_1.CellType.BottleCaps:
          this.isJustBombElimate = true;
          break;

         case Constant_1.CellType.Girl:
         case Constant_1.CellType.Conch:
          this.isInvincible = true;
          break;

         case Constant_1.CellType.IceCream:
          this.isInvincible = true;
          GameModel_1.default.ins.IceCreamPool.add(this);
          break;

         case Constant_1.CellType.Empty:
          this.isEmpty = true;
        }
      };
      CellModel.prototype.setNormalType = function(type) {
        this.type = type;
        this.resetTypeAttribute();
      };
      CellModel.prototype.changeBindGround = function(pos) {
        this.bindGround(Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, pos));
        this.bindGround(Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.UpGroundList, pos), true);
      };
      CellModel.prototype.lockCreateBombPos = function(size, type) {
        size >= 4 && type == Constant_1.ElimateType.Default && GameModel_1.default.ins.Lock.lockFallPos(this.pos, this.pos);
      };
      CellModel.prototype.unlockCreateBombPos = function() {
        GameModel_1.default.ins.Lock.unLockFallPos(this.pos);
      };
      CellModel.prototype.doTestDeath = function() {
        this.isInvincible || this._hp--;
        this._isDeath = this._hp <= 0;
        return this.isDeath;
      };
      CellModel.prototype.execUpElimate = function(type) {
        var data = {
          id: this.GroupId,
          type: type
        };
        this.isCanElimate() ? this.isEmpty && this.bindGModel && this.bindGModel.onMsg(CellBase_1.MsgType.Elimate, data) : this.bindUpGModel && this.bindUpGModel.onMsg(CellBase_1.MsgType.Elimate, data);
      };
      CellModel.prototype.execElimate = function(data) {
        if (this.isCanElimate()) {
          data && data.isForced && (this._isDeath = true);
          this.GroupId = data.id;
        }
      };
      CellModel.prototype.execBesideElimate = function(data) {
        if (this.isCanBesideElimate() && data.type != Constant_1.ElimateType.Beside && !data.cell.isCanBesideElimate()) {
          this.lv--;
          this.lv > 0 ? this.extCtrl && this.extCtrl.playBrokenEff() : this.elimateSelf(Constant_1.ElimateType.Beside);
        }
      };
      CellModel.prototype.notifyRoundElimate = function(type) {
        var _this = this;
        void 0 === type && (type = Constant_1.ElimateType.Default);
        GameModel_1.default.ins && Common_1.default.Dir4.forEach(function(dir) {
          var pos = _this.pos.add(dir);
          var threeLayer = [ GameModel_1.default.ins.UpGroundList, GameModel_1.default.ins.GroundList, GameModel_1.default.ins.CellList ];
          for (var i = threeLayer.length; i--; ) {
            var cell = Common_1.default.safeGet2ArrayValue(threeLayer[i], pos);
            !cell || type != Constant_1.ElimateType.Default && type != Constant_1.ElimateType.Bomb5 || cell.onMsg(CellBase_1.MsgType.BesideElimate, {
              type: type,
              cell: _this,
              groupId: _this._destoryGroup
            });
          }
        });
      };
      CellModel.prototype.notifyRoundFall = function() {
        GameModel_1.default.ins.testFindCanFallCell(this.pos, this._destoryGroup);
      };
      CellModel.prototype.notifyPlugEvent = function() {
        this.type == Constant_1.CellType.BrokenConch && GameModel_1.default.ins.notifyPlug(Girl_1.default);
      };
      CellModel.prototype._updateGroundView = function() {
        if (this.isGround && this.extCtrl) {
          this.extCtrl.showGround();
          this.extCtrl.updateGroundView();
        }
      };
      CellModel.prototype.isNotFixed = function() {
        var result = true;
        this.bindUpGModel && (result = this.bindUpGModel.isCanFall());
        switch (this.type) {
         case Constant_1.CellType.Conch:
         case Constant_1.CellType.Girl:
          result = false;
        }
        return result;
      };
      CellModel.prototype.startFall = function(dir) {
        void 0 === dir && (dir = null);
        this.fallDir = dir || cc.v2(0, 1);
        this._isFall = true;
        GameModel_1.default.ins.Lock.lockFallPos(this.pos.add(this.fallDir), this.pos);
        EventMgr_1.default.ins.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.CellFall);
      };
      CellModel.prototype._deleteOutOfGridCell = function() {
        var groundCell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, this.pos);
        if (!groundCell || null == groundCell.getType()) {
          this.extCtrl && this.extCtrl.preDestory();
          var nextPos = this.pos.add(this.fallDir);
          GameModel_1.default.ins.Lock.unLockBornPos(nextPos);
          GameModel_1.default.ins.Lock.unLockFallLockByKey(this.pos);
        }
      };
      CellModel.prototype.stopFall = function() {
        this.extCtrl.playFallOverAni();
        this._isFall = false;
        GameModel_1.default.ins.completFall(this._destoryGroup, this);
        GameModel_1.default.ins.removeFallDict(this);
        this._deleteOutOfGridCell();
        this.isDeath || (this._destoryGroup = null);
      };
      CellModel.prototype.resetFallDir = function(dir) {
        void 0 === dir && (dir = null);
        this.fallDes = null;
        GameModel_1.default.ins.Lock.unLockFallLockByKey(this.pos);
        this.startFall(dir);
        this.notifyRoundFall();
      };
      CellModel.prototype.unBindGround = function(gm) {
        if (gm.isPortalOut()) {
          var portalPos = GameModel_1.default.ins.getUpGroundModel().getPortalPos(gm.portalIdx);
          var cell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, portalPos.in);
          cell && cell.onMsg(CellBase_1.MsgType.Portal);
        }
      };
      CellModel.prototype.bindGround = function(model, isUp) {
        void 0 === isUp && (isUp = false);
        if (!model) return;
        isUp ? model.getType() != Constant_1.UpGroundType.None && (this.bindUpGModel = model) : null != model.getType() && (this.bindGModel = model);
        model.onBind(this);
      };
      CellModel.prototype.onChangePos = function(pos) {
        this.onUnBind(this.pos);
        Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.CellList, pos, this);
        this.bindGround(Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, pos));
        this.bindUpGModel && (this.bindUpGModel.pos = pos);
      };
      CellModel.prototype.setRandomType = function(isInit, mapIndex) {
        void 0 === isInit && (isInit = false);
        void 0 === mapIndex && (mapIndex = null);
        this.isRandom = true;
        var tempType = GameModel_1.default.ins.getRandomCellType();
        if (Common_1.default.isBombType(tempType) && !isInit) {
          this.type = tempType;
          this.initBombModel();
        } else if (this.type == tempType) this.setRandomType(isInit, mapIndex); else {
          this.type = tempType;
          var isxx = GameModel_1.default.ins.checkPoint(this.pos, null, mapIndex);
          isInit && (GameModel_1.default.ins.checkIsNoInitCreate(tempType) || isxx) && this.setRandomType(isInit, mapIndex);
        }
        this.resetTypeAttribute();
      };
      CellModel.prototype.triggerPortal = function(pos) {
        return __awaiter(this, void 0, void 0, function() {
          var rOut;
          var _this = this;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              if (!this.extCtrl) return [ 2 ];
              this.isPortaling = true;
              GameModel_1.default.ins.Lock.lockBornPos(pos.out);
              return [ 4, this.extCtrl.portalOut() ];

             case 1:
              rOut = _a.sent();
              if (rOut) {
                GameModel_1.default.ins.Lock.unLockBornPos(pos.out);
                Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.CellList, this.pos, null);
                this.notifyRoundFall();
                this.pos = pos.out;
                this.isPortaling = false;
                this.extCtrl.portalIn().then(function(rIn) {
                  rIn && !_this._isFall && _this.continue2Fall();
                });
                if (!this.continue2Fall()) {
                  GameModel_1.default.ins.checkHavaElimate(this.pos);
                  this._updateGroundView();
                }
                this.extCtrl.updatePosition();
                GameModel_1.default.ins.PortalDict.delete(this);
              }
              return [ 2 ];
            }
          });
        });
      };
      CellModel.prototype.checkIsExit = function(pos) {
        if (this.type == Constant_1.CellType.IceCream) {
          var gm = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, pos);
          if (gm && gm.isExit) {
            this.elimateSelf(null);
            GameModel_1.default.ins.IceCreamPool.delete(this);
          }
        }
      };
      CellModel.prototype.isCanTriggerPortal = function(gm) {
        return !this.isEmpty && gm && gm.isPortalIn() && this.isNotFixed();
      };
      CellModel.prototype.elimateSelf = function(type) {
        GameModel_1.default.ins.execElimateOne(this.pos, type || Constant_1.ElimateType.Default, true);
      };
      CellModel.prototype.execPortal = function() {
        var result = false;
        if (GameModel_1.default.ins.PortalDict.has(this)) return true;
        var groudModel = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, this.pos);
        if (!groudModel) return false;
        if (groudModel.isPortalOut()) {
          var portalPos = GameModel_1.default.ins.getUpGroundModel().getPortalPos(groudModel.portalIdx);
          var portalInCell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, portalPos.in);
          !portalInCell || portalInCell.isRemoved() || portalInCell.isFall || portalInCell.onMsg(CellBase_1.MsgType.Portal);
        } else if (!this.isDeath && this.isCanTriggerPortal(groudModel)) {
          var portalPos = GameModel_1.default.ins.getUpGroundModel().getPortalPos(groudModel.portalIdx);
          if (GameModel_1.default.ins.isCanFall(portalPos.out, this.pos) && !GameModel_1.default.ins.Lock.isBornPosLocked(portalPos.out)) {
            result = true;
            GameModel_1.default.ins.PortalDict.add(this);
            this.triggerPortal(portalPos);
          }
        }
        return result;
      };
      CellModel.prototype.execComplexBomb = function(data) {
        if (this.bombModel) {
          this.bombModel.onBombMergeBomb(data.type1, data.type2, this, data.groupId);
          data.isBoard || GameModel_1.default.ins.updateStepCount();
        }
      };
      CellModel.prototype.execBomb = function(data) {
        if (this.bombModel && !this.isRemoved()) {
          var type = null;
          if (data) {
            type = data.type;
            if (!type) {
              var target = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, data.pos);
              target && (type = target.getType());
            }
          }
          this.unlockCreateBombPos();
          this.bombModel.getType() == Constant_1.CellType.Bomb5 ? null != type && this.bombModel.execBomb(this, type, this._destoryGroup) : this.bombModel.execBomb(this, type, this._destoryGroup);
        }
      };
      Object.defineProperty(CellModel.prototype, "GroupId", {
        get: function() {
          return this._destoryGroup;
        },
        set: function(id) {
          null == this._destoryGroup && (this._destoryGroup = id);
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(CellModel.prototype, "fallingDir", {
        get: function() {
          return this.fallDir;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(CellModel.prototype, "isFall", {
        get: function() {
          return this._isFall;
        },
        enumerable: true,
        configurable: true
      });
      CellModel.prototype.change2Cell = function(type) {
        void 0 === type && (type = null);
        this.setNormalType(type);
        GameModel_1.default.ins.checkHavaElimate(this.pos);
      };
      CellModel.prototype.change2Bomb = function(type) {
        void 0 === type && (type = null);
        this.data = {};
        this.data.type = type || Util_1.Util.Tool.rangeInt(10, Constant_1.CellType.Bomb4);
        this.initType(false);
      };
      CellModel.prototype.isCanBesideElimate = function() {
        return this.type == Constant_1.CellType.Banana || this.type == Constant_1.CellType.BottleCaps || this.type == Constant_1.CellType.Ground;
      };
      CellModel.prototype.isCanElimate = function() {
        return !this.bindUpGModel || this.bindUpGModel && !this.bindUpGModel.isHavaSpe;
      };
      CellModel.prototype.isFalling = function() {
        return this.isFall && (this.speed.y > 0 || this.speed.x > 0);
      };
      CellModel.prototype.isRemoved = function() {
        return this.isDeath && !this.extData;
      };
      CellModel.prototype.mermaidJumpTo = function(targetPos) {
        var _this = this;
        if (this.extCtrl) {
          GameModel_1.default.ins.Lock.lockFallPos(targetPos, this.pos, true);
          this.extCtrl.mermaidJumpTo(targetPos, function() {
            Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.CellList, _this.pos, null);
            _this._moveOver(targetPos);
            _this.notifyRoundFall();
          });
        }
      };
      CellModel.prototype.conveyerMoveTo = function(targetPos, callback) {
        var _this = this;
        if (this.extCtrl) {
          GameModel_1.default.ins.Lock.lockFallPos(targetPos, this.pos, true);
          Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.CellList, this.pos, null);
          this.extCtrl.moveTo(targetPos, function() {
            _this._moveOver(targetPos);
            callback && callback();
          });
        }
      };
      CellModel.prototype._moveOver = function(targetPos) {
        GameModel_1.default.ins.Lock.unLockFallPos(targetPos);
        this.pos = targetPos;
      };
      CellModel.prototype.preDestory = function() {
        _super.prototype.destory.call(this);
      };
      CellModel.prototype.destory = function(tType) {
        this._isDeath = true;
        this.isEmpty || M_1.default.runtime.addCollectCount(this.type);
        this.notifyPlugEvent();
        this.bindGModel && !this.isEmpty && this.bindGModel.onMsg(CellBase_1.MsgType.Elimate, {
          type: tType
        });
        if (!this.isRocket) {
          var havePowerCollect = GameModel_1.default.ins.CollectModel.updateCollectPowerCell(this);
          havePowerCollect || M_1.default.runtime.GameState == Constant_1.GameState.End || GameModel_1.default.ins.updateCollectCount(this.type, this.getPosition(), tType);
        }
        GameModel_1.default.ins._isBorn(this.pos) && GameModel_1.default.ins.checkNeedCreateNewCell(this.pos, this._destoryGroup);
        GameModel_1.default.ins.removeDeathDict(this);
        Common_1.default.isBombType(this.getType()) && this.unlockCreateBombPos();
        this.type = Constant_1.CellType.Empty;
        this.isDestoryed = true;
        GameModel_1.default.ins.removeFallDict(this);
        this.notifyRoundFall();
        GameModel_1.default.ins.freeCell(this);
        this._destoryGroup = null;
      };
      CellModel.prototype.forcedResetType = function(type) {
        this.type = type;
      };
      CellModel.prototype.isGridPosChanged = function(nextpos) {
        return 0 != this.fallDir.x && 0 != this.fallDir.y ? nextpos.x != this.pos.x && nextpos.y != this.pos.y : nextpos.x != this.pos.x || nextpos.y != this.pos.y;
      };
      CellModel.prototype.isFallOver = function(nextPos) {
        var result = false;
        var nextCell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, nextPos);
        !nextCell || nextCell.isDeath || nextCell.isEmpty || nextCell.isFall ? GameModel_1.default.ins.isBorder(nextPos) ? result = true : GameModel_1.default.ins.isPassable(nextPos, this.pos) || (result = true) : result = true;
        return result;
      };
      CellModel.prototype.triggerFallChangePos = function(pos) {
        pos = GameModel_1.default.ins.getNotPassblePoss(pos);
        var testCell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, pos);
        if (testCell) {
          if (!testCell.isDeath && !testCell.isEmpty) return null;
          testCell.isEmpty && !GameModel_1.default.ins.isHavaSpe(pos) && testCell.extCtrl && testCell.extCtrl.preDestory();
        }
        Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, this.pos) == this && Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.CellList, this.pos, null);
        if (GameModel_1.default.ins._isBorn(pos)) {
          GameModel_1.default.ins.Lock.unLockBornPos(pos);
          GameModel_1.default.ins.removeNewCreateCell(this);
        }
        GameModel_1.default.ins.Lock.unLockFallLockByKey(this.pos);
        this.pos = pos;
        GameModel_1.default.ins.isCanFall(this.pos.add(cc.v2(0, 1)), this.pos) && (this.fallDir = cc.v2(0, 1));
        0 == this.fallDir.x || GameModel_1.default.ins.isCanDiagonallyFall(this.pos.add(this.fallDir), this) || (this.fallDir = cc.v2(0, 1));
        var nextpos = GameModel_1.default.ins.getNotPassblePoss(this.pos.add(this.fallDir));
        return nextpos;
      };
      CellModel.prototype.continue2Fall = function(isCreateBomb) {
        void 0 === isCreateBomb && (isCreateBomb = false);
        var result = false;
        var dirs = [ cc.v2(0, 1), cc.v2(-1, 1), cc.v2(1, 1) ];
        Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, this.pos) || (dirs = [ cc.v2(0, 1) ]);
        for (var i = 0; i < dirs.length; i++) {
          var dir = dirs[i];
          var targetPos = this.pos.add(dir);
          if (this.isNotFixed() && !GameModel_1.default.ins.isBorder(targetPos) && GameModel_1.default.ins.isCanFall(targetPos, this.pos, false, isCreateBomb)) {
            if (0 != dir.x && !GameModel_1.default.ins.isCanDiagonallyFall(targetPos, this)) continue;
            this._destoryGroup || (this.GroupId = GameModel_1.default.ins.seq.next());
            GameModel_1.default.ins.addFallCell(this, dir, this._destoryGroup);
            this.notifyRoundFall();
            result = true;
            break;
          }
        }
        return result;
      };
      CellModel.prototype.resetFallState = function() {
        this.speed = cc.v2(0, 0);
        this.fallDes = null;
        GameModel_1.default.ins.Lock.unLockFallLockByKey(this.pos);
        var isObl = this.continue2Fall();
        var isPor = this.execPortal();
        isPor || isObl || this.onMsg(CellBase_1.MsgType.FallEnd);
      };
      CellModel.prototype.applySpeed = function(nextpos) {
        this.speed = cc.v2(0, 0);
        this.fallDes = Common_1.default.getPos(nextpos.x, nextpos.y);
        GameModel_1.default.ins.isCanFall(nextpos, this.pos) && (this.speed.x = this.speed.y = TimeConfig_1.GapTime.FallingSpeed);
      };
      CellModel.prototype.updateFall = function(dt) {
        this.extCtrl && this.extCtrl.orderlyUpdate(dt);
      };
      CellModel.prototype.posDetection = function(position) {
        var result = false;
        if (this._isFall && !this.isEmpty) {
          GameModel_1.default.ins.isFalling = true;
          var currpos = Common_1.default.convetPos(position.add(cc.v3(0, Common_1.default.GRID_H / 2)));
          var nextpos = this.pos.add(this.fallDir);
          nextpos = this.isGridPosChanged(currpos) ? this.triggerFallChangePos(currpos) || nextpos : GameModel_1.default.ins.getNotPassblePoss(nextpos);
          this.applySpeed(nextpos);
          this.speed.equals(cc.v2(0, 0)) ? this.extCtrl.playFallPauseAni() : 0 == this.fallDir.x && M_1.default.runtime.GameState != Constant_1.GameState.End && this.extCtrl.playFallStartAni();
          result = this.isFallOver(nextpos);
          result ? this.resetFallState() : GameModel_1.default.ins.Lock.lockFallPos(nextpos, this.pos);
        }
        return result;
      };
      CellModel.prototype.update = function(dt) {
        this.extCtrl && this.extCtrl.orderlyUpdate(dt);
      };
      return CellModel;
    }(CellBase_1.CellBase);
    exports.CellModel = CellModel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/Manager/M": "M",
    "../../../Base/Utils/Util": "Util",
    "../../Common/AudioCtrl": "AudioCtrl",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Const/TimeConfig": "TimeConfig",
    "./BombModel": "BombModel",
    "./CellBase": "CellBase",
    "./GameModel": "GameModel",
    "./SpecialPlug/Girl": "Girl"
  } ],
  ChapterInfo: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "a02328K7UZK37f/ouKQarPQ", "ChapterInfo");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var ChapterInfo = function() {
      function ChapterInfo(data) {
        this.id = null;
        this.name = null;
        this.detail = null;
        this.resId = null;
        this.minLv = 0;
        this.maxLv = 0;
        this.id = data.id;
        this.name = data.name;
        this.detail = data.detail || "";
        this.resId = data.res;
        this.setLv(data.lv);
      }
      ChapterInfo.prototype.setLv = function(cs) {
        if (cs) {
          var sc = cs.split("|");
          this.minLv = Number(sc[0]);
          this.maxLv = Number(sc[1]);
        }
      };
      return ChapterInfo;
    }();
    exports.default = ChapterInfo;
    cc._RF.pop();
  }, {} ],
  ChapterItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e5d46FzdJpKuoZJKYplD7QH", "ChapterItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Logic/Common/Common");
    var Paths_1 = require("../../Base/Utils/Paths");
    var M_1 = require("../../Base/Manager/M");
    var EventMgr_1 = require("../../Base/Manager/EventMgr");
    var Event_1 = require("../../Logic/Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ContentOffsetX = 120;
    var ChapterItemCtrl = function(_super) {
      __extends(ChapterItemCtrl, _super);
      function ChapterItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.bg = null;
        _this.islandParent = null;
        _this.content = null;
        _this.lvScope = null;
        _this.chapterName = null;
        _this.detailLab = null;
        _this.lockNode = null;
        _this.infoNode = null;
        _this._data = null;
        _this._isLocked = false;
        _this._clickCallBack = null;
        return _this;
      }
      ChapterItemCtrl.prototype.init = function(data, isLandScale, clickCallback) {
        void 0 === isLandScale && (isLandScale = 1);
        this.lockNode.active = false;
        if (data) {
          this._data = data;
          this.chapterName.string = data.name;
          this.detailLab.string = data.detail;
          this.islandParent.scale = isLandScale;
          this._clickCallBack = clickCallback;
          this.lockNode.scale = isLandScale;
          this.lvScope.string = data.minLv + "-" + data.maxLv + "\u5173";
          this.lockNode.active = this._isLocked = M_1.default.runtime.getMatch3Level() < data.minLv;
          this._initIsland(data.resId);
        }
      };
      ChapterItemCtrl.prototype._onClick = function() {
        this._data && !this._isLocked && this._clickCallBack && this._clickCallBack(this._data);
      };
      ChapterItemCtrl.prototype._initIsland = function(resId) {
        var _this = this;
        Common_1.default.getRes(Paths_1.default.LevelMapPath + "island_" + resId, cc.Prefab).then(function(eff) {
          if (eff) {
            var island = M_1.default.nodePool.createItem(eff);
            island.parent = _this.islandParent;
            island.on(cc.Node.EventType.TOUCH_END, _this._onClick, _this);
            _this.infoNode.active = false;
            1 != _this.islandParent.scale && _this._setIslandOffset(Number(resId));
            _this._showLock(island);
          } else console.error("\u7ae0\u8282\u5c9b\u5c7f\u52a0\u8f7d\u5931\u8d25!");
        });
      };
      ChapterItemCtrl.prototype._showLock = function(islandNode) {
        if (this._isLocked) {
          islandNode.getComponent(cc.Button).interactable = false;
          this.chapterName.getComponent(cc.LabelOutline).enabled = true;
        } else {
          islandNode.getComponent(cc.Button).interactable = true;
          this.chapterName.getComponent(cc.LabelOutline).enabled = false;
        }
      };
      ChapterItemCtrl.prototype._setIslandOffset = function(resId) {
        this.infoNode.active = true;
        this.node.x += resId % 2 == 0 ? ContentOffsetX : -ContentOffsetX;
      };
      ChapterItemCtrl.prototype.doCloudUnlock = function() {
        var _this = this;
        this.lockNode.active = true;
        this.scheduleOnce(function() {
          var animation = _this.lockNode.getComponent(cc.Animation);
          animation.play();
          EventMgr_1.default.ins.send(Event_1.Event.UI.LevelSceneTouched, true);
        }, 1.5);
      };
      ChapterItemCtrl.prototype.onFinished = function() {
        console.error("\u64ad\u653e\u89e3\u9501\u52a8\u753b\u5b8c\u6bd5");
        this.lockNode.active = false;
      };
      __decorate([ property(cc.Sprite) ], ChapterItemCtrl.prototype, "bg", void 0);
      __decorate([ property(cc.Node) ], ChapterItemCtrl.prototype, "islandParent", void 0);
      __decorate([ property(cc.Node) ], ChapterItemCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Label) ], ChapterItemCtrl.prototype, "lvScope", void 0);
      __decorate([ property(cc.Label) ], ChapterItemCtrl.prototype, "chapterName", void 0);
      __decorate([ property(cc.Label) ], ChapterItemCtrl.prototype, "detailLab", void 0);
      __decorate([ property(cc.Node) ], ChapterItemCtrl.prototype, "lockNode", void 0);
      __decorate([ property(cc.Node) ], ChapterItemCtrl.prototype, "infoNode", void 0);
      ChapterItemCtrl = __decorate([ ccclass ], ChapterItemCtrl);
      return ChapterItemCtrl;
    }(cc.Component);
    exports.default = ChapterItemCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/EventMgr": "EventMgr",
    "../../Base/Manager/M": "M",
    "../../Base/Utils/Paths": "Paths",
    "../../Logic/Common/Common": "Common",
    "../../Logic/Data/Const/Event": "Event"
  } ],
  ChapterStory: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "8cb9d3nx9hAPqIstmeotG6W", "ChapterStory");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var ChapterStory = function() {
      function ChapterStory(data) {
        this.chapterId = null;
        this.trigger = null;
        this.infomation = null;
        this.storys = null;
        this.chapterId = data.id;
        this.trigger = data.trigger;
        this.infomation = data.infomation;
        this.resetContentAry(data.content);
      }
      ChapterStory.prototype.resetContentAry = function(cs) {
        var _this = this;
        if (cs) {
          this.storys = [];
          cs.forEach(function(c) {
            if (c) {
              var sc = c.split("|");
              _this.storys.push({
                rid: Number(sc[0]),
                name: sc[1],
                isLeft: !Number(sc[2]),
                content: sc[3]
              });
            }
          });
        }
      };
      return ChapterStory;
    }();
    exports.default = ChapterStory;
    cc._RF.pop();
  }, {} ],
  CloudView: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "12093WvMqZNFrs8PI0DhElx", "CloudView");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SpinePlayerCtrl_1 = require("../../../../Base/CustomComponent/SpinePlayerCtrl");
    var UIBase_1 = require("../../../../Base/UI/UIBase");
    var Constant_1 = require("../../../Data/Const/Constant");
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var Common_1 = require("../../../Common/Common");
    var EventMgr_1 = require("../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Data/Const/Event");
    var ICloudData;
    (function(ICloudData) {
      ICloudData[ICloudData["JumpIsland"] = 1] = "JumpIsland";
      ICloudData[ICloudData["LeaveIsland"] = 2] = "LeaveIsland";
      ICloudData[ICloudData["OpenHotel"] = 3] = "OpenHotel";
      ICloudData[ICloudData["RoomRefresh"] = 4] = "RoomRefresh";
      ICloudData[ICloudData["VisitFriendHotel"] = 5] = "VisitFriendHotel";
    })(ICloudData = exports.ICloudData || (exports.ICloudData = {}));
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var CloudView = function(_super) {
      __extends(CloudView, _super);
      function CloudView() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this._data = null;
        _this._hasPlayer = false;
        _this._hasLoaded = false;
        return _this;
      }
      CloudView.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
      };
      CloudView.prototype.onInit = function(param) {
        var spinePlayerCtrl = this._spinePlayerCtrl = this.getComponent(SpinePlayerCtrl_1.default);
        spinePlayerCtrl.enabled = true;
        spinePlayerCtrl.paused = true;
        this._data = param;
        this.timePlay();
        switch (param) {
         case ICloudData.JumpIsland:
          this.preloadIslandMap();
          break;

         case ICloudData.LeaveIsland:
          this._hasLoaded = true;
          this.playCloud();
          break;

         case ICloudData.OpenHotel:
          this._hasLoaded = true;
          break;

         case ICloudData.RoomRefresh:
          this._hasLoaded = true;
          EventMgr_1.default.ins.send(Event_1.Event.Hotel.RoomFinished);
          break;

         case ICloudData.VisitFriendHotel:
          this._hasLoaded = true;
        }
      };
      CloudView.prototype.preloadIslandMap = function() {
        this.playCloud();
      };
      CloudView.prototype.timePlay = function() {
        this.scheduleOnce(this.playCloud, 1);
      };
      CloudView.prototype.playCloud = function() {
        if (this._hasPlayer || !this._hasLoaded || null == this._spinePlayerCtrl) return;
        this._hasPlayer = true;
        this.unschedule(this.playCloud);
        this.doBeforePlay();
      };
      CloudView.prototype.doBeforePlay = function() {
        this._data == ICloudData.JumpIsland ? Common_1.default.jumpScene(Constant_1.Scene.Map, this.beginPlay.bind(this)) : this._data == ICloudData.LeaveIsland ? Common_1.default.jumpScene(Constant_1.Scene.Level, this.beginPlay.bind(this)) : this.beginPlay();
      };
      CloudView.prototype.beginPlay = function() {
        if (null == this._spinePlayerCtrl) return;
        this._spinePlayerCtrl.paused = false;
        this._spinePlayerCtrl.play("cloud", 0, false, this.playCloudComplete);
      };
      CloudView.prototype.playCloudComplete = function() {
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.CloudView, true);
      };
      CloudView.prototype.onDestroy = function() {
        _super.prototype.onDestroy.call(this);
        this.unschedule(this.playCloud);
        this._spinePlayerCtrl = null;
        this._hasPlayer = false;
        this._hasLoaded = false;
      };
      CloudView = __decorate([ ccclass ], CloudView);
      return CloudView;
    }(UIBase_1.default);
    exports.default = CloudView;
    cc._RF.pop();
  }, {
    "../../../../Base/CustomComponent/SpinePlayerCtrl": "SpinePlayerCtrl",
    "../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../../Base/UI/UIBase": "UIBase",
    "../../../Common/Common": "Common",
    "../../../Data/Const/Constant": "Constant",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData"
  } ],
  CollectItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "d795dPvQlNJD47uiGgPm8kD", "CollectItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var ResCtrl_1 = require("../../ResCtrl");
    var M_1 = require("../../../../Base/Manager/M");
    var GameModel_1 = require("../../Model/GameModel");
    var Event_1 = require("../../../Data/Const/Event");
    var CollectModel_1 = require("../../Model/CollectModel");
    var Constant_1 = require("../../../Data/Const/Constant");
    var Common_1 = require("../../../Common/Common");
    var RuntimeMgr_1 = require("../../../Data/RuntimeMgr");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var CollectItemCtrl = function(_super) {
      __extends(CollectItemCtrl, _super);
      function CollectItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.count = null;
        _this.icon = null;
        _this.BombStaticFrame = [];
        _this.NormalCellFrame = [];
        _this.Map2NormalCellFrame = [];
        _this.CollectIcon = [];
        _this._type = null;
        return _this;
      }
      CollectItemCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.UpdateInfoPanel, this.onUpdateCollectCount, this);
      };
      CollectItemCtrl.prototype.init = function(type, count) {
        this._type = type;
        this.icon.spriteFrame = this.getIcon(type);
        var heithLimit = 60;
        "showTargetPrefab" == this.node.name && (heithLimit = 80);
        this.icon.node.setScale(heithLimit / this.icon.node.height);
        this.count.string = "x" + count;
        M_1.default.event.register(Event_1.Event.UI.UpdateInfoPanel, this.onUpdateCollectCount, this);
      };
      CollectItemCtrl.prototype.changeLabelColor = function(color) {
        void 0 === color && (color = null);
        this.count.node.color = color || cc.color(255, 0, 0, 255);
      };
      CollectItemCtrl.prototype.onUpdateCollectCount = function(type) {
        if (type == this._type) {
          var c = GameModel_1.default.ins.getCollect();
          c && (this.count.string = "" + c.get(type + ""));
        }
      };
      CollectItemCtrl.prototype.getIcon = function(type) {
        var index = null;
        var result = null;
        switch (type) {
         case CollectModel_1.CollectType.box:
          index = 0;
          break;

         case CollectModel_1.CollectType.gnome:
          index = 1;
          break;

         case CollectModel_1.CollectType.turtles:
          index = 2;
          break;

         case CollectModel_1.CollectType.tree:
          index = 3;
          break;

         case CollectModel_1.CollectType.crab:
          index = 4;
          break;

         case CollectModel_1.CollectType.stone:
          index = 5;
          break;

         case CollectModel_1.CollectType.gem:
          index = 6;
          break;

         case CollectModel_1.CollectType.firefly:
          index = 7;
          break;

         case CollectModel_1.CollectType.colorbox:
          index = 8;
        }
        result = this._getRes(type, index);
        return result;
      };
      CollectItemCtrl.prototype._getRes = function(type, index) {
        var result = null;
        result = ResCtrl_1.default.ins ? null == index ? ResCtrl_1.default.ins.getCellFrame(type, type) : ResCtrl_1.default.ins.getCollectFrame(index) : null == index ? this._getCellFrame(type, type) : this._getCollectFrame(index);
        return result;
      };
      CollectItemCtrl.prototype._getCellFrame = function(type, index) {
        var frames = this.NormalCellFrame;
        Common_1.default.isBombType(type) && (frames = this.BombStaticFrame);
        var frame = frames[index];
        if (type < Constant_1.CellType.Bomb1 && 2 == RuntimeMgr_1.default.ins.CurBgIndex) {
          var bg2frame = this.Map2NormalCellFrame[index];
          bg2frame && (frame = bg2frame);
        }
        return frame;
      };
      CollectItemCtrl.prototype._getCollectFrame = function(index) {
        return this.CollectIcon[index];
      };
      __decorate([ property(cc.Label) ], CollectItemCtrl.prototype, "count", void 0);
      __decorate([ property(cc.Sprite) ], CollectItemCtrl.prototype, "icon", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], CollectItemCtrl.prototype, "BombStaticFrame", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], CollectItemCtrl.prototype, "NormalCellFrame", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], CollectItemCtrl.prototype, "Map2NormalCellFrame", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], CollectItemCtrl.prototype, "CollectIcon", void 0);
      CollectItemCtrl = __decorate([ ccclass ], CollectItemCtrl);
      return CollectItemCtrl;
    }(cc.Component);
    exports.default = CollectItemCtrl;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../Common/Common": "Common",
    "../../../Data/Const/Constant": "Constant",
    "../../../Data/Const/Event": "Event",
    "../../../Data/RuntimeMgr": "RuntimeMgr",
    "../../Model/CollectModel": "CollectModel",
    "../../Model/GameModel": "GameModel",
    "../../ResCtrl": "ResCtrl"
  } ],
  CollectModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e7448VCyNZJu42qqE33adRu", "CollectModel");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var Event_1 = require("../../Data/Const/Event");
    var Log_1 = require("../../../Base/Utils/Log");
    var GameModel_1 = require("./GameModel");
    var Common_1 = require("../../Common/Common");
    var Constant_1 = require("../../Data/Const/Constant");
    exports.CollectType = {
      normal: "normal",
      gnome: "gnome",
      box: "box",
      colorbox: "colorbox",
      stone: "stone",
      tree: "tree",
      turtles: "turtles",
      crab: "crab",
      gem: "gem",
      firefly: "firefly"
    };
    var CollectModel = function() {
      function CollectModel(collect) {
        this.collect = null;
        this.singleCollect = null;
        this.collectPowerCells = null;
        this._marked = null;
        collect && this.initMainCollect(collect);
        this.collectPowerCells = {};
        this._marked = new Set();
      }
      CollectModel.prototype.updateCollectCount = function(type, num, index, elimateType) {
        return __awaiter(this, void 0, void 0, function() {
          var count, isOver;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              type = type;
              count = this.collect.get(type);
              isOver = false;
              if (!count) return [ 3, 2 ];
              count = count - num <= 0 ? 0 : count - num;
              this.collect.set(type, count);
              return [ 4, this.checkCollectOK() ];

             case 1:
              isOver = _a.sent();
              M_1.default.event.send(Event_1.Event.UI.CollectComplet, type, index, elimateType);
              _a.label = 2;

             case 2:
              this.checkSingleCollectState(type, isOver);
              type == exports.CollectType.gnome && Log_1.Log.i("\u5b8c\u6210\u4e00\u4e2a\u6563\u88c5\u6536\u96c6\u7269\u7684\u56de\u6536! \u603b\u8fd8\u9700\u8981\u6536\u96c6:" + this.collect.get(type) + ",\u5f53\u524d\u5730\u56fe\u8fd8\u6709:" + (this.singleCollect && this.singleCollect[type]));
              return [ 2 ];
            }
          });
        });
      };
      CollectModel.prototype.updateCollectPowerCell = function(cell) {
        var result = false;
        var groundCell = this.collectPowerCells["" + cell.getType()];
        if (groundCell) {
          groundCell.extCtrl.updateTuitujiPower();
          result = true;
          M_1.default.event.send(Event_1.Event.GameCMD.UpdateCollectPower, cell, groundCell);
        }
        return result;
      };
      Object.defineProperty(CollectModel.prototype, "mainCollect", {
        get: function() {
          return this.collect;
        },
        enumerable: true,
        configurable: true
      });
      CollectModel.prototype.updateCurSingleCollect = function(singleCollect) {
        this.singleCollect = singleCollect;
      };
      CollectModel.prototype._markPos = function(pos) {
        this._marked.add(Common_1.default.getStringkey(pos));
      };
      CollectModel.prototype._isMarked = function(pos) {
        return this._marked.has(Common_1.default.getStringkey(pos));
      };
      CollectModel.prototype.removeMark = function(pos) {
        this._marked.delete(Common_1.default.getStringkey(pos));
      };
      CollectModel.prototype.findOneCollectPos = function(isHavaExecType) {
        void 0 === isHavaExecType && (isHavaExecType = false);
        var result = null;
        this.collect.get(exports.CollectType.box) > 0 && (result = this._findBoxPos());
        !result && this.collect.get(exports.CollectType.gnome) > 0 && (result = this.findMGPos(exports.CollectType.gnome, isHavaExecType));
        !result && this.collect.get(exports.CollectType.crab) > 0 && (result = this.findMGPos(exports.CollectType.crab, isHavaExecType));
        !result && this.collect.get(exports.CollectType.gem) > 0 && (result = this._findGemPos());
        !result && this.collect.get(Constant_1.CellType.IceCream + "") > 0 && (result = this._findIceCreamPos());
        result || (result = this._findNormalCollectPos());
        result || (result = this._findNotCollectCellPos());
        result && this._markPos(result);
        return result;
      };
      CollectModel.prototype._findGemPos = function() {
        var result = null;
        var list = Array.from(GameModel_1.default.ins.CellDict);
        for (var i = list.length; i--; ) {
          var cell = list[i];
          if (cell && !cell.isDeath && !cell.isFalling() && cell.GemLv > 0 && !this._isMarked(cell.pos)) {
            result = cell.pos;
            break;
          }
        }
        return result;
      };
      CollectModel.prototype._findIceCreamPos = function() {
        var result = null;
        var dir = [ cc.v2(0, 1), cc.v2(1, 1), cc.v2(-1, 1) ];
        var iceCreamList = Array.from(GameModel_1.default.ins.IceCreamPool);
        iceCreamList.sort(function(a, b) {
          return a.pos.y - b.pos.y;
        });
        for (var j = iceCreamList.length; j--; ) {
          var cell = iceCreamList[j];
          if (cell && !cell.isDeath && !cell.isEmpty && cell.getType() == Constant_1.CellType.IceCream && !GameModel_1.default.ins.isHavaSpe(cell.pos)) for (var i = 0; i < dir.length; i++) {
            var cp = cell.pos.add(dir[i]);
            var gc = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, cp);
            if (gc && !gc.isHold && !this._isMarked(cp)) {
              result = cp;
              j = 0;
              break;
            }
          }
        }
        return result;
      };
      CollectModel.prototype._findBoxPos = function() {
        var boxList = GameModel_1.default.ins.getUpGroundModel().BoxMap;
        var result = null;
        if (boxList.size > 0) {
          var ary = Array.from(boxList);
          for (var i = 0; i < ary.length; i++) {
            var pos = ary[i][1];
            if (!this._isMarked(pos)) {
              result = pos;
              break;
            }
          }
        }
        return result;
      };
      CollectModel.prototype._findNotCollectCellPos = function() {
        var result = null;
        var list = Array.from(GameModel_1.default.ins.CellDict);
        for (var i = list.length; i--; ) {
          var cell = list[i];
          if (cell && !cell.isDeath && !cell.isEmpty && !cell.isFalling() && !this._isMarked(cell.pos)) {
            var gc = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, cell.pos);
            if (!gc || gc && !gc.isHold) {
              if (cell.getType() == Constant_1.CellType.Banana) {
                result = cell.pos;
                break;
              }
              if (GameModel_1.default.ins.isHavaSpe(cell.pos)) {
                result = cell.pos;
                break;
              }
              if (cell.getType() == Constant_1.CellType.Ground) {
                result = cell.pos;
                break;
              }
              result = cell.pos;
              break;
            }
          }
        }
        return result;
      };
      CollectModel.prototype._findNormalCollectPos = function() {
        var result = null;
        var collectTypes = Array.from(this.collect.keys());
        for (var j = collectTypes.length; j--; ) {
          var type = Number(collectTypes[j]);
          if (!Number.isNaN(type) && type != Constant_1.CellType.IceCream && this.collect.get(type + "") > 0) {
            var list = Array.from(GameModel_1.default.ins.CellDict);
            for (var i = list.length; i--; ) {
              var cell = list[i];
              if (cell && !cell.isEmpty && !cell.isDeath && !cell.isFalling() && cell.getType() == type && !this._isMarked(cell.pos)) {
                var gc = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, cell.pos);
                if (!gc.isHold) {
                  j = 0;
                  result = cell.pos;
                  break;
                }
              }
            }
          }
        }
        return result;
      };
      CollectModel.prototype.findMGPos = function(type, isHavaExecType) {
        var result = null;
        var data = GameModel_1.default.ins.getMgModel().getData(type);
        if (data) {
          var keys = Object.keys(data);
          for (var i = keys.length; i--; ) {
            var index = keys[i];
            var posPool = data[index];
            if (posPool) for (var j = posPool.length; j--; ) {
              var pos = posPool[j];
              if (!pos || this._isMarked(pos) || isHavaExecType && GameModel_1.default.ins.isHavaSpe(pos)) continue;
              result = pos;
              i = 0;
              break;
            } else result = null;
          }
        }
        return result;
      };
      CollectModel.prototype.checkCollectOK = function() {
        return __awaiter(this, void 0, Promise, function() {
          var result;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              result = true;
              this.collect.forEach(function(remainCount, type) {
                remainCount > 0 && (result = false);
              });
              if (!result) return [ 3, 3 ];
              if (!GameModel_1.default.ins.isNovLv) return [ 3, 2 ];
              return [ 4, GameModel_1.default.ins.checkGameOver() ];

             case 1:
              _a.sent();
              _a.label = 2;

             case 2:
              M_1.default.event.send(Event_1.Event.GameCMD.GameOver, true);
              _a.label = 3;

             case 3:
              return [ 2, result ];
            }
          });
        });
      };
      CollectModel.prototype.checkSingleCollectState = function(type, isOver) {
        if (!this.singleCollect) return;
        var singleCount = this.singleCollect[type];
        if (singleCount && !isOver) {
          singleCount -= 1;
          if (singleCount <= 0) {
            var nextIndex = GameModel_1.default.ins.mapIndex + 1;
            if (nextIndex < GameModel_1.default.ins.mapCount) {
              this.singleCollect[type] = 0;
              Log_1.Log.i("\u89e6\u53d1\u8f6c\u79fb\u68cb\u76d8,nextIndex:", nextIndex, ",singleCount:", singleCount);
              M_1.default.event.send(Event_1.Event.GameCMD.MoveGrid, nextIndex, 0);
            }
          } else {
            this.singleCollect[type] = singleCount;
            M_1.default.event.send(Event_1.Event.GameCMD.MoveGrid, null, 1);
          }
        }
      };
      CollectModel.prototype.initMainCollect = function(collect) {
        var _this = this;
        this.collect = new Map();
        collect.forEach(function(data) {
          _this.collect.set(data.type + "", data.count);
        });
      };
      return CollectModel;
    }();
    exports.CollectModel = CollectModel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../../Base/Utils/Log": "Log",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "./GameModel": "GameModel"
  } ],
  CommonEnums: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "a64113QaDxBiZT/y8w9H5Dw", "CommonEnums");
    cc._RF.pop();
  }, {} ],
  CommonInterfaces: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "3b04003pKxFvbeIMvPPifN8", "CommonInterfaces");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    cc._RF.pop();
  }, {} ],
  CommonRewardView: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "fdb7fczOR1MWoV1Maqp6lNV", "CommonRewardView");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../Base/UI/UIBase");
    var UIMgr_1 = require("../Base/Manager/UIMgr");
    var UIData_1 = require("../Logic/Data/Interface/UIData");
    var M_1 = require("../Base/Manager/M");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var CommonRewardView = function(_super) {
      __extends(CommonRewardView, _super);
      function CommonRewardView() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.itemSp = null;
        _this.itemLabel = null;
        _this._itemData = null;
        return _this;
      }
      CommonRewardView.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
      };
      CommonRewardView.prototype.onInit = function(itemData) {
        this._itemData = itemData;
        this.itemLabel.string = "x" + itemData.num;
      };
      CommonRewardView.prototype.onClickClose = function() {
        this._itemData && M_1.default.runtime.addCurrency(this._itemData.itemId, this._itemData.num);
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.CommonReward);
      };
      __decorate([ property(cc.Sprite) ], CommonRewardView.prototype, "itemSp", void 0);
      __decorate([ property(cc.Label) ], CommonRewardView.prototype, "itemLabel", void 0);
      CommonRewardView = __decorate([ ccclass ], CommonRewardView);
      return CommonRewardView;
    }(UIBase_1.default);
    exports.CommonRewardView = CommonRewardView;
    cc._RF.pop();
  }, {
    "../Base/Manager/M": "M",
    "../Base/Manager/UIMgr": "UIMgr",
    "../Base/UI/UIBase": "UIBase",
    "../Logic/Data/Interface/UIData": "UIData"
  } ],
  Common: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "1db8aCZ+txIbaiX7cOWqp/x", "Common");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GameModel_1 = require("../Match3/Model/GameModel");
    var Util_1 = require("../../Base/Utils/Util");
    var Constant_1 = require("../Data/Const/Constant");
    var NodePoolMgr_1 = require("../../Base/Manager/NodePoolMgr");
    var SpinePlayerCtrl_1 = require("../../Base/CustomComponent/SpinePlayerCtrl");
    var M_1 = require("../../Base/Manager/M");
    var backgrundInfo = {
      idx_1: {
        name: "bg",
        type: "water",
        cfg: "ext",
        isWater: true
      },
      idx_2: {
        name: "bg",
        type: "grass",
        cfg: "ext"
      },
      idx_3: {
        name: "bg",
        type: "sand",
        cfg: "ext"
      }
    };
    var GroundBorderInfo = {
      "0001": [ "0001", cc.v2(1, 1) ],
      "0010": [ "0001", cc.v2(-1, 1) ],
      "0100": [ "0001", cc.v2(1, -1) ],
      1000: [ "0001", cc.v2(-1, -1) ],
      "0011": [ "0011", cc.v2(1, 1) ],
      1100: [ "0011", cc.v2(1, -1) ],
      "0101": [ "0101", cc.v2(1, 1) ],
      1010: [ "0101", cc.v2(-1, 1) ],
      "0111": [ "0111", cc.v2(1, 1) ],
      1011: [ "0111", cc.v2(-1, 1) ],
      1101: [ "0111", cc.v2(1, -1) ],
      1110: [ "0111", cc.v2(-1, -1) ],
      "0110": [ "0110", cc.v2(1, 1) ],
      1001: [ "0110", cc.v2(-1, 1) ]
    };
    var Common = function() {
      function Common() {}
      Common.safeGet2ArrayValue = function(data, pos) {
        var result = null;
        pos && data[pos.y] && (result = data[pos.y][pos.x]);
        return result;
      };
      Common.safeSet2ArrayValue = function(list, pos, data) {
        list[pos.y] && (list[pos.y][pos.x] = data);
      };
      Common.convetPos = function(pos, index) {
        void 0 === index && (index = null);
        var c_x = 0, c_y = 0;
        var gs = GameModel_1.default.GridSize;
        null != index && (gs = GameModel_1.default.ins.getMaps()[index].size);
        pos.x = Math.round(pos.x);
        pos.y = Math.round(pos.y);
        c_x = gs.W % 2 == 0 ? gs.W / 2 + Math.floor(pos.x / this.GRID_W) : (gs.W - 1) / 2 + Math.floor(pos.x / this.GRID_W + .5);
        c_y = gs.H % 2 == 0 ? gs.H / 2 - Math.ceil(pos.y / this.GRID_H) : (gs.H - 1) / 2 - Math.ceil(pos.y / this.GRID_H - .5);
        return cc.v2(c_x, c_y);
      };
      Common.getPos = function(x, y, index) {
        void 0 === index && (index = null);
        var s_x, s_y, s_px, s_py;
        var gs = GameModel_1.default.GridSize;
        null != index && (gs = GameModel_1.default.ins.getMaps()[index].size);
        s_px = .5;
        s_py = .5;
        if (gs.W % 2 == 0) s_x = gs.W / 2; else {
          s_x = (gs.W - 1) / 2;
          s_px = 0;
        }
        if (gs.H % 2 == 0) s_y = gs.H / 2; else {
          s_y = (gs.H - 1) / 2;
          s_py = 0;
        }
        return cc.v2((x - s_x + s_px) * this.GRID_W, -(y - s_y + s_py) * this.GRID_H);
      };
      Common.getBgInfo = function(bgIndex) {
        return backgrundInfo["idx_" + bgIndex];
      };
      Common.getGroundBorderInfo = function(key) {
        return GroundBorderInfo[key];
      };
      Common.getAroundCircleCells = function(center, depth, isLast) {
        void 0 === depth && (depth = 1);
        var rstAry = new Set();
        if (center) {
          var rowNum = 2 * depth + 1;
          var list = GameModel_1.default.ins.CellList;
          for (var j = 0; j < rowNum; j++) {
            var v = Math.ceil(j / 2);
            var v2 = j % 2 * -1 == 0 ? v : -v;
            var dirs = [ cc.v2(depth, v2), cc.v2(v2, depth), cc.v2(-depth, v2), cc.v2(v2, -depth) ];
            for (var i = 0; i < dirs.length; i++) {
              var dir = dirs[i];
              if (this.isBombRand(isLast, depth, dir)) {
                var item = this.safeGet2ArrayValue(list, center.add(dir));
                item && rstAry.add(item);
              }
            }
          }
        }
        return rstAry;
      };
      Common.getDirction = function(targetPos, selfPos) {
        var y = 0;
        selfPos.y < targetPos.y ? y = 1 : selfPos.y > targetPos.y && (y = -1);
        var x = 0;
        selfPos.x < targetPos.x ? x = 1 : selfPos.x > targetPos.x && (x = -1);
        return cc.v2(x, y);
      };
      Common.convertCurWorldPos = function(pos) {
        return this.CurrentCtrlView && this.CurrentCtrlView.convertToWorldSpaceAR(pos);
      };
      Common.getWorldPos = function(self) {
        var pos = null;
        self && self.parent && (pos = self.parent.convertToWorldSpaceAR(self.position));
        return pos;
      };
      Common.getRoundOnePos = function(pos) {
        var newPos = null;
        for (var i = this.Dir4.length; i--; ) {
          var p = pos.add(this.Dir4[i]);
          var cell = this.safeGet2ArrayValue(GameModel_1.default.ins.CellList, p);
          if (p.x >= 0 && p.y >= 0 && cell && !cell.isEmpty && !cell.isBomb && !GameModel_1.default.ins.isHavaSpe(cell.pos) && !GameModel_1.default.ins.isHold(cell.pos)) {
            newPos = p;
            break;
          }
        }
        return newPos;
      };
      Common.setAlignment = function(node, dir, value) {
        var w = node.getComponent(cc.Widget);
        w || (w = node.addComponent(cc.Widget));
        var letter = dir[0].toUpperCase();
        w["isAlign" + letter + dir.substring(1, dir.length)] = true;
        w[dir] = value;
        w.updateAlignment();
      };
      Common.getRes = function(path, type) {
        return new Promise(function(resolve) {
          cc.loader.loadRes(path, type, function(err, res) {
            if (err || !res) {
              console.error(err || "loadRes res is null!");
              return resolve(null);
            }
            resolve(res);
          });
        });
      };
      Common.getRemotPic = function(url, size, type) {
        void 0 === type && (type = "jpg");
        return new Promise(function(resolve) {
          cc.loader.load({
            url: url,
            type: type
          }, function(err, tex) {
            if (err || !tex) resolve(null); else {
              if (size) {
                tex.height = size.width;
                tex.width = size.height;
              }
              resolve(new cc.SpriteFrame(tex));
            }
          });
        });
      };
      Common.isBombRand = function(isLast, depth, pos) {
        return !isLast || Math.abs(pos.x) != depth || Math.abs(pos.y) != depth;
      };
      Common.getSquareSingleCell = function(col, row, checkType, checkPos, list) {
        var mainArr = null;
        var subArr = null;
        var mainKey = null;
        if (col.size > row.size) {
          mainArr = Array.from(col);
          subArr = Array.from(row);
          mainKey = "y";
        } else {
          mainArr = Array.from(row);
          subArr = Array.from(col);
          mainKey = "x";
        }
        var subKey = "x" == mainKey ? "y" : "x";
        var result = null;
        for (var i = mainArr.length; i--; ) {
          var cell = mainArr[i];
          if (1 == Math.abs(cell.pos[mainKey] - checkPos[mainKey])) for (var j = subArr.length; j--; ) {
            var scell = subArr[j];
            if (1 == Math.abs(scell.pos[subKey] - checkPos[subKey]) && 1 == Math.abs(cell.pos[mainKey] - scell.pos[mainKey])) {
              var targetPos = cc.v2(0, 0);
              checkPos.x == cell.pos.x ? targetPos.y = cell.pos.y : targetPos.y = scell.pos.y;
              checkPos.y == cell.pos.y ? targetPos.x = cell.pos.x : targetPos.x = scell.pos.x;
              var target = Common.safeGet2ArrayValue(list, targetPos);
              if (target && target.getType() == checkType) {
                result = target;
                i = 0;
                break;
              }
            }
          }
        }
        return result;
      };
      Common.isMergeBomb = function(bombType1, bombType2, type1, type2) {
        var result = false;
        (type1 == bombType1 && type2 == bombType2 || type1 == bombType2 && type2 == bombType1 || type1 == bombType1 && type2 == bombType1 && type1 == bombType2 && type2 == bombType2) && (result = true);
        return result;
      };
      Common.randomGetOneCell = function() {
        var y = Util_1.Util.Tool.rangeInt(0, GameModel_1.default.GridSize.H, false);
        var x = Util_1.Util.Tool.rangeInt(0, GameModel_1.default.GridSize.W, false);
        var cell = this.safeGet2ArrayValue(GameModel_1.default.ins.CellList, cc.v2(x, y));
        if (!cell) return this.randomGetOneCell();
        return cell.pos;
      };
      Common.switchGray = function(opt, node) {};
      Common.createSprite = function(key, frame, parent) {
        void 0 === parent && (parent = null);
        var node = NodePoolMgr_1.default.ins.getItem(key, null);
        var sprite = node.addComponent(cc.Sprite);
        sprite.spriteFrame = frame;
        parent && (node.parent = parent);
        return sprite;
      };
      Common.createEffPrefab = function(parent, key, prefab, pos) {
        void 0 === pos && (pos = null);
        var node = null;
        node = key ? M_1.default.nodePool.getItem(key, prefab) : M_1.default.nodePool.createItem(prefab);
        node.parent = parent;
        pos && node.setPosition(pos);
        var ctrl = node.getComponent(cc.Animation);
        return {
          node: node,
          ctrl: ctrl
        };
      };
      Common.createSpineNode = function(parent, prefab, key, pos) {
        void 0 === pos && (pos = null);
        var node = null;
        node = key ? NodePoolMgr_1.default.ins.getItem(key, prefab) : NodePoolMgr_1.default.ins.createItem(prefab);
        node.parent = parent;
        pos && node.setPosition(pos);
        var ctrl = node.getComponent(SpinePlayerCtrl_1.default);
        return {
          node: node,
          ctrl: ctrl
        };
      };
      Common.isBombType = function(type) {
        return type >= Constant_1.CellType.Bomb1 && type < Constant_1.CellType.Bomb100;
      };
      Common.parseRankData = function(value) {
        return {
          score: 1048575 & value,
          level: value >> 20
        };
      };
      Common.stringifyRankData = function(lv, socre) {
        return lv << 20 | socre;
      };
      Common.testGroundBorderDisplay = function(x, y, models, type) {
        return [ !this.getStatusByType(x, y - 1, models, type), !this.getStatusByType(x, y + 1, models, type), !this.getStatusByType(x - 1, y, models, type), !this.getStatusByType(x + 1, y, models, type) ];
      };
      Common.getSpriteNameByType = function(x, y, models, type) {
        var coff = "";
        coff += this.getStatusByType(x - 1, y - 1, models, type);
        coff += this.getStatusByType(x, y - 1, models, type);
        coff += this.getStatusByType(x - 1, y, models, type);
        coff += this.getStatusByType(x, y, models, type);
        return coff;
      };
      Common.getStatusByType = function(x, y, models, type) {
        var result = 1;
        models[y] && models[y][x] ? (models[y][x].getType() != type || models[y][x].isDeath) && (result = 0) : result = 0;
        return result;
      };
      Common.execDelayTask = function(fun, delayTime) {
        setTimeout(fun, 1e3 * delayTime);
      };
      Common.getStringkey = function(pos) {
        return pos.x + "_" + pos.y;
      };
      Common.getSpecialAddScoreByType = function(type) {
        return Constant_1.ScoreConfig.Special[type];
      };
      Common.getOfflineTime = function(lastOfflineTime, currentTime) {
        var offlineTime = (currentTime - lastOfflineTime) / 1e3 / 60;
        if (offlineTime > Constant_1.MinOfflineTime) return offlineTime;
        return 0;
      };
      Common.jumpScene = function(targetSceneName, lanuchedNext, delayTime) {
        void 0 === delayTime && (delayTime = 0);
        targetSceneName !== this.curScene && (this.preScene = this.curScene);
        this.curScene = targetSceneName;
        var time = 1e3 * delayTime;
        time > 0 ? setTimeout(function() {
          cc.director.loadScene(targetSceneName, lanuchedNext);
        }, time) : cc.director.loadScene(targetSceneName, lanuchedNext);
      };
      Common.bytesToSize = function(bytes, isBlood) {
        void 0 === isBlood && (isBlood = false);
        if (bytes < 1e4) return Math.floor(bytes).toString();
        if (0 === bytes) return "0";
        var k = 1e3, sizes = [ "", "K", "M", "G", "T", "P", "E", "Z", "Y", "aa", "bb", "cc", "dd", "ee", "ff", "gg", "hh", "ii", "jj", "kk", "mm", "nn", "pp", "qq", "rr", "ss", "tt", "uu", "vv", "ww", "xx", "zz" ], i = Math.floor(Math.log(bytes) / Math.log(k));
        var unit = "";
        if (i < sizes.length) unit = sizes[i]; else {
          var numLenght = i - sizes.length;
          unit = String.fromCharCode(97 + numLenght % 26);
          for (var index = 0; index < 1 + Math.floor(numLenght / 65); index++) unit += unit;
        }
        return isBlood ? Math.abs(parseInt((bytes / Math.pow(k, i)).toPrecision(3))) + unit : (bytes / Math.pow(k, i)).toPrecision(3) + "" + unit;
      };
      Common.getCurrencyName = function(type) {
        return [ "\u91d1\u5e01", "\u94bb\u77f3", "\u80fd\u91cf" ][type];
      };
      Common.getRewardArray = function(rewardData) {
        var arr = [];
        if (rewardData) for (var key in rewardData) if ("box" == key) for (var boxKey in rewardData[key]) {
          var v = rewardData[key][boxKey];
          arr.push({
            type: Number(boxKey),
            count: v
          });
        } else arr.push({
          type: Number(key),
          count: rewardData[key]
        });
        return arr;
      };
      Common.preScene = null;
      Common.curScene = null;
      Common.GRID_H = 84;
      Common.GRID_W = 84;
      Common.CurrentCtrlView = null;
      Common.Dir4 = [ cc.v2(-1, 0), cc.v2(1, 0), cc.v2(0, 1), cc.v2(0, -1) ];
      return Common;
    }();
    exports.default = Common;
    window["Common"] = Common;
    cc._RF.pop();
  }, {
    "../../Base/CustomComponent/SpinePlayerCtrl": "SpinePlayerCtrl",
    "../../Base/Manager/M": "M",
    "../../Base/Manager/NodePoolMgr": "NodePoolMgr",
    "../../Base/Utils/Util": "Util",
    "../Data/Const/Constant": "Constant",
    "../Match3/Model/GameModel": "GameModel"
  } ],
  Constant: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "60e9eLuphxDh75GUZUcWk7D", "Constant");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a, _b, _c;
    var Util_1 = require("../../../Base/Utils/Util");
    exports.APPID = "wxf56baeaa289ce6cd";
    exports.NewbieOpt = false;
    exports.MaxPowerCount = 30;
    exports.RunTimeGate = 60;
    exports.MinOfflineTime = 3;
    exports.BrokenConchHp = 1;
    exports.ROOM_DETAIL_SCALE = 1.5;
    exports.FallMaxGateLimit = 1 / 30;
    exports.PowerConfig = {
      NormalTime: 300,
      NormalCount: 1,
      NewLvCount: 5,
      LvConsumption: 5
    };
    exports.TempLoadingTip = {
      1: "\u5408\u6210\u516b\u722a\u9c7c",
      2: "\u516b\u722a\u9c7c\u7206\u70b8\u65f6\u76f8\u90bb\u7684\u5143\u7d20\u4e5f\u4f1a\u88ab\u6d88\u9664\u54e6"
    };
    exports.WaringTips = {
      PowerNotEnough: "\u80fd\u91cf\u4e0d\u591f\u4e86\u5462!",
      PropNotEnough: "\u9053\u5177\u6570\u91cf\u4e0d\u591f\u4e86\u5462!",
      CantUseForThat: "\u4e0d\u80fd\u5728\u5f53\u524d\u4f4d\u7f6e\u4f7f\u7528!",
      NoElimate: "\u6ca1\u6709\u6d88\u9664\u7684\u5143\u7d20\u5566,\u5e2e\u60a8\u91cd\u7f6e!",
      PropAdd3StepTips: "\u7ed9\u60a8\u52a0\u4e0a\u4e863\u6b65\u5462!",
      PropResetGrid: "\u7ed9\u60a8\u91cd\u65b0\u641e\u4e86\u4e00\u4e0b\u5462!",
      PowerMax: "\u4f53\u529b\u5df2\u6ee1",
      OfflineReward: "\u79bb\u7ebf\u671f\u95f4\u7ed9\u4f60\u52a0\u4e86",
      NoMoreCoin: "\u91d1\u5e01\u4e0d\u8db3",
      NoMoreDiamond: "\u94bb\u77f3\u4e0d\u8db3",
      BuyOk: "\u8d2d\u4e70\u6210\u529f",
      UnlockProp: "\u89e3\u9501\u4e86\u65b0\u9053\u5177!",
      CannotOpenIsland: "\u8fbe\u5230%s\u9897\u661f\u5f00\u542f\u6d77\u5c9b",
      ShareTip: '\u6210\u529f\u5206\u4eab\u5373\u53ef\u83b7\u5f97"<color=#FE980A>\u91d1\u5e01 x%s</c>"~'
    };
    exports.ConditionType = {
      time: "time",
      merge: "merge",
      doprop: "doporp",
      gameCount: "game",
      collect: "collect"
    };
    exports.Scene = {
      Loading: "LoadingScene",
      Map: "MapScene",
      Match: "Match3",
      Level: "LevelScene",
      Hotel: "HotelScene"
    };
    var SceneTaskKey;
    (function(SceneTaskKey) {
      SceneTaskKey[SceneTaskKey["ShowTargetDlg"] = 0] = "ShowTargetDlg";
    })(SceneTaskKey = exports.SceneTaskKey || (exports.SceneTaskKey = {}));
    var NodePoolKey;
    (function(NodePoolKey) {
      NodePoolKey[NodePoolKey["GroundCell"] = 10] = "GroundCell";
      NodePoolKey[NodePoolKey["GroundMulti"] = 11] = "GroundMulti";
      NodePoolKey[NodePoolKey["Cell"] = 12] = "Cell";
      NodePoolKey[NodePoolKey["UpGroundCell"] = 13] = "UpGroundCell";
      NodePoolKey[NodePoolKey["BombEff"] = 14] = "BombEff";
      NodePoolKey[NodePoolKey["FishBombEff"] = 15] = "FishBombEff";
      NodePoolKey[NodePoolKey["RowColEff"] = 16] = "RowColEff";
      NodePoolKey[NodePoolKey["LittleBomb"] = 17] = "LittleBomb";
      NodePoolKey[NodePoolKey["RainbowBomb"] = 18] = "RainbowBomb";
      NodePoolKey[NodePoolKey["ShootStar"] = 19] = "ShootStar";
      NodePoolKey[NodePoolKey["OverShoot"] = 20] = "OverShoot";
      NodePoolKey[NodePoolKey["MergeBomb"] = 21] = "MergeBomb";
      NodePoolKey[NodePoolKey["BombAndBomb"] = 22] = "BombAndBomb";
      NodePoolKey[NodePoolKey["BombAndFish"] = 23] = "BombAndFish";
      NodePoolKey[NodePoolKey["HaimaAndHetun"] = 24] = "HaimaAndHetun";
      NodePoolKey[NodePoolKey["HaimaAndHaima"] = 25] = "HaimaAndHaima";
      NodePoolKey[NodePoolKey["ZhangyuAndJianyu"] = 26] = "ZhangyuAndJianyu";
      NodePoolKey[NodePoolKey["hetuanAndJianyu"] = 27] = "hetuanAndJianyu";
      NodePoolKey[NodePoolKey["HaimaAndZhangyu"] = 28] = "HaimaAndZhangyu";
      NodePoolKey[NodePoolKey["Plane"] = 29] = "Plane";
      NodePoolKey[NodePoolKey["ComboEff"] = 30] = "ComboEff";
      NodePoolKey[NodePoolKey["ZyJump"] = 31] = "ZyJump";
      NodePoolKey[NodePoolKey["ZyJumpOver"] = 32] = "ZyJumpOver";
      NodePoolKey[NodePoolKey["ZyJumpElimate"] = 33] = "ZyJumpElimate";
      NodePoolKey[NodePoolKey["ShuiCao"] = 34] = "ShuiCao";
      NodePoolKey[NodePoolKey["Dot"] = 35] = "Dot";
      NodePoolKey[NodePoolKey["TeshuLight"] = 36] = "TeshuLight";
      NodePoolKey[NodePoolKey["LeafBroken"] = 37] = "LeafBroken";
      NodePoolKey[NodePoolKey["BoxBroken"] = 38] = "BoxBroken";
      NodePoolKey[NodePoolKey["Broken"] = 39] = "Broken";
      NodePoolKey[NodePoolKey["ComplexGround"] = 40] = "ComplexGround";
      NodePoolKey[NodePoolKey["GemNode"] = 41] = "GemNode";
      NodePoolKey[NodePoolKey["Firefly"] = 42] = "Firefly";
      NodePoolKey[NodePoolKey["AddScoreEff"] = 43] = "AddScoreEff";
      NodePoolKey[NodePoolKey["HaiMaOver"] = 44] = "HaiMaOver";
      NodePoolKey[NodePoolKey["AddScoreOverEff"] = 45] = "AddScoreOverEff";
      NodePoolKey[NodePoolKey["RankItem"] = 46] = "RankItem";
      NodePoolKey[NodePoolKey["Chuizi"] = 47] = "Chuizi";
      NodePoolKey[NodePoolKey["ShanhuAnim"] = 48] = "ShanhuAnim";
      NodePoolKey[NodePoolKey["Roket"] = 49] = "Roket";
    })(NodePoolKey = exports.NodePoolKey || (exports.NodePoolKey = {}));
    Util_1.Util.Enum.convert2EventEnum(NodePoolKey);
    var NativeKey;
    (function(NativeKey) {
      NativeKey[NativeKey["LvDataKey"] = 1e4] = "LvDataKey";
      NativeKey[NativeKey["BoxGifts"] = 10001] = "BoxGifts";
      NativeKey[NativeKey["PlayerInfo"] = 10002] = "PlayerInfo";
      NativeKey[NativeKey["Sound"] = 10003] = "Sound";
      NativeKey[NativeKey["LastTime"] = 10004] = "LastTime";
      NativeKey[NativeKey["DailyTime"] = 10005] = "DailyTime";
      NativeKey[NativeKey["DailyCollect"] = 10006] = "DailyCollect";
      NativeKey[NativeKey["MonthCollect"] = 10007] = "MonthCollect";
      NativeKey[NativeKey["Collect"] = 10008] = "Collect";
      NativeKey[NativeKey["DailyMerge"] = 10009] = "DailyMerge";
      NativeKey[NativeKey["MonthMerge"] = 10010] = "MonthMerge";
      NativeKey[NativeKey["Merge"] = 10011] = "Merge";
      NativeKey[NativeKey["DailyGameCount"] = 10012] = "DailyGameCount";
      NativeKey[NativeKey["MonthGameCount"] = 10013] = "MonthGameCount";
      NativeKey[NativeKey["GameCount"] = 10014] = "GameCount";
      NativeKey[NativeKey["DailyUsePropCount"] = 10015] = "DailyUsePropCount";
      NativeKey[NativeKey["MonthUsePropCount"] = 10016] = "MonthUsePropCount";
      NativeKey[NativeKey["UsePropCount"] = 10017] = "UsePropCount";
      NativeKey[NativeKey["CurrencyTaskKey"] = 10018] = "CurrencyTaskKey";
      NativeKey[NativeKey["HotelSlotData"] = 10019] = "HotelSlotData";
      NativeKey[NativeKey["ZanList"] = 10020] = "ZanList";
      NativeKey[NativeKey["LevelFailTag"] = 10021] = "LevelFailTag";
      NativeKey[NativeKey["LevelFailShareTag"] = 10022] = "LevelFailShareTag";
      NativeKey[NativeKey["LevelFailShareTimeTag"] = 10023] = "LevelFailShareTimeTag";
    })(NativeKey = exports.NativeKey || (exports.NativeKey = {}));
    var GroundType;
    (function(GroundType) {
      GroundType[GroundType["None"] = 2e4] = "None";
      GroundType[GroundType["Water"] = 20001] = "Water";
      GroundType[GroundType["MoneyTree"] = 20002] = "MoneyTree";
      GroundType[GroundType["Crab"] = 20003] = "Crab";
      GroundType[GroundType["Tuituji"] = 20004] = "Tuituji";
      GroundType[GroundType["Leaves"] = 20005] = "Leaves";
      GroundType[GroundType["Flower"] = 20006] = "Flower";
      GroundType[GroundType["Firefly"] = 20007] = "Firefly";
      GroundType[GroundType["Ivy"] = 20008] = "Ivy";
      GroundType[GroundType["Mushroom"] = 20009] = "Mushroom";
    })(GroundType = exports.GroundType || (exports.GroundType = {}));
    var UpGroundType;
    (function(UpGroundType) {
      UpGroundType[UpGroundType["None"] = 1e4] = "None";
      UpGroundType[UpGroundType["Box"] = 10001] = "Box";
      UpGroundType[UpGroundType["Lock"] = 10002] = "Lock";
      UpGroundType[UpGroundType["Ice"] = 10003] = "Ice";
      UpGroundType[UpGroundType["Portal"] = 10004] = "Portal";
      UpGroundType[UpGroundType["Stone"] = 10005] = "Stone";
      UpGroundType[UpGroundType["Nov_grass"] = 11e3] = "Nov_grass";
      UpGroundType[UpGroundType["Nov_conch"] = 11001] = "Nov_conch";
    })(UpGroundType = exports.UpGroundType || (exports.UpGroundType = {}));
    var PropType;
    (function(PropType) {
      PropType[PropType["BeikeBomb"] = 100] = "BeikeBomb";
      PropType[PropType["Hammer"] = 101] = "Hammer";
      PropType[PropType["ResetGrid"] = 102] = "ResetGrid";
      PropType[PropType["Board"] = 103] = "Board";
      PropType[PropType["Add3Step"] = 104] = "Add3Step";
      PropType[PropType["StartBomb"] = 105] = "StartBomb";
      PropType[PropType["StartStar"] = 106] = "StartStar";
      PropType[PropType["PowerBottle1"] = 107] = "PowerBottle1";
      PropType[PropType["PowerBottle2"] = 108] = "PowerBottle2";
      PropType[PropType["PowerUnitPrice"] = 200] = "PowerUnitPrice";
    })(PropType = exports.PropType || (exports.PropType = {}));
    var CellType;
    (function(CellType) {
      CellType[CellType["Back"] = -2] = "Back";
      CellType[CellType["Empty"] = -1] = "Empty";
      CellType[CellType["Apple"] = 0] = "Apple";
      CellType[CellType["Leaf"] = 1] = "Leaf";
      CellType[CellType["Grape"] = 2] = "Grape";
      CellType[CellType["Pear"] = 3] = "Pear";
      CellType[CellType["Water"] = 4] = "Water";
      CellType[CellType["Flower"] = 5] = "Flower";
      CellType[CellType["Banana"] = 6] = "Banana";
      CellType[CellType["IceCream"] = 7] = "IceCream";
      CellType[CellType["Coconut"] = 8] = "Coconut";
      CellType[CellType["BrokenConch"] = 9] = "BrokenConch";
      CellType[CellType["Fish"] = 10] = "Fish";
      CellType[CellType["Conch"] = 11] = "Conch";
      CellType[CellType["BottleCaps"] = 12] = "BottleCaps";
      CellType[CellType["Ground"] = 13] = "Ground";
      CellType[CellType["Bomb1"] = 100] = "Bomb1";
      CellType[CellType["Bomb2"] = 101] = "Bomb2";
      CellType[CellType["Bomb3"] = 102] = "Bomb3";
      CellType[CellType["Bomb4"] = 103] = "Bomb4";
      CellType[CellType["Bomb5"] = 104] = "Bomb5";
      CellType[CellType["Bomb6"] = 105] = "Bomb6";
      CellType[CellType["Bomb7"] = 106] = "Bomb7";
      CellType[CellType["Bomb100"] = 199] = "Bomb100";
      CellType[CellType["Girl"] = 200] = "Girl";
      CellType[CellType["Lighting"] = 201] = "Lighting";
      CellType[CellType["Temp"] = 200] = "Temp";
    })(CellType = exports.CellType || (exports.CellType = {}));
    var ElimateType;
    (function(ElimateType) {
      ElimateType[ElimateType["Default"] = 0] = "Default";
      ElimateType[ElimateType["Beside"] = 1] = "Beside";
      ElimateType[ElimateType["Girl"] = 2] = "Girl";
      ElimateType[ElimateType["Bomb1"] = 100] = "Bomb1";
      ElimateType[ElimateType["Bomb2"] = 101] = "Bomb2";
      ElimateType[ElimateType["Bomb3"] = 102] = "Bomb3";
      ElimateType[ElimateType["Bomb4"] = 103] = "Bomb4";
      ElimateType[ElimateType["Bomb5"] = 104] = "Bomb5";
      ElimateType[ElimateType["Bomb6"] = 105] = "Bomb6";
      ElimateType[ElimateType["ThreeOctopus"] = 106] = "ThreeOctopus";
      ElimateType[ElimateType["ThreeRowAndCol"] = 107] = "ThreeRowAndCol";
      ElimateType[ElimateType["RowAndCol"] = 108] = "RowAndCol";
      ElimateType[ElimateType["DoubleBomb"] = 109] = "DoubleBomb";
      ElimateType[ElimateType["Tuituji"] = 110] = "Tuituji";
      ElimateType[ElimateType["Rocket"] = 111] = "Rocket";
      ElimateType[ElimateType["All"] = 112] = "All";
      ElimateType[ElimateType["Prop"] = 200] = "Prop";
      ElimateType[ElimateType["Hammer"] = 201] = "Hammer";
    })(ElimateType = exports.ElimateType || (exports.ElimateType = {}));
    exports.ScoreConfig = {
      Merge: 100,
      Normal: {
        3: 60,
        4: 80,
        5: 100
      },
      BombElimate: (_a = {}, _a[CellType.Bomb1] = 500, _a[CellType.Bomb2] = 300, _a[CellType.Bomb3] = 300, 
      _a[CellType.Bomb4] = 300, _a[CellType.Bomb5] = 500, _a),
      SingleElimate: (_b = {}, _b[CellType.Bomb1] = 40, _b[CellType.Bomb2] = 40, _b[CellType.Bomb3] = 40, 
      _b[CellType.Bomb4] = 40, _b[CellType.Bomb5] = 40, _b),
      Combo: {
        0: 600,
        1: 800,
        2: 1e3
      },
      Special: (_c = {}, _c[UpGroundType.Box] = 500, _c[GroundType.Leaves] = 500, _c[UpGroundType.Lock] = 500, 
      _c[UpGroundType.Ice] = 500, _c[CellType.Banana] = 500, _c[CellType.IceCream] = 500, 
      _c.gnome = 5e3, _c),
      OverStep: {
        1: 5e3,
        2: 6e3,
        3: 7e3,
        4: 8e3,
        5: 8e3,
        6: 9e3,
        7: 1e4
      }
    };
    var ComboLevel;
    (function(ComboLevel) {
      ComboLevel[ComboLevel["great"] = 3] = "great";
      ComboLevel[ComboLevel["awesome"] = 6] = "awesome";
      ComboLevel[ComboLevel["fantastic"] = 9] = "fantastic";
      ComboLevel[ComboLevel["blossom"] = 12] = "blossom";
    })(ComboLevel = exports.ComboLevel || (exports.ComboLevel = {}));
    var comboRatio;
    (function(comboRatio) {
      comboRatio[comboRatio["great"] = 0] = "great";
      comboRatio[comboRatio["awesome"] = 1] = "awesome";
      comboRatio[comboRatio["fantastic"] = 2] = "fantastic";
      comboRatio[comboRatio["blossom"] = 3] = "blossom";
    })(comboRatio = exports.comboRatio || (exports.comboRatio = {}));
    var GameState;
    (function(GameState) {
      GameState[GameState["preReady"] = 0] = "preReady";
      GameState[GameState["Normal"] = 1] = "Normal";
      GameState[GameState["Pause"] = 2] = "Pause";
      GameState[GameState["Win"] = 3] = "Win";
      GameState[GameState["Fail"] = 4] = "Fail";
      GameState[GameState["ChangeBomb"] = 5] = "ChangeBomb";
      GameState[GameState["End"] = 6] = "End";
    })(GameState = exports.GameState || (exports.GameState = {}));
    exports.WX_OPENDATA_KEY = {
      SCORE: "SCORE"
    };
    exports.WX_OPENDATA_COMMAND_KEY = {
      SHOW_RANK: "SHOW_RANK",
      HIDE_RANK: "HIDE_RANK",
      NEXT_PAGE: "NEXT_PAGE",
      PREV_PAGE: "PREV_PAGE",
      SWITCH_TAB: "SWITCH_TAB",
      SHOW_FRIEND_COMP: "SHOW_FRIEND_COMP",
      SHOW_BEYOND_FRIEND: "SHOW_BEYOND_FRIEND",
      UPDATE_BEYOND_FRIEND: "UPDATE_BEYOND_FRIEND"
    };
    cc._RF.pop();
  }, {
    "../../../Base/Utils/Util": "Util"
  } ],
  Conveyer: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "51044aYfvdP4bsXrTJrLdMP", "Conveyer");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GameModel_1 = require("../GameModel");
    var Common_1 = require("../../../Common/Common");
    var MainCtrl_1 = require("../../MainCtrl");
    var Conveyer = function() {
      function Conveyer(data) {
        this._cfg = null;
        this._triggerCount = 0;
        this._nodeHandler = null;
        this._cfgData = null;
        if (data && data.conveyerList) {
          this._cfgData = data.conveyerList;
          this._nodeHandler = cc.find("Canvas/main").getComponent(MainCtrl_1.default);
        }
      }
      Conveyer.prototype.moveTo = function() {
        var _this = this;
        this._cfg.forEach(function(valuse, index) {
          for (var i = 0; i < valuse.length; i++) {
            var item = valuse[i];
            var nextItem = valuse[i + 1] || valuse[0];
            var cell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, item.pos);
            cell && cell.conveyerMoveTo(nextItem.pos, null);
          }
          _this.moveOver(index);
        });
      };
      Conveyer.prototype.moveOver = function(index) {
        var _this = this;
        this._nodeHandler && this._nodeHandler.scheduleOnce(function() {
          var values = _this._cfg.get(index);
          for (var i = values.length; i--; ) {
            var pos = values[i].pos;
            var cell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, pos);
            if (cell) {
              if (!cell.isFall) {
                cell.continue2Fall();
                cell.notifyRoundFall();
                GameModel_1.default.ins.checkHavaElimate(cell.pos);
              }
            } else GameModel_1.default.ins.testFindCanFallCell(pos, null);
          }
        }, .5);
      };
      Conveyer.prototype.checkIsConveyerItemForPos = function(pos) {
        var result = false;
        for (var i = this._cfgData.length; i--; ) {
          var list = this._cfgData[i];
          for (var index = list.length; index--; ) {
            var item = list[index];
            if (pos.x == item.x && pos.y == item.y) {
              i = 0;
              result = true;
              break;
            }
          }
        }
        return result;
      };
      Conveyer.prototype.init = function() {
        if (this._cfgData) {
          this._cfg = new Map();
          var _loop_1 = function(i) {
            var p = [];
            var m = this_1._cfgData[i];
            m.forEach(function(item) {
              var c = {
                pos: cc.v2(item.x, item.y),
                exist: item.exist
              };
              p.push(c);
            });
            this_1._cfg.set(i, p);
          };
          var this_1 = this;
          for (var i = 0; i < this._cfgData.length; i++) _loop_1(i);
        }
      };
      Conveyer.prototype.onTrigger = function() {
        this._triggerCount++;
        this.moveTo();
      };
      return Conveyer;
    }();
    exports.default = Conveyer;
    cc._RF.pop();
  }, {
    "../../../Common/Common": "Common",
    "../../MainCtrl": "MainCtrl",
    "../GameModel": "GameModel"
  } ],
  CrabModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "a70592cUXBMl5IbChJ8cnJL", "CrabModel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var MultipleGridColBase_1 = require("./MultipleGridColBase");
    var Common_1 = require("../../../Common/Common");
    var GameModel_1 = require("../GameModel");
    var CellBase_1 = require("../CellBase");
    var Constant_1 = require("../../../Data/Const/Constant");
    var CrabModel = function(_super) {
      __extends(CrabModel, _super);
      function CrabModel() {
        return null !== _super && _super.apply(this, arguments) || this;
      }
      CrabModel.prototype.sync2View = function(groundList) {
        if (!this._cfg) return;
        this._count = this._cfg.length;
        for (var i = 0; i < this._count; i++) {
          var cfg = this._cfg[i];
          this._pool[i] || (this._pool[i] = []);
          var isCross = false;
          cfg.type % 2 == 0 && (isCross = true);
          var max = 2 * (Math.floor(cfg.type / 2) + 1);
          var min = max / 2;
          var dir = null;
          for (var k = 0; k < min; k++) for (var j = 0; j < max; j++) {
            dir = isCross ? cc.v2(j, k) : cc.v2(k, j);
            var pos = cc.v2(cfg.x, cfg.y).add(dir);
            var groundItem = Common_1.default.safeGet2ArrayValue(groundList, pos);
            if (groundItem) {
              groundItem.initCrab(i);
              this._pool[i].push(pos);
            }
          }
        }
      };
      CrabModel.prototype.onComplet = function(dir, pos) {
        var line = GameModel_1.default.ins.CellList[pos.y];
        var closeAry = null;
        if (dir > 0) closeAry = line.slice(pos.x, line.length); else {
          closeAry = line.slice(0, pos.x);
          closeAry.sort(function(a, b) {
            if (a && b) return b.pos.x - a.pos.x;
          });
        }
        GameModel_1.default.ins.execElimate(closeAry[0], new Set(closeAry), Constant_1.ElimateType.Bomb6, null, null);
      };
      CrabModel.prototype.freeGrid = function(point, index) {
        var list = GameModel_1.default.ins.GroundList;
        for (var i = 0; i < list.length; i++) {
          var listx = list[i];
          for (var x = 0; x < listx.length; x++) {
            var gc = listx[x];
            gc && gc.getType() == Constant_1.GroundType.Crab && gc.zIndex == index && gc.freeThisPos();
          }
        }
        var notifyPosY = 0 == point.y ? 0 : point.y - 1;
        var notifyCell = GameModel_1.default.ins.CellList[notifyPosY];
        notifyCell.forEach(function(c) {
          c && c.onMsg(CellBase_1.MsgType.Fall);
        });
      };
      return CrabModel;
    }(MultipleGridColBase_1.default);
    exports.default = CrabModel;
    cc._RF.pop();
  }, {
    "../../../Common/Common": "Common",
    "../../../Data/Const/Constant": "Constant",
    "../CellBase": "CellBase",
    "../GameModel": "GameModel",
    "./MultipleGridColBase": "MultipleGridColBase"
  } ],
  CustomTaskItem: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "c58b9hMLqtON5benlOqWtr4", "CustomTaskItem");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var DailyTaskMgr_1 = require("../../../../Base/Manager/DailyTaskMgr");
    var M_1 = require("../../../../Base/Manager/M");
    var Event_1 = require("../../../Data/Const/Event");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var CustomTaskItem = function(_super) {
      __extends(CustomTaskItem, _super);
      function CustomTaskItem() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.count = null;
        _this.stateLabel = null;
        _this.icon = null;
        _this._isReceivd = false;
        _this._isComplet = false;
        _this._info = null;
        return _this;
      }
      CustomTaskItem.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.DailyTask.UpdateTaskKey, this._onUpdateTaskKey, this);
      };
      CustomTaskItem.prototype.start = function() {
        M_1.default.event.unRegister(Event_1.Event.DailyTask.UpdateTaskKey, this._onUpdateTaskKey, this);
      };
      CustomTaskItem.prototype.init = function(info, iconFrame) {
        this._info = info;
        this.icon.spriteFrame = iconFrame;
        this.icon.node.scale = 60 / this.icon.node.height;
        this.count.string = info.rewards[0].count.toString();
        this._isComplet = info.condition >= DailyTaskMgr_1.default.ins.getDailyTaskKey();
        M_1.default.runtime.DailyTaskProgress.progress && -1 == M_1.default.runtime.DailyTaskProgress.progress[this._info.id] && (this._isReceivd = true);
        this._isComplet = DailyTaskMgr_1.default.ins.getDailyTaskKey() >= this._info.condition;
        if (this._isComplet) {
          this.stateLabel.node.active = true;
          this._isReceivd ? this.stateLabel.string = "\u5df2\u9886\u53d6" : this.stateLabel.string = "\u5f85\u9886\u53d6";
        } else this.stateLabel.node.active = false;
      };
      CustomTaskItem.prototype.onClick = function() {
        if (this._isComplet && !this._isReceivd) {
          M_1.default.ui.showUI(UIData_1.UIHudDef.OpenBox, {
            config: {
              rewards: this._info.rewards
            },
            text: "\u6302\u673a\u5956\u52b1!",
            isHideBox: true
          });
          DailyTaskMgr_1.default.ins.receiveOK(this._info.id);
          M_1.default.runtime.DailyTaskProgress.progress[this._info.id] = -1;
          this._isReceivd = true;
          this.stateLabel.string = "\u5df2\u9886\u53d6";
        }
      };
      CustomTaskItem.prototype._onUpdateTaskKey = function(count) {
        if (count >= this._info.condition && !this._isReceivd) {
          this._isComplet = true;
          this.stateLabel.node.active = true;
          this.stateLabel.string = "\u5f85\u9886\u53d6";
        }
      };
      __decorate([ property(cc.Label) ], CustomTaskItem.prototype, "count", void 0);
      __decorate([ property(cc.Label) ], CustomTaskItem.prototype, "stateLabel", void 0);
      __decorate([ property(cc.Sprite) ], CustomTaskItem.prototype, "icon", void 0);
      CustomTaskItem = __decorate([ ccclass ], CustomTaskItem);
      return CustomTaskItem;
    }(cc.Component);
    exports.default = CustomTaskItem;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/DailyTaskMgr": "DailyTaskMgr",
    "../../../../Base/Manager/M": "M",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData"
  } ],
  DLogId: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9aa660eRSJP8q7LxrJXeQJw", "DLogId");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var DLogIdTutorial = function() {
      function DLogIdTutorial() {}
      DLogIdTutorial.lv1_click = "lv1_click";
      DLogIdTutorial.lv1_clickgame = "lv1_clickgame";
      DLogIdTutorial.lv3_clickback = "lv3_clickback";
      DLogIdTutorial.lv3_clickbeach = "lv3_clickbeach";
      DLogIdTutorial.lv3_clickrepair1 = "lv3_clickrepair1";
      DLogIdTutorial.lv3_clickbuy1 = "lv3_clickbuy1";
      DLogIdTutorial.lv3_clickchoose1 = "lv3_clickchoose1";
      DLogIdTutorial.lv3_clickrepair2 = "lv3_clickrepair2";
      DLogIdTutorial.lv3_clickbuy2 = "lv3_clickbuy2";
      DLogIdTutorial.lv3_clickgame = "lv3_clickgame";
      DLogIdTutorial.lv4_clickback = "lv4_clickback";
      DLogIdTutorial.lv4_clickbeach = "lv4_clickbeach";
      DLogIdTutorial.lv4_clickrepair2 = "lv4_clickrepair2";
      DLogIdTutorial.lv4_clickbuy2 = "lv4_clickbuy2";
      DLogIdTutorial.lv4_clickchoose2 = "lv4_clickchoose2";
      return DLogIdTutorial;
    }();
    exports.DLogIdTutorial = DLogIdTutorial;
    cc._RF.pop();
  }, {} ],
  DailyItem: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "beeaeD0WI5IZLXg8wlkMlRc", "DailyItem");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../../Base/Manager/M");
    var Constant_1 = require("../../../Data/Const/Constant");
    var StorageMgr_1 = require("../../../../Base/Manager/StorageMgr");
    var DailyTaskMgr_1 = require("../../../../Base/Manager/DailyTaskMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var DailyItem = function(_super) {
      __extends(DailyItem, _super);
      function DailyItem() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.bg = null;
        _this.nameLab = null;
        _this.count = null;
        _this.progressLab = null;
        _this.stateLab = null;
        _this.icon = null;
        _this.progress = null;
        _this._info = null;
        _this._conditionType = null;
        _this._conditionSubType = null;
        _this._isComplet = false;
        _this._isReceivd = false;
        return _this;
      }
      DailyItem.prototype.onLoad = function() {};
      DailyItem.prototype.onDestroy = function() {};
      DailyItem.prototype.init = function(info, icon) {
        this._info = info;
        this.count.string = "x" + info.rewards[0].count;
        this.icon.spriteFrame = icon;
        this.nameLab.string = info.name;
        this._parseCondition();
        this._updateProgress();
      };
      DailyItem.prototype._parseCondition = function() {
        this._conditionType = this._info.conditionType;
        this._conditionSubType = this._info.conditionSubType;
      };
      DailyItem.prototype._updateProgress = function() {
        var count = this._getConditionCount();
        var max = this._info.condition;
        count = -1 == count ? max : count;
        this.progress.progress = count / max;
        this.progressLab.string = (count > max ? max : count) + "/" + max;
        var data = M_1.default.runtime.DailyTaskProgress.progress ? M_1.default.runtime.DailyTaskProgress.progress[this._info.id] : null;
        if (-1 == data || count >= this._info.condition) {
          this._isComplet = true;
          this.stateLab.node.active = true;
          if (-1 == data) {
            this._isReceivd = true;
            this.stateLab.string = "\u5df2\u9886\u53d6!";
          } else this.stateLab.string = "\u5f85\u9886\u53d6!";
        } else this.stateLab.node.active = false;
      };
      DailyItem.prototype.onClick = function() {
        var _this = this;
        this._isComplet && !this._isReceivd && M_1.default.net.checkTaskIsOK(this._info.id).then(function(result) {
          if (result) {
            M_1.default.ui.showUI(UIData_1.UIHudDef.OpenBox, {
              config: {
                rewards: _this._info.rewards
              },
              isHideBox: true,
              text: 2 == _this._info.type ? "\u65e5\u4efb\u52d9\u734e\u52f5!" : "\u6708\u4efb\u52d9\u734e\u52f5!"
            });
            _this.stateLab.string = "\u5df2\u9886\u53d6!";
            _this._isReceivd = true;
            M_1.default.runtime.DailyTaskProgress[_this._info.id] = -1;
            DailyTaskMgr_1.default.ins.receiveOK(_this._info.id);
          }
        });
      };
      DailyItem.prototype._getConditionCount = function() {
        var count = 0;
        var dateStr = [ "day", "month" ][this._info.type - 2];
        var key = null;
        switch (this._conditionType) {
         case Constant_1.ConditionType.collect:
          key = [ Constant_1.NativeKey.DailyCollect, Constant_1.NativeKey.MonthCollect ][this._info.type - 2];
          var cd = StorageMgr_1.StorageMgr.RingStorage[dateStr]().getValue(key, null);
          cd && (count = cd[this._conditionSubType] || 0);
          break;

         case Constant_1.ConditionType.merge:
          key = [ Constant_1.NativeKey.DailyMerge, Constant_1.NativeKey.MonthMerge ][this._info.type - 2];
          var md = StorageMgr_1.StorageMgr.RingStorage[dateStr]().getValue(key, null);
          md && (count = md[this._conditionSubType] || 0);
          break;

         case Constant_1.ConditionType.doprop:
          key = [ Constant_1.NativeKey.DailyUsePropCount, Constant_1.NativeKey.MonthUsePropCount ][this._info.type - 2];
          count = StorageMgr_1.StorageMgr.RingStorage[dateStr]().getValue(key, 0);
          break;

         case Constant_1.ConditionType.gameCount:
          key = [ Constant_1.NativeKey.DailyGameCount, Constant_1.NativeKey.MonthGameCount ][this._info.type - 2];
          count = StorageMgr_1.StorageMgr.RingStorage[dateStr]().getValue(key, 0);
        }
        return count;
      };
      __decorate([ property(cc.Sprite) ], DailyItem.prototype, "bg", void 0);
      __decorate([ property(cc.Label) ], DailyItem.prototype, "nameLab", void 0);
      __decorate([ property(cc.Label) ], DailyItem.prototype, "count", void 0);
      __decorate([ property(cc.Label) ], DailyItem.prototype, "progressLab", void 0);
      __decorate([ property(cc.Label) ], DailyItem.prototype, "stateLab", void 0);
      __decorate([ property(cc.Sprite) ], DailyItem.prototype, "icon", void 0);
      __decorate([ property(cc.ProgressBar) ], DailyItem.prototype, "progress", void 0);
      DailyItem = __decorate([ ccclass ], DailyItem);
      return DailyItem;
    }(cc.Component);
    exports.default = DailyItem;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/DailyTaskMgr": "DailyTaskMgr",
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Manager/StorageMgr": "StorageMgr",
    "../../../Data/Const/Constant": "Constant",
    "../../../Data/Interface/UIData": "UIData"
  } ],
  DailyTaskInfo: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "875d2ZQiE9OZYdmPmJ0RPtq", "DailyTaskInfo");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var DailyTaskInfo = function() {
      function DailyTaskInfo(data) {
        this.id = null;
        this.type = null;
        this.name = null;
        this.condition = null;
        this.conditionType = null;
        this.conditionSubType = null;
        this.rewards = null;
        this.id = Number(data.id);
        this.type = Number(data.type);
        this.condition = Number(data.condition);
        this.name = data.name;
        this._parseConditionType(data.conditionType);
        this.rewards = [ {
          type: Number(data.rewards.name),
          count: data.rewards.count
        } ];
      }
      DailyTaskInfo.prototype._parseConditionType = function(type) {
        if (type) {
          var tmpData = type.split("|");
          if (1 == tmpData.length) this.conditionType = type; else {
            this.conditionType = tmpData[0];
            this.conditionSubType = tmpData[1];
          }
        }
      };
      return DailyTaskInfo;
    }();
    exports.default = DailyTaskInfo;
    cc._RF.pop();
  }, {} ],
  DailyTaskMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "3d8b4oG/jJBYpfbGJ11NqzC", "DailyTaskMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Constant_1 = require("../../Logic/Data/Const/Constant");
    var M_1 = require("./M");
    var StorageMgr_1 = require("./StorageMgr");
    var Event_1 = require("../../Logic/Data/Const/Event");
    var DailyTaskMgr = function() {
      function DailyTaskMgr() {}
      Object.defineProperty(DailyTaskMgr, "ins", {
        get: function() {
          this._instance || (this._instance = new DailyTaskMgr());
          return this._instance;
        },
        enumerable: true,
        configurable: true
      });
      DailyTaskMgr.prototype.syncPro2Ser = function(key, subType, dailyCount, monthCount) {
        var type = this._getConditionTypeByNatieKey(key);
        if (type && M_1.default.table.DailyTaskInfo) {
          var infos = M_1.default.table.DailyTaskInfo.getData();
          for (var i = 0; i < infos.length; i++) {
            var info = infos[i];
            if (info.conditionType == type && (!info.conditionSubType || info.conditionSubType == subType) && (2 == info.type || 3 == info.type)) {
              var count = 2 == info.type ? dailyCount : monthCount;
              count <= info.condition && M_1.default.net.putDailyTaskProgress(info.id, count);
            }
          }
        }
      };
      DailyTaskMgr.prototype.receiveOK = function(taskid) {
        M_1.default.net.putDailyTaskProgress(taskid, -1);
      };
      DailyTaskMgr.prototype.syncPro2Native = function(propgress) {
        console.error("\u5f00\u59cb\u540c\u6b65\u6570\u636e\u5230\u672c\u5730!");
        if (propgress && M_1.default.table.DailyTaskInfo) for (var taskId in propgress) {
          var count = propgress[taskId];
          var info = M_1.default.table.DailyTaskInfo.getByPrimaryKey(Number(taskId));
          var ringStr = [ "day", "month" ][info.type - 2];
          if (ringStr) {
            var key = this._getNativeKeyByConditionType(info.conditionType, info.type);
            var data = null;
            if (info.conditionSubType) {
              data = StorageMgr_1.StorageMgr.RingStorage[ringStr]().getValue(key, {});
              data[info.conditionSubType] = count;
            } else data = count;
            StorageMgr_1.StorageMgr.RingStorage[ringStr]().setValue(key, data);
          }
        } else for (var i = Constant_1.NativeKey.DailyCollect; i <= Constant_1.NativeKey.UsePropCount; i++) {
          var key = Constant_1.NativeKey[i];
          StorageMgr_1.StorageMgr.RingStorage.day().deleteValue(key);
          StorageMgr_1.StorageMgr.RingStorage.month().deleteValue(key);
        }
      };
      DailyTaskMgr.prototype._getNativeKeyByConditionType = function(conditionType, type) {
        var result = null;
        switch (conditionType) {
         case Constant_1.ConditionType.collect:
          result = Constant_1.NativeKey.DailyCollect;
          break;

         case Constant_1.ConditionType.doprop:
          result = Constant_1.NativeKey.DailyUsePropCount;
          break;

         case Constant_1.ConditionType.gameCount:
          result = Constant_1.NativeKey.DailyGameCount;
          break;

         case Constant_1.ConditionType.merge:
          result = Constant_1.NativeKey.DailyMerge;
        }
        result && 3 == type && (result += 1);
        return result;
      };
      DailyTaskMgr.prototype._getConditionTypeByNatieKey = function(key) {
        var type = null;
        key >= Constant_1.NativeKey.DailyCollect && key < Constant_1.NativeKey.Collect ? type = Constant_1.ConditionType.collect : key >= Constant_1.NativeKey.DailyMerge && key < Constant_1.NativeKey.Merge ? type = Constant_1.ConditionType.merge : key >= Constant_1.NativeKey.DailyGameCount && key < Constant_1.NativeKey.GameCount ? type = Constant_1.ConditionType.gameCount : key >= Constant_1.NativeKey.DailyUsePropCount && key < Constant_1.NativeKey.UsePropCount && (type = Constant_1.ConditionType.doprop);
        return type;
      };
      DailyTaskMgr.prototype.addDailyTaskKey = function(num) {
        var count = this.getDailyTaskKey() + num;
        StorageMgr_1.StorageMgr.Storage.setInt(Constant_1.NativeKey.CurrencyTaskKey, count, true);
        M_1.default.event.send(Event_1.Event.DailyTask.UpdateTaskKey, count);
        return count;
      };
      DailyTaskMgr.prototype.getDailyTaskKey = function() {
        return StorageMgr_1.StorageMgr.Storage.getInt(Constant_1.NativeKey.CurrencyTaskKey, 0);
      };
      DailyTaskMgr._instance = null;
      return DailyTaskMgr;
    }();
    exports.default = DailyTaskMgr;
    cc._RF.pop();
  }, {
    "../../Logic/Data/Const/Constant": "Constant",
    "../../Logic/Data/Const/Event": "Event",
    "./M": "M",
    "./StorageMgr": "StorageMgr"
  } ],
  DailyTaskPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e37f1UoGFRAA75j36BGyPMK", "DailyTaskPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../../Base/UI/UIBase");
    var M_1 = require("../../../../Base/Manager/M");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var DailyItem_1 = require("./DailyItem");
    var TimerTaskItem_1 = require("./TimerTaskItem");
    var Event_1 = require("../../../Data/Const/Event");
    var Util_1 = require("../../../../Base/Utils/Util");
    var CustomTaskItem_1 = require("./CustomTaskItem");
    var DailyTaskMgr_1 = require("../../../../Base/Manager/DailyTaskMgr");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var DailyTaskPanel = function(_super) {
      __extends(DailyTaskPanel, _super);
      function DailyTaskPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.customContent = null;
        _this.dailyContent = null;
        _this.monthContent = null;
        _this.timerContent = null;
        _this.dailyNode = null;
        _this.monthNode = null;
        _this.customCountDown = null;
        _this.dailyCountDown = null;
        _this.monthCountDown = null;
        _this.customItemPrefab = null;
        _this.timerItemPrefab = null;
        _this.dailyItemPrefab = null;
        _this.monthItemPrefab = null;
        _this.rewardIconFrames = [];
        _this._customProgressPool = [];
        _this._customProgress = null;
        _this._isCanUpdateRemoteData = true;
        return _this;
      }
      DailyTaskPanel.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.DailyTask.UpdateProgress, this._onTimerTick, this);
        M_1.default.event.register(Event_1.Event.DailyTask.UpdateTaskKey, this._onUpdateTaskKey, this);
      };
      DailyTaskPanel.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.DailyTask.UpdateProgress, this._onTimerTick, this);
        M_1.default.event.unRegister(Event_1.Event.DailyTask.UpdateTaskKey, this._onUpdateTaskKey, this);
      };
      DailyTaskPanel.prototype.onShow = function() {
        _super.prototype.onShow.call(this);
        this._isCanUpdateRemoteData = true;
      };
      DailyTaskPanel.prototype.onInit = function() {
        var datas = M_1.default.table.DailyTaskInfo.getData();
        var isNeedCreateCustomItem = 0 === this.customContent.children.length;
        this.timerContent.removeAllChildren();
        this.dailyContent.removeAllChildren();
        this.monthContent.removeAllChildren();
        for (var i = 0; i < datas.length; i++) {
          var data = datas[i];
          isNeedCreateCustomItem && this._initCustomTask(data);
          this._initDailyTask(data);
          this._initMonthTask(data);
        }
        this.scheduleOnce(this._delayInitTask.bind(this), .2);
        this._updateCountDown();
      };
      DailyTaskPanel.prototype._initCustomTask = function(data) {
        if (4 == data.type) {
          var node = M_1.default.nodePool.createItem(this.customItemPrefab);
          node.parent = this.customContent;
          node.getComponent(CustomTaskItem_1.default).init(data, this._getIconByType(data.rewards[0].type));
          this._customProgressPool.push({
            data: data,
            node: node
          });
        }
      };
      DailyTaskPanel.prototype._updateCountDown = function() {
        var _this = this;
        if (this.node.active && M_1.default.runtime.DailyTaskProgress && M_1.default.runtime.DailyTaskProgress.expires) {
          var now = Date.now() / 1e3 >> 0;
          var dailyCountDown = M_1.default.runtime.DailyTaskProgress.expires.daily - now;
          this.dailyCountDown.string = Util_1.Util.Timer.conversionTime(dailyCountDown);
          this.monthCountDown.string = Util_1.Util.Timer.conversionTime(M_1.default.runtime.DailyTaskProgress.expires.monthly - now);
          this.customCountDown.string = Util_1.Util.Timer.conversionTime(M_1.default.runtime.DailyTaskProgress.expires.custom - now);
          if (dailyCountDown < 0 && this._isCanUpdateRemoteData) {
            this._isCanUpdateRemoteData = false;
            this.scheduleOnce(function() {
              M_1.default.net.getDailyTask().then(function(res) {
                M_1.default.runtime.DailyTaskProgress = res;
                M_1.default.runtime.initTaskNativeData();
                _this.customContent.removeAllChildren();
                _this._customProgress.parent = _this.customContent.parent.parent;
                _this._customProgress.active = false;
                _this._customProgress = null;
                _this.customContent.getComponent(cc.Layout).enabled = true;
                _this.onInit();
              });
            }, 1);
          }
        }
      };
      DailyTaskPanel.prototype._delayInitTask = function() {
        this.customContent.getComponent(cc.Layout).enabled = false;
        if (!this._customProgress) {
          this._customProgress = this.customContent.parent.parent.getChildByName("keyProgress");
          this._customProgress.parent = this.customContent;
        }
        this._customProgress.active = true;
        this._customProgress.x = 21;
        this._customProgress.y = -58;
        this._customProgress.width = this.customContent.width - 50;
        this._onUpdateTaskKey();
      };
      DailyTaskPanel.prototype._initTimerTask = function(data) {
        if (1 == data.type) {
          var node = M_1.default.nodePool.createItem(this.timerItemPrefab);
          node.parent = this.timerContent;
          node.getComponent(TimerTaskItem_1.default).init(data, this._getIconByType(data.rewards[0].type));
        }
      };
      DailyTaskPanel.prototype._initDailyTask = function(data) {
        if (2 == data.type) {
          var node = M_1.default.nodePool.createItem(this.dailyItemPrefab);
          node.parent = this.dailyContent;
          node.getComponent(DailyItem_1.default).init(data, this._getIconByType(data.rewards[0].type));
        } else this._initTimerTask(data);
      };
      DailyTaskPanel.prototype._initMonthTask = function(data) {
        if (3 == data.type) {
          var node = M_1.default.nodePool.createItem(this.dailyItemPrefab);
          node.parent = this.monthContent;
          node.getComponent(DailyItem_1.default).init(data, this._getIconByType(data.rewards[0].type));
        }
      };
      DailyTaskPanel.prototype.onCloseBtnClick = function() {
        M_1.default.ui.hideUI(UIData_1.UIHudDef.DailyTaskPanel);
      };
      DailyTaskPanel.prototype._onUpdateTaskKey = function() {
        var lastData = this._customProgressPool[this._customProgressPool.length - 1].data;
        var unit = this._customProgress.width / lastData.condition;
        this._customProgress.getChildByName("bar").width = unit * DailyTaskMgr_1.default.ins.getDailyTaskKey();
        this._customProgress.getChildByName("label").getComponent(cc.Label).string = DailyTaskMgr_1.default.ins.getDailyTaskKey();
      };
      DailyTaskPanel.prototype.onChangeTaskTypeClick = function(event) {
        switch (event.node.name) {
         case "daily":
          this.dailyNode.active = true;
          this.monthNode.active = false;
          break;

         case "monty":
          this.dailyNode.active = false;
          this.monthNode.active = true;
        }
      };
      DailyTaskPanel.prototype._getIconByType = function(type) {
        var frame = null;
        frame = type < 100 ? this.rewardIconFrames[20 + type] : this.rewardIconFrames[type - 100];
        return frame;
      };
      DailyTaskPanel.prototype._onTimerTick = function() {
        this._updateCountDown();
      };
      __decorate([ property(cc.Node) ], DailyTaskPanel.prototype, "customContent", void 0);
      __decorate([ property(cc.Node) ], DailyTaskPanel.prototype, "dailyContent", void 0);
      __decorate([ property(cc.Node) ], DailyTaskPanel.prototype, "monthContent", void 0);
      __decorate([ property(cc.Node) ], DailyTaskPanel.prototype, "timerContent", void 0);
      __decorate([ property(cc.Node) ], DailyTaskPanel.prototype, "dailyNode", void 0);
      __decorate([ property(cc.Node) ], DailyTaskPanel.prototype, "monthNode", void 0);
      __decorate([ property(cc.Label) ], DailyTaskPanel.prototype, "customCountDown", void 0);
      __decorate([ property(cc.Label) ], DailyTaskPanel.prototype, "dailyCountDown", void 0);
      __decorate([ property(cc.Label) ], DailyTaskPanel.prototype, "monthCountDown", void 0);
      __decorate([ property(cc.Prefab) ], DailyTaskPanel.prototype, "customItemPrefab", void 0);
      __decorate([ property(cc.Prefab) ], DailyTaskPanel.prototype, "timerItemPrefab", void 0);
      __decorate([ property(cc.Prefab) ], DailyTaskPanel.prototype, "dailyItemPrefab", void 0);
      __decorate([ property(cc.Prefab) ], DailyTaskPanel.prototype, "monthItemPrefab", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], DailyTaskPanel.prototype, "rewardIconFrames", void 0);
      DailyTaskPanel = __decorate([ ccclass ], DailyTaskPanel);
      return DailyTaskPanel;
    }(UIBase_1.default);
    exports.default = DailyTaskPanel;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/DailyTaskMgr": "DailyTaskMgr",
    "../../../../Base/Manager/M": "M",
    "../../../../Base/UI/UIBase": "UIBase",
    "../../../../Base/Utils/Util": "Util",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData",
    "./CustomTaskItem": "CustomTaskItem",
    "./DailyItem": "DailyItem",
    "./TimerTaskItem": "TimerTaskItem"
  } ],
  DataPool: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b5479qDeQFJ1L2tIXtUUYFl", "DataPool");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var DataPool = function() {
      function DataPool(size, CLS, initCreate, isClean) {
        void 0 === size && (size = 10);
        void 0 === initCreate && (initCreate = false);
        void 0 === isClean && (isClean = true);
        this.CLS = null;
        this.datas = null;
        this.SIZE = null;
        this._isClean = true;
        this.SIZE = size;
        this.CLS = CLS;
        this.datas = [];
        this._isClean = isClean;
        if (initCreate) for (var i = size; i--; ) this.datas.push(new CLS());
      }
      DataPool.prototype.getData = function() {
        if (this.datas.length <= 0) return new this.CLS();
        return this.datas.pop();
      };
      DataPool.prototype.freeData = function(data) {
        if (this.datas.length < this.SIZE) {
          this._isClean && data.destory();
          this.datas.push(data);
        }
      };
      DataPool.prototype.freeAll = function() {
        this._isClean && this.datas.forEach(function(data) {
          data.destory();
        });
        this.datas.length = 0;
      };
      Object.defineProperty(DataPool.prototype, "size", {
        get: function() {
          return this.datas.length;
        },
        enumerable: true,
        configurable: true
      });
      return DataPool;
    }();
    exports.DataPool = DataPool;
    cc._RF.pop();
  }, {} ],
  DeviceMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b13b0MaaixLu6ryB/di8Jse", "DeviceMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var PlatformMgr_1 = require("./PlatformMgr");
    var SingletonFactory_1 = require("../Utils/SingletonFactory");
    var DeviceMgr = function() {
      function DeviceMgr() {}
      DeviceMgr.prototype.getDeviceModel = function() {
        var systemInfo = PlatformMgr_1.default.ins.getSystemInfoSync();
        if (!systemInfo || !systemInfo["system"]) return null;
        return systemInfo["system"].indexOf("Android") >= 0 ? "Android" : systemInfo["model"].indexOf("iPhone X") >= 0 || systemInfo["model"].indexOf("unknow") >= 0 ? "ipX" : "iphone";
      };
      Object.defineProperty(DeviceMgr.prototype, "isAndroid", {
        get: function() {
          if (cc.sys.platform == cc.sys.ANDROID) return 1;
          return 0;
        },
        enumerable: true,
        configurable: true
      });
      DeviceMgr.ins = SingletonFactory_1.SingletonFactory.getInstance(DeviceMgr);
      return DeviceMgr;
    }();
    exports.default = DeviceMgr;
    cc._RF.pop();
  }, {
    "../Utils/SingletonFactory": "SingletonFactory",
    "./PlatformMgr": "PlatformMgr"
  } ],
  DialogPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "589033LajhPCIQVvxL+baE2", "DialogPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var UIMgr_1 = require("../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Data/Interface/UIData");
    var CollectItemCtrl_1 = require("../../Match3/View/UI/CollectItemCtrl");
    var Event_1 = require("../../Data/Const/Event");
    var Constant_1 = require("../../Data/Const/Constant");
    var SlideButton_1 = require("../../../Base/CustomComponent/SlideButton");
    var RuntimeMgr_1 = require("../../Data/RuntimeMgr");
    var Common_1 = require("../Common");
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var BaseConst_1 = require("../../../Base/BaseConst");
    var SelectPropCtrl_1 = require("../../Match3/View/UI/SelectPropCtrl");
    var StorageMgr_1 = require("../../../Base/Manager/StorageMgr");
    var GuideUtils_1 = require("../../../../GodGuide/GuideUtils");
    var ShareMgr_1 = require("../../../Base/Manager/ShareMgr");
    var AudioCtrl_1 = require("../AudioCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var DialogPanel = function(_super) {
      __extends(DialogPanel, _super);
      function DialogPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.content = null;
        _this.collectPrefab = null;
        _this.frames = [];
        _this.curData = null;
        _this._animation = null;
        return _this;
      }
      DialogPanel.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
        this.initEvent();
        this.initAnimation();
      };
      DialogPanel.prototype.onDestroy = function() {
        this.node.stopAllActions();
        this.unscheduleAllCallbacks();
        this.removeEvent();
      };
      DialogPanel.prototype.initEvent = function() {
        M_1.default.event.register(Event_1.Event.UI.ChangeScene, this.onSceneChanged, this);
      };
      DialogPanel.prototype.removeEvent = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.ChangeScene, this.onSceneChanged, this);
      };
      DialogPanel.prototype._clearDisplay = function() {
        this.curData && this.curData.type == UIData_1.UIHudDef.SelectShowTarget && (this.node.getChildByName("lab_lv").getComponent(cc.Label).string = "");
      };
      DialogPanel.prototype.onInit = function(params) {
        if (params) {
          this.curData = params;
          switch (params.type) {
           case UIData_1.UIHudDef.GameOverWin:
            EventMgr_1.default.ins.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.GameWin);
            this.fillGameWinData();
            break;

           case UIData_1.UIHudDef.SelectShowTarget:
            this.fillShowSelectTargetData(params.data);
            this.node.getChildByName("propContent").getComponent(SelectPropCtrl_1.default).init();
            break;

           case UIData_1.UIHudDef.GameShowTarget:
            EventMgr_1.default.ins.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.GameShowTarget);
            this.fillShowTargetData();
            this.initShowTargetContent(params.data.collect);
            break;

           case UIData_1.UIHudDef.GameOverFail:
            EventMgr_1.default.ins.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.GameFail);
            this.fillGameFailData();
            this.initShowTargetContent(params.data);
            break;

           case UIData_1.UIHudDef.GamePause:
            this.initSoundOpt();
          }
        }
      };
      DialogPanel.prototype.onHide = function() {
        _super.prototype.onHide.call(this);
        this._animation && this._animation.stop();
        this._clearDisplay();
      };
      DialogPanel.prototype.onShow = function(closeCallBack) {
        _super.prototype.onShow.call(this, closeCallBack);
        this.initAnimation();
        this.playAnimation();
      };
      DialogPanel.prototype.onUILoad = function() {};
      DialogPanel.prototype.onStartGame = function() {
        if (M_1.default.runtime.isPowerEnough()) {
          UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.MenuPanel);
          this.hide();
          M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.StartGame);
          M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, -Constant_1.PowerConfig.LvConsumption);
          Common_1.default.curScene == Constant_1.Scene.Match ? M_1.default.event.send(Event_1.Event.GameCMD.GameReset) : UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GameLoading, null, function() {
            cc.director.preloadScene(Constant_1.Scene.Match, function(completedCount, totalCount, item) {
              EventMgr_1.default.ins.send(Event_1.Event.UI.UpdateTmpLoadingProgress, Math.ceil(completedCount / totalCount * 50));
            }, function() {
              Common_1.default.jumpScene(Constant_1.Scene.Match);
              StorageMgr_1.StorageMgr.Storage.setInt(Constant_1.NativeKey.LevelFailTag, 0);
            });
          });
        } else M_1.default.tips.show(Constant_1.WaringTips.PowerNotEnough);
      };
      DialogPanel.prototype.onGameOverClose = function() {
        this.hide();
        var curLevel = M_1.default.runtime.CurLevel;
        GuideUtils_1.GuideUtils.onMatch3Next(curLevel);
        Common_1.default.jumpScene(Constant_1.Scene.Hotel);
      };
      DialogPanel.prototype.onGameOverRestart = function() {
        M_1.default.runtime.SceneTask.push(Constant_1.SceneTaskKey.ShowTargetDlg);
        Common_1.default.jumpScene(Constant_1.Scene.Hotel);
      };
      DialogPanel.prototype.onGameOverNext = function() {
        if (-1 != GuideUtils_1.GuideUtils.curGuideId) return;
        var curLevel = M_1.default.runtime.CurLevel;
        GuideUtils_1.GuideUtils.onMatch3Next(curLevel);
        M_1.default.runtime.SceneTask.push(Constant_1.SceneTaskKey.ShowTargetDlg);
        Common_1.default.jumpScene(Constant_1.Scene.Hotel);
      };
      DialogPanel.prototype.onGameShare = function() {
        var level = M_1.default.runtime.CurLevel;
        var shareConfig = ShareMgr_1.default.ins.getConfig(level, "level");
        if (shareConfig) {
          var bottom = this.node.getChildByName("bottom");
          if (bottom) {
            var ButtonShare_1 = bottom.getChildByName("ButtonShare");
            ButtonShare_1 && ShareMgr_1.default.ins.doShareLevel(level, function() {
              ButtonShare_1 && (ButtonShare_1.active = false);
            });
          }
        }
      };
      DialogPanel.prototype.onShowGameTargetOver = function() {
        UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.GameShowTarget);
      };
      DialogPanel.prototype.onBgmOptChanged = function(opt) {
        console.error("onBgmOptChanged:", opt);
        M_1.default.event.send(Event_1.Event.Sound.UpdateOpt, "bgm", opt);
      };
      DialogPanel.prototype.resetMatch3Scene = function() {
        M_1.default.event.send(Event_1.Event.GameCMD.GameReset);
      };
      DialogPanel.prototype.onEffSoundOptChanged = function(opt) {
        console.error("onEffSoundOptChanged:", opt);
        M_1.default.event.send(Event_1.Event.Sound.UpdateOpt, "eff", opt);
      };
      DialogPanel.prototype.onSceneChanged = function() {
        this.hide();
        this.unscheduleAllCallbacks();
        this.node.stopAllActions();
      };
      DialogPanel.prototype.initAnimation = function() {
        if (!this._animation) {
          this._animation = this.getComponent(cc.Animation);
          if (this._animation) {
            this._animation.stop();
            this._animation.on("stop", this.onAnimationStop, this);
          }
        }
      };
      DialogPanel.prototype.initSoundOpt = function() {
        var opt = StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.Sound, {
          eff: false,
          bgm: true
        });
        var bgmBtn = this.node.getChildByName("bgm").getComponent(SlideButton_1.default);
        var effBtn = this.node.getChildByName("eff").getComponent(SlideButton_1.default);
        bgmBtn.onChange(null, opt["bgm"]);
        effBtn.onChange(null, opt["eff"]);
      };
      DialogPanel.prototype.onAnimationFrameEvent = function() {
        EventMgr_1.default.ins.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.GetStar);
      };
      DialogPanel.prototype.onAnimationStop = function(eventName, aniState) {
        switch (aniState.name) {
         case "gameWin":
          this._animation.play("star" + (this.curData.data || 0));
          break;

         case "overShow":
          this.scheduleOnce(this.hide.bind(this), .3);
        }
      };
      DialogPanel.prototype.hide = function() {
        UIMgr_1.default.ins.hideUI(this.curData.type);
        this.unscheduleAllCallbacks();
      };
      DialogPanel.prototype.goMainScene = function() {
        Common_1.default.jumpScene(Constant_1.Scene.Hotel);
      };
      DialogPanel.prototype.playAnimation = function() {
        this._animation && this._animation.play();
      };
      DialogPanel.prototype.fillShowSelectTargetData = function(lv) {
        GuideUtils_1.GuideUtils.onMatch3SelectShowTarget(lv);
        M_1.default.runtime.SelectLevel = lv = lv || M_1.default.runtime.getMatch3Level();
        this.setLv(this.node.getChildByName("lab_lv"), lv, "");
        var lvData = RuntimeMgr_1.default.ins.getNativeLvData(lv);
        var parent = this.node.getChildByName("starContent");
        for (var i = 1; i <= 3; ++i) parent.getChildByName(i.toString()).active = lvData.star >= i;
      };
      DialogPanel.prototype.fillShowTargetData = function() {
        var cfg = M_1.default.table.Titles.getByPrimaryKey(M_1.default.runtime.CurLevel);
        cfg && cfg.showTargetContent && (cc.find("kunag/di/title", this.node).getComponent(cc.Label).string = cfg.showTargetContent);
        this.unscheduleAllCallbacks();
        this.scheduleOnce(this.hide.bind(this), 2);
      };
      DialogPanel.prototype.fillGameFailData = function() {
        this.runContinueAction();
        this.setLv2(this.node.getChildByName("lab_lv"));
        GuideUtils_1.GuideUtils.onMatch3Over(M_1.default.runtime.CurLevel, false);
      };
      DialogPanel.prototype.fillGameWinData = function() {
        var _this = this;
        var score = this.node.getChildByName("lab_score").getComponent(cc.Label);
        var bestScore = this.node.getChildByName("lab_best").getComponent(cc.Label);
        var curLevel = M_1.default.runtime.CurLevel;
        this.runContinueAction();
        this.setLv2(this.node.getChildByName("lab_lv"));
        var data = M_1.default.runtime.getNativeLvData();
        score.string = M_1.default.runtime.currentScore + "";
        bestScore.string = (data.score || M_1.default.runtime.currentScore) + "";
        var configInfo = M_1.default.table.LevelUpReward.getByPrimaryKey(curLevel);
        if (configInfo && configInfo.rewards) {
          this.content.removeAllChildren();
          configInfo.rewards.forEach(function(item) {
            var count = item.count;
            item.type == BaseConst_1.CurrencyId.Coin && (count = Common_1.default.bytesToSize(count));
            var node = M_1.default.nodePool.createItem(_this.collectPrefab);
            node.parent = _this.content;
            node.getComponent(cc.Sprite).spriteFrame = _this.frames[item.type];
            node.getChildByName("count").getComponent(cc.Label).string = "x" + count;
          });
        }
        var shareConfig = ShareMgr_1.default.ins.getConfig(curLevel, "level");
        if (shareConfig) {
          var bottom = this.node.getChildByName("bottom");
          if (bottom) {
            var ButtonShare = bottom.getChildByName("ButtonShare");
            ButtonShare && (ButtonShare.active = true);
          }
        }
      };
      DialogPanel.prototype.runContinueAction = function() {
        var node = cc.find("bottom/continue", this.node);
        if (node) {
          var a0 = cc.scaleTo(.5, 1.1);
          var a1 = cc.scaleTo(.5, 1);
          node.runAction(cc.repeatForever(cc.sequence(a0, a1)));
        }
      };
      DialogPanel.prototype.setLv = function(node, lv, content) {
        void 0 === lv && (lv = 0);
        void 0 === content && (content = "\u5173\u5361");
        node.getComponent(cc.Label).string = "" + content + (lv || RuntimeMgr_1.default.ins.CurLevel);
      };
      DialogPanel.prototype.setLv2 = function(node, lv, content) {
        void 0 === lv && (lv = 0);
        void 0 === content && (content = "\u7b2c");
        node.getComponent(cc.Label).string = "" + content + (lv || RuntimeMgr_1.default.ins.CurLevel) + "\u5173";
      };
      DialogPanel.prototype.initShowTargetContent = function(data) {
        var _this = this;
        if (data) {
          this.content.destroyAllChildren();
          data.forEach(function(data) {
            var collect = M_1.default.nodePool.createItem(_this.collectPrefab);
            var itemCtrl = collect.getComponent(CollectItemCtrl_1.default);
            collect.parent = _this.content;
            itemCtrl.init(data.type, data.count);
          });
        }
      };
      __decorate([ property(cc.Node) ], DialogPanel.prototype, "content", void 0);
      __decorate([ property(cc.Prefab) ], DialogPanel.prototype, "collectPrefab", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], DialogPanel.prototype, "frames", void 0);
      DialogPanel = __decorate([ ccclass ], DialogPanel);
      return DialogPanel;
    }(UIBase_1.default);
    exports.default = DialogPanel;
    cc._RF.pop();
  }, {
    "../../../../GodGuide/GuideUtils": "GuideUtils",
    "../../../Base/BaseConst": "BaseConst",
    "../../../Base/CustomComponent/SlideButton": "SlideButton",
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/Manager/M": "M",
    "../../../Base/Manager/ShareMgr": "ShareMgr",
    "../../../Base/Manager/StorageMgr": "StorageMgr",
    "../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Interface/UIData": "UIData",
    "../../Data/RuntimeMgr": "RuntimeMgr",
    "../../Match3/View/UI/CollectItemCtrl": "CollectItemCtrl",
    "../../Match3/View/UI/SelectPropCtrl": "SelectPropCtrl",
    "../AudioCtrl": "AudioCtrl",
    "../Common": "Common"
  } ],
  DiningHall: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9cf99WPNKRITKn63x49g3kT", "DiningHall");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Exchange_1 = require("./Exchange");
    var SpinePlayerCtrl_1 = require("../../../../Base/CustomComponent/SpinePlayerCtrl");
    var EventMgr_1 = require("../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var DiningHall = function(_super) {
      __extends(DiningHall, _super);
      function DiningHall() {
        return null !== _super && _super.apply(this, arguments) || this;
      }
      DiningHall.prototype.onLoad = function() {
        var _this = this;
        var exchange = this.node.getComponent(Exchange_1.default);
        cc.loader.loadRes("prefab/map/canting/canting", cc.Prefab, function(err, prefab) {
          if (!err) {
            var node = cc.instantiate(prefab);
            _this.node.addChild(node);
            var sp = _this.sp = node.getComponentInChildren(SpinePlayerCtrl_1.default);
            sp.play("dianmian_jinzhi" + (exchange.state + 1), 0);
            EventMgr_1.default.ins.register(Event_1.Event.Map.Upgrade, _this.exchangeState, _this);
          }
        });
      };
      DiningHall.prototype.onDestroy = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.Upgrade, this.exchangeState, this);
      };
      DiningHall.prototype.exchangeState = function(state) {
        var exchange = this.node.getComponent(Exchange_1.default);
        this.sp.play(1 == state ? "dianmian" : "dianmian2", 0, false, function() {
          exchange.inAnim = false;
        });
      };
      DiningHall.prototype.showState = function(state) {
        this.sp.play("dianmian_jinzhi" + (state + 1), 0);
      };
      DiningHall.prototype.start = function() {};
      DiningHall = __decorate([ ccclass ], DiningHall);
      return DiningHall;
    }(cc.Component);
    exports.default = DiningHall;
    cc._RF.pop();
  }, {
    "../../../../Base/CustomComponent/SpinePlayerCtrl": "SpinePlayerCtrl",
    "../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Data/Const/Event": "Event",
    "./Exchange": "Exchange"
  } ],
  EffLayerCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "98a33qumQtJkZvEl7frOI0a", "EffLayerCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SpinePlayerCtrl_1 = require("../../../Base/CustomComponent/SpinePlayerCtrl");
    var M_1 = require("../../../Base/Manager/M");
    var Constant_1 = require("../../Data/Const/Constant");
    var Event_1 = require("../../Data/Const/Event");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var Common_1 = require("../../Common/Common");
    var AudioCtrl_1 = require("../../Common/AudioCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var EffLayerCtrl = function(_super) {
      __extends(EffLayerCtrl, _super);
      function EffLayerCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.bombEffPrefab = null;
        _this.littleBombPrefab = null;
        _this.mergeBombPrefab = null;
        _this.comboPrefab = null;
        _this.rowColBombPrefab = null;
        _this.fishBombPrefab = null;
        _this.rainbowBombPrefab = null;
        _this.shootStarPrefab = null;
        _this.haimaShootOverEff = null;
        _this.zyJumpPrefab = null;
        _this.zyJumpOverPrefab = null;
        _this.zyJumpElimatePrefab = null;
        _this.brokenPrefab = null;
        _this.LeavesBrokenPrefab = null;
        _this.boxBrokenPrefab = null;
        _this.overShootPrefab = null;
        _this.addScorePrefab = null;
        _this.addScoreOverPrefab = null;
        _this.dotPrefab = null;
        _this.bombAndBombPrefab = null;
        _this.haimaAndHetuanPrefab = null;
        _this.haimaAndHaimaPrefab = null;
        _this.zhangyuAndJianyu = null;
        _this.hetuanAndJianyu = null;
        _this.chuizi = null;
        _this.bombAndFishPrefab = null;
        _this.haimaAndZhangyuPrefab = null;
        _this._tmpShootStar = [];
        _this._tmpShootOver = [];
        return _this;
      }
      EffLayerCtrl_1 = EffLayerCtrl;
      EffLayerCtrl.prototype.onLoad = function() {
        EffLayerCtrl_1.ins = this;
        this.registerEvent();
        this._preLoadNodePool();
        this.node.zIndex = 100;
      };
      EffLayerCtrl.prototype.onDestroy = function() {
        this.removeEvent();
        M_1.default.nodePool.destory();
      };
      EffLayerCtrl.prototype._preLoadNodePool = function() {
        var now = Date.now();
        M_1.default.nodePool.create(Constant_1.NodePoolKey.HaimaAndZhangyu, this.haimaAndZhangyuPrefab, 5);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.BombAndFish, this.bombAndFishPrefab, 5);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.BombAndBomb, this.bombAndBombPrefab, 5);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.MergeBomb, this.mergeBombPrefab, 20);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.LittleBomb, this.littleBombPrefab, 50);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.Broken, this.brokenPrefab, 50);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.LeafBroken, this.LeavesBrokenPrefab, 20);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.BombEff, this.bombEffPrefab, 20);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.RowColEff, this.rowColBombPrefab, 20);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.ZyJumpElimate, this.zyJumpElimatePrefab, 20);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.ZyJumpOver, this.zyJumpOverPrefab, 20);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.HaiMaOver, this.haimaShootOverEff, 20);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.AddScoreOverEff, this.addScoreOverPrefab, 20);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.AddScoreEff, this.addScorePrefab, 50);
      };
      EffLayerCtrl.prototype.registerEvent = function() {
        M_1.default.event.register(Event_1.Event.Effect.LittleBomb, this.playLittleBomb, this);
        M_1.default.event.register(Event_1.Event.Effect.SpeedLine, this.playSpeedLine, this);
        M_1.default.event.register(Event_1.Event.Effect.ShootStar, this.onShootStar, this);
        M_1.default.event.register(Event_1.Event.Effect.OverShoot, this.overShoot, this);
        M_1.default.event.register(Event_1.Event.Effect.Combo, this.playComboEff, this);
        M_1.default.event.register(Event_1.Event.Effect.Broken, this.playBrokenEff, this);
        M_1.default.event.register(Event_1.Event.Effect.CollectOver, this.normalCollectOverEff, this);
        M_1.default.event.register(Event_1.Event.Effect.AddScore, this.playAddScoreEff, this);
      };
      EffLayerCtrl.prototype.removeEvent = function() {
        M_1.default.event.unRegister(Event_1.Event.Effect.LittleBomb, this.playLittleBomb, this);
        M_1.default.event.unRegister(Event_1.Event.Effect.SpeedLine, this.playSpeedLine, this);
        M_1.default.event.unRegister(Event_1.Event.Effect.OverShoot, this.overShoot, this);
        M_1.default.event.unRegister(Event_1.Event.Effect.ShootStar, this.onShootStar, this);
        M_1.default.event.unRegister(Event_1.Event.Effect.Combo, this.playComboEff, this);
        M_1.default.event.unRegister(Event_1.Event.Effect.Broken, this.playBrokenEff, this);
        M_1.default.event.unRegister(Event_1.Event.Effect.AddScore, this.playAddScoreEff, this);
        M_1.default.event.unRegister(Event_1.Event.Effect.CollectOver, this.normalCollectOverEff, this);
      };
      EffLayerCtrl.prototype.playComboEff = function(level) {
        var name = Constant_1.ComboLevel[level];
        if (name) {
          var comboNode = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.ComboEff, this.comboPrefab);
          comboNode.parent = this.node;
          var animation = comboNode.getComponent(cc.Animation);
          animation.play(name);
          animation.on("finished", this.effCompleted.bind(this, Constant_1.NodePoolKey.ComboEff, animation, comboNode), this);
        }
      };
      EffLayerCtrl.prototype.effCompleted = function(key, anim, comboNode) {
        anim.off("finished", this.effCompleted, this);
        M_1.default.nodePool.freeItem(key, comboNode);
      };
      EffLayerCtrl.prototype.playAddScoreEff = function(score, pos, isOver) {
        void 0 === isOver && (isOver = false);
        var node = null;
        if (isOver) node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.AddScoreOverEff, this.addScoreOverPrefab); else {
          pos = this.node.convertToNodeSpaceAR(pos);
          pos = pos.add(cc.v2(-Common_1.default.GRID_W / 4, Common_1.default.GRID_H / 2));
          node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.AddScoreEff, this.addScorePrefab);
        }
        node.parent = this.node;
        node.opacity = 255;
        node.setAnchorPoint(cc.v2(1, 0));
        node.setPosition(pos);
        if (isOver) {
          node.getChildByName("score").getComponent(cc.Label).string = score.toString();
          var animation = node.getComponent(cc.Animation);
          animation.play();
          var a1 = cc.delayTime(.5);
          var a2 = cc.fadeOut(.5);
          var a3 = cc.callFunc(function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.AddScoreOverEff, node);
          });
          node.runAction(cc.sequence(a1, a2, a3));
        } else {
          node.getComponent(cc.Label).string = score.toString();
          var a1 = cc.scaleTo(.2, 1.2);
          var a2 = cc.scaleTo(.2, 1);
          var a3 = cc.moveBy(.3, cc.v2(0, 30));
          var a4 = cc.fadeOut(.2);
          var a5 = cc.callFunc(function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.AddScoreEff, node);
          });
          node.runAction(cc.sequence(a1, a2, a3, a4, a5));
        }
      };
      EffLayerCtrl.prototype.playZyJump = function(startPos, targetPos, callback, conveType) {
        var _this = this;
        startPos = this.node.convertToNodeSpaceAR(startPos);
        targetPos = this.node.convertToNodeSpaceAR(targetPos);
        this.scheduleOnce(function() {
          _this.playZyJumpEliamteEff(startPos);
          M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.Octopus);
        }, 0);
        var eff = this.createSpineNode(Constant_1.NodePoolKey.ZyJump, this.zyJumpPrefab, startPos);
        var animName = "zhangyu_tiao";
        conveType == Constant_1.CellType.Bomb2 ? animName = "zhangyu_tiao_jianyu" : conveType == Constant_1.CellType.Bomb1 && (animName = "zhangyu_tiao_hetun");
        eff.ctrl.play(animName, 0, false, function() {});
        var tmpx = Math.abs(Math.abs(startPos.x) - Math.abs(targetPos.x)) / 2;
        var tmpy = (startPos.y > targetPos.y ? startPos.y : targetPos.y) + 400;
        var centerPos = cc.v2(startPos.x > targetPos.x ? -tmpx : tmpx, tmpy);
        var a0 = cc.delayTime(.2);
        var a1 = cc.bezierTo(TimeConfig_1.GapTime.OctopusJumpSpeed, [ startPos, centerPos, targetPos ]);
        var a2 = cc.callFunc(function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.ZyJump, eff.node);
          var bomb = _this.createSpineNode(Constant_1.NodePoolKey.ZyJumpOver, _this.zyJumpOverPrefab, targetPos);
          bomb.ctrl.play("FX_zhangyu_xiaochu", 0, false, function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.ZyJumpOver, bomb.node);
          });
          callback && callback();
        }, this);
        eff.node.runAction(cc.sequence(a0, a1, a2));
      };
      EffLayerCtrl.prototype.playZyJumpEliamteEff = function(startPos) {
        var eff = this.createSpineNode(Constant_1.NodePoolKey.ZyJumpElimate, this.zyJumpElimatePrefab, startPos);
        eff.node.zIndex = -1;
        eff.ctrl.play("zhangyu_tiaoFX", 0, false, function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.ZyJumpElimate, eff.node);
        });
      };
      EffLayerCtrl.prototype.playBrokenEff = function(pos, callback, type, name) {
        var key = Constant_1.NodePoolKey.Broken;
        var prefab = this.brokenPrefab;
        var playName = "tongyog_posui";
        var eff = null;
        if (type) if (type == Constant_1.GroundType.Leaves) {
          key = Constant_1.NodePoolKey.LeafBroken;
          prefab = this.LeavesBrokenPrefab;
        } else if (type == Constant_1.UpGroundType.Box) {
          key = Constant_1.NodePoolKey.BoxBroken;
          prefab = this.boxBrokenPrefab;
          playName = name;
        }
        if (type == Constant_1.UpGroundType.Box) {
          eff = this.createEffPrefab(key, prefab, this.node.convertToNodeSpaceAR(pos));
          eff.ctrl.play(playName);
        } else {
          eff = this.createSpineNode(key, prefab, this.node.convertToNodeSpaceAR(pos));
          eff.ctrl.play(playName, 0, false, function() {
            M_1.default.nodePool.freeItem(key, eff.node);
            callback && callback();
          });
        }
      };
      EffLayerCtrl.prototype.playRowColEff = function(type, centerPos) {
        var angle = 0;
        type == Constant_1.CellType.Bomb3 && (angle = 90);
        centerPos = this.node.convertToNodeSpaceAR(centerPos);
        var item = this.createSpineNode(Constant_1.NodePoolKey.RowColEff, this.rowColBombPrefab, centerPos);
        item.node.angle = angle;
        item.ctrl.play("hengsudan_fashe", 0, false, function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.RowColEff, item.node);
        });
      };
      EffLayerCtrl.prototype.playFishBombEff = function(pos) {
        pos = this.node.convertToNodeSpaceAR(pos);
        var item = this.createSpineNode(Constant_1.NodePoolKey.FishBombEff, this.fishBombPrefab, pos);
        item.ctrl.play("baozhayu_bom", 0, false, function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.FishBombEff, item.node);
        });
      };
      EffLayerCtrl.prototype.playItemHeti = function(pos, key, prefab, animName, isNeedPlayBombEff) {
        var _this = this;
        void 0 === isNeedPlayBombEff && (isNeedPlayBombEff = true);
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(key, prefab, _this.node.convertToNodeSpaceAR(pos));
          cc.log("\u64ad\u653e\u9053\u51772\u54081\u65f6\u7684\u52a8\u753b\uff0c\u52a8\u753b\u540d\u79f0: " + animName);
          item.ctrl.play(animName, 0, false, function() {
            true == isNeedPlayBombEff;
            M_1.default.nodePool.freeItem(key, item.node);
            resolve();
          });
        });
      };
      EffLayerCtrl.prototype.playZhangyuAndJianyu = function(animName, pos, targetPos, fun) {
        var _this = this;
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(Constant_1.NodePoolKey.ZhangyuAndJianyu, _this.zhangyuAndJianyu, _this.node.convertToNodeSpaceAR(pos));
          cc.log("\u8df3\u8dc3\u52a8\u753b\u540d\u79f0: " + animName);
          var a1 = cc.moveTo(.2, 150, 300);
          item.ctrl.scheduleOnce(resolve, .2);
          item.ctrl.play(animName, 0, false, function() {});
          var a2 = cc.delayTime(.2);
          var a3 = cc.moveTo(.5, targetPos);
          var a4 = cc.callFunc(function() {
            if (fun) {
              fun();
              M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.ZhangyuAndJianyu, item.node);
            }
          });
          item.node.runAction(cc.sequence(a1, a2, a3, a4));
        });
      };
      EffLayerCtrl.prototype.playZhangyuAndZhangyu = function(pos) {
        var _this = this;
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(Constant_1.NodePoolKey.HaimaAndHetun, _this.haimaAndHetuanPrefab, _this.node.convertToNodeSpaceAR(pos));
          item.ctrl.scheduleOnce(resolve, .6);
          item.ctrl.play("zhangyuZhangyu", 0, false, function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.HaimaAndHetun, item.node);
          });
        });
      };
      EffLayerCtrl.prototype.playChuizi = function(pos) {
        var _this = this;
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(Constant_1.NodePoolKey.Chuizi, _this.chuizi, _this.node.convertToNodeSpaceAR(pos));
          item.ctrl.play("animation", 0, false, function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.Chuizi, item.node);
            resolve();
          });
        });
      };
      EffLayerCtrl.prototype.playHaimaAndZhangyu = function(pos) {
        var _this = this;
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(Constant_1.NodePoolKey.HaimaAndZhangyu, _this.haimaAndZhangyuPrefab, _this.node.convertToNodeSpaceAR(pos));
          item.ctrl.play("hetunHaima", 0, false, function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.HaimaAndZhangyu, item.node);
            resolve();
          });
        });
      };
      EffLayerCtrl.prototype.playHaimaAndHaima = function(pos) {
        var _this = this;
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(Constant_1.NodePoolKey.HaimaAndHaima, _this.haimaAndHaimaPrefab, _this.node.convertToNodeSpaceAR(pos));
          item.ctrl.scheduleOnce(resolve, 4);
          item.ctrl.play("haimaHaima", 0, false, function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.HaimaAndHaima, item.node);
          });
        });
      };
      EffLayerCtrl.prototype.playFishAndFish = function(pos) {
        var _this = this;
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(Constant_1.NodePoolKey.BombAndFish, _this.bombAndFishPrefab, _this.node.convertToNodeSpaceAR(pos));
          item.ctrl.scheduleOnce(resolve, 1);
          item.ctrl.play("jianyuJianyu", 0, false, function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.BombAndFish, item.node);
          });
        });
      };
      EffLayerCtrl.prototype.playBombAndFish = function(pos) {
        var _this = this;
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(Constant_1.NodePoolKey.BombAndFish, _this.bombAndFishPrefab, _this.node.convertToNodeSpaceAR(pos));
          item.ctrl.scheduleOnce(resolve, 1);
          item.ctrl.play("jianyuHetun", 0, false, function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.BombAndFish, item.node);
          });
        });
      };
      EffLayerCtrl.prototype.playBombAndBomb = function(pos) {
        var _this = this;
        return new Promise(function(resolve) {
          var item = _this.createSpineNode(Constant_1.NodePoolKey.BombAndBomb, _this.bombAndBombPrefab, _this.node.convertToNodeSpaceAR(pos));
          item.ctrl.play("hetunHeti", 0, false, function() {
            _this.playBombEff(0, pos, 1.5);
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.BombAndBomb, item.node);
            resolve();
          });
        });
      };
      EffLayerCtrl.prototype.playBombEff = function(bombLv, pos, scale) {
        void 0 === scale && (scale = 1);
        pos = this.node.convertToNodeSpaceAR(pos);
        var item = this.createSpineNode(Constant_1.NodePoolKey.BombEff, this.bombEffPrefab, pos);
        item.node.scale = scale;
        item.ctrl.play("beiek_baozha", 0, false, function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.BombEff, item.node);
        });
      };
      EffLayerCtrl.prototype.playLittleBomb = function(pos) {
        pos = this.node.convertToNodeSpaceAR(pos);
        var item = this.createSpineNode(Constant_1.NodePoolKey.LittleBomb, this.littleBombPrefab, pos);
        item.ctrl.play("ciaochu01", 0, false, function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.LittleBomb, item.node);
        });
      };
      EffLayerCtrl.prototype.playRainbowBomb = function(pos, callback) {
        pos = this.node.convertToNodeSpaceAR(pos);
        var rainbowBombNode = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.RainbowBomb, this.rainbowBombPrefab);
        rainbowBombNode.parent = this.node;
        rainbowBombNode.setPosition(pos);
        var effCtrl = rainbowBombNode.getComponent(SpinePlayerCtrl_1.default);
        effCtrl.timeScale = 3;
        effCtrl.play("skill_haima1", 0, false, function() {
          callback();
          effCtrl.timeScale = 1;
          effCtrl.play("skill_haima2", 0, false, function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.RainbowBomb, rainbowBombNode);
          });
        });
      };
      EffLayerCtrl.prototype.overShoot = function(centerPos, targetPos, cm, callback) {
        centerPos = this.node.convertToNodeSpaceAR(centerPos);
        targetPos = this.node.convertToNodeSpaceAR(targetPos);
        var handle = this.createSpineNode(Constant_1.NodePoolKey.OverShoot, this.overShootPrefab, centerPos);
        var a0 = cc.moveTo(1, targetPos);
        var a1 = cc.callFunc(function() {
          M_1.default.runtime.OverStepCount++;
          M_1.default.runtime.OverStepCount > 7 && (M_1.default.runtime.OverStepCount = 7);
          M_1.default.event.send(Event_1.Event.UI.AddScore, Constant_1.ScoreConfig.OverStep[M_1.default.runtime.OverStepCount], targetPos, true);
          callback(cm);
        });
        M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.partytime_shoot);
        handle.node.runAction(cc.sequence(a0, a1));
      };
      EffLayerCtrl.prototype.onShootStar = function(centerPos, targetPos, callback) {
        var _this = this;
        centerPos = this.node.convertToNodeSpaceAR(centerPos);
        targetPos = this.node.convertToNodeSpaceAR(targetPos);
        var handle = this.createSpineNode(Constant_1.NodePoolKey.ShootStar, this.shootStarPrefab, centerPos);
        var distance = Math.sqrt(Math.pow(centerPos.x - targetPos.x, 2) + Math.pow(centerPos.y - targetPos.y, 2));
        var scaleY = distance / 309 - .2;
        handle.node.scaleY = scaleY;
        scaleY > .5 ? handle.ctrl.play("anim_haimaDian2", 0, false) : handle.ctrl.play("anim_haimaDian1", 0, false);
        var dirVec = targetPos.sub(centerPos);
        var comVec = new cc.Vec2(1, 0);
        var radian = dirVec.signAngle(comVec);
        var degree = Math.floor(cc.misc.radiansToDegrees(radian));
        handle.node.angle = -(degree - 90);
        this._tmpShootStar.push(handle.node);
        var a1 = cc.repeatForever(cc.rotateBy(1, 360));
        var a2 = cc.callFunc(function() {
          var h = _this.createSpineNode(Constant_1.NodePoolKey.HaiMaOver, _this.haimaShootOverEff, targetPos);
          _this._tmpShootOver.push(h.node);
          h.ctrl.play("mingzhong", 0, true);
          callback();
        }, this);
        handle.node.runAction(a2);
      };
      EffLayerCtrl.prototype.removeShootStars = function() {
        this._tmpShootStar && this._tmpShootStar.length > 0 && this._tmpShootStar.forEach(function(node) {
          node.stopAllActions();
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.ShootStar, node);
        });
        this._tmpShootOver && this._tmpShootOver.length > 0 && this._tmpShootOver.forEach(function(node) {
          node.stopAllActions();
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.HaiMaOver, node);
        });
      };
      EffLayerCtrl.prototype.normalCollectOverEff = function(pos, targetName) {
        void 0 === targetName && (targetName = null);
        var item = this.createSpineNode(Constant_1.NodePoolKey.MergeBomb, this.mergeBombPrefab, pos);
        item.ctrl.play(targetName || "shouji", 0, false, function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.MergeBomb, item.node);
        });
      };
      EffLayerCtrl.prototype.playSpeedLine = function(pos, dir) {
        pos = this.node.convertToNodeSpaceAR(pos);
        var item = this.createSpineNode(Constant_1.NodePoolKey.MergeBomb, this.mergeBombPrefab, pos);
        item.node.angle = 0;
        var over = function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.MergeBomb, item.node);
        };
        var isCenter = 0 == dir.x && 0 == dir.y;
        var isOblique = 0 != dir.x && 0 != dir.y;
        if (isCenter) item.ctrl.play("hecheng01", 0, false, over); else {
          var angle = [ 0, 90, 180, 270 ];
          var index = 0;
          var p = cc.v3(Common_1.default.GRID_W, Common_1.default.GRID_H);
          if (isOblique) {
            angle = [ 45, 225, -45, -225 ];
            if (1 == dir.x && -1 == dir.y) {
              index = 1;
              p.y = p.y;
              p.x = p.x;
            }
            if (-1 == dir.x && 1 == dir.y) {
              index = 0;
              p.y = -p.y;
              p.x = -p.x;
            }
            if (1 == dir.x && 1 == dir.y) {
              index = 3;
              p.y = -p.y;
              p.x = p.x;
            }
            if (-1 == dir.x && -1 == dir.y) {
              index = 2;
              p.y = p.y;
              p.x = -p.x;
            }
          } else {
            if (1 == dir.x) {
              index = 2;
              p.x = p.x;
              p.y = 0;
            }
            if (-1 == dir.x) {
              index = 0;
              p.x = -p.x;
              p.y = 0;
            }
            if (1 == dir.y) {
              index = 1;
              p.y = -p.y;
              p.x = 0;
            }
            if (-1 == dir.y) {
              index = 3;
              p.y = p.y;
              p.x = 0;
            }
          }
          item.node.angle = angle[index];
          item.node.position = item.node.position.add(p);
          item.ctrl.play("hecheng01_1", 0, false, over);
        }
      };
      EffLayerCtrl.prototype.preFallingCountDown = function(remainStep, callback) {
        var _this = this;
        return new Promise(function(resolve) {
          var node = _this.node.getChildByName("tmpCountDown");
          node.active = true;
          node.y = 0;
          var lable = node.getComponent(cc.Label);
          var countDown = function(count, isfrist, cb) {
            _this.schedule(function() {
              lable.string = "\u62a2\u5206\u5012\u8ba1\u65f6: " + count;
              count--;
              if (count < 0) {
                node.runAction(cc.moveBy(1, cc.v2(0, 360)));
                cb();
                isfrist ? countDown(remainStep, false, callback) : node.active = false;
              }
            }, 1, count);
          };
          countDown(2, true, resolve);
        });
      };
      EffLayerCtrl.prototype.createSpineNode = function(key, prefab, pos) {
        void 0 === pos && (pos = null);
        return Common_1.default.createSpineNode(this.node, prefab, key, pos);
      };
      EffLayerCtrl.prototype.createEffPrefab = function(key, prefab, pos) {
        void 0 === pos && (pos = null);
        return Common_1.default.createEffPrefab(this.node, key, prefab, pos);
      };
      var EffLayerCtrl_1;
      EffLayerCtrl.ins = null;
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "bombEffPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "littleBombPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "mergeBombPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "comboPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "rowColBombPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "fishBombPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "rainbowBombPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "shootStarPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "haimaShootOverEff", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "zyJumpPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "zyJumpOverPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "zyJumpElimatePrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "brokenPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "LeavesBrokenPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "boxBrokenPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "overShootPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "addScorePrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "addScoreOverPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "dotPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "bombAndBombPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "haimaAndHetuanPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "haimaAndHaimaPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "zhangyuAndJianyu", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "hetuanAndJianyu", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "chuizi", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "bombAndFishPrefab", void 0);
      __decorate([ property(cc.Prefab) ], EffLayerCtrl.prototype, "haimaAndZhangyuPrefab", void 0);
      EffLayerCtrl = EffLayerCtrl_1 = __decorate([ ccclass ], EffLayerCtrl);
      return EffLayerCtrl;
    }(cc.Component);
    exports.default = EffLayerCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/CustomComponent/SpinePlayerCtrl": "SpinePlayerCtrl",
    "../../../Base/Manager/M": "M",
    "../../Common/AudioCtrl": "AudioCtrl",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Const/TimeConfig": "TimeConfig"
  } ],
  EnergyModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "84248scDy9PHIUvnIpaW1hB", "EnergyModel");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a;
    var M_1 = require("../../../Base/Manager/M");
    var Event_1 = require("../../Data/Const/Event");
    var SingletonFactory_1 = require("../../../Base/Utils/SingletonFactory");
    var GameModel_1 = require("./GameModel");
    var Common_1 = require("../../Common/Common");
    var Util_1 = require("../../../Base/Utils/Util");
    var Constant_1 = require("../../Data/Const/Constant");
    var ComboMaxInterval = 2e3;
    var BoomScore = (_a = {}, _a[Constant_1.CellType.Bomb1] = 6, _a[Constant_1.CellType.Bomb2] = 5, 
    _a[Constant_1.CellType.Bomb3] = 5, _a[Constant_1.CellType.Bomb4] = 3, _a[Constant_1.CellType.Bomb5] = 9, 
    _a);
    var EnergyLevel = {
      1: 30,
      2: 35,
      3: 40
    };
    var EnergyModel = function() {
      function EnergyModel() {
        this.comboTimes = 0;
        this.sendComboTimes = 0;
        this.lastComboTime = 0;
        this.energy = 0;
        this.curLevel = 1;
        this.curMaxEnergy = 0;
      }
      EnergyModel.prototype.setCurLevel = function() {
        var level = M_1.default.runtime.getMatch3Level();
        this.curLevel = Math.ceil(level / 10);
        this.curMaxEnergy = EnergyLevel[this.curLevel];
        this.energy = 0;
        this.comboTimes = 0;
        this.lastComboTime = 0;
      };
      EnergyModel.prototype.updataEnergy = function(type, cellType) {
        var now = cc.sys.now();
        if (type == Constant_1.ElimateType.Default) if (!this.lastComboTime || now - this.lastComboTime < ComboMaxInterval) {
          this.comboTimes++;
          this.lastComboTime = now;
          if (this.sendComboTimes != this.comboTimes) {
            this.sendComboTimes = this.comboTimes;
            M_1.default.runtime.CurCombo = this.comboTimes;
            M_1.default.event.send(Event_1.Event.Effect.Combo, this.comboTimes);
          }
        } else {
          this.comboTimes = M_1.default.runtime.CurCombo = 0;
          this.lastComboTime = 0;
        } else type >= Constant_1.ElimateType.Bomb1;
      };
      EnergyModel.prototype.addEnergy = function(energy) {};
      EnergyModel.prototype.addBoomToGame = function() {
        if (1 == this.curLevel) for (var i = 0; i < 3; i++) this.randomChangeNormal2Boom(Constant_1.CellType.Bomb4); else if (2 == this.curLevel) {
          this.randomChangeNormal2Boom(Constant_1.CellType.Bomb1);
          this.randomChangeNormal2Boom(Math.random() > .5 ? Constant_1.CellType.Bomb2 : Constant_1.CellType.Bomb3);
        } else 3 == this.curLevel && this.randomChangeNormal2Boom(Constant_1.CellType.Bomb5);
      };
      EnergyModel.prototype.randomChangeNormal2Boom = function(type) {
        var list = GameModel_1.default.ins.CellList;
        var x = Util_1.Util.Tool.rangeInt(1, GameModel_1.default.GridSize.W, false);
        var y = Util_1.Util.Tool.rangeInt(1, GameModel_1.default.GridSize.H, false);
        var cell = Common_1.default.safeGet2ArrayValue(list, cc.v2(x, y));
        if (cell && cell.extCtrl && cell.getType() < Constant_1.CellType.Bomb1 && cell.getType() != Constant_1.CellType.Fish && !cell.bindUpGModel) {
          cell.isExecBomb = false;
          cell.extCtrl.change2Bomb(type);
        } else this.randomChangeNormal2Boom(type);
      };
      EnergyModel.ins = SingletonFactory_1.SingletonFactory.getInstance(EnergyModel);
      return EnergyModel;
    }();
    exports.EnergyModel = EnergyModel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../../Base/Utils/SingletonFactory": "SingletonFactory",
    "../../../Base/Utils/Util": "Util",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "./GameModel": "GameModel"
  } ],
  EventMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e4b7057MSNBwZy6V+kZ0QsJ", "EventMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var DataPool_1 = require("../DataPool");
    var SingletonFactory_1 = require("../Utils/SingletonFactory");
    var EventData = function() {
      function EventData() {}
      EventData.prototype.destory = function() {
        this.eventHandler = null;
        this.thisArg = null;
        this.isOnce = false;
      };
      return EventData;
    }();
    var EventMgr = function() {
      function EventMgr() {
        this._dataPool = null;
        this.events = null;
        this._dataPool = new DataPool_1.DataPool(20, EventData);
        this.events = new Map();
      }
      EventMgr.prototype.hasRegister = function(event, eventHandler, thisArg) {
        var ed = null;
        event.forEach(function(e) {
          e.eventHandler == eventHandler && e.thisArg == thisArg && (ed = e);
        });
        return ed;
      };
      EventMgr.prototype.register = function(id, eventHandler, thisArg) {
        var event = this.events.get(id);
        if (!event) {
          event = new Set();
          this.events.set(id, event);
        }
        if (this.hasRegister(event, eventHandler, thisArg)) console.error("\u4e8b\u4ef6\u91cd\u590d\u6ce8\u518c"); else {
          var eventData = this._dataPool.getData();
          eventData.eventHandler = eventHandler;
          eventData.thisArg = thisArg;
          eventData.isOnce = false;
          event.add(eventData);
        }
      };
      EventMgr.prototype.once = function(id, eventHandler, thisArg) {
        var event = this.events.get(id);
        if (!event) {
          event = new Set();
          this.events.set(id, event);
        }
        if (this.hasRegister(event, eventHandler)) console.error("\u4e8b\u4ef6\u91cd\u590d\u6ce8\u518c"); else {
          var eventData = this._dataPool.getData();
          eventData.eventHandler = eventHandler;
          eventData.thisArg = thisArg;
          eventData.isOnce = true;
          event.add(eventData);
        }
      };
      EventMgr.prototype.unRegister = function(id, eventHandler, thisArg) {
        var event = this.events.get(id);
        if (!event) return;
        var d = this.hasRegister(event, eventHandler, thisArg);
        if (null != d) {
          event.delete(d);
          this._dataPool.freeData(d);
        }
      };
      EventMgr.prototype.destory = function() {
        this.events = null;
        this.events = new Map();
      };
      EventMgr.prototype.send = function(id) {
        var _this = this;
        var data = [];
        for (var _i = 1; _i < arguments.length; _i++) data[_i - 1] = arguments[_i];
        var event = this.events.get(id);
        if (!event) return;
        event.forEach(function(d) {
          d.eventHandler.apply(d.thisArg, data);
          if (d.isOnce) {
            event.delete(d);
            _this._dataPool.freeData(d);
          }
        });
      };
      EventMgr.ins = SingletonFactory_1.SingletonFactory.getInstance(EventMgr);
      return EventMgr;
    }();
    exports.default = EventMgr;
    window["EventMgr"] = EventMgr;
    cc._RF.pop();
  }, {
    "../DataPool": "DataPool",
    "../Utils/SingletonFactory": "SingletonFactory"
  } ],
  Event: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "18f8anA3BJIsLntdQeRwvEI", "Event");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Util_1 = require("../../../Base/Utils/Util");
    var Event;
    (function(Event) {
      var Sound;
      (function(Sound) {
        Sound[Sound["PlaySoundEff"] = 0] = "PlaySoundEff";
        Sound[Sound["PlayBGM"] = 1] = "PlayBGM";
        Sound[Sound["StopBGM"] = 2] = "StopBGM";
        Sound[Sound["UpdateOpt"] = 3] = "UpdateOpt";
      })(Sound = Event.Sound || (Event.Sound = {}));
      Util_1.Util.Enum.convert2EventEnum(Sound);
      var Model;
      (function(Model) {
        Model[Model["CheckGameOver"] = 0] = "CheckGameOver";
      })(Model = Event.Model || (Event.Model = {}));
      Util_1.Util.Enum.convert2EventEnum(Model);
      var UI;
      (function(UI) {
        UI[UI["UpdateCurrency"] = 0] = "UpdateCurrency";
        UI[UI["HideDock"] = 1] = "HideDock";
        UI[UI["ShowDock"] = 2] = "ShowDock";
        UI[UI["PropCount"] = 3] = "PropCount";
        UI[UI["UpdateInfoPanel"] = 4] = "UpdateInfoPanel";
        UI[UI["CollectComplet"] = 5] = "CollectComplet";
        UI[UI["UpdateLv"] = 6] = "UpdateLv";
        UI[UI["ChangeScene"] = 7] = "ChangeScene";
        UI[UI["CloseTutorial"] = 8] = "CloseTutorial";
        UI[UI["UpdateTmpLoadingProgress"] = 9] = "UpdateTmpLoadingProgress";
        UI[UI["HideSelectLevelView"] = 10] = "HideSelectLevelView";
        UI[UI["AddScore"] = 11] = "AddScore";
        UI[UI["UpdateRemainAddPowerTime"] = 12] = "UpdateRemainAddPowerTime";
        UI[UI["updateBoxState"] = 13] = "updateBoxState";
        UI[UI["ShowBagTips"] = 14] = "ShowBagTips";
        UI[UI["MapMenuUpdate"] = 15] = "MapMenuUpdate";
        UI[UI["LevelSceneTouched"] = 16] = "LevelSceneTouched";
        UI[UI["ChapterUnlock"] = 17] = "ChapterUnlock";
      })(UI = Event.UI || (Event.UI = {}));
      Util_1.Util.Enum.convert2EventEnum(UI);
      var Effect;
      (function(Effect) {
        Effect[Effect["LittleBomb"] = 0] = "LittleBomb";
        Effect[Effect["SpeedLine"] = 1] = "SpeedLine";
        Effect[Effect["Combo"] = 2] = "Combo";
        Effect[Effect["ShootStar"] = 3] = "ShootStar";
        Effect[Effect["OverShoot"] = 4] = "OverShoot";
        Effect[Effect["ShowDot"] = 5] = "ShowDot";
        Effect[Effect["Broken"] = 6] = "Broken";
        Effect[Effect["BoxBroken"] = 7] = "BoxBroken";
        Effect[Effect["CollectOver"] = 8] = "CollectOver";
        Effect[Effect["AddScore"] = 9] = "AddScore";
      })(Effect = Event.Effect || (Event.Effect = {}));
      Util_1.Util.Enum.convert2EventEnum(Effect);
      var GameCMD;
      (function(GameCMD) {
        GameCMD[GameCMD["MainCMD"] = 0] = "MainCMD";
        GameCMD[GameCMD["Exchange"] = 1] = "Exchange";
        GameCMD[GameCMD["Elimate"] = 2] = "Elimate";
        GameCMD[GameCMD["CBomb_RainbowFly"] = 3] = "CBomb_RainbowFly";
        GameCMD[GameCMD["AddNewCell"] = 4] = "AddNewCell";
        GameCMD[GameCMD["MoveGrid"] = 5] = "MoveGrid";
        GameCMD[GameCMD["GameResume"] = 6] = "GameResume";
        GameCMD[GameCMD["GameOver"] = 7] = "GameOver";
        GameCMD[GameCMD["ChangeCell"] = 8] = "ChangeCell";
        GameCMD[GameCMD["PropClick"] = 9] = "PropClick";
        GameCMD[GameCMD["PropUsed"] = 10] = "PropUsed";
        GameCMD[GameCMD["PromptCanElimate"] = 11] = "PromptCanElimate";
        GameCMD[GameCMD["StopPrompts"] = 12] = "StopPrompts";
        GameCMD[GameCMD["EnergyStorage"] = 13] = "EnergyStorage";
        GameCMD[GameCMD["SpeCollect"] = 14] = "SpeCollect";
        GameCMD[GameCMD["GameReset"] = 15] = "GameReset";
        GameCMD[GameCMD["GameTutorial"] = 16] = "GameTutorial";
        GameCMD[GameCMD["UpdateComplexView"] = 17] = "UpdateComplexView";
        GameCMD[GameCMD["UpdateCollectPower"] = 18] = "UpdateCollectPower";
        GameCMD[GameCMD["ShowGameResult"] = 19] = "ShowGameResult";
        GameCMD[GameCMD["GameOverFall"] = 20] = "GameOverFall";
        GameCMD[GameCMD["GameGetStepContinue"] = 21] = "GameGetStepContinue";
      })(GameCMD = Event.GameCMD || (Event.GameCMD = {}));
      Util_1.Util.Enum.convert2EventEnum(GameCMD);
      var System;
      (function(System) {
        System[System["CacheWarning"] = 0] = "CacheWarning";
      })(System = Event.System || (Event.System = {}));
      Util_1.Util.Enum.convert2EventEnum(System);
      var Map;
      (function(Map) {
        Map[Map["CameraMoveTo"] = 0] = "CameraMoveTo";
        Map[Map["MapTouchMoveEnable"] = 1] = "MapTouchMoveEnable";
        Map[Map["WalkEnd"] = 2] = "WalkEnd";
        Map[Map["ShowTool"] = 3] = "ShowTool";
        Map[Map["HideTool"] = 4] = "HideTool";
        Map[Map["UnLock"] = 5] = "UnLock";
        Map[Map["ShowLock"] = 6] = "ShowLock";
        Map[Map["Upgrade"] = 7] = "Upgrade";
        Map[Map["UnLockIsland"] = 8] = "UnLockIsland";
        Map[Map["GuideMask"] = 9] = "GuideMask";
      })(Map = Event.Map || (Event.Map = {}));
      Util_1.Util.Enum.convert2EventEnum(Map);
      var Guide;
      (function(Guide) {
        Guide[Guide["ReplaceMapObj"] = 0] = "ReplaceMapObj";
      })(Guide = Event.Guide || (Event.Guide = {}));
      Util_1.Util.Enum.convert2EventEnum(Guide);
      var Hotel;
      (function(Hotel) {
        Hotel[Hotel["UIRoomUnlock"] = 0] = "UIRoomUnlock";
        Hotel[Hotel["SlotUnlock"] = 1] = "SlotUnlock";
        Hotel[Hotel["MapScrollBegin"] = 2] = "MapScrollBegin";
        Hotel[Hotel["RoomFinished"] = 3] = "RoomFinished";
        Hotel[Hotel["ShowSubSlot"] = 4] = "ShowSubSlot";
        Hotel[Hotel["HideSubSlot"] = 5] = "HideSubSlot";
        Hotel[Hotel["UpateSubSlotState"] = 6] = "UpateSubSlotState";
        Hotel[Hotel["ShowGuestRoom"] = 7] = "ShowGuestRoom";
        Hotel[Hotel["TouchSlotIcon"] = 8] = "TouchSlotIcon";
        Hotel[Hotel["ChangeSlot"] = 9] = "ChangeSlot";
        Hotel[Hotel["SelectSubSlot"] = 10] = "SelectSubSlot";
      })(Hotel = Event.Hotel || (Event.Hotel = {}));
      Util_1.Util.Enum.convert2EventEnum(Hotel);
      var DailyTask;
      (function(DailyTask) {
        DailyTask[DailyTask["UpdateProgress"] = 0] = "UpdateProgress";
        DailyTask[DailyTask["UpdateTimerTaskActive"] = 1] = "UpdateTimerTaskActive";
        DailyTask[DailyTask["UpdateTaskKey"] = 2] = "UpdateTaskKey";
      })(DailyTask = Event.DailyTask || (Event.DailyTask = {}));
      Util_1.Util.Enum.convert2EventEnum(DailyTask);
    })(Event = exports.Event || (exports.Event = {}));
    cc._RF.pop();
  }, {
    "../../../Base/Utils/Util": "Util"
  } ],
  Exchange: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "07a90nMs9lHZLtIB2or7Fn3", "Exchange");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Data/Const/Event");
    var Util_1 = require("../../../../Base/Utils/Util");
    var SpinePlayerCtrl_1 = require("../../../../Base/CustomComponent/SpinePlayerCtrl");
    var ShowBuildTool_1 = require("./ShowBuildTool");
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var MapIslandManager_1 = require("./MapIslandManager");
    var BuildingLock_1 = require("./Component/BuildingLock");
    var MapIslandUtils_1 = require("./MapIslandUtils");
    var M_1 = require("../../../../Base/Manager/M");
    var GuideUtils_1 = require("../../../../../GodGuide/GuideUtils");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ShowInEditMode = false;
    var Exchange = function(_super) {
      __extends(Exchange, _super);
      function Exchange() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.buildingId = -1;
        _this.buildingName = "";
        _this.path = "";
        _this.state = 0;
        _this.showInEdit = false;
        _this.unlockState = false;
        _this.lockIconPrefab = null;
        _this._lockIconItem = null;
        _this.inAnim = false;
        _this.rootPath = "prefab/map/";
        _this.stateArr = [];
        _this._config = null;
        return _this;
      }
      Exchange.prototype.onLoad = function() {
        this._config = MapIslandManager_1.MapIslandManager.getBuildConfigById(this.buildingId);
        this.state = MapIslandUtils_1.default.getBuildingState(this.buildingId);
        if (null == this._config) {
          console.error("\u83b7\u53d6\u4e0d\u5230\u914d\u7f6e" + this.path);
          return;
        }
        var star = M_1.default.runtime.getStarCount();
        if (star >= this._config.starlv) {
          this.unlockState = true;
          0 == this.state || this.state >= 1;
        }
      };
      Exchange.prototype.onEnable = function() {
        false;
        this.loadBuilding(this.state);
      };
      Exchange.prototype.loadBuilding = function(state, fix) {
        var _this = this;
        void 0 === fix && (fix = false);
        var path = this.rootPath + this.path + state;
        this.path && (this.stateArr[state] ? this.showNodeByState(state, fix) : cc.loader.loadRes(path, cc.Prefab, function(err, prefab) {
          if (err) _this.showNodeByState(state, fix); else {
            var node = cc.instantiate(prefab);
            _this.node.addChild(node);
            _this.stateArr[state] = node;
            _this.showNodeByState(state, fix);
          }
        }));
      };
      Exchange.prototype.showNodeByState = function(state, fix) {
        this.stateArr.forEach(function(node, idx) {
          node && "number" != typeof node && (node.active = state == idx);
        });
        this.tempState = state;
        fix && this.setState(true);
        this.showLockIcon();
      };
      Exchange.prototype.setState = function(confirm) {
        if (confirm) {
          if (this.state != this.tempState && !this.inAnim) {
            this.inAnim = true;
            this.showHammer(this.tempState, this.state);
            this.state = this.tempState;
            this.tempState = null;
            this.showLockIcon();
            MapIslandUtils_1.default.setBuildingState(this.buildingId, this.state);
          }
        } else if (this.tempState) {
          this.loadBuilding(this.state);
          this.tempState = null;
        }
      };
      Exchange.prototype.showLockIcon = function() {
        if (this.state > 0 || !this.unlockState) {
          this._lockIconItem && this._lockIconItem.destroy();
          this._lockIconItem = null;
          return;
        }
        if (this._lockIconItem) return;
        var node = this.stateArr[this.state];
        if (node) {
          var lockItem = cc.instantiate(this.lockIconPrefab);
          var lock = node.getChildByName("Lock");
          lockItem.getComponent(BuildingLock_1.default).setData(this._config.iconId, this._config.buildId, this);
          lockItem.setPosition(lock ? lock.position : cc.v2(0, 0));
          lockItem.scale = 2;
          this.node.addChild(lockItem, 3, "LockItem");
          this._lockIconItem = lockItem;
        }
      };
      Exchange.prototype.showHammer = function(toState, fromState) {
        var _this = this;
        if (this.stateArr.length > 1) {
          var toNode = this.stateArr[toState];
          toNode && (toNode.opacity = .01);
          var fromNode = this.stateArr[fromState];
          fromNode && (fromNode.active = true);
        }
        cc.loader.loadRes(this.rootPath + "Hammer", cc.Prefab, function(err, prefab) {
          if (!err) {
            var node_1 = cc.instantiate(prefab);
            _this.node.parent.parent.addChild(node_1);
            var showBuildTool = (_this.stateArr.length ? _this.stateArr[fromState] : _this.node).getComponentInChildren(ShowBuildTool_1.default);
            node_1.position = showBuildTool.node.position;
            var cnt_1 = Util_1.Util.Tool.rangeInt(2, 3);
            var sp_1 = node_1.getComponent(SpinePlayerCtrl_1.default);
            var call_1 = function() {
              cnt_1--;
              if (cnt_1 < 0) {
                node_1.removeFromParent();
                node_1.destroy();
                _this.exchangeAnim(toState, fromState);
              } else sp_1.play("chuizi_ani", 0, false, call_1);
            };
            sp_1.play("chuizi_ani", 0, false, call_1);
          }
        });
      };
      Exchange.prototype.exchangeAnim = function(toState, fromState) {
        var _this = this;
        if (this.stateArr.length) {
          var toNode = this.stateArr[toState];
          if (toNode) {
            toNode.runAction(cc.sequence(cc.fadeIn(1), cc.callFunc(function() {
              0 == fromState && -1 == GuideUtils_1.GuideUtils.curGuideId && UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.BuildSuccess, _this.buildingId);
            }, this)));
            var particle = toNode.getComponentInChildren(cc.ParticleSystem);
            if (particle) {
              particle.node.active = true;
              particle.resetSystem();
            }
          } else {
            this.loadBuilding(toState);
            -1 == GuideUtils_1.GuideUtils.curGuideId && UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.BuildSuccess, this.buildingId);
          }
          var fromNode_1 = this.stateArr[fromState];
          fromNode_1.runAction(cc.sequence(cc.fadeOut(1), cc.callFunc(function() {
            fromNode_1.active = false;
            fromNode_1.opacity = 255;
            _this.inAnim = false;
          }, this)));
        } else EventMgr_1.default.ins.send(Event_1.Event.Map.Upgrade, toState);
      };
      Exchange.prototype.setLockState = function(lockState) {
        MapIslandUtils_1.default.setBuildingState(this.buildingId, lockState);
      };
      Exchange.prototype.unLock = function() {
        this.tempState = 1;
        this.setState(true);
      };
      __decorate([ property(cc.Integer) ], Exchange.prototype, "buildingId", void 0);
      __decorate([ property(cc.String) ], Exchange.prototype, "buildingName", void 0);
      __decorate([ property(cc.String) ], Exchange.prototype, "path", void 0);
      __decorate([ property(cc.Integer) ], Exchange.prototype, "state", void 0);
      __decorate([ property(cc.Boolean) ], Exchange.prototype, "showInEdit", void 0);
      __decorate([ property(cc.Boolean) ], Exchange.prototype, "unlockState", void 0);
      __decorate([ property(cc.Prefab) ], Exchange.prototype, "lockIconPrefab", void 0);
      Exchange = __decorate([ ccclass ], Exchange);
      return Exchange;
    }(cc.Component);
    exports.default = Exchange;
    cc._RF.pop();
  }, {
    "../../../../../GodGuide/GuideUtils": "GuideUtils",
    "../../../../Base/CustomComponent/SpinePlayerCtrl": "SpinePlayerCtrl",
    "../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../../Base/Utils/Util": "Util",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData",
    "./Component/BuildingLock": "BuildingLock",
    "./MapIslandManager": "MapIslandManager",
    "./MapIslandUtils": "MapIslandUtils",
    "./ShowBuildTool": "ShowBuildTool"
  } ],
  FriendRankCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "776a1dCP5xJX6KuFJoQzMby", "FriendRankCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var Common_1 = require("../../Common/Common");
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var UIData_1 = require("../../Data/Interface/UIData");
    var Paths_1 = require("../../../Base/Utils/Paths");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RankPanelCtrl = function(_super) {
      __extends(RankPanelCtrl, _super);
      function RankPanelCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.friendContent = null;
        _this.visitContent = null;
        _this.itemPrefab = null;
        _this.visitItemPrefab = null;
        _this.selfLv = null;
        _this.selfScore = null;
        _this.selfRank = null;
        _this.selfIcon = null;
        _this.visitRedNode = null;
        _this.visitCountLab = null;
        _this.friendView = null;
        _this.visitView = null;
        _this.selfRankNode = null;
        _this._itemPool = null;
        _this._animation = null;
        _this._rankSize = 6;
        _this._endNode = null;
        _this._startNode = null;
        _this.content = null;
        _this._currentSelectView = null;
        _this._currentItemPrefab = null;
        _this._currentDataList = null;
        _this._currentCtrl = null;
        _this._myRank = 100;
        _this._friendList = null;
        _this._interactiveList = null;
        return _this;
      }
      RankPanelCtrl.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
        this._animation = this.node.getComponent(cc.Animation);
      };
      RankPanelCtrl.prototype.onInit = function() {
        this._initData();
        this._itemPool || (this._itemPool = []);
        this._animation || (this._animation = this.node.getComponent(cc.Animation));
      };
      RankPanelCtrl.prototype._initData = function() {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            this._currentSelectView || (this._currentSelectView = "0");
            this.onSwitchBtnClick(null, this._currentSelectView);
            return [ 2 ];
          });
        });
      };
      RankPanelCtrl.prototype.show = function() {
        this._cleanView();
        this._initView();
      };
      RankPanelCtrl.prototype.onHide = function() {
        this._friendList = null;
        this._interactiveList = null;
      };
      RankPanelCtrl.prototype._initView = function() {
        this._initRankContent();
      };
      RankPanelCtrl.prototype._initRankContent = function() {
        if (this._currentDataList && this._currentDataList.length > 0) {
          for (var i = 0; i < this._rankSize; i++) {
            var itemData = this._currentDataList[i];
            if (itemData) {
              var itemNode = M_1.default.nodePool.createItem(this._currentItemPrefab);
              itemNode.y = -(i * itemNode.height + (10 + itemNode.height / 2) + 5 * i);
              itemNode.parent = this.content;
              itemNode["index"] = i;
              itemNode.getComponent(this._currentCtrl).init(itemData);
              this._endNode = itemNode;
            }
          }
          var size = this._currentDataList.length;
          this._startNode = this.content.children[0];
          this.content.height = size * this._currentItemPrefab.data.height + 5 * size + 10;
        }
      };
      RankPanelCtrl.prototype._cleanView = function() {
        this.content.removeAllChildren();
      };
      RankPanelCtrl.prototype._initSelfDisplay = function(myData) {
        var _this = this;
        if (myData) {
          this.selfRankNode.active = true;
          this.selfScore.string = myData.score || "0";
          this.selfLv.string = "" + (myData.appreciate || 0);
          this.selfRank.string = this._myRank > 100 ? "99+" : this._myRank.toString();
          M_1.default.platform.getUserInfo().then(function(userdata) {
            userdata && userdata.avatarUrl && Common_1.default.getRemotPic(userdata.avatarUrl).then(function(frame) {
              frame && (_this.selfIcon.spriteFrame = frame);
            });
          });
        } else this.selfRankNode.active = false;
      };
      RankPanelCtrl.prototype.onCloseBtnClick = function() {
        M_1.default.ui.hideUI(UIData_1.UIHudDef.FriendRank);
      };
      RankPanelCtrl.prototype.onScrollCallBack = function(a, b, c) {
        if (!this._currentDataList) return;
        for (var i = this.content.children.length; i--; ) {
          var node = this.content.children[i];
          if (node.active) {
            var pos = this.content.parent.convertToNodeSpaceAR(Common_1.default.getWorldPos(node));
            if (pos.y >= node.height / 2 + 10) {
              var nextIndex = this._endNode["index"] + 1;
              var data = this._currentDataList[nextIndex];
              if (data) {
                node.active = false;
                this._startNode = this._getNodeByIndex(node["index"] + 1);
                node["index"] = nextIndex;
                node.getComponent(this._currentCtrl).init(data);
                node.y = this._endNode.y - (node.height + 5);
                this._endNode = node;
                node.active = true;
              }
            }
          }
        }
        if (this._startNode) {
          var startPos = this.content.parent.convertToNodeSpaceAR(Common_1.default.getWorldPos(this._startNode));
          if (startPos.y + this._startNode.height / 2 + 10 < 0) {
            var data = this._currentDataList[this._startNode["index"] - 1];
            if (data) {
              var tempNode = this._endNode;
              this._endNode = this._getNodeByIndex(this._endNode["index"] - 1);
              tempNode.y = this._startNode.y + (this._startNode.height + 5);
              tempNode["index"] = this._startNode["index"] - 1;
              tempNode.getComponent(this._currentCtrl).init(data);
              this._startNode = tempNode;
            }
          }
        }
      };
      RankPanelCtrl.prototype._getNodeByIndex = function(index) {
        var result = null;
        for (var i = this.content.children.length; i--; ) {
          var node = this.content.children[i];
          if (node["index"] == index) {
            result = node;
            break;
          }
        }
        return result;
      };
      RankPanelCtrl.prototype._showRedDot = function(count) {
        void 0 === count && (count = 0);
        if (count) {
          this.visitRedNode.active = true;
          this.visitCountLab.string = count.toString();
        } else this.visitRedNode.active = false;
      };
      RankPanelCtrl.prototype.onShareClick = function() {
        M_1.default.platform.share("\u770b\u770b\u6211\u7684\u597d\u53cb\u5427!!!", Paths_1.default.ShareImgPath + "level_share_45.png");
      };
      RankPanelCtrl.prototype.onSwitchBtnClick = function(event, customValue) {
        return __awaiter(this, void 0, void 0, function() {
          var _a, _b, i, _c;
          return __generator(this, function(_d) {
            switch (_d.label) {
             case 0:
              _a = customValue;
              switch (_a) {
               case "0":
                return [ 3, 1 ];

               case "1":
                return [ 3, 4 ];
              }
              return [ 3, 8 ];

             case 1:
              this.friendView.active = true;
              this.visitView.active = false;
              this.content = this.friendContent;
              this._currentCtrl = "FriendRankItemCtrl";
              this._currentItemPrefab = this.itemPrefab;
              if (!!this._friendList) return [ 3, 3 ];
              _b = this;
              return [ 4, M_1.default.net.getFriendList() ];

             case 2:
              _b._friendList = _d.sent();
              if (this._friendList.list) {
                this._friendList.list.sort(function(a, b) {
                  return b.score - a.score;
                });
                for (i = this._friendList.list.length; i--; ) if (this._friendList.list[i].id == M_1.default.runtime.UserId) {
                  this._myRank = i + 1;
                  break;
                }
              }
              _d.label = 3;

             case 3:
              console.error("this._friendList:", this._friendList);
              this._friendList && this._initSelfDisplay(this._friendList.myrank);
              this._currentDataList = this._friendList.list;
              return [ 3, 8 ];

             case 4:
              this.friendView.active = false;
              this.visitView.active = true;
              this.selfRankNode.active = false;
              this.content = this.visitContent;
              this._currentCtrl = "VistItemCtrl";
              this._currentItemPrefab = this.visitItemPrefab;
              if (!!this._interactiveList) return [ 3, 6 ];
              _c = this;
              return [ 4, M_1.default.net.getInteractiveList() ];

             case 5:
              _c._interactiveList = _d.sent();
              this._interactiveList && this._interactiveList.sort(function(a, b) {
                return b.created_at - a.created_at;
              });
              return [ 3, 7 ];

             case 6:
              this._currentDataList;
              _d.label = 7;

             case 7:
              console.error("this._interactiveList:", this._interactiveList);
              this._currentDataList = this._interactiveList;
              return [ 3, 8 ];

             case 8:
              this._currentSelectView = customValue;
              this.show();
              return [ 2 ];
            }
          });
        });
      };
      __decorate([ property(cc.Node) ], RankPanelCtrl.prototype, "friendContent", void 0);
      __decorate([ property(cc.Node) ], RankPanelCtrl.prototype, "visitContent", void 0);
      __decorate([ property(cc.Prefab) ], RankPanelCtrl.prototype, "itemPrefab", void 0);
      __decorate([ property(cc.Prefab) ], RankPanelCtrl.prototype, "visitItemPrefab", void 0);
      __decorate([ property(cc.Label) ], RankPanelCtrl.prototype, "selfLv", void 0);
      __decorate([ property(cc.Label) ], RankPanelCtrl.prototype, "selfScore", void 0);
      __decorate([ property(cc.Label) ], RankPanelCtrl.prototype, "selfRank", void 0);
      __decorate([ property(cc.Sprite) ], RankPanelCtrl.prototype, "selfIcon", void 0);
      __decorate([ property(cc.Node) ], RankPanelCtrl.prototype, "visitRedNode", void 0);
      __decorate([ property(cc.Label) ], RankPanelCtrl.prototype, "visitCountLab", void 0);
      __decorate([ property(cc.Node) ], RankPanelCtrl.prototype, "friendView", void 0);
      __decorate([ property(cc.Node) ], RankPanelCtrl.prototype, "visitView", void 0);
      __decorate([ property(cc.Node) ], RankPanelCtrl.prototype, "selfRankNode", void 0);
      RankPanelCtrl = __decorate([ ccclass ], RankPanelCtrl);
      return RankPanelCtrl;
    }(UIBase_1.default);
    exports.default = RankPanelCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../../Base/UI/UIBase": "UIBase",
    "../../../Base/Utils/Paths": "Paths",
    "../../Common/Common": "Common",
    "../../Data/Interface/UIData": "UIData"
  } ],
  FriendRankItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "3aab1UfWNhECbFKxnEwkPbK", "FriendRankItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var M_1 = require("../../../Base/Manager/M");
    var UIData_1 = require("../../Data/Interface/UIData");
    var CloudView_1 = require("../../SimulationOperation/View/Map/CloudView");
    var Event_1 = require("../../Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var FriendRankItemCtrl = function(_super) {
      __extends(FriendRankItemCtrl, _super);
      function FriendRankItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.hotelName = null;
        _this.score = null;
        _this.rank = null;
        _this.icon = null;
        _this.rankIcon = null;
        _this.zanLab = null;
        _this.rankIconFrame = [];
        _this._userId = null;
        _this._data = null;
        return _this;
      }
      FriendRankItemCtrl.prototype.init = function(data) {
        if (data) {
          this._userId = data.id;
          this._data = data;
          this._data._hotelDatas = "string" == typeof data._hotelDatas ? JSON.parse(data._hotelDatas) : data._hotelDatas;
          this.hotelName.string = data.nickname + "\u7684\u9152\u5e97";
          this.zanLab.string = data.appreciate || "0";
          this.score.string = data.score;
          this._fillIcon(data.avatar_url);
          var rank = this.rank.string = this.node["index"] + 1;
          if (rank <= 3) {
            this.rank.node.active = false;
            this.rankIcon.node.active = true;
            this.rankIcon.spriteFrame = this.rankIconFrame[rank - 1];
          } else {
            this.rank.node.active = true;
            this.rankIcon.node.active = false;
          }
        }
      };
      FriendRankItemCtrl.prototype._fillIcon = function(url) {
        var _this = this;
        url && Common_1.default.getRemotPic(url, this.icon.node.getContentSize()).then(function(frame) {
          frame ? _this.icon.spriteFrame = frame : console.error("get avatar error!");
        });
      };
      FriendRankItemCtrl.prototype.onAccessClick = function() {
        var _this = this;
        M_1.default.net.visitFriend(this._userId).then(function(item) {
          console.error(_this._data, item);
          M_1.default.ui.showUI(UIData_1.UIHudDef.CloudView, CloudView_1.ICloudData.VisitFriendHotel, function() {
            M_1.default.ui.hideUI(UIData_1.UIHudDef.FriendRank);
            M_1.default.event.send(Event_1.Event.Hotel.ShowGuestRoom, _this._data);
          });
        });
      };
      FriendRankItemCtrl.prototype.update = function() {};
      __decorate([ property(cc.Label) ], FriendRankItemCtrl.prototype, "hotelName", void 0);
      __decorate([ property(cc.Label) ], FriendRankItemCtrl.prototype, "score", void 0);
      __decorate([ property(cc.Label) ], FriendRankItemCtrl.prototype, "rank", void 0);
      __decorate([ property(cc.Sprite) ], FriendRankItemCtrl.prototype, "icon", void 0);
      __decorate([ property(cc.Sprite) ], FriendRankItemCtrl.prototype, "rankIcon", void 0);
      __decorate([ property(cc.Label) ], FriendRankItemCtrl.prototype, "zanLab", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], FriendRankItemCtrl.prototype, "rankIconFrame", void 0);
      FriendRankItemCtrl = __decorate([ ccclass ], FriendRankItemCtrl);
      return FriendRankItemCtrl;
    }(cc.Component);
    exports.default = FriendRankItemCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../Common/Common": "Common",
    "../../Data/Const/Event": "Event",
    "../../Data/Interface/UIData": "UIData",
    "../../SimulationOperation/View/Map/CloudView": "CloudView"
  } ],
  GMView: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "514fdRPkCRKRqUha5xUlRI9", "GMView");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../Base/UI/UIBase");
    var M_1 = require("../Base/Manager/M");
    var BaseConst_1 = require("../Base/BaseConst");
    var UIMgr_1 = require("../Base/Manager/UIMgr");
    var UIData_1 = require("../Logic/Data/Interface/UIData");
    var Common_1 = require("../Logic/Common/Common");
    var Constant_1 = require("../Logic/Data/Const/Constant");
    var StorageMgr_1 = require("../Base/Manager/StorageMgr");
    var NetMgr_1 = require("../Base/Manager/NetMgr");
    var Event_1 = require("../Logic/Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var GMView = function(_super) {
      __extends(GMView, _super);
      function GMView() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.editCoin = null;
        _this.editDiamond = null;
        _this.editLevel = null;
        _this.editUserId = null;
        return _this;
      }
      GMView.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
      };
      GMView.prototype.start = function() {
        this.editLevel.string = M_1.default.runtime.CurLevel.toString();
        this.editUserId.string = StorageMgr_1.StorageMgr.Storage.getString("__userId");
      };
      GMView.prototype.onAddCoin = function() {
        var num = Number(this.editCoin.string) || 1e3;
        M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Coin, num);
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.GMView);
      };
      GMView.prototype.onAddDiamond = function() {
        var num = Number(this.editDiamond.string) || 100;
        M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Diamond, num);
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.GMView);
      };
      GMView.prototype.onJumpLevel = function() {
        M_1.default.runtime.SelectLevel = 0;
        var nextLv = Number(this.editLevel.string) || 1;
        M_1.default.runtime.setMatch3Level(nextLv, true);
        Common_1.default.jumpScene(Constant_1.Scene.Match);
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.GMView);
      };
      GMView.prototype.onChangePlayer = function() {
        var userId = this.RemoveChinese(this.editUserId.string) || Date.now().toString();
        StorageMgr_1.StorageMgr.Storage.setString("__userId", userId, true);
        window.location.reload();
      };
      GMView.prototype.onCleanPlayer = function() {
        return __awaiter(this, void 0, void 0, function() {
          var ss;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              return [ 4, NetMgr_1.default.ins.cleanPlayer() ];

             case 1:
              ss = _a.sent();
              ss && window.location.reload();
              return [ 2 ];
            }
          });
        });
      };
      GMView.prototype.onGameOver = function() {
        M_1.default.event.send(Event_1.Event.GameCMD.GameOver, true);
        this.onClickClose();
      };
      GMView.prototype.onClickClose = function() {
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.GMView);
      };
      GMView.prototype.RemoveChinese = function(strValue) {
        if (null != strValue && "" != strValue) {
          var reg = /[\u4e00-\u9fa5]/g;
          return strValue.replace(reg, "");
        }
        return "";
      };
      GMView.prototype.onWin = function() {
        M_1.default.runtime.SelectLevel = 0;
        var isNew = M_1.default.runtime.savaLvData(3);
        if (isNew) {
          var info = M_1.default.table.LevelUpReward.getByPrimaryKey(M_1.default.runtime.CurLevel);
          info && info.rewards && info.rewards.forEach(function(item) {
            M_1.default.runtime.addCurrency(item.type, item.count);
          });
        }
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GameOverWin, {
          type: UIData_1.UIHudDef.GameOverWin,
          data: 3
        });
        M_1.default.runtime.setMatch3Level(M_1.default.runtime.CurLevel + 1);
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.GMView);
      };
      __decorate([ property(cc.EditBox) ], GMView.prototype, "editCoin", void 0);
      __decorate([ property(cc.EditBox) ], GMView.prototype, "editDiamond", void 0);
      __decorate([ property(cc.EditBox) ], GMView.prototype, "editLevel", void 0);
      __decorate([ property(cc.EditBox) ], GMView.prototype, "editUserId", void 0);
      GMView = __decorate([ ccclass ], GMView);
      return GMView;
    }(UIBase_1.default);
    exports.GMView = GMView;
    cc._RF.pop();
  }, {
    "../Base/BaseConst": "BaseConst",
    "../Base/Manager/M": "M",
    "../Base/Manager/NetMgr": "NetMgr",
    "../Base/Manager/StorageMgr": "StorageMgr",
    "../Base/Manager/UIMgr": "UIMgr",
    "../Base/UI/UIBase": "UIBase",
    "../Logic/Common/Common": "Common",
    "../Logic/Data/Const/Constant": "Constant",
    "../Logic/Data/Const/Event": "Event",
    "../Logic/Data/Interface/UIData": "UIData"
  } ],
  GameFailEncouragePanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "a7981qmDfxIoY4pqq1yRDSj", "GameFailEncouragePanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var M_1 = require("../../../Base/Manager/M");
    var Common_1 = require("../Common");
    var UIData_1 = require("../../Data/Interface/UIData");
    var BaseConst_1 = require("../../../Base/BaseConst");
    var Event_1 = require("../../Data/Const/Event");
    var GameModel_1 = require("../../Match3/Model/GameModel");
    var StorageMgr_1 = require("../../../Base/Manager/StorageMgr");
    var Constant_1 = require("../../Data/Const/Constant");
    var UIMgr_1 = require("../../../Base/Manager/UIMgr");
    var Constant_2 = require("../../Data/Const/Constant");
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var Paths_1 = require("../../../Base/Utils/Paths");
    var GuideUtils_1 = require("../../../../GodGuide/GuideUtils");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var GameFailEncouragePanel = function(_super) {
      __extends(GameFailEncouragePanel, _super);
      function GameFailEncouragePanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.failEncourageRoot = null;
        _this.buyDiamondRoot = null;
        _this.diamond = null;
        _this.btnFriend = null;
        _this.btnAd = null;
        _this.isFirstFail = true;
        _this.buyNeedDiamond = null;
        _this._data = null;
        _this.passedTime = 0;
        return _this;
      }
      GameFailEncouragePanel.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
        EventMgr_1.default.ins.register(Event_1.Event.GameCMD.GameGetStepContinue, this.gameGetStepContinue, this);
      };
      GameFailEncouragePanel.prototype.onInit = function(params) {
        if (params) {
          this._data = params.data;
          var levelFailShareTag = StorageMgr_1.StorageMgr.Storage.getInt(Constant_1.NativeKey.LevelFailShareTag, 0);
          var data2 = new Date();
          1 == levelFailShareTag && StorageMgr_1.StorageMgr.Storage.getInt(Constant_1.NativeKey.LevelFailShareTimeTag, 0) != data2.getDate() && StorageMgr_1.StorageMgr.Storage.setInt(Constant_1.NativeKey.LevelFailShareTag, 0);
          if (0 == levelFailShareTag) {
            var levelFailNum = StorageMgr_1.StorageMgr.Storage.getInt(Constant_1.NativeKey.LevelFailTag, 0);
            if (0 == levelFailNum) {
              StorageMgr_1.StorageMgr.Storage.setInt(Constant_1.NativeKey.LevelFailTag, 1);
              this.btnFriend.active = true;
              this.btnAd.active = false;
              this.buyNeedDiamond = 45;
              this.diamond.string = this.buyNeedDiamond + "\u7ee7\u7eed";
            } else {
              this.btnFriend.active = false;
              this.btnAd.active = true;
              this.buyNeedDiamond = 90;
              this.diamond.string = this.buyNeedDiamond + "\u7ee7\u7eed";
            }
          } else {
            this.btnFriend.active = false;
            this.btnAd.active = true;
            var levelFailNum = StorageMgr_1.StorageMgr.Storage.getInt(Constant_1.NativeKey.LevelFailTag, 0);
            if (0 == levelFailNum) {
              StorageMgr_1.StorageMgr.Storage.setInt(Constant_1.NativeKey.LevelFailTag, 1);
              this.buyNeedDiamond = 45;
              this.diamond.string = this.buyNeedDiamond + "\u7ee7\u7eed";
            } else {
              this.buyNeedDiamond = 90;
              this.diamond.string = this.buyNeedDiamond + "\u7ee7\u7eed";
            }
          }
        }
      };
      GameFailEncouragePanel.prototype.onShow = function() {};
      GameFailEncouragePanel.prototype.destory = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.GameCMD.GameGetStepContinue, this.gameGetStepContinue, this);
      };
      GameFailEncouragePanel.prototype.gameGetStepContinue = function() {
        GameModel_1.default.ins.stepLimit += 5;
        M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel);
        M_1.default.ui.hideUI(UIData_1.UIHudDef.UIGameFailEncourage);
        M_1.default.runtime.GameState = Constant_2.GameState.Normal;
      };
      GameFailEncouragePanel.prototype.onBtnClickCloseFailEncourage = function() {
        M_1.default.runtime.SceneTask.push(Constant_1.SceneTaskKey.ShowTargetDlg);
        Common_1.default.jumpScene(Constant_2.Scene.Hotel);
      };
      GameFailEncouragePanel.prototype.onLevelBtnClick = function() {
        M_1.default.runtime.SelectLevel = 0;
        var next = GuideUtils_1.GuideUtils.checkMatchNext();
        next && UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.SelectShowTarget, {
          type: UIData_1.UIHudDef.SelectShowTarget,
          data: M_1.default.runtime.SelectLevel || null
        });
        M_1.default.ui.hideUI(UIData_1.UIHudDef.UIGameFailEncourage);
      };
      GameFailEncouragePanel.prototype.onBtnClickDiamond = function() {
        if (this.buyNeedDiamond <= M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Diamond)) {
          M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Diamond, -this.buyNeedDiamond);
          GameModel_1.default.ins.stepLimit += 5;
          M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel);
          M_1.default.ui.hideUI(UIData_1.UIHudDef.UIGameFailEncourage);
          M_1.default.runtime.GameState = Constant_2.GameState.Normal;
        } else this.SetRootIsState(false);
      };
      GameFailEncouragePanel.prototype.onBtnClickFriend = function() {
        var _this = this;
        M_1.default.platform.share("\u5feb\u6765\u4e00\u8d77\u73a9\u6e38\u620f", Paths_1.default.ShareImgPath + "level_share_45.png", 1).then(function(result) {
          if (result) {
            StorageMgr_1.StorageMgr.Storage.setInt(Constant_1.NativeKey.LevelFailShareTag, 1);
            var data2 = new Date();
            StorageMgr_1.StorageMgr.Storage.setInt(Constant_1.NativeKey.LevelFailShareTimeTag, data2.getDate());
            _this.gameGetStepContinue();
          }
        });
      };
      GameFailEncouragePanel.prototype.onBtnClickAdGetStep = function() {
        GameModel_1.default.ins.stepLimit += 1;
        M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel);
        M_1.default.ui.hideUI(UIData_1.UIHudDef.UIGameFailEncourage);
        M_1.default.runtime.GameState = Constant_2.GameState.Normal;
      };
      GameFailEncouragePanel.prototype.onBtnClickCloseGetDiamond = function() {
        this.SetRootIsState(true);
      };
      GameFailEncouragePanel.prototype.onBtnClickLookAdGetDiamond = function() {
        M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Diamond, 10);
      };
      GameFailEncouragePanel.prototype.SetRootIsState = function(failEncouIsShow) {
        this.failEncourageRoot.active = failEncouIsShow;
        this.buyDiamondRoot.active = !failEncouIsShow;
      };
      __decorate([ property(cc.Node) ], GameFailEncouragePanel.prototype, "failEncourageRoot", void 0);
      __decorate([ property(cc.Node) ], GameFailEncouragePanel.prototype, "buyDiamondRoot", void 0);
      __decorate([ property(cc.Label) ], GameFailEncouragePanel.prototype, "diamond", void 0);
      __decorate([ property(cc.Node) ], GameFailEncouragePanel.prototype, "btnFriend", void 0);
      __decorate([ property(cc.Node) ], GameFailEncouragePanel.prototype, "btnAd", void 0);
      GameFailEncouragePanel = __decorate([ ccclass ], GameFailEncouragePanel);
      return GameFailEncouragePanel;
    }(UIBase_1.default);
    exports.default = GameFailEncouragePanel;
    cc._RF.pop();
  }, {
    "../../../../GodGuide/GuideUtils": "GuideUtils",
    "../../../Base/BaseConst": "BaseConst",
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/Manager/M": "M",
    "../../../Base/Manager/StorageMgr": "StorageMgr",
    "../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../../Base/Utils/Paths": "Paths",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Interface/UIData": "UIData",
    "../../Match3/Model/GameModel": "GameModel",
    "../Common": "Common"
  } ],
  GameModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "7f6782dIJpIr4dMjn3r8QIA", "GameModel");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var CellModel_1 = require("./CellModel");
    var Common_1 = require("../../Common/Common");
    var CellBase_1 = require("./CellBase");
    var MultipleGridColModel_1 = require("./MultipleGridColModel");
    var M_1 = require("../../../Base/Manager/M");
    var PropModel_1 = require("./PropModel");
    var GroundModel_1 = require("./GroundModel");
    var Log_1 = require("../../../Base/Utils/Log");
    var Event_1 = require("../../Data/Const/Event");
    var Util_1 = require("../../../Base/Utils/Util");
    var UpGroundModel_1 = require("./UpGroundModel");
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var CollectModel_1 = require("./CollectModel");
    var RuntimeMgr_1 = require("../../Data/RuntimeMgr");
    var Constant_1 = require("../../Data/Const/Constant");
    var EnergyModel_1 = require("./EnergyModel");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var Sequence_1 = require("../../../Base/Network/Sequence");
    var TaskCtrl_1 = require("../Control/TaskCtrl");
    var LockCtrl_1 = require("../Control/LockCtrl");
    var Girl_1 = require("./SpecialPlug/Girl");
    var Conveyer_1 = require("./SpecialPlug/Conveyer");
    var CreateType;
    (function(CreateType) {
      CreateType[CreateType["Initial"] = 0] = "Initial";
      CreateType[CreateType["Bron"] = 1] = "Bron";
      CreateType[CreateType["Midway"] = 2] = "Midway";
      CreateType[CreateType["Nov"] = 3] = "Nov";
    })(CreateType = exports.CreateType || (exports.CreateType = {}));
    var GameModel = function() {
      function GameModel(data) {
        this.lvData = null;
        this.task = null;
        this.lock = null;
        this.propModel = null;
        this.groundModel = null;
        this.upGroundModel = null;
        this.mgModel = null;
        this.collectModel = null;
        this.cellDict = null;
        this.fallDict = null;
        this.destoryMap = null;
        this.deathDict = null;
        this.portalDict = null;
        this.cellList = null;
        this.chipSetList = null;
        this.initNoCreateList = null;
        this.minExecNum = 3;
        this.stepCount = 0;
        this.stepLimit = 0;
        this.timeLimit = 0;
        this.isHavaMoveGround = false;
        this.isHaveGem = false;
        this.isLongHeight = false;
        this.timerTriggerCount = 0;
        this.prompting = false;
        this._isOpenAutoCheck = false;
        this._isOpenConvyer = false;
        this._mapCount = 0;
        this._mapIndex = 0;
        this.bornAry = [];
        this.mapDatas = null;
        this._plugAry = null;
        this.CollectPos = null;
        this.isNovLv = false;
        this.isFalling = false;
        this.seq = null;
        this.IceCreamPool = null;
        this.CellTypeMap = null;
        this.HaveFlowers = false;
        this._dataPool = null;
        this._cellAllCount = 0;
        this.currentPromptTask = null;
        this._newCreatePool = new Set();
        GameModel._ins = this;
        this.init(data);
      }
      Object.defineProperty(GameModel, "ins", {
        get: function() {
          this._ins || Log_1.Log.e("GameModel No Init ");
          return this._ins;
        },
        enumerable: true,
        configurable: true
      });
      GameModel.destory = function() {
        this._ins.propModel.destory();
        this._ins = null;
      };
      GameModel.prototype.init = function(data) {
        void 0 === data && (data = null);
        data = this.lvData = data || this.lvData;
        this.seq = new Sequence_1.default();
        this.CellTypeMap = new Map();
        this.IceCreamPool = new Set();
        this.CollectPos = null;
        this.HaveFlowers = false;
        this.isNovLv = false;
        this.isFalling = false;
        this.isHaveGem = false;
        this.isHavaMoveGround = false;
        this.stepLimit = this.stepCount = data.levelInfo.movesLimit;
        this.timeLimit = data.levelInfo.timeLimit;
        this._mapCount = data.grid.length;
        this.lock = new LockCtrl_1.default();
        this.task = new TaskCtrl_1.default();
        this.cellDict = new Set();
        this.fallDict = new Set();
        this.destoryMap = new Map();
        this.deathDict = new Set();
        this.portalDict = new Set();
        this.propModel = new PropModel_1.PropModel(this);
        this.collectModel = new CollectModel_1.CollectModel(data.collect);
        this.initChipSet();
        this.createPlug();
        this.initMap();
        this.initPlug();
      };
      GameModel.prototype.createPlug = function() {
        this.lvData.girl && this.mountPlug(Girl_1.default, this.lvData.girl);
        this.lvData.conveyerList && this.mountPlug(Conveyer_1.default, this.lvData);
      };
      GameModel.prototype.initPlug = function() {
        this._plugAry && this._plugAry.forEach(function(value, key) {
          value.init();
        });
      };
      GameModel.prototype.mountPlug = function(e, cfg) {
        this._plugAry || (this._plugAry = new Map());
        var plug = new e(cfg);
        this._plugAry.set(e, plug);
        return plug;
      };
      GameModel.prototype.getPlug = function(plug) {
        var result = null;
        this._plugAry && (result = this._plugAry.get(plug));
        return result;
      };
      GameModel.prototype.notifyPlug = function(plug) {
        var p = this.getPlug(plug);
        p && p.onTrigger();
      };
      GameModel.prototype.initMap = function() {
        this.mapDatas = {};
        for (var i = 0; i < this._mapCount; i++) {
          var data = this.lvData.grid[i];
          this.initCell(data, i);
        }
        this.changeMap(0);
      };
      GameModel.prototype.changeMap = function(index) {
        this._mapIndex = index;
        var data = this.mapDatas[index];
        this.bornAry = data.bornAry;
        this.cellList = data.cellList;
        this.mgModel = data.mgModel;
        this.groundModel = data.gm;
        this.upGroundModel = data.ugm;
        this.collectModel.updateCurSingleCollect(data.collect);
        GameModel.GridSize = data.size;
      };
      GameModel.prototype.notifyFallColumnOver = function(pos) {
        var dirs = [ cc.v2(-1, 0), cc.v2(1, 0) ];
        for (var i = dirs.length; i--; ) {
          var dir = dirs[i];
          var cell = Common_1.default.safeGet2ArrayValue(this.cellList, pos.add(dir));
          cell && cell.onMsg(CellBase_1.MsgType.Fall);
        }
      };
      GameModel.prototype.isCanMergeBomb = function(type, cell) {
        var result = true;
        this.lvData.mergeLimit && (result = this.lvData.mergeLimit[type + ""]);
        cell && this.isHavaSpe(cell.pos) && (result = false);
        return result;
      };
      GameModel.prototype.initCell = function(mapData, index) {
        this.cellList = [];
        var map = mapData.map;
        var yLength = map.length;
        var xLength = map[0].length;
        var gm = new GroundModel_1.GroundModel();
        var ugm = new UpGroundModel_1.UpGroundModel();
        var bornAry = [];
        var cellList = [];
        var mgModel = new MultipleGridColModel_1.default(this.lvData, index);
        var size = {
          H: mapData.map.length,
          W: mapData.map[0].length
        };
        for (var y = 0; y < yLength; y++) {
          var xCells = [];
          for (var x = 0; x < xLength; x++) {
            var data = mapData.map[y][x];
            var gCell = gm.initGroupCell(data, x, y, index);
            var ugCell = ugm.initUpGroupCell(data, x, y, index);
            if (data && gCell.isCanCreateCell) {
              var cell = this.createCell({
                cfg: data,
                pos: cc.v2(x, y),
                createType: CreateType.Initial,
                index: index,
                isInit: true
              });
              cell && cell.initBindGround(gCell, ugCell);
              xCells.push(cell);
            } else xCells.push(null);
            gCell.isBorn && bornAry.push(gCell.pos);
          }
          cellList.push(xCells);
        }
        this.mapDatas[index] = {
          gm: gm,
          ugm: ugm,
          mgModel: mgModel,
          bornAry: bornAry,
          cellList: cellList,
          size: size,
          collect: mapData.collect
        };
        this.checkInitSameCell(index);
        mgModel.sync2View(gm.getGroupCellList());
      };
      GameModel.prototype.initChipSet = function() {
        this.chipSetList = [];
        this.initNoCreateList = new Map();
        var chips = this.lvData.chipset;
        chips || (chips = [ {
          type: 0,
          percent: 75
        }, {
          type: 2,
          percent: 100
        }, {
          type: 3,
          percent: 75
        }, {
          type: 5,
          percent: 100
        } ]);
        for (var i = 0; i < chips.length; i++) {
          var item = chips[i];
          var n = item.percent / 5;
          var type = item.type;
          item.isNoInitCreate && this.initNoCreateList.set(type, true);
          for (var j = 0; j < n; j++) this.chipSetList.push(type);
        }
      };
      GameModel.prototype.createCell = function(data) {
        var isInsert2Ary = void 0 == data.isInsert2Ary ? null : data.isInsert2Ary;
        var index = data.index || null;
        var createType = data.createType || CreateType.Initial;
        var isInit = data.isInit || false;
        var cfg = data.cfg || {};
        var cell = new CellModel_1.CellModel();
        cell == Common_1.default.safeGet2ArrayValue(this.cellList, cell.pos) && Common_1.default.safeSet2ArrayValue(this.cellList, cell.pos, null);
        null == index && (index = this.mapIndex);
        this.cellDict.add(cell);
        null == isInsert2Ary && (isInsert2Ary = !!createType);
        cell.init(cfg, index, data.pos, isInit, isInsert2Ary);
        this.isCollect(cell.getType()) && (cell.isCollect = true);
        if (createType) {
          cell.changeBindGround(cell.pos);
          this.task.pushAddNewTask(cell, createType);
        }
        return cell;
      };
      GameModel.prototype.freeCell = function(cell) {};
      GameModel.prototype.addStep = function(count) {
        this.stepLimit += count;
      };
      GameModel.prototype.timerTrigger = function() {
        this.timerTriggerCount++;
        this.isFalling = this.checkHaveFalling();
        this.lock && this.lock.update();
        if (!this.prompting && this.timerTriggerCount % TimeConfig_1.GapTime.PromptElimate == 0) {
          this.prompting = true;
          this.checkSameCell();
        }
        if (!this.isFalling) {
          this.timerTriggerCount % 2 == 0 && 0 != this.destoryMap.size && console.error(this.destoryMap);
          if (this._isOpenAutoCheck && this.timerTriggerCount % 3 == 0) {
            this.checkIsNeedResetGrid();
            this._isOpenAutoCheck = false;
          }
          if (this._isOpenConvyer && this.getPlug(Conveyer_1.default)) {
            this._isOpenConvyer = false;
            this.getPlug(Conveyer_1.default).onTrigger();
          }
          this.stepLimit <= 0 && RuntimeMgr_1.default.ins.GameState == Constant_1.GameState.Normal && M_1.default.event.send(Event_1.Event.GameCMD.GameOver, false);
        }
      };
      GameModel.prototype.execElimate = function(centerModel, closeAry, eType, extInfo, keepTime, groupId) {
        var _this = this;
        void 0 === keepTime && (keepTime = null);
        void 0 === groupId && (groupId = null);
        this.stopPrompt();
        var size = 0;
        eType = eType || Constant_1.ElimateType.Default;
        this.isFalling = true;
        groupId = groupId || this.seq.next();
        if (closeAry) {
          size = closeAry.size;
          closeAry.forEach(function(itemModel) {
            itemModel && itemModel.isCanElimate() && (itemModel.doTestDeath() && !_this._newCreatePool.has(itemModel) || closeAry.delete(itemModel));
          });
          closeAry.forEach(function(itemModel) {
            if (itemModel && itemModel.isDeath) {
              _this.deathDict.add(itemModel);
              itemModel.onMsg(CellBase_1.MsgType.Elimate, {
                id: groupId,
                targetModel: centerModel,
                size: size,
                type: eType
              });
            }
          });
        }
        centerModel.GroupId = groupId;
        centerModel.lockCreateBombPos(size, eType);
        (centerModel.getType() == Constant_1.CellType.Bomb4 || 0 == size && centerModel.isRocket) && (extInfo = {
          pos: this.findPlaneEndPos(extInfo),
          type: extInfo
        });
        this.task.pushElimateTask(centerModel, closeAry, size, eType, extInfo, keepTime);
        EnergyModel_1.EnergyModel.ins.updataEnergy(eType, centerModel.getType());
      };
      GameModel.prototype.isCanDiagonallyFall = function(target, fallCell) {
        var result = true;
        var isHaveBorn = false;
        target instanceof CellModel_1.CellModel && (target = target.pos);
        var isport = this.isHavaPortalOut(target);
        var isCreateBron = this.lock.isBornPosLocked(target);
        var ud = GameModel.ins.checkHavaWall(target, target.add(cc.v2(0, -1)));
        var lr = GameModel.ins.checkHavaWall(fallCell.pos.add(cc.v2(0, 1)), target);
        if (lr || isport || isCreateBron) return false;
        for (var i = 1; i <= target.y; i++) {
          var tmpPos = target.add(cc.v2(0, -i));
          var gCell = Common_1.default.safeGet2ArrayValue(this.GroundList, tmpPos);
          if (this._isActive(tmpPos)) {
            result = false;
            break;
          }
          if (this._isBarrierCell(tmpPos)) break;
          isHaveBorn = gCell && gCell.isBorn;
        }
        result && isHaveBorn && (result = false);
        result || (result = ud && !lr);
        return result;
      };
      GameModel.prototype._isActive = function(pos) {
        var result = true;
        var cell = Common_1.default.safeGet2ArrayValue(this.CellList, pos);
        (!cell || cell && (cell.isDeath || cell.isEmpty || cell.isDestoryed) || this._isBarrierCell(pos)) && (result = false);
        return result;
      };
      GameModel.prototype._isBarrierCell = function(pos) {
        var result = false;
        var upCell = Common_1.default.safeGet2ArrayValue(this.CellList, pos);
        var upGm = Common_1.default.safeGet2ArrayValue(this.GroundList, pos);
        var upUgm = Common_1.default.safeGet2ArrayValue(this.UpGroundList, pos);
        (upGm && upGm.isHold && !upGm.isPassable || upUgm && upUgm.isObs || upCell && !upCell.isNotFixed()) && (result = true);
        return result;
      };
      GameModel.prototype._testCanFall = function(checkCell, curCell, curPos) {
        var result = null;
        if (!checkCell.isEmpty && !checkCell.isDeath && checkCell.isNotFixed() && this.upCellIsCanMove(checkCell.pos) && (!curCell || curCell && (curCell.isDeath || curCell.isFall || curCell.isEmpty) && this.lock.isMyLocked(curPos, checkCell.pos))) if (checkCell.isBomb && !checkCell.isBombReady || this.checkHavaWall(checkCell.pos, curPos)) result = null; else {
          var dir = curPos.sub(checkCell.pos);
          0 != dir.x && 0 != dir.y ? this.isCanDiagonallyFall(curPos, checkCell) && (result = dir) : result = dir;
        }
        return result;
      };
      GameModel.prototype._isHaveBron = function(pos, dir) {
        void 0 === dir && (dir = null);
        dir = dir || cc.v2(0, 0);
        var target = pos.add(dir);
        return !(target.y < 0) && (!!this._isBorn(target) || this._isHaveBron(target, cc.v2(0, -1)));
      };
      GameModel.prototype.testFindCanFallCell = function(closeAry, group) {
        var _this = this;
        var nextDeps = new Set();
        closeAry instanceof cc.Vec2 ? this._findFallCell(closeAry, nextDeps, group) : closeAry.forEach(function(itemCell) {
          _this._findFallCell(itemCell, nextDeps, group);
        });
        nextDeps.size > 0 && this.testFindCanFallCell(nextDeps, group);
      };
      GameModel.prototype.isHavaPortalOut = function(pos) {
        var gm = Common_1.default.safeGet2ArrayValue(GameModel.ins.GroundList, pos);
        var result = false;
        if (gm && gm.isPortalOut()) {
          var portalPos = GameModel.ins.getUpGroundModel().getPortalPos(gm.portalIdx);
          var cell = Common_1.default.safeGet2ArrayValue(GameModel.ins.CellList, portalPos.in);
          result = cell && this.isCanFall(pos, cell.pos, false) && cell.isNotFixed();
        }
        return result;
      };
      GameModel.prototype._findFallCell = function(basePos, nextDeps, grounpId) {
        void 0 === nextDeps && (nextDeps = null);
        var groundCell = Common_1.default.safeGet2ArrayValue(this.GroundList, basePos);
        if (basePos && groundCell && !groundCell.isHold) {
          var _threeDir = [ cc.v2(0, -1), cc.v2(-1, -1), cc.v2(1, -1) ];
          basePos.x > GameModel.GridSize.W / 2 && (_threeDir = [ cc.v2(0, -1), cc.v2(1, -1), cc.v2(-1, -1) ]);
          for (var i = 0; i < _threeDir.length; i++) {
            var dir = _threeDir[i];
            var isUp = dir.equals(cc.v2(0, -1));
            var checkPos = basePos.add(dir);
            var baseItem = Common_1.default.safeGet2ArrayValue(this.cellList, basePos);
            var checkModel = Common_1.default.safeGet2ArrayValue(this.cellList, checkPos);
            if (checkModel) {
              var downDir = this._testCanFall(checkModel, baseItem, basePos);
              if (downDir) {
                if (this.fallDict.has(checkModel)) isUp && checkModel.resetFallDir(); else {
                  this.addFallCell(checkModel, downDir, grounpId);
                  nextDeps && nextDeps.add(checkModel.pos);
                }
                break;
              }
            } else isUp && !this.isBorder(checkPos) && nextDeps && nextDeps.add(checkPos);
          }
        }
      };
      GameModel.prototype.addFallCell = function(cell, downDir, groupId) {
        if (!cell.isEmpty && !cell.isDeath) {
          groupId || (groupId = this.seq.next());
          this.fallDict.add(cell);
          this._insert2FallGroup(groupId, cell);
          cell.startFall(downDir);
          this.openAutoCheckOpt();
        }
      };
      GameModel.prototype.completFall = function(groupId, testCell) {
        var _this = this;
        var groupData = this.destoryMap.get(groupId);
        groupId || console.error(testCell.pos.x, testCell.pos.y, groupId);
        if (groupData) {
          groupData.count--;
          if (groupData.count <= 0) {
            var elimateAry_1 = [];
            groupData.ary.forEach(function(cell) {
              if (cell && !cell.isEmpty && !cell.isDestoryed) {
                var tmpAry = _this.checkHavaElimate(cell.pos, false);
                if (tmpAry) {
                  tmpAry["pos"] = cell.pos;
                  (elimateAry_1.length <= 0 || _this.hasSameCellInElimteAry(elimateAry_1, tmpAry)) && elimateAry_1.push(tmpAry);
                }
              }
            });
            elimateAry_1.forEach(function(v) {
              _this.execElimate(Common_1.default.safeGet2ArrayValue(_this.cellList, v.pos), v.closeAry, null, v.bombType);
            });
            this.destoryMap.delete(groupId);
          }
        }
      };
      GameModel.prototype.hasSameCellInElimteAry = function(elimateAry, ary2) {
        var result = true;
        if (elimateAry && ary2) {
          var arr = Array.from(ary2.closeAry);
          for (var o = elimateAry.length; o--; ) {
            var inElimateCloseAry = elimateAry[o].closeAry;
            for (var i = arr.length; i--; ) if (inElimateCloseAry.has(arr[i])) {
              inElimateCloseAry.size < ary2.closeAry.size && (elimateAry[o] = ary2);
              result = false;
              o = 0;
              break;
            }
          }
        }
        return result;
      };
      GameModel.prototype._deleteCellFromGroup = function(cell) {
        if (cell && cell.GroupId) {
          var mapdata = this.destoryMap.get(cell.GroupId);
          if (mapdata && mapdata.ary.has(cell)) {
            mapdata.ary.delete(cell);
            this.completFall(cell.GroupId, cell);
          }
        }
      };
      GameModel.prototype._insert2FallGroup = function(groupId, cell) {
        if (groupId && cell && !cell.isDeath) {
          cell.GroupId = groupId;
          var groupData = this.destoryMap.get(groupId) || {
            count: 0,
            ary: new Set()
          };
          if (!groupData.ary.has(cell)) {
            groupData.count++;
            groupData.ary.add(cell);
            this.destoryMap.set(groupId, groupData);
          }
        }
      };
      GameModel.prototype.openAutoCheckOpt = function() {
        this._isOpenAutoCheck = true;
      };
      GameModel.prototype.removeFallDict = function(cell) {
        this.fallDict.delete(cell);
      };
      Object.defineProperty(GameModel.prototype, "PortalDict", {
        get: function() {
          return this.portalDict;
        },
        enumerable: true,
        configurable: true
      });
      GameModel.prototype.removeDeathDict = function(cell) {
        this._deleteCellFromGroup(cell);
        this.cellDict.delete(cell);
        this.deathDict.delete(cell);
      };
      GameModel.prototype.checkGameOver = function() {
        return new Promise(function(resolve) {
          M_1.default.event.send(Event_1.Event.Model.CheckGameOver, function() {
            resolve();
          });
        });
      };
      GameModel.prototype.execElimateOneAtAll = function(pos, eType, attackType) {
        var _this = this;
        this._cellAllCount = 1;
        this.stopPrompt();
        var upcell = Common_1.default.safeGet2ArrayValue(this.UpGroundList, pos);
        upcell && (this._cellAllCount += upcell.execElimateAll());
        var groundCell = Common_1.default.safeGet2ArrayValue(this.GroundList, pos);
        groundCell && groundCell.execElimateAll();
        var destoryId = this.seq.next();
        Common_1.default.execDelayTask(function() {
          _this.testFindCanFallCell(pos, destoryId);
        }, .3);
        this.execElimateOne(pos, eType, false, destoryId);
        return this._cellAllCount;
      };
      GameModel.prototype.execElimateOne = function(pos, type, isForced, destoryId) {
        void 0 === type && (type = Constant_1.ElimateType.Default);
        void 0 === isForced && (isForced = false);
        void 0 === destoryId && (destoryId = null);
        var cell = Common_1.default.safeGet2ArrayValue(this.cellList, pos);
        if (cell && (cell.isEmpty || !cell.isDeath)) if (cell.isCanElimate()) {
          cell.doTestDeath();
          destoryId = destoryId || this.seq.next();
          if (cell.isBomb && type != Constant_1.ElimateType.Girl) cell.onMsg(CellBase_1.MsgType.Bomb); else if (cell.isDeath || isForced) {
            cell.onMsg(CellBase_1.MsgType.Elimate, {
              id: destoryId,
              type: type,
              isForced: isForced
            });
            this.task.pushElimateTask(cell, null, 0, type, null, null);
          }
        } else cell.onMsg(CellBase_1.MsgType.Elimate, {
          type: type,
          isForced: isForced
        });
      };
      GameModel.prototype.updateCollectCount = function(type, index, elimateType, num) {
        void 0 === num && (num = 1);
        this.collectModel.updateCollectCount(type + "", num, index, elimateType);
        this.upGroundModel.updateCollectCount(type, index);
      };
      GameModel.prototype.stopOverFall = function() {
        M_1.default.runtime.GameState = Constant_1.GameState.preReady;
      };
      GameModel.prototype.startOverFall = function() {
        var _this = this;
        this.stopPrompt();
        var id = this.seq.next();
        this.CellDict.forEach(function(cell) {
          _this.addFallCell(cell, cc.v2(0, 1), id);
        });
      };
      GameModel.prototype._overFindFallCell = function(position) {
        var result = null;
        for (var i = this.cellList.length; i--; ) {
          var row = this.cellList[i];
          for (var j = row.length; j--; ) {
            var cell = row[j];
            if (cell && cell.extData) {
              var box = cell.extData.getBoundingBoxToWorld();
              if (box.contains(position)) {
                result = cell;
                i = 0;
                break;
              }
            }
          }
        }
        return result;
      };
      GameModel.prototype.onClick = function(position, isChuizi) {
        if (RuntimeMgr_1.default.ins.GameState == Constant_1.GameState.End) {
          console.error("\u70b9\u6d88\u70b9\u51fb~");
          var touchCell = this._overFindFallCell(position);
          if (touchCell) {
            var result = this._endCheckPoint([ touchCell ]);
            console.error(result);
            if (result) {
              var bombType = this.getClickPointBombType(result.length);
              this.execElimate(touchCell, new Set(result), null, bombType);
            }
          }
        } else this.propModel.execute(position, isChuizi);
      };
      GameModel.prototype.onDoubleClick = function(pos) {
        var cm = Common_1.default.safeGet2ArrayValue(this.cellList, pos);
        if (cm && cm.isBomb && cm.isBombReady && !cm.isFalling() && !this.isHavaSpe(pos)) {
          cm.onMsg(CellBase_1.MsgType.Bomb);
          this.updateStepCount();
        }
      };
      GameModel.prototype.execResetGridMove = function(cpos, dir) {
        var epos = cpos.add(dir);
        if (epos.x < 0 || epos.y < 0) return;
        var cModel = Common_1.default.safeGet2ArrayValue(this.cellList, cpos);
        var eModel = Common_1.default.safeGet2ArrayValue(this.cellList, epos);
        if (cModel && eModel && !cModel.isEmpty && !eModel.isEmpty && !cModel.isGround && !eModel.isGround && this.isCanExchange(cpos, epos) && cModel.getType() != eModel.getType() && !this.lock.isAutoExchangeLocked(epos) && !this.lock.isAutoExchangeLocked(cpos)) {
          var result = [ this.checkPoint(epos, cModel), this.checkPoint(cpos, eModel) ];
          if (!result[0] && !result[1]) {
            eModel.pos = cpos;
            cModel.pos = epos;
            this.task.pushExchangeTask(eModel, cpos, cModel, epos);
            this.lock.addAutoExchange(epos);
            this.lock.addAutoExchange(cpos);
          }
        }
      };
      GameModel.prototype.touchMove = function(pos, direction) {
        var _this = this;
        var epos = pos.add(direction);
        if (epos.x < 0 || epos.y < 0) return;
        var moveState = this.exchange(pos, epos);
        if (0 == moveState || 3 == moveState) return;
        var result = [ this.checkPoint(epos), this.checkPoint(pos) ];
        var ps = [ epos, pos ];
        if (result[0] || result[1]) {
          result.forEach(function(r, index) {
            var cm = Common_1.default.safeGet2ArrayValue(_this.cellList, ps[index]);
            r ? _this.execElimate(cm, r.closeAry, null, r.bombType) : cm.checkIsExit(cm.pos);
          });
          this.updateStepCount();
        } else if (1 == moveState) this.exchange(pos, epos); else {
          ps.forEach(function(p) {
            Common_1.default.safeGet2ArrayValue(_this.cellList, p).checkIsExit(p);
          });
          this.updateStepCount();
        }
      };
      GameModel.prototype.checkHavaElimate = function(pos, exec) {
        void 0 === exec && (exec = true);
        if (M_1.default.runtime.GameState == Constant_1.GameState.Normal || M_1.default.runtime.GameState == Constant_1.GameState.Pause) {
          var ary = this.checkPoint(pos);
          ary && exec && this.execElimate(Common_1.default.safeGet2ArrayValue(this.cellList, pos), ary.closeAry, null, ary.bombType);
          return ary;
        }
        return null;
      };
      GameModel.prototype.checkIsAllDeath = function() {
        var isAllDeath = true;
        for (var i = this.CellList.length; i--; ) for (var j = this.CellList[i].length; j--; ) {
          var cell = this.CellList[i][j];
          if (cell && !cell.isDeath) {
            i = 0;
            isAllDeath = false;
            break;
          }
        }
        return isAllDeath;
      };
      GameModel.prototype.updateStepCount = function() {
        this.stepLimit--;
        this._isOpenConvyer = true;
        this.stepLimit <= 0 && (this.stepLimit = 0);
        M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel);
        M_1.default.event.send(Event_1.Event.UI.CloseTutorial);
      };
      GameModel.prototype.findPlaneEndPos = function(type) {
        void 0 === type && (type = null);
        var targetPos = this.collectModel.findOneCollectPos(!!type);
        return targetPos;
      };
      GameModel.prototype.resetGrid = function(isForced) {
        var _this = this;
        void 0 === isForced && (isForced = false);
        this.stopPrompt();
        var ary = new Set();
        var markExit = false;
        for (var i = this.CellList.length; i--; ) {
          var row = this.CellList[i];
          for (var j = row.length; j--; ) {
            var cell = row[j];
            if (cell && !cell.isDeath) {
              if (!isForced && cell.isBomb && !this.isHavaSpe(cell.pos)) {
                i = 0;
                j = 0;
                markExit = true;
                break;
              }
              cell.isEmpty || !cell.isNotFixed || cell.isBomb || this.isHavaObs(cell.pos) || this.isHavaSpe(cell.pos) || ary.add(cell);
            }
          }
        }
        if (markExit) return;
        var dir = [ cc.v2(-1, 0), cc.v2(0, 1) ];
        console.error("\u6ca1\u6709\u53ef\u6d88\u9664\u7684! \u91cd\u7f6e!");
        if (ary.size > 0) {
          M_1.default.tips.show(Constant_1.WaringTips.NoElimate);
          ary.forEach(function(cell) {
            _this.execResetGridMove(cell.pos, dir[Util_1.Util.Tool.rangeInt(0, dir.length, false)]);
          });
          this.lock.deleteAutoExchangeAll();
          Common_1.default.execDelayTask(function() {
            _this._isOpenAutoCheck = true;
          }, 1);
        }
      };
      GameModel.prototype.checkIsNeedResetGrid = function() {
        var result = !this.checkSameCell(true);
        result && this.resetGrid();
        return;
      };
      GameModel.prototype.checkSameCell = function(isCheckNoting) {
        void 0 === isCheckNoting && (isCheckNoting = false);
        var result = false;
        for (var y = this.cellList.length; y--; ) {
          var xList = this.cellList[y];
          for (var x = xList.length; x--; ) {
            var pos = cc.v2(x, y);
            var cellItem = xList[x];
            if (cellItem) {
              if (this.isHavaObs(pos) || this.isHavaSpe(pos)) continue;
              for (var k = Common_1.default.Dir4.length; k--; ) {
                var checkPos = cellItem.pos.add(Common_1.default.Dir4[k]);
                if (this.checkHavaWall(cellItem.pos, checkPos) || this.isHavaObs(checkPos) || this.isHavaSpe(checkPos) || cellItem.isInvincible || cellItem.isGround) continue;
                var res = this.checkPoint(checkPos, cellItem);
                if (res && res.closeAry.size >= this.minExecNum) {
                  this.prompting && !isCheckNoting && this.promptCanElimate(cellItem, res.closeAry, checkPos);
                  result = true;
                  x = 0;
                  y = 0;
                  break;
                }
              }
            }
          }
        }
        return result;
      };
      GameModel.prototype.stopPrompt = function() {
        this.timerTriggerCount = 0;
        if (this.prompting) {
          this.prompting = false;
          if (this.currentPromptTask) {
            EventMgr_1.default.ins.send(Event_1.Event.GameCMD.StopPrompts, this.currentPromptTask);
            this.currentPromptTask = null;
          }
        }
      };
      GameModel.prototype.promptCanElimate = function(singleModel, closeAry, ckPos) {
        if (this.currentPromptTask) {
          EventMgr_1.default.ins.send(Event_1.Event.GameCMD.StopPrompts, this.currentPromptTask);
          this.currentPromptTask = null;
        }
        closeAry.forEach(function(cm) {
          Util_1.Util.Tool.compareV2(cm.pos, ckPos) && closeAry.delete(cm);
        });
        this.currentPromptTask = this.task.pushTisTask(singleModel, closeAry, ckPos);
      };
      GameModel.prototype.checkInitSameCell = function(mapIndex) {
        var list = this.mapDatas[mapIndex].cellList;
        for (var y = list.length; y--; ) {
          var xList = list[y];
          for (var x = xList.length; x--; ) {
            var cellItem = xList[x];
            cellItem && cellItem.isRandom && this.checkPoint(cellItem.pos, null, mapIndex) && cellItem.setRandomType(true, mapIndex);
          }
        }
      };
      GameModel.prototype.isCollect = function(type) {
        return void 0 != this.getCollect().get(type + "");
      };
      GameModel.prototype.isCanExchange = function(pos1, pos2, isCheckWall) {
        void 0 === isCheckWall && (isCheckWall = true);
        var result = true;
        var tmpAry = [ pos1, pos2 ];
        for (var i = tmpAry.length; i--; ) {
          var pos = tmpAry[i];
          if (this.isHavaSpe(pos) || this.isHavaObs(pos) || this.isHold(pos)) {
            result = false;
            break;
          }
        }
        isCheckWall && result && (result = !this.checkHavaWall(pos1, pos2));
        return result;
      };
      GameModel.prototype.checkHavaWall = function(pos1, pos2) {
        var result = false;
        var g1 = Common_1.default.safeGet2ArrayValue(this.GroundList, pos1);
        var g2 = Common_1.default.safeGet2ArrayValue(this.GroundList, pos2);
        g1 && g2 && (pos1.x == pos2.x ? result = pos1.y > pos2.y ? g1.checkWall("top") || g2.checkWall("bottom") : g1.checkWall("bottom") || g2.checkWall("top") : pos1.y == pos2.y && (result = pos1.x > pos2.x ? g1.checkWall("left") || g2.checkWall("right") : g1.checkWall("right") || g2.checkWall("left")));
        return result;
      };
      GameModel.prototype.isNoMoving = function(m1, m2) {
        var result = false;
        if (m1 && m2) {
          m1.extCtrl && m2.extCtrl && (result = !m1.extCtrl.isRunMove && !m2.extCtrl.isRunMove);
          (m1.isFall || m1.isDeath || m2.isFall || m2.isDeath) && (result = false);
        }
        return result;
      };
      GameModel.prototype.exchange = function(cpos, epos, justChangePosData) {
        void 0 === justChangePosData && (justChangePosData = false);
        var cModel = Common_1.default.safeGet2ArrayValue(this.cellList, cpos);
        var eModel = Common_1.default.safeGet2ArrayValue(this.cellList, epos);
        var result = 1;
        if (!cModel || !eModel || !cModel.isNotFixed() || !eModel.isNotFixed()) return 0;
        if (eModel.isEmpty || cModel.isEmpty || cModel.isGround || eModel.isGround) return 0;
        if (cModel.isBomb && !cModel.isBombReady || eModel.isBomb && !eModel.isBombReady) return 0;
        if (eModel.isBomb && cModel.isBomb) {
          result = 3;
          this.task.pushExchangeTask(eModel, cpos, cModel, epos);
        } else if (this.isNoMoving(cModel, eModel) && this.isCanExchange(cpos, epos)) {
          eModel.pos = cpos;
          cModel.pos = epos;
          this.task.pushExchangeTask(eModel, cpos, cModel, epos);
          (eModel.isBomb || cModel.isBomb) && (result = 2);
        } else result = 0;
        return result;
      };
      GameModel.prototype.getUpGroundCell = function(pos, index) {
        void 0 === index && (index = null);
        var list = null;
        list = null != index ? this.mapDatas[index].ugm.getUGroupCellList() : this.UpGroundList;
        return Common_1.default.safeGet2ArrayValue(list, pos);
      };
      GameModel.prototype.getGroundCell = function(pos, index) {
        void 0 === index && (index = null);
        var list = null;
        list = null != index ? this.mapDatas[index].gm.getGroupCellList() : this.GroundList;
        return Common_1.default.safeGet2ArrayValue(list, pos);
      };
      GameModel.prototype.getRandomCell = function(isNotLimit) {
        void 0 === isNotLimit && (isNotLimit = false);
        var y = Util_1.Util.Tool.rangeInt(0, this.cellList.length, false);
        var x = Util_1.Util.Tool.rangeInt(0, this.cellList[y].length, false);
        var cs = Common_1.default.safeGet2ArrayValue(this.cellList, cc.v2(x, y));
        return !cs || cs.isEmpty || !isNotLimit && (cs.isBomb || this.isHavaObs(cs.pos)) ? this.getRandomCell(isNotLimit) : cs;
      };
      Object.defineProperty(GameModel.prototype, "CollectModel", {
        get: function() {
          return this.collectModel;
        },
        enumerable: true,
        configurable: true
      });
      GameModel.prototype.getCollect = function() {
        return this.collectModel.mainCollect;
      };
      GameModel.prototype.checkIsNoInitCreate = function(type) {
        return this.initNoCreateList.get(type);
      };
      GameModel.prototype.getRandomCellType = function() {
        var type = Constant_1.CellType.Empty;
        this.chipSetList && (type = this.chipSetList[Util_1.Util.Tool.rangeInt(0, this.chipSetList.length - 1)]);
        return type;
      };
      Object.defineProperty(GameModel.prototype, "GroundList", {
        get: function() {
          return this.groundModel.getGroupCellList();
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GameModel.prototype, "CellList", {
        get: function() {
          return this.cellList;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GameModel.prototype, "Lock", {
        get: function() {
          return this.lock;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GameModel.prototype, "UpGroundList", {
        get: function() {
          return this.upGroundModel.getUGroupCellList();
        },
        enumerable: true,
        configurable: true
      });
      GameModel.prototype.getUpGroundModel = function() {
        return this.upGroundModel;
      };
      GameModel.prototype.getTopPosition = function(mapIndex) {
        return Common_1.default.getPos(0, 0, mapIndex);
      };
      GameModel.prototype.getMgModel = function() {
        return this.mgModel;
      };
      GameModel.prototype.getLvData = function() {
        return this.lvData;
      };
      GameModel.prototype.getGridSize = function() {
        return GameModel.GridSize;
      };
      GameModel.prototype.getMaps = function() {
        return this.mapDatas;
      };
      Object.defineProperty(GameModel.prototype, "mapIndex", {
        get: function() {
          return this._mapIndex;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GameModel.prototype, "mapCount", {
        get: function() {
          return this._mapCount;
        },
        enumerable: true,
        configurable: true
      });
      GameModel.prototype.setLongHeight = function(opt) {
        this.isLongHeight = opt;
      };
      GameModel.prototype.isLongMode = function() {
        return this.isLongHeight;
      };
      GameModel.prototype.checkHaveFalling = function() {
        var result = false;
        this.fallDict.size > 0 && (result = true);
        result || this.CellDict.forEach(function(cell) {
          cell && !cell.isEmpty && (cell.isFall || cell.isDeath) && (result = true);
        });
        return result;
      };
      GameModel.prototype.checkUpNotCellByPos = function(pos) {
        if (Util_1.Util.Tool.isNull(pos)) return null;
        var upPos = pos.add(cc.v2(0, -1));
        var upItem = Common_1.default.safeGet2ArrayValue(this.cellList, upPos);
        var result = null;
        if (!upItem && upPos.y > 0) return this.checkUpNotCellByPos(upPos);
        upItem && (result = upItem);
        return result;
      };
      GameModel.prototype.checkPoint = function(pos, ckModel, mapIndex) {
        void 0 === ckModel && (ckModel = null);
        void 0 === mapIndex && (mapIndex = null);
        var container = null;
        var bombType = null;
        var isSquare = false;
        var list = this.cellList;
        null != mapIndex && (list = this.mapDatas[mapIndex].cellList);
        var curModel = Common_1.default.safeGet2ArrayValue(list, pos);
        if (curModel) {
          if (curModel.isInvincible || curModel.isEmpty || curModel.isGround) return null;
          if (!this.isHavaObs(pos, mapIndex) && !curModel.isBomb) {
            var row = new Set();
            var col = new Set();
            var type = ckModel ? ckModel.getType() : curModel.getType();
            this.checkWithDirection(pos, type, row, [ cc.v2(1, 0), cc.v2(-1, 0) ], ckModel, mapIndex);
            this.checkWithDirection(pos, type, col, [ cc.v2(0, 1), cc.v2(0, -1) ], ckModel, mapIndex);
            ckModel && (row.size >= 2 ? row.add(curModel) : col.size >= 2 && col.add(curModel));
            if (0 == row.size && 0 == col.size) return null;
            bombType = this.getBombType(row, col);
            if (col.size >= 2 && row.size >= 2 && !bombType) {
              var squareCell = Common_1.default.getSquareSingleCell(col, row, type, curModel.pos, list);
              if (squareCell) {
                row.add(squareCell);
                bombType = Constant_1.CellType.Bomb4;
                isSquare = true;
              }
            }
            container = row.size >= this.minExecNum || isSquare ? row : new Set();
            (col.size >= this.minExecNum || isSquare) && col.forEach(function(model) {
              return container.add(model);
            });
            if (container.size < this.minExecNum) {
              container.clear();
              container = null;
            }
          }
        }
        return container ? {
          closeAry: container,
          bombType: bombType
        } : null;
      };
      GameModel.prototype.isTypeMatching = function(type, nextCell) {
        var result = false;
        nextCell.isJustBombElimate || type != nextCell.getType() || (result = true);
        return result;
      };
      GameModel.prototype.checkWithDirection = function(pos, type, container, dir, ckModel, mapIndex) {
        void 0 === ckModel && (ckModel = null);
        void 0 === mapIndex && (mapIndex = null);
        var list = this.cellList;
        null != mapIndex && (list = this.mapDatas[mapIndex].cellList);
        for (var i = dir.length; i--; ) {
          var nextPos = cc.v2(pos.add(dir[i]));
          var nextModel = Common_1.default.safeGet2ArrayValue(list, nextPos);
          if (0 != dir[i].y) {
            var upItem = this.checkUpNotCellByPos(pos);
            if (upItem && upItem.isFalling() && upItem.getType() == type) break;
          }
          if (!nextModel || nextModel && nextModel.isEmpty || this.isHavaObs(nextPos, mapIndex)) continue;
          if (ckModel && (this.isHavaObs(nextPos, mapIndex) || Util_1.Util.Tool.compareV2(nextPos, ckModel.pos))) continue;
          if (!nextModel.isDeath && !nextModel.isFalling() && !nextModel.isPortaling && this.isTypeMatching(type, nextModel) && !container.has(nextModel)) {
            container.add(nextModel);
            this.checkWithDirection(nextModel.pos, type, container, dir, ckModel, mapIndex);
          }
        }
      };
      GameModel.prototype._endCheckPoint = function(cellAry) {
        var _this = this;
        var result = [];
        var _loop_1 = function(i) {
          var cell = cellAry[i];
          cell && Common_1.default.Dir4.forEach(function(dir) {
            var nextPos = cell.pos.add(dir);
            var nextCell = Common_1.default.safeGet2ArrayValue(_this.cellList, nextPos);
            nextCell && nextCell.getType() == cell.getType() && -1 == cellAry.indexOf(nextCell) && result.push(nextCell);
          });
        };
        for (var i = cellAry.length; i--; ) _loop_1(i);
        return result.length > 0 ? this._endCheckPoint(cellAry.concat(result)) : cellAry;
      };
      Object.defineProperty(GameModel.prototype, "CellDict", {
        get: function() {
          return this.cellDict;
        },
        enumerable: true,
        configurable: true
      });
      GameModel.prototype.isHavaSpe = function(pos, index) {
        void 0 === index && (index = null);
        var upCell = this.getUpGroundCell(pos, index);
        return !!upCell && upCell.isHavaSpe;
      };
      GameModel.prototype.upCellIsCanMove = function(pos) {
        var upCell = this.getUpGroundCell(pos);
        return !upCell || upCell && upCell.isCanFall();
      };
      GameModel.prototype.isHavaObs = function(pos, index) {
        void 0 === index && (index = null);
        var upCell = this.getUpGroundCell(pos, index);
        return !!upCell && upCell.isObs;
      };
      GameModel.prototype.isHold = function(pos, index) {
        void 0 === index && (index = null);
        var groundCell = this.getGroundCell(pos, index);
        return !groundCell || groundCell.isHold;
      };
      GameModel.prototype.getNotPassblePoss = function(nextPos) {
        var gc = Common_1.default.safeGet2ArrayValue(this.GroundList, nextPos);
        if (gc && gc.isPassable) return this.getNotPassblePoss(nextPos.add(cc.v2(0, 1)));
        return nextPos;
      };
      GameModel.prototype.isBorder = function(pos) {
        var result = false;
        var gcell = Common_1.default.safeGet2ArrayValue(GameModel.ins.GroundList, pos);
        if (gcell) {
          (gcell.isHold || null == gcell.getType()) && (result = true);
          gcell.isPassable && (result = false);
        } else result = true;
        return result;
      };
      GameModel.prototype.isCanFall = function(nextPos, selfPos, isFalling, isCreateBomb) {
        void 0 === isFalling && (isFalling = true);
        void 0 === isCreateBomb && (isCreateBomb = false);
        var isLocked = this.lock.isMyLocked(nextPos, selfPos);
        var isPassable = this.isPassable(nextPos, selfPos);
        var isInvalid = this._isInvalidCell(nextPos, isFalling, isCreateBomb);
        return isLocked && isInvalid && isPassable;
      };
      GameModel.prototype._isInvalidCell = function(pos, isFalling, isCreateBomb) {
        var result = false;
        var cell = Common_1.default.safeGet2ArrayValue(GameModel.ins.CellList, pos);
        cell ? (cell.isEmpty || cell.isRemoved() || (isFalling ? cell.isFalling() : cell.isFall) || isCreateBomb && cell.isDeath) && (result = true) : result = true;
        return result;
      };
      GameModel.prototype.isPassable = function(nextPos, selfPos) {
        var result = true;
        var gcell = Common_1.default.safeGet2ArrayValue(GameModel.ins.GroundList, nextPos);
        var ugcell = Common_1.default.safeGet2ArrayValue(GameModel.ins.UpGroundList, nextPos);
        gcell || (result = false);
        gcell && selfPos && (gcell.isHold ? result = false : this.checkHavaWall(nextPos, selfPos) && (result = false));
        ugcell && ugcell.isObs && (result = false);
        return result;
      };
      GameModel.prototype.getBombType = function(row, col) {
        if (row.size >= 5 || col.size >= 5) return Constant_1.CellType.Bomb5;
        if (row.size >= 3 && col.size >= 3) return Constant_1.CellType.Bomb1;
        if (row.size >= 4) return Constant_1.CellType.Bomb3;
        if (col.size >= 4) return Constant_1.CellType.Bomb2;
        return null;
      };
      GameModel.prototype.getClickPointBombType = function(size) {
        var result = null;
        size >= 4 && size < 5 ? result = Constant_1.CellType.Bomb2 : size > 5 && size < 6 ? result = Constant_1.CellType.Bomb1 : size > 6 && (result = Constant_1.CellType.Bomb5);
        return result;
      };
      GameModel.prototype.checkPortal = function() {};
      GameModel.prototype.isCanCreateBornCell = function(pos, model) {
        if (this.lock.isBornPosLocked(pos) || this.lock.isFallLocked(pos)) return false;
        if (this.isHavaSpe(pos) && !this.upCellIsCanMove(pos) || this.isHold(pos)) return false;
        if (model && !model.isEmpty && !model.isDeath && !model.isFalling()) return false;
        return true;
      };
      GameModel.prototype.removeNewCreateCell = function(cell) {
        this._newCreatePool.delete(cell);
      };
      GameModel.prototype.checkNeedCreateNewCell = function(pos, groupId) {
        var bornModel = Common_1.default.safeGet2ArrayValue(this.cellList, pos);
        if (this.isCanCreateBornCell(pos, bornModel)) {
          this.lock.lockBornPos(pos);
          var cell = this.createCell({
            cfg: null,
            pos: pos.add(cc.v2(0, -1)),
            createType: CreateType.Bron,
            isInsert2Ary: false
          });
          this.addFallCell(cell, cc.v2(0, 1), groupId);
          this._newCreatePool.add(cell);
        }
      };
      GameModel.prototype._isBorn = function(pos) {
        var ground = Common_1.default.safeGet2ArrayValue(this.GroundList, pos);
        return ground && ground.isBorn;
      };
      GameModel.prototype.cellUpdate = function(dt) {
        var _this = this;
        if (this.fallDict && this.fallDict.size > 0) for (var i = this.cellList.length; i--; ) {
          var coll = this.cellList[i];
          for (var j = 0; j < coll.length; j++) {
            var cell = coll[j];
            if (cell && cell.isFall && !cell.isDestoryed) {
              cell.updateFall(dt);
              this._isBorn(cell.pos) && this.checkNeedCreateNewCell(cell.pos, cell.GroupId);
            }
          }
        }
        this._newCreatePool && this._newCreatePool.size > 0 && this._newCreatePool.forEach(function(cell) {
          cell && !cell.isDestoryed ? cell.updateFall(dt) : _this._newCreatePool.delete(cell);
        });
      };
      GameModel.prototype.update = function(dt) {
        this.task.update(dt);
        RuntimeMgr_1.default.ins.GameState != Constant_1.GameState.Pause && this.cellUpdate(dt);
      };
      GameModel.GridSize = null;
      GameModel._ins = null;
      return GameModel;
    }();
    exports.default = GameModel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/Manager/M": "M",
    "../../../Base/Network/Sequence": "Sequence",
    "../../../Base/Utils/Log": "Log",
    "../../../Base/Utils/Util": "Util",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Const/TimeConfig": "TimeConfig",
    "../../Data/RuntimeMgr": "RuntimeMgr",
    "../Control/LockCtrl": "LockCtrl",
    "../Control/TaskCtrl": "TaskCtrl",
    "./CellBase": "CellBase",
    "./CellModel": "CellModel",
    "./CollectModel": "CollectModel",
    "./EnergyModel": "EnergyModel",
    "./GroundModel": "GroundModel",
    "./MultipleGridColModel": "MultipleGridColModel",
    "./PropModel": "PropModel",
    "./SpecialPlug/Conveyer": "Conveyer",
    "./SpecialPlug/Girl": "Girl",
    "./UpGroundModel": "UpGroundModel"
  } ],
  GameTableMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "3b65fbC0rFChYM1cvxZmvb6", "GameTableMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BaseTable_1 = require("./Table/BaseTable");
    var SingletonFactory_1 = require("../Utils/SingletonFactory");
    var Titles_1 = require("../Tabls/Titles");
    var ChapterStory_1 = require("../Tabls/ChapterStory");
    var ChapterInfo_1 = require("../Tabls/ChapterInfo");
    var PropInfo_1 = require("../Tabls/PropInfo");
    var BoxRewardInfo_1 = require("../Tabls/BoxRewardInfo");
    var IslandUnlockCfg_1 = require("../Tabls/IslandUnlockCfg");
    var SlotBonusCfg_1 = require("../Tabls/SlotBonusCfg");
    var LevelUpReward_1 = require("../Tabls/LevelUpReward");
    var ShareCfg_1 = require("../Tabls/ShareCfg");
    var HotelCfg_1 = require("../Tabls/HotelCfg");
    var HotelRoomCfg_1 = require("../Tabls/HotelRoomCfg");
    var ShopInfo_1 = require("../Tabls/ShopInfo");
    var GameTableMgr = function() {
      function GameTableMgr() {
        this.Titles = new BaseTable_1.BaseTable("lv", "titles", Titles_1.default, null);
        this.ChapterStory = new BaseTable_1.BaseTable("trigger", "ChapterStory", ChapterStory_1.default, null);
        this.ChapterInfo = new BaseTable_1.BaseTable("id", "ChapterInfo", ChapterInfo_1.default, null);
        this.PropInfo = new BaseTable_1.BaseTable("id", "PropInfo", PropInfo_1.default, null);
        this.BoxRewardInfo = new BaseTable_1.BaseTable("id", "BoxReward", BoxRewardInfo_1.default, null);
        this.LevelUpReward = new BaseTable_1.BaseTable("id", "LevelUpReward", LevelUpReward_1.default, null);
        this.ShopInfo = new BaseTable_1.BaseTable("id", "ShopTools", ShopInfo_1.default, null);
        this.IslandUnlockCfg = new BaseTable_1.BaseTable("id", "IslandUnlockCfg", IslandUnlockCfg_1.default, null);
        this.ShareCfg = new BaseTable_1.BaseTable("id", "ShareCfg", ShareCfg_1.default, null);
        this.HotelCfg = new BaseTable_1.BaseTable("id", "HotelCfg", HotelCfg_1.default, null);
        this.HotelRoomCfg = new BaseTable_1.BaseTable([ "roomId", "slotId" ], "HotelRoomCfg", HotelRoomCfg_1.default, null);
        this.SlotBonusCfg = new BaseTable_1.BaseTable([ "roomId", "count" ], "SlotBonus", SlotBonusCfg_1.default, null);
        this.DailyTaskInfo = null;
        this.isReady = false;
      }
      GameTableMgr.prototype.execute = function() {
        var _this = this;
        return new Promise(function(resolve, reject) {
          if (_this.checkAllReady() || _this.isReady) return resolve(true);
          var timer = setInterval(function() {
            if (_this.checkAllReady()) {
              clearInterval(timer);
              resolve(true);
              _this.isReady = true;
            }
          }, 10);
        });
      };
      GameTableMgr.prototype.checkAllReady = function() {
        var c;
        var isReady = true;
        var keys = Object.keys(this);
        for (var i = 0; i < keys.length; i++) {
          c = this[keys[i]];
          c && c instanceof BaseTable_1.BaseTable && !c.isReady && (isReady = false);
        }
        return isReady;
      };
      GameTableMgr.ins = SingletonFactory_1.SingletonFactory.getInstance(GameTableMgr);
      return GameTableMgr;
    }();
    exports.GameTableMgr = GameTableMgr;
    cc._RF.pop();
  }, {
    "../Tabls/BoxRewardInfo": "BoxRewardInfo",
    "../Tabls/ChapterInfo": "ChapterInfo",
    "../Tabls/ChapterStory": "ChapterStory",
    "../Tabls/HotelCfg": "HotelCfg",
    "../Tabls/HotelRoomCfg": "HotelRoomCfg",
    "../Tabls/IslandUnlockCfg": "IslandUnlockCfg",
    "../Tabls/LevelUpReward": "LevelUpReward",
    "../Tabls/PropInfo": "PropInfo",
    "../Tabls/ShareCfg": "ShareCfg",
    "../Tabls/ShopInfo": "ShopInfo",
    "../Tabls/SlotBonusCfg": "SlotBonusCfg",
    "../Tabls/Titles": "Titles",
    "../Utils/SingletonFactory": "SingletonFactory",
    "./Table/BaseTable": "BaseTable"
  } ],
  GameTaskModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "33e53A8Jo5EH6QH0Y1KoCBY", "GameTaskModel");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GameTaskModel = function() {
      function GameTaskModel() {
        this.type = 0;
        this.action = null;
        this.model1 = null;
        this.model2 = null;
        this.size = 0;
        this.extData = 0;
        this.closeAry = null;
        this.cp1 = null;
        this.cp2 = null;
        this.keepTime = 0;
        this.isNeedShowEff = true;
        this.init();
      }
      GameTaskModel.prototype.destory = function() {
        this.init();
      };
      GameTaskModel.prototype.init = function() {
        this.type = 0;
        this.action = null;
        this.model1 = null;
        this.model2 = null;
        this.size = 0;
        this.extData = 0;
        this.closeAry = null;
        this.cp1 = null;
        this.cp2 = null;
        this.keepTime = 0;
      };
      return GameTaskModel;
    }();
    exports.GameTaskModel = GameTaskModel;
    cc._RF.pop();
  }, {} ],
  Girl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "ee577rU6N5AzLkSvnLFNthV", "Girl");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GameModel_1 = require("../GameModel");
    var Common_1 = require("../../../Common/Common");
    var Constant_1 = require("../../../Data/Const/Constant");
    var Girl = function() {
      function Girl(cfg) {
        this._cfg = null;
        this._path = null;
        this._currentStep = 0;
        this._triggerCount = 0;
        this._girlCell = null;
        this._cfg = cfg;
        this._path = [];
      }
      Girl.prototype.initStartPoint = function() {
        this._currentStep = 0;
        this._girlCell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, this._path[0]);
        this._girlCell.change2Cell(Constant_1.CellType.Girl);
      };
      Girl.prototype.initEndPoint = function() {
        var endPos = this._path[this._path.length - 1];
        var endCellModel = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, endPos);
        endCellModel.change2Cell(Constant_1.CellType.Conch);
      };
      Girl.prototype.initRoad = function(pos) {
        var groundCellModel = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, pos);
        groundCellModel && groundCellModel.showGirlGround();
      };
      Girl.prototype.execJump2NextStep = function() {
        if (this._girlCell) {
          this._currentStep++;
          this.nextPos && GameModel_1.default.ins.isPassable(this.nextPos, null) && this._girlCell.mermaidJumpTo(this.nextPos);
        }
      };
      Object.defineProperty(Girl.prototype, "nextPos", {
        get: function() {
          return this._path[this._currentStep];
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(Girl.prototype, "path", {
        get: function() {
          return this._path;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(Girl.prototype, "index", {
        get: function() {
          return this._cfg.index;
        },
        enumerable: true,
        configurable: true
      });
      Girl.prototype.onTrigger = function() {
        this._triggerCount++;
        this.execJump2NextStep();
      };
      Girl.prototype.init = function() {
        for (var i = 0; i < this._cfg.path.length; i++) {
          var pos = cc.v2(this._cfg.path[i][0], this._cfg.path[i][1]);
          this._path.push(pos);
          this.initRoad(pos);
        }
        this.initStartPoint();
        this.initEndPoint();
      };
      return Girl;
    }();
    exports.default = Girl;
    cc._RF.pop();
  }, {
    "../../../Common/Common": "Common",
    "../../../Data/Const/Constant": "Constant",
    "../GameModel": "GameModel"
  } ],
  GnomeModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "a8a3dLbMypMN4Yl0xoWIurp", "GnomeModel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var MultipleGridColBase_1 = require("./MultipleGridColBase");
    var Common_1 = require("../../../Common/Common");
    var GnomeModel = function(_super) {
      __extends(GnomeModel, _super);
      function GnomeModel() {
        return null !== _super && _super.apply(this, arguments) || this;
      }
      GnomeModel.prototype.sync2View = function(groundList) {
        if (!this._cfg) return;
        this._count = this._cfg.length;
        for (var i = 0; i < this._count; i++) {
          var cfg = this._cfg[i];
          this._pool[i] || (this._pool[i] = []);
          var isCross = false;
          cfg.type % 2 == 0 && (isCross = true);
          var max = 2 * (Math.floor(cfg.type / 2) + 1);
          var min = max / 2;
          var dir = null;
          for (var k = 0; k < min; k++) for (var j = 0; j < max; j++) {
            dir = isCross ? cc.v2(j, k) : cc.v2(k, j);
            var pos = cc.v2(cfg.x, cfg.y).add(dir);
            var groundItem = Common_1.default.safeGet2ArrayValue(groundList, pos);
            if (groundItem) {
              groundItem.isGnome = true;
              this._pool[i].push(pos);
            }
          }
        }
      };
      GnomeModel.prototype.onComplet = function(index, topPoint) {};
      return GnomeModel;
    }(MultipleGridColBase_1.default);
    exports.default = GnomeModel;
    cc._RF.pop();
  }, {
    "../../../Common/Common": "Common",
    "./MultipleGridColBase": "MultipleGridColBase"
  } ],
  GodCommand: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "c83afiAlmFJErvPKSGx5Ilq", "GodCommand");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var async = require("async");
    var GodCommand = function() {
      function GodCommand() {}
      GodCommand.locator = function(godGuide, step, callback) {
        var args = step.command.args;
        godGuide.find(args, function(node) {
          godGuide._targetNode = node;
          node.once(cc.Node.EventType.TOUCH_END, function() {
            console.warn("\u8282\u70b9\u88ab\u70b9\u51fb");
            callback();
          });
          var autorun = godGuide.getTask().autorun;
          autorun && godGuide.touchSimulation(node);
        });
      };
      GodCommand.finger = function(godGuide, step, callback) {
        var args = step.command.args;
        godGuide._targetNode = null;
        godGuide.find(args, function(node) {
          godGuide.fingerToNode(node, function() {
            if (!node || 0 == node.name.length) {
              callback();
              return;
            }
            godGuide._targetNode = node;
            node.once(cc.Node.EventType.TOUCH_END, function() {
              console.warn("\u8282\u70b9\u88ab\u70b9\u51fb");
              godGuide._targetNode && callback();
            });
          });
        });
      };
      GodCommand.text = function(godGuide, step, callback) {
        var _a = step.command, role = _a.role, args = _a.args, positionY = _a.positionY;
        !args || "string" !== typeof args && "number" !== typeof args || (args = [ args ]);
        var index = 0;
        async.eachSeries(args, function(str, cb) {
          var flag = false;
          godGuide.showText(str, role, positionY || 0, function() {
            if (flag) return;
            flag = true;
            cb();
          });
        }, callback);
      };
      GodCommand.dialogue = function(godGuide, step, callback) {
        var args = step.command.args;
        !args || "string" !== typeof args && "number" !== typeof args || (args = [ args ]);
        var autorun = godGuide.getTask().autorun;
        var index = 0;
        async.eachSeries(args, function(str, cb) {
          var flag = false;
          var next = function() {
            if (++index >= args.length - 1) {
              godGuide._dialogue.active = false;
              flag = true;
              cb();
              return;
            }
            if (flag) return;
            flag = true;
            godGuide._dialogue.active = false;
            cb();
          };
          godGuide.showDialogue(str, function() {
            next();
          });
          autorun && setTimeout(function() {
            if (flag) return;
            flag = true;
            cb();
          }, 1e4);
        }, callback);
      };
      GodCommand.condition = function() {};
      GodCommand.DIALOGUE = "dialogue";
      GodCommand.FINGER = "finger";
      GodCommand.TEXT = "text";
      GodCommand.LOCATOR = "locator";
      GodCommand.SAVE = "save";
      GodCommand.typeList = [ GodCommand.DIALOGUE, GodCommand.FINGER, GodCommand.TEXT, GodCommand.LOCATOR, GodCommand.SAVE ];
      return GodCommand;
    }();
    exports.GodCommand = GodCommand;
    cc._RF.pop();
  }, {
    async: "async"
  } ],
  GodFinger: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "fb7adJU6jVMwLpq0Hhj17dq", "GodFinger");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var GodFinger = function(_super) {
      __extends(GodFinger, _super);
      function GodFinger() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this._animation = null;
        return _this;
      }
      GodFinger.prototype.onLoad = function() {
        this._animation = this.getComponent(cc.Animation);
      };
      GodFinger.prototype.doFinger = function() {
        this._animation.play("GodFinger");
      };
      GodFinger.prototype.stopFinger = function() {
        this._animation.stop();
      };
      Object.defineProperty(GodFinger.prototype, "active", {
        set: function(active) {
          this.node.active = active;
          active || this.stopFinger();
        },
        enumerable: true,
        configurable: true
      });
      GodFinger = __decorate([ ccclass ], GodFinger);
      return GodFinger;
    }(cc.Component);
    exports.default = GodFinger;
    cc._RF.pop();
  }, {} ],
  GodGuide: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "fc7d0qwogREsqMsfej7uXfW", "GodGuide");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var async = require("async");
    var GodCommand_1 = require("./GodCommand");
    var Locator_1 = require("./Locator");
    var GuideCondition_1 = require("./GuideCondition");
    var GuideUtils_1 = require("./GuideUtils");
    var MapIslandUtils_1 = require("../Script/Logic/SimulationOperation/View/Map/MapIslandUtils");
    var GodFinger_1 = require("./GodFinger");
    var GuideData_1 = require("./GuideData");
    var RADIAN = 2 * Math.PI / 360;
    var EGuideEvent;
    (function(EGuideEvent) {
      EGuideEvent["Stop"] = "_GuideStopHanlder";
    })(EGuideEvent = exports.EGuideEvent || (exports.EGuideEvent = {}));
    function getRotatePoint(p, angle, center) {
      var out = cc.v2();
      var radian = -angle * RADIAN;
      out.x = (p.x - center.x) * Math.cos(radian) - (p.y - center.y) * Math.sin(radian) + center.x;
      out.y = (p.x - center.x) * Math.sin(radian) + (p.y - center.y) * Math.cos(radian) + center.y;
      return out;
    }
    function getRectRotatePoints(rect, angle, pt) {
      var array = [ cc.v2(rect.x, rect.y), cc.v2(rect.x + rect.width, rect.y), cc.v2(rect.x + rect.width, rect.y + rect.height), cc.v2(rect.x, rect.y + rect.height) ];
      return array.map(function(p) {
        return getRotatePoint(p, angle, pt);
      });
    }
    function getHTMLElementPosition(element) {
      var docElem = document.documentElement;
      var leftOffset = window.pageXOffset - docElem.clientLeft;
      var topOffset = window.pageYOffset - docElem.clientTop;
      if ("function" === typeof element.getBoundingClientRect) {
        var box = element.getBoundingClientRect();
        return {
          left: box.left + leftOffset,
          top: box.top + topOffset,
          width: box.width,
          height: box.height
        };
      }
      return element instanceof HTMLCanvasElement ? {
        left: leftOffset,
        top: topOffset,
        width: element.width,
        height: element.height
      } : {
        left: leftOffset,
        top: topOffset,
        width: parseInt(element.style.width),
        height: parseInt(element.style.height)
      };
    }
    function touchSimulation(x, y) {
      var rect;
      var inputManager = window._cc ? window._cc.inputManager : cc.internal.inputManager;
      if (cc.sys.isBrowser) {
        var canvas = document.getElementById("GameCanvas");
        rect = getHTMLElementPosition(canvas);
      } else {
        rect = cc.view.getFrameSize();
        rect.left = 0;
        rect.top = 0;
      }
      var vp = cc.view.getViewportRect();
      var sx = cc.view.getScaleX();
      var sy = cc.view.getScaleY();
      var ratio = cc.view.getDevicePixelRatio();
      var htmlx = (x * sx + vp.x) / ratio + rect.left;
      var htmly = rect.top + rect.height - (y * sy + vp.y) / ratio;
      var pt = cc.v2(htmlx, htmly);
      cc.log("\u6a21\u62df\u70b9\u51fb\u5750\u6807\uff1a" + pt.x + ", " + pt.y);
      var touch = inputManager.getTouchByXY(pt.x, pt.y, rect);
      inputManager.handleTouchesBegin([ touch ]);
      setTimeout(function() {
        inputManager.handleTouchesEnd([ touch ]);
      }, 200);
    }
    var TAG = "Guide";
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var GodGuide = function(_super) {
      __extends(GodGuide, _super);
      function GodGuide() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this._selector = "";
        _this.FINGER_PREFAB = null;
        _this.TEXT_PREFAB = null;
        return _this;
      }
      Object.defineProperty(GodGuide.prototype, "selector", {
        get: function() {
          return this._selector;
        },
        set: function(value) {
          this._selector = value;
          this.find(value);
        },
        enumerable: true,
        configurable: true
      });
      GodGuide.prototype.onLoad = function() {
        this.init();
        this.GodGuide = this;
      };
      GodGuide.prototype.onDestroy = function() {};
      GodGuide.prototype.touchSimulation = function(node) {
        this.log("\u81ea\u52a8\u6267\u884c\uff0c\u6a21\u62df\u89e6\u6478");
        this.scheduleOnce(function() {
          cc.log("\u81ea\u52a8\u8282\u70b9 :", JSON.stringify(node.position));
          var p = node.parent.convertToWorldSpaceAR(node.position);
          cc.log("\u4e16\u754c\u8282\u70b9 :", JSON.stringify(p));
          touchSimulation(p.x, p.y);
        }, 1);
      };
      GodGuide.prototype.init = function() {
        var _this = this;
        this.node.setContentSize(cc.winSize);
        this._targetNode = null;
        if (this.FINGER_PREFAB) {
          var nodeFinger = cc.instantiate(this.FINGER_PREFAB);
          nodeFinger.parent = this.node;
          nodeFinger.active = false;
          this._finger = nodeFinger.getComponent(GodFinger_1.default);
        }
        if (this.TEXT_PREFAB) {
          this._text = cc.instantiate(this.TEXT_PREFAB);
          this._text.parent = this.node;
          this._text.active = false;
        }
        this._debugNode = this.node.getChildByName("debug");
        this._autorun = cc.find("autorun/Background/Label", this._debugNode).getComponent(cc.Label);
        this._autorun.string = "\u81ea\u52a8\u6267\u884c\uff08\u5173\uff09";
        this._mask = this.node.getComponentInChildren(cc.Mask);
        this._mask.inverted = true;
        this._mask.node.active = false;
        this.node.on(cc.Node.EventType.TOUCH_START, function(event) {
          if (_this._dispatchEvent) {
            _this.node["_touchListener"].setSwallowTouches(false);
            return;
          }
          if (!_this._mask.node.active) {
            _this.node["_touchListener"].setSwallowTouches(false);
            return;
          }
          if (!_this._targetNode) {
            _this.node["_touchListener"].setSwallowTouches(true);
            return;
          }
          var rectPos = MapIslandUtils_1.default.convertMapItemPosition(_this._targetNode, _this._curStepConfig);
          var rect = _this._targetNode.getBoundingBoxToWorld();
          if (null == rectPos) {
            var command = _this._curStepConfig.command;
            if (command && command.type && "MapUI" == command.type) {
              var cameraPos = MapIslandUtils_1.default.mapCamera.node.position;
              var newRect = cc.rect(rect.x - cameraPos.x, rect.y - cameraPos.y, rect.width, rect.height);
              rect = newRect;
            }
          } else {
            var cavans = cc.find("Canvas");
            rectPos = cavans.convertToWorldSpaceAR(rectPos);
            var newRect = cc.rect(rectPos.x - rect.width / 2, rectPos.y - rect.height / 2, rect.width, rect.height);
            rect = newRect;
          }
          if (rect.contains(event.getLocation())) {
            _this.node["_touchListener"].setSwallowTouches(false);
            cc.log("\u547d\u4e2d\u76ee\u6807\u8282\u70b9\uff0c\u653e\u884c");
          } else {
            _this.node["_touchListener"].setSwallowTouches(true);
            cc.log("\u672a\u547d\u4e2d\u76ee\u6807\u8282\u70b9\uff0c\u62e6\u622a");
          }
        }, this);
      };
      GodGuide.prototype.start = function() {};
      GodGuide.prototype.setTask = function(task) {
        if (this._task) {
          cc.warn("\u5f53\u524d\u4efb\u52a1\u8fd8\u672a\u5904\u7406\u5b8c\u6bd5\uff01");
          return;
        }
        this._debugNode.active = !!task.debug;
        this._autorun.string = "\u81ea\u52a8\u6267\u884c(" + (task.autorun ? "\u5f00" : "\u5173") + ")";
        this._task = task;
      };
      GodGuide.prototype.getTask = function() {
        return this._task;
      };
      GodGuide.prototype.run = function(callback) {
        var _this = this;
        if (!this._task) return;
        async.eachSeries(this._task.steps, function(step, cb) {
          _this._curStepConfig = step;
          _this._processStep(step, cb);
        }, function(error) {
          if (error) GuideUtils_1.GuideUtils.logError(TAG, _this._curStepConfig.guideId, "run error", error); else {
            GuideUtils_1.GuideUtils.logError("\u5f15\u5bfc\u987a\u5229\u5b8c\u6210", _this._task.filename);
            _this._task && GuideData_1.GuideData.pushFinishedTask(_this._task.filename);
          }
          _this._task = null;
          _this._curStepConfig = null;
          _this._mask.node.active = false;
          _this._finger && (_this._finger.active = false);
          callback && callback();
        });
      };
      GodGuide.prototype._processStep = function(step, callback) {
        var _this = this;
        GuideUtils_1.GuideUtils.logError(TAG, " \u5f00\u59cb\u6267\u884c ", step.guideId);
        async.series({
          stepStart: function(cb) {
            if (step.onStart) if (GuideUtils_1.GuideUtils.checkGuideDone(step.guideId) && !step.noCheckDone) cb(null, null); else {
              GuideUtils_1.GuideUtils.logError(TAG, " onStart ", step.guideId);
              step.onStart(function(err) {
                cb(err, null);
              });
            } else cb(null, null);
          },
          stepCommand: function(cb) {
            _this.registerStop(cb);
            GuideUtils_1.GuideUtils.logError(TAG, " stepCommand ", step.guideId);
            var cmd = GodCommand_1.GodCommand[step.command.cmd];
            var guideId = GuideUtils_1.GuideUtils.curGuideId = step.guideId;
            if (!cmd || GuideUtils_1.GuideUtils.checkGuideDone(guideId) && !step.noCheckDone) {
              _this.log("\u6267\u884c\u6b65\u9aa4\u3010" + guideId + "\u3011\u6307\u4ee4 \u8df3\u8fc7\uff01", step);
              cb();
            } else GuideCondition_1.GuideCondition.checkCondition(step) ? _this.scheduleOnce(function() {
              _this._processStepCommand(step, function(error) {
                cb(error, null);
              });
            }, step.delayTime || 0) : cb(GuideUtils_1.EGuideStart.ConditionNotReach);
          },
          taskEnd: function(cb) {
            GuideUtils_1.GuideUtils.logError(TAG, " taskEnd ", step.guideId);
            _this._mask["_graphics"] && _this._mask["_graphics"].clear();
            _this._mask.node.setContentSize(0, 0);
            _this._finger.active = false;
            _this._finger.node.setPosition(cc.v2(0, 0));
            step.onEnd ? GuideUtils_1.GuideUtils.checkGuideDone(step.guideId) && !step.noCheckDone ? cb(null, null) : step.onEnd(function(err) {
              cb(err, null);
            }) : cb(null, null);
          }
        }, function(error, result) {
          GuideUtils_1.GuideUtils.curGuideId = -1;
          _this._targetNode = null;
          _this.unregisterStop();
          GuideUtils_1.GuideUtils.logError(TAG, "\u6b65\u9aa4\u3010" + step.guideId + "\u3011\u7ed3\u675f\uff01 error:" + error);
          if (GuideUtils_1.GuideUtils.stopGuide) {
            _this.clearGuide();
            GuideUtils_1.GuideUtils.logError("\u624b\u52a8\u505c\u6b62\u5f15\u5bfc");
            callback(true);
            return;
          }
          if (error && error != GuideUtils_1.EGuideStart.None) {
            if (error == GuideUtils_1.EGuideStart.ConditionNotReach) {
              _this._task && GuideData_1.GuideData.pushNoConditionTask(_this._task.filename);
              callback(null, null);
              return;
            }
            if (error == GuideUtils_1.EGuideStart.Stop) {
              callback(error, null);
              return;
            }
          }
          GuideUtils_1.GuideUtils.doneGuideId = step.guideId;
          callback(error);
        });
      };
      GodGuide.prototype.fingerToNode = function(node, cb) {
        var _this = this;
        this._finger || cb();
        var curStepConfig = this._curStepConfig;
        if (curStepConfig && curStepConfig.command && curStepConfig.command.hideFinger) {
          this._finger.active = false;
          cb();
          return;
        }
        this._finger.active = true;
        var rectPos = MapIslandUtils_1.default.convertMapItemPosition(node, curStepConfig);
        if (null == rectPos) {
          var command = curStepConfig.command;
          rectPos = node.parent.convertToWorldSpaceAR(node.position);
          command && command.type && "MapUI" == command.type && (rectPos = rectPos.sub(MapIslandUtils_1.default.mapCamera.node.getPosition()));
        } else {
          var cavans = cc.find("Canvas");
          rectPos = cavans.convertToWorldSpaceAR(rectPos);
        }
        var p = this.node.convertToNodeSpaceAR(rectPos);
        var duration = .6 * p.sub(this._finger.node.getPosition()).mag() / cc.winSize.height;
        var moveTo = cc.moveTo(duration, p);
        var callFunc = cc.callFunc(function() {
          cb();
          _this._finger.doFinger();
        }, this);
        var sequnce = cc.sequence(moveTo, callFunc);
        this._finger.node.runAction(sequnce);
      };
      GodGuide.prototype.log = function() {
        var text = [];
        for (var _i = 0; _i < arguments.length; _i++) text[_i] = arguments[_i];
        this._task && this._task.debug && GuideUtils_1.GuideUtils.logError(text);
      };
      GodGuide.prototype._processStepCommand = function(step, cb) {
        var _this = this;
        var cmd = GodCommand_1.GodCommand[step.command.cmd];
        var guideId = step.guideId;
        this.log("\u6267\u884c\u6b65\u9aa4\u3010" + guideId + "\u3011\u6307\u4ee4");
        this._mask.node.active = void 0 == step.mask || step.mask;
        cmd(this, step, function() {
          _this.log("\u6b65\u9aa4\u3010" + guideId + "\u3011\u6307\u4ee4 \u6267\u884c\u5b8c\u6bd5");
          cb();
        });
      };
      GodGuide.prototype.find = function(value, cb) {
        var _this = this;
        var _a = this.findRoot(value), root = _a[0], value1 = _a[1];
        Locator_1.Locator.locateNode(root, value1, function(error, node) {
          if (error) {
            cc.error(error);
            return;
          }
          cc.log("\u5b9a\u4f4d\u8282\u70b9\u6210\u529f");
          var rect = _this._focusToNode(node);
          cb && rect && cb(node, rect);
        });
      };
      GodGuide.prototype.findRoot = function(value) {
        if (-1 != value.indexOf(":")) {
          var arr = value.split(":");
          return [ cc.find(arr[0]), arr[1] ];
        }
        return [ cc.find("Canvas"), value ];
      };
      GodGuide.prototype.locateNodeByEvent = function(sender) {
        this._selector = sender.string;
      };
      GodGuide.prototype.getNodePoints = function(rect, angle, pt) {
        return getRectRotatePoints(rect, angle, pt).map(function(p) {
          return p;
        });
      };
      GodGuide.prototype._focusToNode = function(node) {
        if (!this._curStepConfig) return null;
        var rect = node.getBoundingBoxToWorld();
        var rectPos = MapIslandUtils_1.default.convertMapItemPosition(node, this._curStepConfig);
        if (null == rectPos) {
          var command = this._curStepConfig.command;
          rectPos = command && command.type && "MapUI" == command.type ? rect.origin.sub(MapIslandUtils_1.default.mapCamera.node.getPosition()) : rect.origin;
        } else {
          var canvas = cc.find("Canvas");
          rectPos = canvas.convertToWorldSpaceAR(rectPos);
          rectPos.x -= rect.width / 2;
          rectPos.y -= rect.height / 2;
        }
        var p = this.node.convertToNodeSpaceAR(rectPos);
        rect.x = p.x;
        rect.y = p.y;
        if (this._curStepConfig.command) {
          this._mask["_graphics"] && this._mask["_graphics"].clear(true);
          this._mask.node.setContentSize(0, 0);
          if (this._curStepConfig.command.maskType && 1 == this._curStepConfig.command.maskType) {
            this._mask.type = cc.Mask.Type.RECT;
            this._mask.node.setPosition(cc.v2(0, 0));
            this._mask["_graphics"].fillRect(rect.x, rect.y, rect.width, rect.height);
          } else {
            var maskSp = node.getComponent(cc.Sprite) || node.getComponentInChildren(cc.Sprite);
            if (maskSp) {
              var nodeScale = 1;
              this._mask.type = cc.Mask.Type.IMAGE_STENCIL;
              this._mask.spriteFrame = maskSp.spriteFrame;
              this._mask.alphaThreshold = .7;
              this._mask.node.setContentSize(node.width * nodeScale, node.height * nodeScale);
              p.x += rect.width / 2;
              p.y += rect.height / 2;
              this._mask.node.setPosition(p);
            }
          }
        }
        return rect;
      };
      GodGuide.prototype.getNodeFullPath = function(node) {
        var array = [];
        var temp = node;
        do {
          array.unshift(temp.name);
          temp = temp.parent;
        } while (temp && "Canvas" !== temp.name);
        return array.join("/");
      };
      GodGuide.prototype.isGuideNode = function(node) {
        var result = false;
        var temp = node;
        do {
          if (temp === this.node) {
            result = true;
            break;
          }
        } while (temp = temp.parent);
        return result;
      };
      GodGuide.prototype.startRecordNodeTouch = function() {
        if (this._task) {
          cc.warn("\u4efb\u52a1\u5f15\u5bfc\u4e2d\uff0c\u4e0d\u80fd\u5f55\u5236");
          return;
        }
        if (this._dispatchEvent) {
          cc.warn("\u5df2\u7ecf\u8fdb\u5165\u5f55\u5236\u6a21\u5f0f");
          return;
        }
        this._dispatchEvent = cc.Node.prototype.dispatchEvent;
        this._recordSteps = [];
        var self = this;
        var time = Date.now();
        cc.Node.prototype.dispatchEvent = function(event) {
          self._dispatchEvent.call(this, event);
          if (self.isGuideNode(this)) return;
          if (event.type === cc.Node.EventType.TOUCH_END) {
            var now = Date.now();
            var delay = (now - time) / 1e3;
            time = now;
            var args = self.getNodeFullPath(this);
            self._recordSteps.push({
              desc: "\u70b9\u51fb" + args,
              command: {
                cmd: "finger",
                args: args
              },
              delay: delay
            });
          }
        };
      };
      GodGuide.prototype.stopRecordNodeTouch = function() {
        if (this._dispatchEvent) {
          cc.Node.prototype.dispatchEvent = this._dispatchEvent;
          this._dispatchEvent = null;
          cc.warn("\u9000\u51fa\u5f55\u5236\u72b6\u6001");
        } else cc.warn("\u672a\u8fdb\u5165\u5f55\u5236\u72b6\u6001");
      };
      GodGuide.prototype.playRecordNodeTouch = function(sender, autorun) {
        this.stopRecordNodeTouch();
        if (this._recordSteps && this._recordSteps.length) {
          cc.log("\u751f\u6210\u4efb\u52a1\uff1a", JSON.stringify(this._recordSteps));
          var task = {
            autorun: !!autorun,
            debug: true,
            steps: this._recordSteps
          };
          this._recordSteps = null;
          this.setTask(task);
          this.run();
        }
      };
      GodGuide.prototype.showText = function(text, role, positionY, callback) {
        this._text.once("click", callback);
        var godText = this._text.getComponent(this.TEXT_PREFAB.name);
        godText.setText(text, role, positionY, callback);
      };
      GodGuide.prototype.setAutorun = function() {
        if (this._task) {
          this._task.autorun = !this._task.autorun;
          this._autorun.string = "\u81ea\u52a8\u6267\u884c(" + (this._task.autorun ? "\u5f00" : "\u5173") + ")";
        }
      };
      GodGuide.prototype.close = function() {
        this.node.active = false;
      };
      GodGuide.prototype.registerStop = function(next) {
        this.unregisterStop();
        this.node.once(EGuideEvent.Stop, function() {
          next && next("\u5f3a\u5236\u505c\u6b62\u4e86");
        });
      };
      GodGuide.prototype.unregisterStop = function() {
        this.node.off(EGuideEvent.Stop);
      };
      GodGuide.prototype.clearGuide = function() {
        this._text && (this._text.active = false);
        this._finger && (this._finger.active = false);
        this._mask && (this._mask.node.active = false);
      };
      __decorate([ property(cc.Prefab) ], GodGuide.prototype, "FINGER_PREFAB", void 0);
      __decorate([ property(cc.Prefab) ], GodGuide.prototype, "TEXT_PREFAB", void 0);
      GodGuide = __decorate([ ccclass ], GodGuide);
      return GodGuide;
    }(cc.Component);
    exports.default = GodGuide;
    cc._RF.pop();
  }, {
    "../Script/Logic/SimulationOperation/View/Map/MapIslandUtils": "MapIslandUtils",
    "./GodCommand": "GodCommand",
    "./GodFinger": "GodFinger",
    "./GuideCondition": "GuideCondition",
    "./GuideData": "GuideData",
    "./GuideUtils": "GuideUtils",
    "./Locator": "Locator",
    async: "async"
  } ],
  GodText: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "83aa0WddPdOa6LnZ49stCZ5", "GodText");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var GodText = function(_super) {
      __extends(GodText, _super);
      function GodText() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.label = null;
        _this.contentNode = null;
        _this.personSp = null;
        _this.roleSprites = [];
        _this._positionY = 0;
        _this._loaded = false;
        _this._curText = "";
        return _this;
      }
      GodText.prototype.start = function() {
        var _this = this;
        this.node.on(cc.Node.EventType.TOUCH_START, function(event) {
          _this.node["_touchListener"].setSwallowTouches(false);
          if (_this.node.active) {
            _this.hide();
            _this.node.emit("click");
            return;
          }
        });
        this.contentNode.active = true;
        this.contentNode.setPosition(0, this._positionY);
        this._loaded = true;
      };
      GodText.prototype.setText = function(txt, role, positionY, cb) {
        this.callback = cb;
        this._positionY = positionY;
        if (!this.label) return;
        this.personSp.spriteFrame = this.roleSprites[role - 1];
        this.label.string = "";
        this.showText(txt);
        this._curText = txt;
        if (this._loaded) {
          this.contentNode.active = true;
          this.contentNode.setPosition(0, this._positionY);
        } else this.contentNode.active = false;
        gsap.TweenLite.to(this.node, .5, {
          opacity: 255
        });
        this.node.active = true;
      };
      GodText.prototype.showText = function(text) {
        this.unscheduleAllCallbacks();
        var i = 0;
        this.schedule(function() {
          this.label.string += text[i];
          i++;
        }, .08, text.length - 1, 0);
      };
      GodText.prototype.hide = function() {
        var _this = this;
        this.unscheduleAllCallbacks();
        this.label.string = this._curText;
        gsap.TweenLite.to(this.node, .5, {
          opacity: 0,
          onComplete: function() {
            _this.node.active = false;
          }
        });
      };
      __decorate([ property(cc.Label) ], GodText.prototype, "label", void 0);
      __decorate([ property(cc.Node) ], GodText.prototype, "contentNode", void 0);
      __decorate([ property(cc.Sprite) ], GodText.prototype, "personSp", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], GodText.prototype, "roleSprites", void 0);
      GodText = __decorate([ ccclass ], GodText);
      return GodText;
    }(cc.Component);
    exports.default = GodText;
    cc._RF.pop();
  }, {} ],
  GroundCellModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "3cda9FkkthC8bFU0HOV3p4T", "GroundCellModel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var CellBase_1 = require("./CellBase");
    var Common_1 = require("../../Common/Common");
    var GameModel_1 = require("./GameModel");
    var CollectModel_1 = require("./CollectModel");
    var Conveyer_1 = require("./SpecialPlug/Conveyer");
    var Constant_1 = require("../../Data/Const/Constant");
    var Mushroom_1 = require("./SpecialPlug/Mushroom");
    var GroundCellModel = function(_super) {
      __extends(GroundCellModel, _super);
      function GroundCellModel(data, pos, index) {
        var _this = _super.call(this) || this;
        _this.wall = null;
        _this._isHold = false;
        _this._isGnome = false;
        _this._isTurtles = false;
        _this._isDestorying = false;
        _this.portalIdx = 0;
        _this.gemLv = 0;
        _this.tuitujiCfg = null;
        _this.BindCell = null;
        _this.isGirlRoad = false;
        _this.isConveyer = false;
        _this.zIndex = 0;
        _this.mapIndex = index;
        _this._pos = pos;
        _this._isHold = true;
        _this.BindCell = null;
        _this.type = Constant_1.GroundType.None;
        _this.ctrlName = "ItemGroundCtrl";
        _this.init(data);
        return _this;
      }
      GroundCellModel.prototype.showGirlGround = function() {
        this.isGirlRoad = true;
      };
      GroundCellModel.prototype.onUnBind = function(pos) {
        this.BindCell && this.BindCell.unBindGround(this);
      };
      GroundCellModel.prototype.onBind = function(model) {
        this.BindCell = model;
      };
      GroundCellModel.prototype.init = function(data) {
        if (!data) {
          this.type = null;
          return;
        }
        this._isHold = false;
        this._isGnome = false;
        this._isTurtles = false;
        this._isDestorying = false;
        this.zIndex = 0;
        this.data = data;
        if (data.leaves) {
          this.type = Constant_1.GroundType.Leaves;
          this.lv = data.leaves;
        }
        if (data.water) {
          this.type = Constant_1.GroundType.Water;
          this._isHold = true;
          var plug = GameModel_1.default.ins.getPlug(Conveyer_1.default);
          if (plug && plug.checkIsConveyerItemForPos(this.pos)) {
            this.isConveyer = true;
            this._isHold = false;
          }
        }
        this.setWall(data);
        if (data.flowers) {
          this._isHold = true;
          this.lv = data.flowers;
          GameModel_1.default.ins.HaveFlowers = true;
          this.type = Constant_1.GroundType.Flower;
        }
        if (data.firefly) {
          this._isHold = true;
          this.lv = data.firefly;
          this.type = Constant_1.GroundType.Firefly;
        }
        if (data.ivy) {
          this.type = Constant_1.GroundType.Ivy;
          this.lv = data.ivy;
          this._isHold = true;
        }
        if (data.mushroom) {
          this.type = Constant_1.GroundType.Mushroom;
          this.lv = data.mushroom;
          this._isHold = true;
          var mrPlug = GameModel_1.default.ins.getPlug(Mushroom_1.default);
          mrPlug || (mrPlug = GameModel_1.default.ins.mountPlug(Mushroom_1.default));
          mrPlug.add(this.pos, this);
        }
        data.portal_idx && (this.portalIdx = data.portal_idx);
        this.isPassable;
      };
      GroundCellModel.prototype.initMonkeyTreePos = function() {
        this.type = Constant_1.GroundType.MoneyTree;
        this.accountForPos();
      };
      GroundCellModel.prototype.initCrab = function(index) {
        this.type = Constant_1.GroundType.Crab;
        this.zIndex = index;
        this.accountForPos();
      };
      GroundCellModel.prototype.initTurtles = function(topPoint) {
        this.type = Constant_1.GroundType.Ivy;
        this.lv = 2;
        this.zIndex = 0;
        this._isTurtles = true;
        this.accountForPos();
        this._pos.y == topPoint.y && (this.zIndex = -1);
      };
      GroundCellModel.prototype.change2TargetType = function(type, cfg) {
        this.type = type;
        if (Constant_1.GroundType.Tuituji || Constant_1.GroundType.Firefly || Constant_1.GroundType.Flower) {
          this.BindCell && this.BindCell.change2Cell(Constant_1.CellType.Empty);
          this.accountForPos();
        }
        if (cfg) switch (type) {
         case Constant_1.GroundType.Flower:
         case Constant_1.GroundType.Firefly:
          cfg && "number" == typeof cfg.lv && (this.lv = cfg.lv);
          break;

         case Constant_1.GroundType.Tuituji:
          this.tuitujiCfg = cfg;
        }
      };
      GroundCellModel.prototype.accountForPos = function() {
        this._isHold = true;
      };
      GroundCellModel.prototype.freeThisPos = function() {
        this._isHold = false;
      };
      GroundCellModel.prototype.onMsg = function(type, data) {
        var eliamteType = data ? data.type : null;
        switch (type) {
         case CellBase_1.MsgType.Elimate:
          this.execElimate(eliamteType);
          break;

         case CellBase_1.MsgType.BesideElimate:
          this.type != Constant_1.GroundType.Firefly && this.type != Constant_1.GroundType.Ivy && this.type != Constant_1.GroundType.Flower && this.type != Constant_1.GroundType.Mushroom || this.execElimate(eliamteType);
          break;

         case CellBase_1.MsgType.UpGroundDone:
          this.checkCoverItem();
        }
      };
      GroundCellModel.prototype.execElimateAll = function() {
        if (null != this.getType()) {
          this._updateCollectItemCount();
          this.cleanGround(true);
        }
      };
      GroundCellModel.prototype.onChangePos = function(pos) {
        Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.GroundList, pos, this);
      };
      Object.defineProperty(GroundCellModel.prototype, "Wall", {
        get: function() {
          return this.wall;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GroundCellModel.prototype, "isGem", {
        get: function() {
          return this.gemLv > 0;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GroundCellModel.prototype, "isBorn", {
        get: function() {
          return !!this.data && this.data.born;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GroundCellModel.prototype, "isExit", {
        get: function() {
          return !!this.data && this.data.exit;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GroundCellModel.prototype, "isPassable", {
        get: function() {
          return !!this.data && this.data.passable;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GroundCellModel.prototype, "isCanCreateCell", {
        get: function() {
          var result = !this._isHold;
          this.type != Constant_1.GroundType.Flower && this.type != Constant_1.GroundType.Ivy && this.type != Constant_1.GroundType.Firefly && this.type != Constant_1.GroundType.Mushroom || (result = true);
          return result;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GroundCellModel.prototype, "isHold", {
        get: function() {
          return this._isHold;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GroundCellModel.prototype, "isGnome", {
        get: function() {
          return this._isGnome;
        },
        set: function(opt) {
          this._isGnome = opt;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GroundCellModel.prototype, "isTurtles", {
        get: function() {
          return this._isTurtles;
        },
        enumerable: true,
        configurable: true
      });
      GroundCellModel.prototype.isPortalOut = function() {
        if (this.portalIdx > 0) return this.portalIdx;
        return 0;
      };
      GroundCellModel.prototype.isPortalIn = function() {
        if (this.portalIdx < 0) return this.portalIdx;
        return 0;
      };
      GroundCellModel.prototype.checkWall = function(dir) {
        var result = false;
        this.wall && void 0 != this.wall[dir] && (result = true);
        return result;
      };
      GroundCellModel.prototype.cleanGround = function(isPlayAnimation) {
        void 0 === isPlayAnimation && (isPlayAnimation = false);
        if (this.type != Constant_1.GroundType.None && this.type != Constant_1.GroundType.Water) {
          this.type = Constant_1.GroundType.None;
          this.lv = 0;
          this._isHold = false;
          isPlayAnimation && this.extCtrl.playAnimation();
        }
      };
      GroundCellModel.prototype.setWall = function(data) {
        var dirDatas = {
          left: 90,
          right: -90,
          top: 0,
          bottom: 180
        };
        for (var key in dirDatas) if (data["wall_" + key]) {
          this.wall || (this.wall = {});
          this.wall[key] = dirDatas[key];
        }
      };
      GroundCellModel.prototype.lvOverTrigger = function(type) {
        switch (this.type) {
         case Constant_1.GroundType.Firefly:
          this.cleanGround();
          var groupId = GameModel_1.default.ins.seq.next();
          this.isBorn ? GameModel_1.default.ins.checkNeedCreateNewCell(this.pos, groupId) : GameModel_1.default.ins.testFindCanFallCell(this.pos, groupId);
          break;

         case Constant_1.GroundType.Mushroom:
          GameModel_1.default.ins.getPlug(Mushroom_1.default).del(this.pos);
        }
      };
      GroundCellModel.prototype.checkCoverItem = function() {
        var mg = GameModel_1.default.ins.getMgModel();
        if (this.getType() == Constant_1.GroundType.Crab) {
          var type = CollectModel_1.CollectType.crab;
          var idx = mg.updateItemCountByPos(type, this.pos);
          mg.checkItemOver(type, idx) && GameModel_1.default.ins.updateCollectCount(type, idx);
        }
      };
      GroundCellModel.prototype.execElimate = function(eType) {
        void 0 === eType && (eType = Constant_1.ElimateType.Default);
        return __awaiter(this, void 0, void 0, function() {
          var idx, type;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              idx = null;
              type = null;
              if (!(this.getType() >= Constant_1.GroundType.Leaves && this.lv > 0 && !this._isDestorying)) return [ 3, 2 ];
              this._isDestorying = true;
              return [ 4, this.extCtrl.playAnimation() ];

             case 1:
              _a.sent();
              this._isDestorying = false;
              this.setLv(-1);
              this.type == Constant_1.GroundType.Firefly && GameModel_1.default.ins.updateCollectCount(CollectModel_1.CollectType.firefly, this.getPosition());
              if (0 == this.lv) {
                this.extCtrl.cleanOtherDisplay();
                this.lvOverTrigger(eType);
              }
              _a.label = 2;

             case 2:
              this._updateCollectItemCount();
              return [ 2 ];
            }
          });
        });
      };
      GroundCellModel.prototype._updateCollectItemCount = function() {
        var _this = this;
        var _a;
        var types = [ CollectModel_1.CollectType.turtles, CollectModel_1.CollectType.gnome ];
        var opt = (_a = {}, _a[CollectModel_1.CollectType.turtles] = this.isTurtles, _a[CollectModel_1.CollectType.gnome] = this.isGnome, 
        _a);
        types.forEach(function(type) {
          var idx = null;
          var mg = GameModel_1.default.ins.getMgModel();
          opt[type] && _this.lv <= 0 && (idx = mg.updateItemCountByPos(type, _this.pos));
          mg.checkItemOver(type, idx) && GameModel_1.default.ins.updateCollectCount(type, idx);
        });
      };
      return GroundCellModel;
    }(CellBase_1.CellBase);
    exports.default = GroundCellModel;
    cc._RF.pop();
  }, {
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "./CellBase": "CellBase",
    "./CollectModel": "CollectModel",
    "./GameModel": "GameModel",
    "./SpecialPlug/Conveyer": "Conveyer",
    "./SpecialPlug/Mushroom": "Mushroom"
  } ],
  GroundModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "d7fd6WsVr9KsZQt5Wq2QNg7", "GroundModel");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GroundCellModel_1 = require("./GroundCellModel");
    var GroundModel = function() {
      function GroundModel() {
        this.gCellList = null;
        this.gCellList = [];
      }
      GroundModel.prototype.initGroupCell = function(data, x, y, index) {
        var item = new GroundCellModel_1.default(data, cc.v2(x, y), index);
        var warr = this.gCellList[y] || [];
        warr.push(item);
        this.gCellList[y] = warr;
        return item;
      };
      GroundModel.prototype.getGroupCellList = function() {
        return this.gCellList;
      };
      GroundModel.prototype.getGCellByPos = function(pos) {
        return this.gCellList[pos.y][pos.x];
      };
      return GroundModel;
    }();
    exports.GroundModel = GroundModel;
    cc._RF.pop();
  }, {
    "./GroundCellModel": "GroundCellModel"
  } ],
  GroundViewCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "837e7BFspRJ2bwmth8o2HEm", "GroundViewCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var BaseView_1 = require("./BaseView");
    var M_1 = require("../../../Base/Manager/M");
    var ItemGroundCtrl_1 = require("./ItemGroundCtrl");
    var Event_1 = require("../../Data/Const/Event");
    var Constant_1 = require("../../Data/Const/Constant");
    var CollectModel_1 = require("../Model/CollectModel");
    var GameModel_1 = require("../Model/GameModel");
    var SpinePlayerCtrl_1 = require("../../../Base/CustomComponent/SpinePlayerCtrl");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var ActionCtrl_1 = require("../../Common/ActionCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var TrayOffset = cc.v2(12, 45);
    var GroundViewCtrl = function(_super) {
      __extends(GroundViewCtrl, _super);
      function GroundViewCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.borderFrames = [];
        _this.middleFrames = [];
        _this.waterFrames = [];
        _this.borderParent = null;
        _this.waterParent = null;
        _this.multFuncParent = null;
        _this.gnomeParent = null;
        _this.gnomePrefab = null;
        _this.turtlesPrefab = null;
        _this.crabPrefab = null;
        _this.monkeyTreePrefab = null;
        _this.groundBasePrefab = null;
        _this.gemPrefab = null;
        _this.firefly = null;
        _this.baseFrames = [];
        _this._cfg = null;
        _this._complexItemMap = null;
        _this.type = null;
        _this.gnomeAry = {};
        _this.crabAry = {};
        _this.monkeyTreeAry = {};
        _this.turtlesAry = {};
        return _this;
      }
      GroundViewCtrl.prototype.onLoad = function() {};
      GroundViewCtrl.prototype.initView = function(models, data, cfg, groundType) {
        _super.prototype.initView.call(this, models);
        this.type = groundType;
        this._cfg = cfg;
        M_1.default.nodePool.create(Constant_1.NodePoolKey.GroundCell, this.groundBasePrefab, 150);
        GameModel_1.default.ins.isHaveGem && M_1.default.nodePool.create(Constant_1.NodePoolKey.GemNode, this.gemPrefab, 20);
        this.initBaseView(models);
        this.initGnome(data.mgModel.getConfig(CollectModel_1.CollectType.gnome));
        this.initTurtles(data.mgModel.getConfig(CollectModel_1.CollectType.turtles));
        this.initCrab(data.mgModel.getConfig(CollectModel_1.CollectType.crab));
        this.initMonkeyTree(cfg.monkeyTree);
        this.initLawnmower(cfg.lawnmower);
      };
      GroundViewCtrl.prototype.initCrab = function(crabCfg) {
        if (!crabCfg) return;
        for (var i = 0; i < crabCfg.length; i++) {
          var cfg = crabCfg[i];
          var node = M_1.default.nodePool.createItem(this.crabPrefab);
          var topPos = Common_1.default.getPos(cfg.x, cfg.y, cfg.index);
          var tmpScaleHeight = 20;
          node["cfg"] = cfg;
          node.parent = this.gnomeParent;
          node.x = topPos.x - Common_1.default.GRID_W / 2;
          node.y = topPos.y + Common_1.default.GRID_H / 2;
          node.setScale((Common_1.default.GRID_H - tmpScaleHeight) / (node.height / (2 * (Math.floor(cfg.type / 2) + 1))));
          if (cfg.type % 2 == 0) {
            node.angle = 90;
            node.y -= node.width * node.scale;
            cfg.type < 2 && (node.x += tmpScaleHeight);
          } else cfg.type < 2 && (node.y -= tmpScaleHeight);
          if (cfg.x < (GameModel_1.default.GridSize.W - 1) / 2) {
            var item = node.getChildByName("item");
            item.scaleX = -item.scaleX;
          }
          this.crabAry[i] = node;
        }
      };
      GroundViewCtrl.prototype.initMonkeyTree = function(monkeyTreeCfg) {
        if (!monkeyTreeCfg) return;
        for (var i = 0; i < monkeyTreeCfg.length; i++) {
          var cfg = monkeyTreeCfg[i];
          var pos = cc.v2(cfg.x, cfg.y);
          var data = this.createMonkeyTree(Common_1.default.getPos(pos.x, pos.y, cfg.index));
          data.pos = pos;
          data.exp = 0;
          data.remainLabel = cc.find("qipao/count", data.tree.node).getComponent(cc.Label);
          this.monkeyTreeAry[i] = data;
          this.updateMoneyTreeState(i);
        }
      };
      GroundViewCtrl.prototype.initLawnmower = function(lawnmowerCfg) {
        if (!lawnmowerCfg) return;
        for (var i = 0; i < lawnmowerCfg.length; i++) {
          var cfg = lawnmowerCfg[i];
          var pos = cc.v2(cfg.x, cfg.y);
          var groundCell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, pos);
          groundCell && groundCell.change2TargetType(Constant_1.GroundType.Tuituji, cfg);
          GameModel_1.default.ins.CollectModel.collectPowerCells[cfg.type] = groundCell;
        }
      };
      GroundViewCtrl.prototype.initTurtles = function(turtlesCfg) {
        if (!turtlesCfg) return;
        for (var i = 0; i < turtlesCfg.length; i++) {
          var cfg = turtlesCfg[i];
          var pos = Common_1.default.getPos(cfg.x, cfg.y, cfg.index);
          var result = Common_1.default.createSpineNode(this.gnomeParent, this.turtlesPrefab, null, pos.add(cc.v2(Common_1.default.GRID_W / 2, -Common_1.default.GRID_H / 2)));
          this.turtlesAry[i] = {
            ctrl: result.ctrl,
            pos: cc.v2(cfg.x, cfg.y)
          };
        }
      };
      GroundViewCtrl.prototype.initGnome = function(gnomeCfg) {
        if (!gnomeCfg) return;
        for (var i = 0; i < gnomeCfg.length; i++) {
          var cfg = gnomeCfg[i];
          var node = M_1.default.nodePool.createItem(this.gnomePrefab);
          var topPos = Common_1.default.getPos(cfg.x, cfg.y, cfg.index);
          var tmpScaleHeight = 20;
          node.parent = this.gnomeParent;
          node.x = topPos.x - Common_1.default.GRID_W / 2;
          node.y = topPos.y + Common_1.default.GRID_H / 2;
          node.setScale(Common_1.default.GRID_H / (node.height / (2 * (Math.floor(cfg.type / 2) + 1))));
          if (cfg.type % 2 == 0) {
            node.angle = 90;
            node.y -= node.width * node.scale - tmpScaleHeight * node.scale;
          }
          this.gnomeAry[i] = node;
        }
      };
      GroundViewCtrl.prototype.playCrabAni = function(upLayer, index) {
        var _this = this;
        var item = this.crabAry[index];
        if (item) {
          item.parent = upLayer;
          item.setPosition(upLayer.convertToNodeSpaceAR(Common_1.default.getWorldPos(item)));
          var pxCtrl = item.getChildByName("item").getComponent(SpinePlayerCtrl_1.default);
          var cfg_1 = item["cfg"];
          var dir_1 = cc.v2(-1, 0);
          M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel, CollectModel_1.CollectType.crab);
          cfg_1.x < (GameModel_1.default.GridSize.W - 1) / 2 && (dir_1.x = 1);
          pxCtrl.play("pangxie2", 0, false, function() {
            item.destroy();
          });
          this.scheduleOnce(function() {
            GameModel_1.default.ins.getMgModel().onComplet(CollectModel_1.CollectType.crab, dir_1.x, cc.v2(cfg_1.x, cfg_1.y));
            _this.scheduleOnce(function() {
              var m = GameModel_1.default.ins.getMgModel().getModel(CollectModel_1.CollectType.crab);
              m && m.freeGrid(cc.v2(cfg_1.x, cfg_1.y), index);
            }, TimeConfig_1.GapTime.CrabStartedFallGap);
          }, TimeConfig_1.GapTime.CrabStartElimate);
        }
      };
      GroundViewCtrl.prototype.playTurtlesAni = function(upLayer, index) {
        var item = this.turtlesAry[index];
        if (item) {
          item.ctrl.node.parent = upLayer;
          item.ctrl.play("haigui_run", 0, false, function() {
            var node = item.ctrl.node;
            node.destroy();
          });
          this.scheduleOnce(function() {
            M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel, CollectModel_1.CollectType.turtles);
            GameModel_1.default.ins.getMgModel().onComplet(CollectModel_1.CollectType.turtles, index, item.pos);
          }, TimeConfig_1.GapTime.TurtlesOver);
        }
      };
      GroundViewCtrl.prototype.playFireflyAni = function(parent, selfPos, targetPos) {
        var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.Firefly, this.firefly);
        node.parent = parent;
        node.setPosition(parent.convertToNodeSpaceAR(this.waterParent.convertToWorldSpaceAR(selfPos)));
        ActionCtrl_1.default.ins.runCollectGem(node, targetPos, parent).then(function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.Firefly, node);
          M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel, CollectModel_1.CollectType.firefly);
        });
      };
      GroundViewCtrl.prototype.playGemAni = function(parent, selfPos, targetPos) {
        var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.GemNode, this.gemPrefab);
        node.parent = parent;
        node.setPosition(parent.convertToNodeSpaceAR(this.waterParent.convertToWorldSpaceAR(selfPos)));
        ActionCtrl_1.default.ins.runCollectGem(node, targetPos, parent).then(function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.GemNode, node);
          M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel, CollectModel_1.CollectType.gem);
        });
      };
      GroundViewCtrl.prototype.playGnomeAni = function(parent, index, targetPos) {
        var gn = this.gnomeAry[index];
        gn && ActionCtrl_1.default.ins.runCollectGnome(gn, targetPos, parent).then(function() {
          gn.destroy();
          M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel, CollectModel_1.CollectType.gnome);
        });
      };
      GroundViewCtrl.prototype.getGnomeAry = function() {
        return this.gnomeAry;
      };
      GroundViewCtrl.prototype.checkCollectMoveDistance = function(curView, maskNode) {
        var moveGap = 0;
        if (curView.height > 0) for (var key in this.gnomeAry) {
          var gnomeNode = this.gnomeAry[key];
          var wp = gnomeNode.parent.convertToWorldSpaceAR(gnomeNode.position);
          var mp = maskNode.convertToNodeSpaceAR(wp);
          if (!(mp.y < 0 && mp.y < maskNode.height / 3)) {
            moveGap = 0;
            break;
          }
          var distance = Math.abs(mp.y) + (0 != gnomeNode.angle ? gnomeNode.width : gnomeNode.height) * gnomeNode.scale;
          var maxDistance = curView.height / 2 - curView.y - maskNode.height / 2 + Common_1.default.GRID_H / 2;
          moveGap = distance > maxDistance ? maxDistance : distance;
        }
        return moveGap;
      };
      GroundViewCtrl.prototype.initBaseView = function(models) {
        var yLength = models.length;
        var xLength = models[0].length;
        var index = null;
        for (var y = 0; y <= yLength; y++) for (var x = 0; x <= xLength; x++) {
          var gItem = models[y] ? models[y][x] : null;
          var cmp = null;
          if (gItem) {
            null == index && (index = gItem.getMapIndex());
            var baseSprite = null;
            if (null != gItem.getType()) {
              var groundBase = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.GroundCell, this.groundBasePrefab);
              groundBase.setPosition(gItem.getPosition());
              baseSprite = groundBase.getComponent(cc.Sprite);
              this.setGroundSprite(baseSprite, x, y);
              groundBase.parent = this.borderParent;
              groundBase.zIndex = 2;
            }
            var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.GroundMulti, this.ItemPrefab);
            node["baseSprite"] = baseSprite;
            node.parent = this.multFuncParent;
            cmp = node.getComponent(ItemGroundCtrl_1.default);
            cmp.init(gItem, this.borderParent);
            gItem.extData = node;
            gItem.extCtrl = cmp;
          }
          this.showComplexItem(x, y, Constant_1.GroundType.Water);
          var borderCoff = this.getBorderSpriteName(x, y);
          Common_1.default.getGroundBorderInfo(borderCoff) && this.initBorderView(borderCoff, x, y, index);
        }
      };
      GroundViewCtrl.prototype.updateComlexIteamByPos = function(pos) {};
      GroundViewCtrl.prototype.showComplexItem = function(x, y, type) {
        var groundCoff = Common_1.default.getSpriteNameByType(x, y, this.models, type);
        "0000" != groundCoff && this.initViewByType(groundCoff, x, y, type);
      };
      GroundViewCtrl.prototype.setGroundSprite = function(sprite, x, y) {
        var startIndex = 0;
        switch (this.type) {
         case "water":
          startIndex = 0;
          break;

         case "grass":
          startIndex = 2;
          break;

         case "sand":
          startIndex = 4;
        }
        sprite.spriteFrame = this.baseFrames[startIndex];
      };
      GroundViewCtrl.prototype.getBorderSpriteName = function(x, y) {
        var coff = "";
        coff += this.getCellEmptyStatus(x - 1, y - 1);
        coff += this.getCellEmptyStatus(x, y - 1);
        coff += this.getCellEmptyStatus(x - 1, y);
        coff += this.getCellEmptyStatus(x, y);
        return coff;
      };
      GroundViewCtrl.prototype.initBorderView = function(coff, x, y, index) {
        var cfg = Common_1.default.getGroundBorderInfo(coff);
        var pos = Common_1.default.getPos(x, y, index);
        pos.x -= Common_1.default.GRID_W / 2;
        pos.y += Common_1.default.GRID_H / 2;
        this.createMiddleBorder(pos, coff);
        this.createUpBorder(pos, cfg, coff);
      };
      GroundViewCtrl.prototype.createMonkeyTree = function(pos) {
        var ctrls = {};
        var result = Common_1.default.createSpineNode(this.gnomeParent, this.monkeyTreePrefab, null, pos.add(cc.v2(Common_1.default.GRID_W / 2, -Common_1.default.GRID_H / 2)));
        ctrls.tree = result.ctrl;
        result.ctrl._setMix("yezishu_yaoshu", "yezishu_xiuxian");
        return ctrls;
      };
      GroundViewCtrl.prototype.getRandMonkeyTree = function() {
        var data = null;
        for (var key in this.monkeyTreeAry) {
          data = {
            index: key,
            data: this.monkeyTreeAry[key]
          };
          break;
        }
        return data;
      };
      GroundViewCtrl.prototype.monkeyTreeExpUp = function(upLayer, index) {
        var _this = this;
        var data = this.monkeyTreeAry[index];
        if (data) {
          data.exp++;
          data.remainLabel.string = "x" + (9 - data.exp % 9);
          data.exp % 9 == 0 && this.scheduleOnce(function() {
            _this.monkeyWakeUp(upLayer, index);
          }, .5);
        }
      };
      GroundViewCtrl.prototype.monkeyWakeUp = function(upLayer, index) {
        var data = this.monkeyTreeAry[index];
        if (data) {
          data.tree.play("yezishu_yaoshu", 0, false, function() {
            data.tree.play("yezishu_xiuxian", 0, true);
          });
          M_1.default.event.send(Event_1.Event.GameCMD.ChangeCell, Constant_1.CellType.Coconut);
        }
      };
      GroundViewCtrl.prototype.updateMoneyTreeState = function(index) {
        var data = this.monkeyTreeAry[index];
        data && this.scheduleOnce(function() {
          data.tree.play("yezishu_xiuxian", 0, true);
          var baseDirs = [ cc.v2(0, 0), cc.v2(1, 0), cc.v2(0, -1), cc.v2(1, -1), cc.v2(0, -2), cc.v2(1, -2) ];
          baseDirs.forEach(function(dir) {
            var cm = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, data.pos.add(dir));
            cm && cm.initMonkeyTreePos();
          });
        }, 0);
      };
      GroundViewCtrl.prototype.createMiddleBorder = function(pos, name) {
        "1101" != name && "1110" != name && "0110" != name && "1001" != name || (name = "1100");
        var frame = this.getBorderFrame(this.middleFrames, "m" + name, 3);
        if (frame) {
          var borderNode = new cc.Node();
          var sprite = borderNode.addComponent(cc.Sprite);
          sprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
          borderNode.parent = this.borderParent;
          borderNode.anchorY = 1;
          borderNode.zIndex = 1;
          sprite.spriteFrame = frame;
          var offset = cc.v2(0, -14);
          switch (name) {
           case "0100":
            borderNode.anchorX = 16 / 51.5;
            offset = cc.v2(0, Common_1.default.GRID_H / 2 - 8);
            break;

           case "1000":
            borderNode.anchorX = 1 - 16 / 51.5;
            offset = cc.v2(0, Common_1.default.GRID_H / 2 - 8);
            break;

           case "1100":
            borderNode.setContentSize(cc.size(Common_1.default.GRID_W, borderNode.height));
          }
          borderNode.setPosition(pos.add(offset));
        }
      };
      GroundViewCtrl.prototype.createUpBorder = function(pos, cfg, name) {
        var borderNode = new cc.Node();
        var sprite = borderNode.addComponent(cc.Sprite);
        sprite.trim = false;
        sprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
        borderNode.parent = this.borderParent;
        borderNode.name = name + "_" + cfg[0];
        borderNode.zIndex = 2;
        sprite.spriteFrame = this.getBorderFrame(this.borderFrames, cfg[0], 5);
        borderNode.setPosition(pos);
        borderNode.setScale(cfg[1]);
        borderNode.setContentSize(Common_1.default.GRID_W, Common_1.default.GRID_H);
      };
      GroundViewCtrl.prototype.getBorderFrame = function(container, sid, gapIndex) {
        var startIdx = 0;
        switch (this.type) {
         case "water":
          startIdx = 0;
          break;

         case "grass":
          startIdx = gapIndex;
          break;

         case "sand":
          startIdx = 2 * gapIndex;
        }
        var frame = null;
        for (var i = 5; i--; ) {
          var f = container[startIdx + i];
          if (f && f.name == this.type + "_" + sid) {
            frame = f;
            break;
          }
        }
        return frame;
      };
      GroundViewCtrl.prototype.initViewByType = function(coff, x, y, type) {
        var offset = cc.v2(-Common_1.default.GRID_W / 2, Common_1.default.GRID_H / 2);
        var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.ComplexGround);
        node.name = coff;
        var sprite = node.addComponent(cc.Sprite);
        sprite.spriteFrame = this.getFrameByType(coff, type);
        sprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
        sprite.trim = false;
        node.parent = this.waterParent;
        node.setPosition(Common_1.default.getPos(x, y).add(offset));
        node.setContentSize(cc.size(Common_1.default.GRID_W, Common_1.default.GRID_H));
      };
      GroundViewCtrl.prototype._saveComplexObject = function(x, y, node) {
        this._complexItemMap || (this._complexItemMap = []);
        this._complexItemMap[y] || (this._complexItemMap[y] = []);
        this._complexItemMap[y][x] = node;
      };
      GroundViewCtrl.prototype.getFrameByType = function(coff, type) {
        var result = null;
        var frames = type == Constant_1.GroundType.Water ? this.waterFrames : [];
        for (var i = frames.length; i--; ) {
          var water = frames[i];
          if (-1 != water.name.indexOf(coff)) {
            result = water;
            break;
          }
        }
        result || console.error("\u6ca1\u627e\u5230\u8d44\u6e90:-----\x3e", coff);
        return result;
      };
      GroundViewCtrl.prototype.getCellEmptyStatus = function(x, y) {
        var result = 1;
        this.models[y] && this.models[y][x] ? null == this.models[y][x].getType() && (result = 0) : result = 0;
        return result;
      };
      GroundViewCtrl.prototype.update = function(dt) {};
      __decorate([ property([ cc.SpriteFrame ]) ], GroundViewCtrl.prototype, "borderFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], GroundViewCtrl.prototype, "middleFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], GroundViewCtrl.prototype, "waterFrames", void 0);
      __decorate([ property(cc.Node) ], GroundViewCtrl.prototype, "borderParent", void 0);
      __decorate([ property(cc.Node) ], GroundViewCtrl.prototype, "waterParent", void 0);
      __decorate([ property(cc.Node) ], GroundViewCtrl.prototype, "multFuncParent", void 0);
      __decorate([ property(cc.Node) ], GroundViewCtrl.prototype, "gnomeParent", void 0);
      __decorate([ property(cc.Prefab) ], GroundViewCtrl.prototype, "gnomePrefab", void 0);
      __decorate([ property(cc.Prefab) ], GroundViewCtrl.prototype, "turtlesPrefab", void 0);
      __decorate([ property(cc.Prefab) ], GroundViewCtrl.prototype, "crabPrefab", void 0);
      __decorate([ property(cc.Prefab) ], GroundViewCtrl.prototype, "monkeyTreePrefab", void 0);
      __decorate([ property(cc.Prefab) ], GroundViewCtrl.prototype, "groundBasePrefab", void 0);
      __decorate([ property(cc.Prefab) ], GroundViewCtrl.prototype, "gemPrefab", void 0);
      __decorate([ property(cc.Prefab) ], GroundViewCtrl.prototype, "firefly", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], GroundViewCtrl.prototype, "baseFrames", void 0);
      GroundViewCtrl = __decorate([ ccclass ], GroundViewCtrl);
      return GroundViewCtrl;
    }(BaseView_1.default);
    exports.default = GroundViewCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/CustomComponent/SpinePlayerCtrl": "SpinePlayerCtrl",
    "../../../Base/Manager/M": "M",
    "../../Common/ActionCtrl": "ActionCtrl",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Const/TimeConfig": "TimeConfig",
    "../Model/CollectModel": "CollectModel",
    "../Model/GameModel": "GameModel",
    "./BaseView": "BaseView",
    "./ItemGroundCtrl": "ItemGroundCtrl"
  } ],
  GroupAnimatCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "46c3dFIOoROf5mZ5TnBtGv8", "GroupAnimatCtrl");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SingletonFactory_1 = require("../../Base/Utils/SingletonFactory");
    var GameModel_1 = require("../Match3/Model/GameModel");
    var Common_1 = require("./Common");
    var TimeConfig_1 = require("../Data/Const/TimeConfig");
    var M_1 = require("../../Base/Manager/M");
    var Event_1 = require("../Data/Const/Event");
    var Constant_1 = require("../Data/Const/Constant");
    var Util_1 = require("../../Base/Utils/Util");
    var AudioCtrl_1 = require("./AudioCtrl");
    var GroupAnimatCtrl = function() {
      function GroupAnimatCtrl() {
        this.rainbowStarCount = 0;
        this.overShootCount = 0;
        this._animationPool = null;
        this._animationPool = new Set();
      }
      GroupAnimatCtrl.prototype.playCrabBomb = function(closeAry) {
        var timeline = this.createTimeLine();
        closeAry.forEach(function(cm) {
          cm && cm.extCtrl && timeline.add(gsap.TweenLite.delayedCall(TimeConfig_1.GapTime.CrabElimateGap, function() {
            cm.extCtrl.elimate(0, null, Constant_1.ElimateType.Bomb6);
          }, []));
        });
      };
      GroupAnimatCtrl.prototype.playRainbowBomb = function(closeAry, centerPos, callback) {
        var _this = this;
        var timeline = this.createTimeLine();
        this.rainbowStarCount = 0;
        var size = closeAry.size;
        var time = TimeConfig_1.GapTime.RainbowShootStarCount / size;
        closeAry.forEach(function(cm) {
          if (cm) {
            var targetPos = Common_1.default.convertCurWorldPos(cm.getPosition());
            timeline.add(gsap.TweenLite.delayedCall(time, _this.onExecSingleRainbowShoot.bind(_this), [ targetPos, centerPos, size, callback ]));
          }
        });
      };
      GroupAnimatCtrl.prototype.overShootEff = function(closeAry, centerPos, callback) {
        var _this = this;
        var timeline = this.createTimeLine();
        this.overShootCount = 0;
        var size = closeAry.size;
        var time = 2 / size;
        time = time > .15 ? .15 : time;
        closeAry.forEach(function(cm) {
          if (cm) {
            var targetPos = Common_1.default.convertCurWorldPos(cm.getPosition());
            timeline.add(gsap.TweenLite.delayedCall(time, _this.onExecOverShootEff.bind(_this), [ targetPos, centerPos, size, cm, callback ]));
          }
        });
      };
      GroupAnimatCtrl.prototype.playRowElimate = function(centerPos, closeAry, elimateType, callback) {
        if (closeAry.size > 0) {
          var timeline1 = this.createTimeLine();
          var timeline2 = this.createTimeLine();
          var left_1 = [];
          var right_1 = [];
          var isLeft_1 = true;
          closeAry.forEach(function(cell) {
            if (cell) {
              isLeft_1 && cell.pos.equals(centerPos) && (isLeft_1 = false);
              isLeft_1 ? left_1.push(cell) : right_1.push(cell);
            }
          });
          for (var i = left_1.length; i--; ) timeline1.add(gsap.TweenLite.delayedCall(TimeConfig_1.GapTime.RowAndColElimate, this.onExecSingleElimateEff, [ left_1[i], callback, elimateType ]));
          for (var i = 0; i < right_1.length; i++) timeline2.add(gsap.TweenLite.delayedCall(TimeConfig_1.GapTime.RowAndColElimate, this.onExecSingleElimateEff, [ right_1[i], callback, elimateType ]));
        }
      };
      GroupAnimatCtrl.prototype.playCreateBomb = function(type, pos, isExec, time, insertGrid, groupId) {
        void 0 === time && (time = .3);
        void 0 === insertGrid && (insertGrid = true);
        void 0 === groupId && (groupId = null);
        var timeline = this.createTimeLine();
        timeline.add(gsap.TweenLite.delayedCall(time, function() {
          var bombCell = GameModel_1.default.ins.createCell({
            cfg: {
              type: type
            },
            pos: pos,
            createType: GameModel_1.CreateType.Midway,
            isInsert2Ary: insertGrid
          });
          bombCell.isBombReady = false;
          bombCell.isExecBomb = isExec;
          isExec || bombCell.continue2Fall(true);
        }));
      };
      GroupAnimatCtrl.prototype.playCellBombShocks = function(centerPos, bombLv, depth, lastRound) {
        void 0 === depth && (depth = 2);
        void 0 === lastRound && (lastRound = false);
        var timeline = this.createTimeLine();
        for (var i = 0; i < depth; i++) {
          var ary = Common_1.default.getAroundCircleCells(centerPos, bombLv + i, !lastRound && i == depth - 1);
          timeline.add(gsap.TweenLite.delayedCall(TimeConfig_1.GapTime.BombShocks, this.onExecBombAftershocks, [ ary, i, centerPos ]));
        }
      };
      GroupAnimatCtrl.prototype.gameOverCreateBomb = function(count, callback) {
        var timeline = this.createTimeLine();
        for (var i = count; i--; ) timeline.add(gsap.TweenLite.delayedCall(.2, callback));
      };
      GroupAnimatCtrl.prototype.onExecBombAftershocks = function(cells, distance, centerPos) {
        distance = 5 - distance;
        cells.forEach(function(cell) {
          cell && cell.extCtrl && cell.extCtrl.execBombAfterShocks(distance, centerPos);
        });
      };
      GroupAnimatCtrl.prototype.onExecSingleElimateEff = function(cm, callback, type) {
        cm && cm.extCtrl && cm.extCtrl.elimate(0, cm.pos, type, callback);
      };
      GroupAnimatCtrl.prototype.onExecSingleRainbowShoot = function(targetPos, centerPos, size, callback) {
        var _this = this;
        M_1.default.event.send(Event_1.Event.Effect.ShootStar, centerPos, targetPos, function() {
          _this.rainbowStarCount++;
          if (_this.rainbowStarCount >= size) {
            _this.rainbowStarCount = 0;
            gsap.TweenLite.delayedCall(TimeConfig_1.GapTime.RainbowShootOverElimate, function() {
              callback();
            });
          }
        });
      };
      GroupAnimatCtrl.prototype.onExecOverShootEff = function(targetPos, centerPos, size, cm, callback) {
        var _this = this;
        var bombContent = [ Constant_1.CellType.Bomb2, Constant_1.CellType.Bomb3, Constant_1.CellType.Bomb1 ];
        GameModel_1.default.ins.stepLimit--;
        M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel);
        M_1.default.event.send(Event_1.Event.Effect.OverShoot, centerPos, targetPos, cm, function(c) {
          M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.partytime_change);
          _this.overShootCount++;
          c.change2Bomb(bombContent[Util_1.Util.Tool.rangeInt(0, bombContent.length, false)]);
          c.extCtrl && c.extCtrl.playCreateBombAni();
          if (_this.overShootCount >= size) {
            _this.overShootCount = 0;
            callback();
          }
        });
      };
      GroupAnimatCtrl.prototype.createTimeLine = function() {
        var timeline = new gsap.TimelineMax();
        timeline.autoRemoveChildren = true;
        this._insertPool(timeline);
        return timeline;
      };
      GroupAnimatCtrl.prototype._insertPool = function(timeLine) {
        var _this = this;
        this._animationPool.add({
          ts: Date.now(),
          v: timeLine
        });
        this._animationPool.forEach(function(item) {
          Date.now() - item.ts > 3e3 && _this._animationPool.delete(item);
        });
      };
      GroupAnimatCtrl.prototype.destory = function() {
        var _this = this;
        this._animationPool.forEach(function(item) {
          item.v.kill();
          _this._animationPool.delete(item);
        });
      };
      GroupAnimatCtrl.ins = SingletonFactory_1.SingletonFactory.getInstance(GroupAnimatCtrl);
      return GroupAnimatCtrl;
    }();
    exports.default = GroupAnimatCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "../../Base/Utils/SingletonFactory": "SingletonFactory",
    "../../Base/Utils/Util": "Util",
    "../Data/Const/Constant": "Constant",
    "../Data/Const/Event": "Event",
    "../Data/Const/TimeConfig": "TimeConfig",
    "../Match3/Model/GameModel": "GameModel",
    "./AudioCtrl": "AudioCtrl",
    "./Common": "Common"
  } ],
  GuestPanelCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f2fb8ykLLlGv7a884A6Ip25", "GuestPanelCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var M_1 = require("../../../Base/Manager/M");
    var Paths_1 = require("../../../Base/Utils/Paths");
    var StorageMgr_1 = require("../../../Base/Manager/StorageMgr");
    var Constant_1 = require("../../Data/Const/Constant");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var FriendsEventIds;
    (function(FriendsEventIds) {
      FriendsEventIds[FriendsEventIds["Zan"] = 10] = "Zan";
      FriendsEventIds[FriendsEventIds["CancelZan"] = 11] = "CancelZan";
      FriendsEventIds[FriendsEventIds["Share"] = 12] = "Share";
    })(FriendsEventIds = exports.FriendsEventIds || (exports.FriendsEventIds = {}));
    var GuestPanelCtrl = function(_super) {
      __extends(GuestPanelCtrl, _super);
      function GuestPanelCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.nameLab = null;
        _this.zanLab = null;
        _this.zan2Lab = null;
        _this.scoreLab = null;
        _this.headIcon = null;
        _this.zanHeart = null;
        _this._uid = null;
        _this._zanList = null;
        return _this;
      }
      GuestPanelCtrl.prototype.init = function(data) {
        if (data) {
          this._uid = M_1.default.runtime.CurrentGuestUserid = data.id;
          this.scoreLab.string = data.score;
          this.updateZanLab(data.appreciate || 0);
          this.nameLab.string = data.nickname;
          this._fillIcon(data.avatar_url);
          this._syncZanState();
        }
      };
      GuestPanelCtrl.prototype._syncZanState = function() {
        this.zanHeart.isChecked = false;
        this._zanList || (this._zanList = new Set(StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.ZanList, [])));
        if (this._zanList.has(this._uid)) {
          this.zanHeart.isChecked = true;
          "0" == this.zanLab.string && this.updateZanLab(1);
        }
      };
      GuestPanelCtrl.prototype.updateZanLab = function(count) {
        this.zanLab.string = count.toString();
        this.zan2Lab.string = this.zanLab.string;
      };
      GuestPanelCtrl.prototype._fillIcon = function(url) {
        var _this = this;
        url && Common_1.default.getRemotPic(url, this.headIcon.node.getContentSize()).then(function(frame) {
          frame ? _this.headIcon.spriteFrame = frame : console.error("get avatar error!");
        });
      };
      GuestPanelCtrl.prototype.onZanClick = function() {
        if (!this._zanList.has(this._uid)) {
          this._zanList.add(this._uid);
          M_1.default.net.interactive(this._uid, FriendsEventIds.Zan);
          StorageMgr_1.StorageMgr.Storage.setObject(Constant_1.NativeKey.ZanList, Array.from(this._zanList), true);
          this.updateZanLab((Number(this.zanLab.string) + 1).toString());
          this.zanHeart.isChecked = true;
        }
      };
      GuestPanelCtrl.prototype.onShareClick = function() {
        var _this = this;
        M_1.default.platform.share("\u6211\u597d\u53cbxxx\u7684\u9152\u5e97", Paths_1.default.ShareImgPath + "level_share_45.png").then(function() {
          M_1.default.net.interactive(_this._uid, FriendsEventIds.Share);
        });
      };
      __decorate([ property(cc.Label) ], GuestPanelCtrl.prototype, "nameLab", void 0);
      __decorate([ property(cc.Label) ], GuestPanelCtrl.prototype, "zanLab", void 0);
      __decorate([ property(cc.Label) ], GuestPanelCtrl.prototype, "zan2Lab", void 0);
      __decorate([ property(cc.Label) ], GuestPanelCtrl.prototype, "scoreLab", void 0);
      __decorate([ property(cc.Sprite) ], GuestPanelCtrl.prototype, "headIcon", void 0);
      __decorate([ property(cc.Toggle) ], GuestPanelCtrl.prototype, "zanHeart", void 0);
      GuestPanelCtrl = __decorate([ ccclass ], GuestPanelCtrl);
      return GuestPanelCtrl;
    }(cc.Component);
    exports.default = GuestPanelCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../../Base/Manager/StorageMgr": "StorageMgr",
    "../../../Base/Utils/Paths": "Paths",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant"
  } ],
  GuideCondition: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9bed4fEwmBC14GiOkls+Ntp", "GuideCondition");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../Script/Base/Manager/M");
    var Common_1 = require("../Script/Logic/Common/Common");
    var GuideCondition = function() {
      function GuideCondition() {}
      GuideCondition.checkCondition = function(config) {
        var condition = config.if;
        if (!condition) return true;
        var splitArr = condition.split(",");
        if (!splitArr) return true;
        var conditionRet = true;
        for (var i in splitArr) {
          var funcStrPre = splitArr[i];
          var hasNot = -1 != funcStrPre.indexOf("-");
          var funcStr = funcStrPre.replace("-", "");
          var ret = GuideCondition[funcStr](config.param);
          if (hasNot && ret) {
            conditionRet = false;
            break;
          }
          if (!hasNot && !ret) {
            conditionRet = false;
            break;
          }
        }
        return conditionRet;
      };
      GuideCondition.checkLevel = function(param) {
        var curLevel = M_1.default.runtime.CurLevel;
        if (curLevel == param) return true;
        return false;
      };
      GuideCondition.checkAtMatch3Scene = function() {
        return "Match3" == Common_1.default.curScene;
      };
      GuideCondition.checkAtLevelScene = function() {
        return "LevelScene" == Common_1.default.curScene;
      };
      GuideCondition.checkAtMapScene = function() {
        return "MapScene" == Common_1.default.curScene;
      };
      GuideCondition.checkUIOpen = function(param) {
        var root = cc.find("UIRoot");
        return !!root.getChildByName(param);
      };
      GuideCondition.checkNoDialogUI = function() {
        return true;
      };
      GuideCondition.checkLevelFinished = function(param) {
        var lvData = M_1.default.runtime.getNativeLvData(param);
        if (lvData && lvData.star > 0) return true;
        return false;
      };
      return GuideCondition;
    }();
    exports.GuideCondition = GuideCondition;
    window["GuideCondition"] = GuideCondition;
    cc._RF.pop();
  }, {
    "../Script/Base/Manager/M": "M",
    "../Script/Logic/Common/Common": "Common"
  } ],
  GuideData: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "21f8dYXwHRCmbBr35l3Uehs", "GuideData");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideData = function() {
      function GuideData() {}
      Object.defineProperty(GuideData, "firstFailed", {
        get: function() {
          return this._firstFailed;
        },
        set: function(v) {
          this._firstFailed = v;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GuideData, "finishedTaskName", {
        get: function() {
          return this._finishedTaskName;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GuideData, "markNoConditionTask", {
        get: function() {
          return this._markNoConditionTask;
        },
        enumerable: true,
        configurable: true
      });
      GuideData.pushNoConditionTask = function(filename) {
        -1 == this._markNoConditionTask.indexOf(filename) && this._markNoConditionTask.push(filename);
      };
      GuideData.pushFinishedTask = function(filename) {
        -1 == this._finishedTaskName.indexOf(filename) && this._finishedTaskName.push(filename);
      };
      GuideData.clearMarkTasks = function() {
        this._finishedTaskName = [];
        this._markNoConditionTask = [];
      };
      GuideData._firstFailed = false;
      GuideData._finishedTaskName = [];
      GuideData._markNoConditionTask = [];
      return GuideData;
    }();
    exports.GuideData = GuideData;
    window["GuideData"] = GuideData;
    cc._RF.pop();
  }, {} ],
  GuideUtils: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "478d24lRFJECpxw2IU0DYHA", "GuideUtils");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var LoadGuide_1 = require("./LoadGuide");
    var StorageMgr_1 = require("../Script/Base/Manager/StorageMgr");
    var ReportMgr_1 = require("../Script/Base/Manager/ReportMgr");
    var DLogId_1 = require("../Script/Base/Utils/DLogId");
    var GodGuide_1 = require("./GodGuide");
    var GuideData_1 = require("./GuideData");
    var M_1 = require("../Script/Base/Manager/M");
    var EGuideStart;
    (function(EGuideStart) {
      EGuideStart[EGuideStart["None"] = 0] = "None";
      EGuideStart[EGuideStart["ConditionNotReach"] = 1] = "ConditionNotReach";
      EGuideStart[EGuideStart["Stop"] = 2] = "Stop";
    })(EGuideStart = exports.EGuideStart || (exports.EGuideStart = {}));
    var GuideUtils = function() {
      function GuideUtils() {}
      Object.defineProperty(GuideUtils, "godGuideNode", {
        get: function() {
          if (this._loadGuide && this._loadGuide._godGuide) return this._loadGuide._godGuide.node;
          return null;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GuideUtils, "stopGuide", {
        get: function() {
          return this._stopGuide;
        },
        set: function(stop) {
          this._stopGuide = stop;
          this.godGuideNode && this.godGuideNode.hasEventListener(GodGuide_1.EGuideEvent.Stop) && this.godGuideNode.emit(GodGuide_1.EGuideEvent.Stop);
        },
        enumerable: true,
        configurable: true
      });
      GuideUtils.initGuide = function(guidePrefab) {
        if (null != cc.find("GuideLayer")) return;
        return;
        var guideLayer;
        var loadGuide;
      };
      GuideUtils.getGuideConfig = function() {
        return [ "_Guide_level1", "_Guide_level3", "_Guide_level4" ];
      };
      GuideUtils.setLoadGuide = function(loadGuide) {
        this._loadGuide = loadGuide;
      };
      Object.defineProperty(GuideUtils, "curGuideId", {
        get: function() {
          return this._curGuideId;
        },
        set: function(id) {
          this._curGuideId = id;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(GuideUtils, "doneGuideId", {
        set: function(id) {
          this._doneGuideId[id] = 1;
          StorageMgr_1.StorageMgr.Storage.setObject(StorageMgr_1.StorageMgr.Storage.GuideIds, this._doneGuideId, true);
          GuideUtils.reportDLog(id);
        },
        enumerable: true,
        configurable: true
      });
      GuideUtils.checkGuideDone = function(id) {
        if (this._doneGuideId[id]) return true;
        return false;
      };
      GuideUtils.checkGuide = function() {
        if (this._loadGuide) {
          this._stopGuide = false;
          GuideUtils.logError("Guide checkGuide");
          this._loadGuide.runTask();
        }
      };
      GuideUtils.pushGuide = function(taskName, forceRun) {
        void 0 === forceRun && (forceRun = false);
        this._loadGuide && this._loadGuide.pushTask(taskName, forceRun);
      };
      GuideUtils.logError = function(message) {
        var optionalParams = [];
        for (var _i = 1; _i < arguments.length; _i++) optionalParams[_i - 1] = arguments[_i];
      };
      GuideUtils.onMatch3Begin = function(level) {
        console.error("\u5173\u5361\u5f00\u59cb", level);
        11 == level ? this.pushGuide("_Guide_level11") : GuideData_1.GuideData.firstFailed && GuideUtils.pushGuide("_Guide_level11_1");
      };
      GuideUtils.onMatch3Over = function(level, isWin) {
        !isWin && level > 11 && (this.checkGuideDone(1100001) || (GuideData_1.GuideData.firstFailed = true));
      };
      GuideUtils.onMatch3Next = function(level) {
        10 == level ? GuideUtils.pushGuide("_Guide_level10") : 15 == level ? GuideUtils.pushGuide("_Guide_level15_rank") : 30 == level && GuideUtils.pushGuide("_Guide_level30");
      };
      GuideUtils.onMatch3SelectShowTarget = function(level) {
        level || (level = M_1.default.runtime.getMatch3Level());
        21 != level || GuideUtils.checkGuideDone(2101) || GuideUtils.pushGuide("_Guide_level21");
      };
      GuideUtils.checkMatchNext = function() {
        var noNext = [ 1001, 1501, 3001 ];
        if (-1 != noNext.indexOf(GuideUtils.curGuideId)) return false;
        return true;
      };
      GuideUtils.reportDLog = function(guidId) {
        var dlogStr = null;
        if (2 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv1_click; else if (3 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv1_clickgame; else if (302 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv3_clickback; else if (303 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv3_clickbeach; else if (3030004 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv3_clickrepair1; else if (3030005 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv3_clickbuy1; else if (3030008 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv3_clickchoose1; else if (3031002 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv3_clickrepair2; else if (3031004 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv3_clickbuy2; else if (3031006 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv3_clickgame; else if (402 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv4_clickback; else if (403 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv4_clickbeach; else if (405 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv4_clickrepair2; else if (406 == guidId) dlogStr = DLogId_1.DLogIdTutorial.lv4_clickbuy2; else {
          if (408 != guidId) return;
          dlogStr = DLogId_1.DLogIdTutorial.lv4_clickchoose2;
        }
        ReportMgr_1.default.ins.reportTutorial(dlogStr);
      };
      GuideUtils.test = function(index) {
        var async = require("async");
        var tasks = [ 1, 2, 3, 4, 5, 6 ];
        async.eachSeries(tasks, function(task, cb) {
          console.error(task);
          2 == task || cb();
        }, function(err) {
          console.error("run ", err);
        });
      };
      GuideUtils._loadGuide = null;
      GuideUtils._curGuideId = -1;
      GuideUtils._doneGuideId = {};
      GuideUtils._stopGuide = false;
      return GuideUtils;
    }();
    exports.GuideUtils = GuideUtils;
    window["GuideUtils"] = GuideUtils;
    cc._RF.pop();
  }, {
    "../Script/Base/Manager/M": "M",
    "../Script/Base/Manager/ReportMgr": "ReportMgr",
    "../Script/Base/Manager/StorageMgr": "StorageMgr",
    "../Script/Base/Utils/DLogId": "DLogId",
    "./GodGuide": "GodGuide",
    "./GuideData": "GuideData",
    "./LoadGuide": "LoadGuide",
    async: "async"
  } ],
  HotelCfg: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f1907UHIypDoIAtfu4NbgZR", "HotelCfg");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var HotelCfg = function() {
      function HotelCfg(data) {
        this.id = data.id;
        this.roomId = data.roomId;
        this.openLevel = data.openLevel;
        this.roomName = data.roomName;
        this.finishReward = data.finishReward;
      }
      return HotelCfg;
    }();
    exports.default = HotelCfg;
    cc._RF.pop();
  }, {} ],
  HotelData: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f05c9SviIpIgbSgwdnxKEya", "HotelData");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var StorageMgr_1 = require("../../Base/Manager/StorageMgr");
    var M_1 = require("../../Base/Manager/M");
    var Constant_1 = require("../Data/Const/Constant");
    var HotelData = function() {
      function HotelData() {}
      HotelData.initData = function() {
        this._roomData = {};
        var roomDatas = StorageMgr_1.StorageMgr.Storage.getObject(StorageMgr_1.StorageMgr.Storage.HotelData, {});
        for (var i in roomDatas) this._roomData[Number(i)] = roomDatas[i];
        this._slotData = StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.HotelSlotData, {});
        console.error("\u623f\u95f4\u6570\u636e", this._roomData);
      };
      HotelData.addLockItem = function(roomid, slotid, item) {
        this._lockItems || (this._lockItems = new Map());
        this._lockItems.set([ roomid, slotid ].join("_"), item);
      };
      HotelData.getLockItem = function(roomid, slotid) {
        var result = null;
        this._lockItems && (result = this._lockItems.get([ roomid, slotid ].join("_")));
        return result;
      };
      HotelData.getSubSlotStateData = function(data) {
        return this._slotData[[ data.roomId, data.slotId, data.subId ].join("")];
      };
      HotelData.setSubSlotStateData = function(data) {
        var key = [ data.roomId, data.slotId, data.subId ].join("");
        this._slotData[key] = 1;
        StorageMgr_1.StorageMgr.Storage.setObject(Constant_1.NativeKey.HotelSlotData, this._slotData);
      };
      HotelData.getHotelRoomConfig = function(roomId) {
        var configs = M_1.default.table.HotelCfg.getData();
        for (var i = 0; i < configs.length; ++i) if (configs[i].roomId == roomId) return configs[i];
        return null;
      };
      HotelData.getRoomSlotsConfig = function(roomId) {
        var configs = M_1.default.table.HotelRoomCfg.getData();
        var curConfig = new Map();
        configs.forEach(function(iconfig, i) {
          iconfig.roomId == roomId && curConfig.set(i, iconfig);
        });
        return curConfig;
      };
      HotelData.getSlotBonusByCount = function(roomId, count) {
        var data = M_1.default.table.SlotBonusCfg.getData();
        var result = 0;
        var roomCfg = [];
        for (var i = 0; i < data.length; i++) data[i].roomId == roomId && roomCfg.push(data[i]);
        for (var i = 0; i < roomCfg.length; i++) {
          var cfg = roomCfg[i];
          var nextCfg = roomCfg[i + 1];
          if (nextCfg && count >= cfg.count && count < nextCfg.count) {
            result = cfg.bonus;
            break;
          }
          if (count == cfg.count) {
            result = cfg.bonus;
            break;
          }
        }
        return result;
      };
      HotelData.getSlotConfig = function(roomId, slotId) {
        return M_1.default.table.HotelRoomCfg.getByPrimaryKeys(roomId, slotId);
      };
      HotelData.getRoomData = function(roomId) {
        return this._roomData[roomId];
      };
      HotelData.getSlotData = function(roomId, slotId) {
        var roomData = this.getRoomData(roomId);
        if (roomData && roomData.slots && roomData.slots[slotId]) return roomData.slots[slotId];
        return null;
      };
      HotelData.updateSlotData = function(slotData) {
        var roomData = this.getRoomData(slotData.roomId);
        null == roomData && (roomData = {
          roomId: slotData.roomId,
          slots: {},
          score: 0
        });
        roomData.slots[slotData.slotId] = slotData;
        this._roomData[slotData.roomId] = roomData;
        StorageMgr_1.StorageMgr.Storage.setObject(StorageMgr_1.StorageMgr.Storage.HotelData, this._roomData, true);
        return roomData;
      };
      HotelData.getScoreByRoomId = function(roomId) {
        var roomData = this.getRoomData(roomId);
        return roomData && roomData.score || 0;
      };
      HotelData.updateRoomScore = function(roomId, score) {
        var roomData = this.getRoomData(roomId);
        roomData ? roomData.score = score : roomData = {
          roomId: roomId,
          slots: {},
          score: score
        };
        this._roomData[roomId] = roomData;
        StorageMgr_1.StorageMgr.Storage.setObject(StorageMgr_1.StorageMgr.Storage.HotelData, this._roomData, true);
      };
      HotelData._roomData = null;
      HotelData._slotData = null;
      HotelData._lockItems = null;
      return HotelData;
    }();
    exports.HotelData = HotelData;
    window["HotelData"] = HotelData;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "../../Base/Manager/StorageMgr": "StorageMgr",
    "../Data/Const/Constant": "Constant"
  } ],
  HotelManager: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9ee38Kl/4lPILv8TfumUtUm", "HotelManager");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var HotelData_1 = require("./HotelData");
    var HotelManager = function() {
      function HotelManager() {}
      HotelManager.getSlotUnlock = function(roomId, slotId) {
        var slotData = HotelData_1.HotelData.getSlotData(roomId, slotId);
        return slotData && slotData.state > 0;
      };
      HotelManager.checkSlotUnlockShow = function(roomId, index) {
        var config = HotelData_1.HotelData.getRoomSlotsConfig(roomId);
        var isOpen = this.getSlotUnlock(roomId, config.get(index - 1).slotId);
        if (isOpen) return false;
        var lastGroupIndex = index % 2 == 0 ? [ index - 3, index - 2 ] : [ index - 2, index - 1 ];
        for (var i = 0; i < lastGroupIndex.length; ++i) {
          if (lastGroupIndex[i] <= 0) continue;
          if (!this.getSlotUnlock(roomId, config.get(lastGroupIndex[i] - 1).slotId)) return false;
        }
        return true;
      };
      HotelManager.checkRoomSlotsFinished = function(roomId) {
        if (roomId < 1) return true;
        var result = true;
        var configs = HotelData_1.HotelData.getRoomSlotsConfig(roomId).values();
        var cfg = null;
        while (cfg = configs.next(), !cfg.done) {
          var checkOpen = HotelManager.getSlotUnlock(roomId, cfg.value.slotId);
          if (!checkOpen) {
            result = false;
            break;
          }
        }
        return result;
      };
      return HotelManager;
    }();
    exports.HotelManager = HotelManager;
    cc._RF.pop();
  }, {
    "./HotelData": "HotelData"
  } ],
  HotelMapCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "095c2+1R8ZGWpYnts/931L/", "HotelMapCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../Base/Manager/M");
    var HotelManager_1 = require("./HotelManager");
    var HotelRoomCtrl_1 = require("./HotelRoomCtrl");
    var EventMgr_1 = require("../../Base/Manager/EventMgr");
    var Event_1 = require("../Data/Const/Event");
    var UIMgr_1 = require("../../Base/Manager/UIMgr");
    var UIData_1 = require("../Data/Interface/UIData");
    var Apps_1 = require("../../Base/Apps");
    var Common_1 = require("../Common/Common");
    var Paths_1 = require("../../Base/Utils/Paths");
    var RoomDetailCtrl_1 = require("./RoomDetailCtrl");
    var HotelData_1 = require("./HotelData");
    var Util_1 = require("../../Base/Utils/Util");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var HotelMapCtrl = function(_super) {
      __extends(HotelMapCtrl, _super);
      function HotelMapCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.scrollView = null;
        _this.bg = null;
        _this.roomView = null;
        _this.roomItemContent = null;
        _this.roomItemPrefab = null;
        _this.roomBotItemPrefab = null;
        _this.roomTopItemPrefab = null;
        _this._curOpenRoomId = 0;
        _this._roomItemMaps = new Map();
        _this._roomItemGapY = 372;
        _this._roomItemTopHeight = 450;
        _this._roomItemHeight = 703;
        _this._roomItemBotHeight = 703;
        _this._roomItemTopGapY = 300;
        _this._roomItemBottomGapY = 230;
        _this.roomCounter = 0;
        return _this;
      }
      HotelMapCtrl.prototype.initRoomItem = function() {
        var _this = this;
        Apps_1.default.isDebug && Util_1.Util.Tool.showDebugView(true);
        this.roomItemContent.removeAllChildren();
        this._roomItemMaps.clear();
        var datas = M_1.default.table.HotelCfg.getData();
        var lastRoomId = 0;
        datas.forEach(function(data, index) {
          var lastRoomFinished = HotelManager_1.HotelManager.checkRoomSlotsFinished(lastRoomId);
          if (lastRoomFinished) {
            _this.addRoomItem(data.roomId);
            _this._curOpenRoomId = data.roomId;
          }
          lastRoomId = data.roomId;
        });
      };
      HotelMapCtrl.prototype.addRoomTopItem = function() {
        var roomNode = cc.instantiate(this.roomTopItemPrefab);
        this.roomItemContent.addChild(roomNode);
        roomNode.setPosition(cc.v2(0, -roomNode.height / 2 - this._roomItemTopGapY));
      };
      HotelMapCtrl.prototype.addRoomItem = function(roomId) {
        var _this = this;
        this.roomCounter++;
        Common_1.default.getRes(Paths_1.default.RoomPrefabPath + "RoomItem_" + roomId, cc.Prefab).then(function(roomPrefab) {
          if (roomPrefab) {
            var curChildNum = _this.roomItemContent.childrenCount - 1;
            var roomNode = cc.instantiate(roomPrefab);
            roomNode.name = roomId.toString();
            roomNode.setPosition(cc.v2(0, _this._getRoomPosY(curChildNum) - _this._roomItemHeight / 2));
            roomNode.parent = _this.roomItemContent;
            var roomCtrl = roomNode.getComponent(HotelRoomCtrl_1.HotelRoomCtrl);
            roomCtrl.init(roomId);
            _this._roomItemMaps.set(roomId, roomCtrl);
            _this.roomCounter--;
            _this.roomCounter <= 0 && _this._loadRoomItemComplet();
          }
        });
      };
      HotelMapCtrl.prototype._loadRoomItemComplet = function() {
        if (this.roomItemContent.childrenCount <= 1) {
          this.addRoomBotItem();
          this.addRoomBotItem();
        } else this.addRoomBotItem();
        this.updateRoomItemZIndex();
        this.updateScrollHeight();
        this.roomItemContent.childrenCount > 3 && this.scrollTo(this._curOpenRoomId);
      };
      HotelMapCtrl.prototype.addRoomBotItem = function() {
        var curChildNum = this.roomItemContent.childrenCount - 1;
        var roomNode = cc.instantiate(this.roomBotItemPrefab);
        this.roomItemContent.addChild(roomNode);
        roomNode.setPosition(cc.v2(0, this._getRoomPosY(curChildNum) - this._roomItemBotHeight / 2));
      };
      HotelMapCtrl.prototype._getRoomPosY = function(index) {
        return -this._roomItemTopGapY - this._roomItemTopHeight / 2 + (this._roomItemHeight - this._roomItemTopHeight) / 2 - 25 - index * this._roomItemHeight + (1 + index - 1) * this._roomItemGapY;
      };
      HotelMapCtrl.prototype.updateRoomItemZIndex = function() {
        var numChildren = this.roomItemContent.childrenCount;
        for (var i = numChildren - 1; i >= 0; --i) {
          var child = this.roomItemContent.children[i];
          child.zIndex = numChildren - 1 - i;
        }
      };
      HotelMapCtrl.prototype.updateScrollHeight = function() {
        var numChildren = this.roomItemContent.childrenCount;
        this.scrollView.content.height = this.roomItemContent.height = (numChildren - 2) * this._roomItemHeight - (numChildren - 1) * this._roomItemGapY + this._roomItemBotHeight + this._roomItemTopHeight + this._roomItemTopGapY + this._roomItemBottomGapY;
        this.bg.height = 1.2 * this.scrollView.content.height;
        this.bg.y += .1 * this.bg.height;
      };
      HotelMapCtrl.prototype.scrollTo = function(curRoomId) {
        var _this = this;
        this.scheduleOnce(function() {
          var curRoom = _this.getRoomCtrlById(1);
          if (curRoom) {
            var roomPos = curRoom.node.position;
            var ss = Math.abs(roomPos.y / _this.roomItemContent.height);
            console.error(roomPos.y, _this.roomItemContent.height, 1 - ss, ss);
            _this.scrollView.scrollTo(cc.v2(0, 1 - ss));
          }
        }, .02);
      };
      HotelMapCtrl.prototype.onScrollEvent = function(sender, eventType, customEventData) {
        console.error(eventType);
        eventType == cc.ScrollView.EventType.SCROLL_BEGAN && EventMgr_1.default.ins.send(Event_1.Event.Hotel.MapScrollBegin);
      };
      HotelMapCtrl.prototype.doUnlockRoom = function() {
        M_1.default.tips.show("\u606d\u559c\u5f00\u542f\u4e86\u65b0\u623f\u95f4!");
        this.initRoomItem();
      };
      HotelMapCtrl.prototype.getRoomCtrlById = function(roomId) {
        return this._roomItemMaps.get(roomId);
      };
      HotelMapCtrl.prototype.updateInfo = function() {};
      HotelMapCtrl.prototype.onClickHead = function() {
        Apps_1.default.isOpenGM && UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GMView);
      };
      HotelMapCtrl.prototype.onLoad = function() {
        var _this = this;
        EventMgr_1.default.ins.register(Event_1.Event.UI.UpdateCurrency, this.updateInfo, this);
        EventMgr_1.default.ins.register(Event_1.Event.Hotel.RoomFinished, this.doUnlockRoom, this);
        M_1.default.init();
        M_1.default.table.execute().then(function() {
          HotelData_1.HotelData.initData();
          _this.initRoomItem();
          _this.updateInfo();
          _this.initTouch();
        });
      };
      HotelMapCtrl.prototype.onTouchBegin = function(event) {
        var pos = event.touch.getLocation();
      };
      HotelMapCtrl.prototype.onRoomClick = function(event) {
        var rooms = this._roomItemMaps.values();
        var room = null;
        while (room = rooms.next(), !room.done) {
          var ctrl = room.value;
          if (ctrl.touch(event.touch.getLocation())) {
            console.error("\u70b9\u5230\u4e86!", ctrl.name);
            this._showBigView(Number(ctrl.node.name));
            break;
          }
        }
      };
      HotelMapCtrl.prototype._showBigView = function(roomId) {
        this.roomView.active = true;
        this.roomView.getComponent(RoomDetailCtrl_1.default).show(roomId);
      };
      HotelMapCtrl.prototype.initTouch = function() {};
      HotelMapCtrl.prototype.onDestroy = function() {
        this._roomItemMaps.clear();
        EventMgr_1.default.ins.unRegister(Event_1.Event.UI.UpdateCurrency, this.updateInfo, this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.Hotel.RoomFinished, this.doUnlockRoom, this);
      };
      __decorate([ property(cc.ScrollView) ], HotelMapCtrl.prototype, "scrollView", void 0);
      __decorate([ property(cc.Node) ], HotelMapCtrl.prototype, "bg", void 0);
      __decorate([ property(cc.Node) ], HotelMapCtrl.prototype, "roomView", void 0);
      __decorate([ property(cc.Node) ], HotelMapCtrl.prototype, "roomItemContent", void 0);
      __decorate([ property(cc.Prefab) ], HotelMapCtrl.prototype, "roomItemPrefab", void 0);
      __decorate([ property(cc.Prefab) ], HotelMapCtrl.prototype, "roomBotItemPrefab", void 0);
      __decorate([ property(cc.Prefab) ], HotelMapCtrl.prototype, "roomTopItemPrefab", void 0);
      HotelMapCtrl = __decorate([ ccclass ], HotelMapCtrl);
      return HotelMapCtrl;
    }(cc.Component);
    exports.HotelMapCtrl = HotelMapCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Apps": "Apps",
    "../../Base/Manager/EventMgr": "EventMgr",
    "../../Base/Manager/M": "M",
    "../../Base/Manager/UIMgr": "UIMgr",
    "../../Base/Utils/Paths": "Paths",
    "../../Base/Utils/Util": "Util",
    "../Common/Common": "Common",
    "../Data/Const/Event": "Event",
    "../Data/Interface/UIData": "UIData",
    "./HotelData": "HotelData",
    "./HotelManager": "HotelManager",
    "./HotelRoomCtrl": "HotelRoomCtrl",
    "./RoomDetailCtrl": "RoomDetailCtrl"
  } ],
  HotelRoomCfg: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "508baU8zyVEJKefr30j1/Nf", "HotelRoomCfg");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var HotelRoomCfg = function() {
      function HotelRoomCfg(data) {
        this.id = null;
        this.roomId = null;
        this.slotId = null;
        this.slotName = null;
        this.prices = null;
        this.animationOpts = null;
        this.id = data.id;
        this.roomId = data.roomId;
        this.slotId = data.slotId;
        this.slotName = data.name;
        this._parsePrices(data.price);
        this._parseAnimationOpt(data.animation);
      }
      HotelRoomCfg.prototype._parseAnimationOpt = function(opt) {
        if (opt) {
          this.animationOpts = new Map();
          var opts = opt.split("|");
          for (var i = 1; i <= opts.length; i++) this.animationOpts.set(i, !!Number(opts[i - 1]));
        }
      };
      HotelRoomCfg.prototype._parsePrices = function(data) {
        if (!this.prices && data) {
          this.prices = [];
          for (var i = 0; i < data.length; i++) {
            var sd = data[i].split("|");
            sd[0] && this.prices.push({
              id: i + 1,
              itemId: Number(sd[0]),
              num: Number(sd[1]),
              extData: Number(sd[2])
            });
          }
        }
      };
      return HotelRoomCfg;
    }();
    exports.default = HotelRoomCfg;
    cc._RF.pop();
  }, {} ],
  HotelRoomCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "18fc4pNVkdC57cbXHmEfvza", "HotelRoomCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var RoomSlotCtrl_1 = require("./RoomSlotCtrl");
    var Event_1 = require("../Data/Const/Event");
    var EventMgr_1 = require("../../Base/Manager/EventMgr");
    var HotelData_1 = require("./HotelData");
    var HotelManager_1 = require("./HotelManager");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var HotelRoomCtrl = function(_super) {
      __extends(HotelRoomCtrl, _super);
      function HotelRoomCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.bgSp = null;
        _this.unlockItem = null;
        _this.maskItem = null;
        _this.LabelTips = null;
        _this.slotThumbnail = [];
        _this._roomId = 1;
        _this._detailCtrl = null;
        _this._currentTouchPoints = null;
        _this._slotMap = null;
        return _this;
      }
      HotelRoomCtrl.prototype.onLoad = function() {
        EventMgr_1.default.ins.register(Event_1.Event.Hotel.SlotUnlock, this.onSlotUnlock, this);
        this._currentTouchPoints = this.getComponent(cc.PolygonCollider).points;
      };
      HotelRoomCtrl.prototype.onDestroy = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Hotel.SlotUnlock, this.onSlotUnlock, this);
        this._slotMap.clear();
      };
      HotelRoomCtrl.prototype.init = function(roomId, roomData, detailCtrl) {
        void 0 === detailCtrl && (detailCtrl = null);
        this._detailCtrl = detailCtrl;
        this._roomId = roomId;
        this.updateSlots(roomData);
      };
      HotelRoomCtrl.prototype.getSoltFrames = function(slotId) {
        var rst = [];
        for (var i = 0; i < 3; i++) rst.push(this.slotThumbnail[16 * i + (slotId - 1)]);
        return rst;
      };
      HotelRoomCtrl.prototype.touch = function(pos) {
        return cc.Intersection.pointInPolygon(this.node.convertToNodeSpaceAR(pos), this._currentTouchPoints);
      };
      HotelRoomCtrl.prototype.updateSlots = function(roomData) {
        var _this = this;
        var config = HotelData_1.HotelData.getRoomSlotsConfig(this._roomId);
        config.forEach(function(value, key) {
          if (15 == value.slotId) for (var i = 1; i <= 3; i++) _this._initSlotById(roomData, value.slotId, "slot" + value.slotId + "_" + i, key); else _this._initSlotById(roomData, value.slotId, "slot" + value.slotId, key);
        });
      };
      HotelRoomCtrl.prototype._initSlotById = function(roomData, slotId, slotName, index) {
        var slotCtrl = this.node.getChildByName(slotName).getComponent(RoomSlotCtrl_1.RoomSlotCtrl);
        var data = null;
        data = roomData ? this._getGuestSlotData(roomData, slotId) : HotelData_1.HotelData.getSlotData(this._roomId, slotId);
        slotCtrl.init(index + 1, roomData ? roomData.roomId : this._roomId, slotId, data, this.unlockItem, !!this._detailCtrl);
        this._slotMap || (this._slotMap = new Map());
        var rst = this._slotMap.get(slotId);
        if (15 == slotId) {
          rst || (rst = []);
          rst.push(slotCtrl);
        } else rst = slotCtrl;
        this._slotMap.set(slotId, rst);
      };
      HotelRoomCtrl.prototype._getGuestSlotData = function(roomData, slotId) {
        if (roomData && roomData.slots && roomData.slots[slotId]) return roomData.slots[slotId];
      };
      HotelRoomCtrl.prototype.onSlotUnlock = function(data) {
        var _this = this;
        if (this._roomId != data.roomId) return;
        var roomdata = HotelData_1.HotelData.updateSlotData(data);
        this._detailCtrl && this._detailCtrl.updateSlotData(roomdata);
        var result = this.getSlot(data.slotId);
        result && (result instanceof Array ? result.forEach(function(ctrl) {
          _this._unLockSlot(ctrl, data.subId);
        }) : this._unLockSlot(result, data.subId));
      };
      HotelRoomCtrl.prototype._unLockSlot = function(slotCtrl, subId) {
        var _this = this;
        slotCtrl && slotCtrl.doUnlock(subId, function() {
          _this.updateSlots(null);
          var finished = HotelManager_1.HotelManager.checkRoomSlotsFinished(_this._roomId);
          finished;
        });
      };
      HotelRoomCtrl.prototype.getSlot = function(slotId) {
        var result = null;
        if (15 == slotId) {
          result = [];
          for (var i = 1; i <= 3; i++) result.push(this.node.getChildByName("slot" + slotId + "_" + i).getComponent(RoomSlotCtrl_1.RoomSlotCtrl));
        } else result = this.node.getChildByName("slot" + slotId).getComponent(RoomSlotCtrl_1.RoomSlotCtrl);
        return result;
      };
      __decorate([ property(cc.Sprite) ], HotelRoomCtrl.prototype, "bgSp", void 0);
      __decorate([ property(cc.Prefab) ], HotelRoomCtrl.prototype, "unlockItem", void 0);
      __decorate([ property(cc.Mask) ], HotelRoomCtrl.prototype, "maskItem", void 0);
      __decorate([ property(cc.Label) ], HotelRoomCtrl.prototype, "LabelTips", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], HotelRoomCtrl.prototype, "slotThumbnail", void 0);
      HotelRoomCtrl = __decorate([ ccclass ], HotelRoomCtrl);
      return HotelRoomCtrl;
    }(cc.Component);
    exports.HotelRoomCtrl = HotelRoomCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/EventMgr": "EventMgr",
    "../Data/Const/Event": "Event",
    "./HotelData": "HotelData",
    "./HotelManager": "HotelManager",
    "./RoomSlotCtrl": "RoomSlotCtrl"
  } ],
  HotelUiCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "ae5danQxXxPV4LorP+MIYQH", "HotelUiCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../Base/Manager/M");
    var BaseConst_1 = require("../../Base/BaseConst");
    var Common_1 = require("../Common/Common");
    var Constant_1 = require("../Data/Const/Constant");
    var Util_1 = require("../../Base/Utils/Util");
    var Event_1 = require("../Data/Const/Event");
    var BuyPowerCtrl_1 = require("../Common/UI/BuyPowerCtrl");
    var Apps_1 = require("../../Base/Apps");
    var UIMgr_1 = require("../../Base/Manager/UIMgr");
    var UIData_1 = require("../Data/Interface/UIData");
    var GuideUtils_1 = require("../../../GodGuide/GuideUtils");
    var CloudView_1 = require("../SimulationOperation/View/Map/CloudView");
    var HotelViewCtrl_1 = require("./HotelViewCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var HotelUiCtrl = function(_super) {
      __extends(HotelUiCtrl, _super);
      function HotelUiCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.topNode = null;
        _this.buyPowerPanel = null;
        _this.buyPowerBtn = null;
        _this.bottomBox = null;
        _this.coinLabel = null;
        _this.diamondLabel = null;
        _this.powerLabel = null;
        _this.countDownLabel = null;
        _this.lvLabelOnStartBtn = null;
        _this.avatarSprite = null;
        _this.rankPanel = null;
        _this.hotelView = null;
        _this._orginBottomBoxPosY = null;
        _this._startPos = null;
        _this._movePos = null;
        return _this;
      }
      HotelUiCtrl.prototype.onLoad = function() {
        if (cc.sys.localStorage.getItem(M_1.default.runtime.getCurrencyKey(BaseConst_1.CurrencyId.Power))) {
          var pownum = cc.sys.localStorage.getItem(M_1.default.runtime.getCurrencyKey(BaseConst_1.CurrencyId.Power));
          if (pownum < Constant_1.MaxPowerCount) {
            var nowTime = new Date().getTime();
            var hideTime = cc.sys.localStorage.getItem("HideTime");
            var min = (nowTime - hideTime) / 6e4;
            var addnum = Math.min(Math.floor(min / 5), Constant_1.MaxPowerCount - pownum);
            M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, addnum);
          }
        } else M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, 30);
        this._initView();
        this._initEvent();
        this._initTouch();
        this._checkHavaReward();
        this._onUpdateReminTime();
        this._checkOfflineReward();
        this._checkJumpSceneTask();
      };
      HotelUiCtrl.prototype.onDestroy = function() {
        this._destoryEvent();
      };
      HotelUiCtrl.prototype._destoryEvent = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.UpdateCurrency, this._onUpdateCrrencyView, this);
        M_1.default.event.unRegister(Event_1.Event.UI.UpdateRemainAddPowerTime, this._onUpdateReminTime, this);
        cc.game.off(cc.game.EVENT_HIDE, this.onGameHide, this);
      };
      HotelUiCtrl.prototype._initEvent = function() {
        M_1.default.event.register(Event_1.Event.UI.UpdateCurrency, this._onUpdateCrrencyView, this);
        M_1.default.event.register(Event_1.Event.UI.UpdateRemainAddPowerTime, this._onUpdateReminTime, this);
        cc.game.on(cc.game.EVENT_HIDE, this.onGameHide, this);
      };
      HotelUiCtrl.prototype._initTouch = function() {
        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this._touchCancel, this);
        this.node.on(cc.Node.EventType.TOUCH_START, this._touchStart, this);
        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._touchMove, this);
        this.node.on(cc.Node.EventType.TOUCH_END, this._touchEnd, this);
      };
      HotelUiCtrl.prototype._initView = function() {
        this._initLevelDisplay();
        this._initCrrencyDisplay();
        this._checkAuth();
        this._orginBottomBoxPosY = this.bottomBox.y;
        if (Util_1.Util.Tool.isIpx()) {
          var widget = this.topNode.getComponent(cc.Widget);
          widget.top = 70;
          widget.updateAlignment();
        }
      };
      HotelUiCtrl.prototype._touchStart = function(event) {
        this._startPos = event.touch.getLocation();
      };
      HotelUiCtrl.prototype._touchEnd = function(event) {
        var _this = this;
        if (this._movePos && this._startPos && Math.abs(this._startPos.x - this._movePos.x) < 100 && this._startPos.y < 200 && this._movePos.y > this._startPos.y && Math.abs(this._movePos.y - this._startPos.y) > 100) {
          var a0 = cc.moveTo(.2, cc.v2(0, this.bottomBox.y + 50));
          var a1 = cc.moveTo(.1, cc.v2(0, this.bottomBox.y - 100));
          var a2 = cc.callFunc(function() {
            UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.CloudView, CloudView_1.ICloudData.OpenHotel, function() {
              _this.node.active = false;
              _this.hotelView.active = true;
              _this.hotelView.getComponent(HotelViewCtrl_1.default).init();
            }, function() {});
          });
          this.bottomBox.runAction(cc.sequence(a0, a1, a2));
        }
        this._touchCancel();
      };
      HotelUiCtrl.prototype._touchCancel = function() {
        this._startPos = null;
        this._movePos = null;
      };
      HotelUiCtrl.prototype._touchMove = function(event) {
        this._startPos && (this._movePos = event.touch.getLocation());
      };
      HotelUiCtrl.prototype._initLevelDisplay = function() {
        this.lvLabelOnStartBtn.string = "" + M_1.default.runtime.getMatch3Level();
      };
      HotelUiCtrl.prototype._checkAuth = function() {
        var _this = this;
        M_1.default.platform.getUserInfo().then(function(info) {
          var result = null;
          result = info ? new Promise(function(resolve) {
            return resolve(info);
          }) : M_1.default.platform.createAuthButton({
            x: 0,
            y: 0,
            w: cc.winSize.width,
            h: cc.winSize.height
          });
          return result;
        }).then(function(userinfo) {
          if (userinfo) {
            M_1.default.net.login(true);
            _this._updateAvatar(userinfo);
          }
        });
      };
      HotelUiCtrl.prototype._onUpdateCrrencyView = function(type, count) {
        void 0 === count && (count = 0);
        this._initCrrencyDisplay();
        var label = this[M_1.default.runtime.getCurrencyKey(type) + "Lab"];
        if (label) if (type == BaseConst_1.CurrencyId.Power) {
          var curPower = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power);
          label.string = curPower + "/" + Constant_1.MaxPowerCount;
          this.buyPowerBtn.active = !(curPower >= Constant_1.MaxPowerCount);
        } else if (type == BaseConst_1.CurrencyId.Coin) {
          var v = count.toString();
          type == BaseConst_1.CurrencyId.Coin && (v = Common_1.default.bytesToSize(count));
          label.string = v;
        } else type == BaseConst_1.CurrencyId.Diamond && (label.string = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Diamond));
      };
      HotelUiCtrl.prototype._updateAvatar = function(userinfo) {
        var _this = this;
        userinfo.avatarUrl && Common_1.default.getRemotPic(userinfo.avatarUrl).then(function(frame) {
          frame && (_this.avatarSprite.spriteFrame = frame);
        });
      };
      HotelUiCtrl.prototype._initCrrencyDisplay = function() {
        this.coinLabel.string = M_1.default.runtime.getFormateCoin();
        this.diamondLabel.string = M_1.default.runtime.getCurrencyStr(BaseConst_1.CurrencyId.Diamond);
        var curPower = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power);
        this.powerLabel.string = curPower + "/" + Constant_1.MaxPowerCount;
        this.buyPowerBtn.active = !(curPower > Constant_1.MaxPowerCount);
      };
      HotelUiCtrl.prototype._showSelectDlg = function() {
        var next = GuideUtils_1.GuideUtils.checkMatchNext();
        next && UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.SelectShowTarget, {
          type: UIData_1.UIHudDef.SelectShowTarget,
          data: M_1.default.runtime.SelectLevel || null
        });
      };
      HotelUiCtrl.prototype.onAddBtnClick = function(event, customValue) {
        var type = BaseConst_1.CurrencyId.Diamond;
        switch (customValue) {
         case "coin":
          type = BaseConst_1.CurrencyId.Coin;
          this._addCrrencyClick(type);
          break;

         case "power":
          type = BaseConst_1.CurrencyId.Power;
          this.buyPowerPanel.getComponent(BuyPowerCtrl_1.default).show();
          break;

         case "diamond":
          type = BaseConst_1.CurrencyId.Diamond;
          this._addCrrencyClick(type);
        }
      };
      HotelUiCtrl.prototype.initBottomBoxPosition = function() {
        this._orginBottomBoxPosY && (this.bottomBox.y = this._orginBottomBoxPosY);
      };
      HotelUiCtrl.prototype.onLevelBtnClick = function() {
        M_1.default.runtime.SelectLevel = 0;
        this._showSelectDlg();
      };
      HotelUiCtrl.prototype.onShowDailyTaskBtnClick = function() {
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.DailyTaskPanel);
      };
      HotelUiCtrl.prototype._showOfflineRewar = function(currentSerTime) {
        var lastTime = M_1.default.runtime.getLastTime();
        var gapTime = currentSerTime - lastTime;
        if (lastTime > 1e6 && gapTime > Constant_1.PowerConfig.NormalTime) {
          var offlinePower = gapTime / Constant_1.PowerConfig.NormalTime >> 0;
          var cpower = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power);
          if (cpower < Constant_1.MaxPowerCount) {
            var power = cpower + offlinePower > Constant_1.MaxPowerCount ? Constant_1.MaxPowerCount - cpower : offlinePower;
            if (power > 0) {
              M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, power);
              M_1.default.tips.show("" + Constant_1.WaringTips.OfflineReward + power + "\u80fd\u91cf");
            }
          }
        }
        M_1.default.runtime.setServerTime(currentSerTime);
        this._onUpdateReminTime();
      };
      HotelUiCtrl.prototype._onUpdateReminTime = function(curTimeCount) {
        void 0 === curTimeCount && (curTimeCount = 0);
        if (M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power) >= Constant_1.MaxPowerCount) this.countDownLabel.string = "\u6ee1\u4e86!"; else if (curTimeCount) {
          var time = Constant_1.PowerConfig.NormalTime - curTimeCount % Constant_1.PowerConfig.NormalTime;
          this.countDownLabel.string = Util_1.Util.Timer.conversionTime(time, true, {
            m: true
          }) + " \u540e +" + Constant_1.PowerConfig.NormalCount;
        }
      };
      HotelUiCtrl.prototype._checkJumpSceneTask = function() {
        if (M_1.default.runtime.SceneTask && M_1.default.runtime.SceneTask.length > 0) {
          var task = M_1.default.runtime.SceneTask.shift();
          switch (task) {
           case Constant_1.SceneTaskKey.ShowTargetDlg:
            M_1.default.ui.closeAllUI();
            this._showSelectDlg();
          }
          this._checkJumpSceneTask();
        }
      };
      HotelUiCtrl.prototype._checkOfflineReward = function() {
        var _this = this;
        M_1.default.runtime.getServerConfig().then(function(config) {
          config && _this._showOfflineRewar(config.time);
        });
      };
      HotelUiCtrl.prototype._checkHavaReward = function() {
        if (M_1.default.runtime.RewardTask && M_1.default.runtime.RewardTask.reward) {
          var rewards = Common_1.default.getRewardArray(M_1.default.runtime.RewardTask.reward);
          M_1.default.ui.showUI(UIData_1.UIHudDef.OpenBox, {
            config: {
              rewards: rewards,
              text: M_1.default.runtime.RewardTask.text
            }
          });
          M_1.default.runtime.RewardTask = null;
          GuideUtils_1.GuideUtils.stopGuide = true;
        }
      };
      HotelUiCtrl.prototype._addCrrencyClick = function(type) {
        Apps_1.default.isDebug && M_1.default.runtime.addCurrency(type, 1e7);
      };
      HotelUiCtrl.prototype.onGameHide = function() {
        var nowTime = new Date().getTime();
        cc.sys.localStorage.setItem("HideTime", nowTime);
      };
      __decorate([ property(cc.Node) ], HotelUiCtrl.prototype, "topNode", void 0);
      __decorate([ property(cc.Node) ], HotelUiCtrl.prototype, "buyPowerPanel", void 0);
      __decorate([ property(cc.Node) ], HotelUiCtrl.prototype, "buyPowerBtn", void 0);
      __decorate([ property(cc.Node) ], HotelUiCtrl.prototype, "bottomBox", void 0);
      __decorate([ property(cc.Label) ], HotelUiCtrl.prototype, "coinLabel", void 0);
      __decorate([ property(cc.Label) ], HotelUiCtrl.prototype, "diamondLabel", void 0);
      __decorate([ property(cc.Label) ], HotelUiCtrl.prototype, "powerLabel", void 0);
      __decorate([ property(cc.Label) ], HotelUiCtrl.prototype, "countDownLabel", void 0);
      __decorate([ property(cc.Label) ], HotelUiCtrl.prototype, "lvLabelOnStartBtn", void 0);
      __decorate([ property(cc.Sprite) ], HotelUiCtrl.prototype, "avatarSprite", void 0);
      __decorate([ property(cc.Node) ], HotelUiCtrl.prototype, "rankPanel", void 0);
      __decorate([ property(cc.Node) ], HotelUiCtrl.prototype, "hotelView", void 0);
      HotelUiCtrl = __decorate([ ccclass ], HotelUiCtrl);
      return HotelUiCtrl;
    }(cc.Component);
    exports.default = HotelUiCtrl;
    cc._RF.pop();
  }, {
    "../../../GodGuide/GuideUtils": "GuideUtils",
    "../../Base/Apps": "Apps",
    "../../Base/BaseConst": "BaseConst",
    "../../Base/Manager/M": "M",
    "../../Base/Manager/UIMgr": "UIMgr",
    "../../Base/Utils/Util": "Util",
    "../Common/Common": "Common",
    "../Common/UI/BuyPowerCtrl": "BuyPowerCtrl",
    "../Data/Const/Constant": "Constant",
    "../Data/Const/Event": "Event",
    "../Data/Interface/UIData": "UIData",
    "../SimulationOperation/View/Map/CloudView": "CloudView",
    "./HotelViewCtrl": "HotelViewCtrl"
  } ],
  HotelViewCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "becb3ZRwRNHxbWxObmwUma6", "HotelViewCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../Base/Manager/M");
    var UIData_1 = require("../Data/Interface/UIData");
    var CloudView_1 = require("../SimulationOperation/View/Map/CloudView");
    var HotelUiCtrl_1 = require("./HotelUiCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var HotelViewCtrl = function(_super) {
      __extends(HotelViewCtrl, _super);
      function HotelViewCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.scrollView = null;
        _this.mainView = null;
        _this.topBox = null;
        _this._isTouchTopBox = false;
        _this._boxOrginPosY = null;
        return _this;
      }
      HotelViewCtrl.prototype.onLoad = function() {
        var _this = this;
        this.topBox.on(cc.Node.EventType.TOUCH_START, this.onTopBoxClick, this);
        this.node.on("bounce-top", this._onBounceTop, this);
        this.scheduleOnce(function() {
          _this._boxOrginPosY || (_this._boxOrginPosY = _this.topBox.y);
        }, .3);
      };
      HotelViewCtrl.prototype.init = function() {
        this._boxOrginPosY && (this.topBox.y = this._boxOrginPosY);
      };
      HotelViewCtrl.prototype.onTopBoxClick = function() {
        this._isTouchTopBox = true;
      };
      HotelViewCtrl.prototype._cancelBoxClick = function() {
        this._isTouchTopBox = false;
        console.error("_cancelBoxClick");
      };
      HotelViewCtrl.prototype._onBounceTop = function() {
        var _this = this;
        if (this._isTouchTopBox) {
          var a0 = cc.moveTo(.2, cc.v2(0, this.topBox.y - 50));
          var a1 = cc.moveTo(.1, cc.v2(0, this.topBox.y + 100));
          var a2 = cc.callFunc(function() {
            M_1.default.ui.showUI(UIData_1.UIHudDef.CloudView, CloudView_1.ICloudData.OpenHotel, function() {
              _this.node.active = false;
              _this.mainView.active = true;
              _this.mainView.getComponent(HotelUiCtrl_1.default).initBottomBoxPosition();
            }, function() {});
          });
          this.topBox.runAction(cc.sequence(a0, a1, a2));
        }
        this._cancelBoxClick();
      };
      __decorate([ property(cc.ScrollView) ], HotelViewCtrl.prototype, "scrollView", void 0);
      __decorate([ property(cc.Node) ], HotelViewCtrl.prototype, "mainView", void 0);
      __decorate([ property(cc.Node) ], HotelViewCtrl.prototype, "topBox", void 0);
      HotelViewCtrl = __decorate([ ccclass ], HotelViewCtrl);
      return HotelViewCtrl;
    }(cc.Component);
    exports.default = HotelViewCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "../Data/Interface/UIData": "UIData",
    "../SimulationOperation/View/Map/CloudView": "CloudView",
    "./HotelUiCtrl": "HotelUiCtrl"
  } ],
  HttpRequest: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "dc9f6UFauBFiJuzPC1b2vtw", "HttpRequest");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var NetBase_1 = require("./NetBase");
    var Log_1 = require("../Utils/Log");
    var Apps_1 = require("../Apps");
    var DefaultTimeout = 3e3;
    var requestCachePool = new Map();
    var HttpRequest = function(_super) {
      __extends(HttpRequest, _super);
      function HttpRequest(url, method, headers, data, isJsonFromat, rspType) {
        void 0 === headers && (headers = null);
        void 0 === data && (data = null);
        void 0 === isJsonFromat && (isJsonFromat = false);
        void 0 === rspType && (rspType = null);
        var _this = _super.call(this) || this;
        _this.data = null;
        _this.method = null;
        _this.rspType = null;
        _this.headers = null;
        _this.isJsonFromat = false;
        _this.requestID = null;
        _this.request = null;
        _this.reqCompletedCallback = null;
        _this.url = url;
        _this.data = data;
        _this.method = method;
        _this.rspType = rspType;
        _this.headers = headers;
        _this._isReady = true;
        _this.isJsonFromat = isJsonFromat;
        return _this;
      }
      HttpRequest.prototype.execute = function() {
        var _this = this;
        return new Promise(function(resolve) {
          if (_this.isReady) if (Apps_1.default.isOpenNet) {
            _this.reqCompletedCallback = resolve;
            _this.connect();
          } else resolve({
            code: 0
          }); else resolve(null);
        });
      };
      HttpRequest.prototype.cancel = function() {
        this.resultHandler(null);
        this.destory();
      };
      HttpRequest.prototype.onReadyStateChange = function(evt) {
        if (evt && evt.target !== this.request) return;
        if (this.request.readyState == XMLHttpRequest.DONE) if (this.request.status >= 200 && this.request.status < 400) {
          this.resultHandler(this.request.responseText);
          this.destory();
        } else {
          this.onError("ErrorCode " + this.request.status);
          this.resultHandler(this.request.responseText);
          this.destory();
        }
      };
      HttpRequest.prototype.onProgress = function() {};
      HttpRequest.prototype.onTimeOut = function() {
        this.onError("Time out!");
      };
      HttpRequest.prototype.onError = function(err) {
        Log_1.Log.d("request Error ! \n url:" + this.url + " \n method:" + this.method + " \n requestID:" + this.requestID, err);
        if (!this.isAutoRetry || this.retryCount >= this.retryMaxCount) {
          this.resultHandler(null);
          this.destory();
        } else this.retry(err);
      };
      HttpRequest.prototype.connect = function() {
        this.request = new XMLHttpRequest();
        this.setResponseType();
        this.request.open(this.method, this.url, true);
        this.request.timeout = DefaultTimeout * this.retryCount;
        this.request.ontimeout = this.onTimeOut.bind(this);
        this.request.onerror = this.onError.bind(this);
        this.request.onreadystatechange = this.onReadyStateChange.bind(this);
        this.request.onprogress = this.onProgress.bind(this);
        this.addHeaders(this.headers);
        this.requestID = this.getRequestId();
        try {
          requestCachePool.set(this.requestID, this);
        } catch (err) {
          this.onError(err);
        }
      };
      HttpRequest.prototype.retry = function(err) {
        var _this = this;
        if (this.retryCount < this.retryMaxCount) {
          this.retryCount++;
          this.destory();
          setTimeout(function() {
            _this.connect();
          }, 1e3 * this.retryCount);
        } else this.onError(err);
      };
      HttpRequest.prototype.destory = function() {
        requestCachePool.delete(this.requestID);
        if (this.request) {
          this.request.ontimeout = null;
          this.request.onerror = null;
          this.request.onreadystatechange = null;
          this.request.onprogress = null;
          try {
            this.request.abort();
          } catch (error) {}
        }
      };
      HttpRequest.prototype.resultHandler = function(result) {
        if (this.reqCompletedCallback && requestCachePool.get(this.requestID)) {
          if (this.isJsonFromat) try {
            result = JSON.parse(result);
          } catch (error) {
            try {
              result = JSON.parse(result);
            } catch (error) {
              console.error(error);
            }
          }
          this.reqCompletedCallback(result);
        }
      };
      HttpRequest.prototype.addHeaders = function(headers) {
        if (headers) for (var key in headers) {
          var value = headers[key];
          this.request.setRequestHeader(key, value);
          "Content-Type" == key && value.indexOf("json") > 0 && (this.isJsonFromat = true);
        }
      };
      HttpRequest.prototype.setResponseType = function() {
        this.rspType && (this.request.responseType = this.rspType);
      };
      return HttpRequest;
    }(NetBase_1.default);
    exports.HttpRequest = HttpRequest;
    (function(HttpRequest) {
      var METHOD;
      (function(METHOD) {
        METHOD["GET"] = "GET";
        METHOD["POST"] = "POST";
      })(METHOD = HttpRequest.METHOD || (HttpRequest.METHOD = {}));
    })(HttpRequest || (HttpRequest = {}));
    exports.HttpRequest = HttpRequest;
    cc._RF.pop();
  }, {
    "../Apps": "Apps",
    "../Utils/Log": "Log",
    "./NetBase": "NetBase"
  } ],
  ILevel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "230cehJa3dIf5L5yZULM5GN", "ILevel");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    cc._RF.pop();
  }, {} ],
  IPlatform: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "5ba8cILAa5BPqClnVmR5kPS", "IPlatform");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Options = function() {
      function Options() {}
      return Options;
    }();
    exports.Options = Options;
    cc._RF.pop();
  }, {} ],
  ITutorial: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "46d3ahtgbpBAYyXUhu6J/i5", "ITutorial");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EMoveType;
    (function(EMoveType) {
      EMoveType[EMoveType["up"] = 0] = "up";
      EMoveType[EMoveType["down"] = 1] = "down";
      EMoveType[EMoveType["left"] = 2] = "left";
      EMoveType[EMoveType["right"] = 3] = "right";
      EMoveType[EMoveType["click"] = 4] = "click";
    })(EMoveType = exports.EMoveType || (exports.EMoveType = {}));
    cc._RF.pop();
  }, {} ],
  InfoPanelCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "66365FI5kZETLe/pwz9l3ID", "InfoPanelCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../../Base/Manager/M");
    var GameModel_1 = require("../../Model/GameModel");
    var Event_1 = require("../../../Data/Const/Event");
    var CollectItemCtrl_1 = require("./CollectItemCtrl");
    var RuntimeMgr_1 = require("../../../Data/RuntimeMgr");
    var EnergyModel_1 = require("../../Model/EnergyModel");
    var Common_1 = require("../../../Common/Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var InfoPanelCtrl = function(_super) {
      __extends(InfoPanelCtrl, _super);
      function InfoPanelCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.stepLable = null;
        _this.currentLvLable = null;
        _this.scoreLable = null;
        _this.collectContent = null;
        _this.collectItemPrefab = null;
        _this.energyProgress = null;
        _this.colletctPool = null;
        _this.progress = 0;
        _this.max = 0;
        return _this;
      }
      InfoPanelCtrl.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.UI.UpdateInfoPanel, this.onUpdateInfo, this);
        M_1.default.event.register(Event_1.Event.GameCMD.EnergyStorage, this.updataEnergy, this);
      };
      InfoPanelCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.UpdateInfoPanel, this.onUpdateInfo, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.EnergyStorage, this.updataEnergy, this);
      };
      InfoPanelCtrl.prototype.init = function() {
        this.currentLvLable && (this.currentLvLable.string = "\u5173\u5361 : " + RuntimeMgr_1.default.ins.CurLevel);
        this.onUpdateInfo();
        this.initCollectTarget();
        EnergyModel_1.EnergyModel.ins.setCurLevel();
      };
      InfoPanelCtrl.prototype.onUpdateInfo = function() {
        this.stepLable.string = "" + GameModel_1.default.ins.stepLimit;
        if (Number(this.scoreLable.string) != RuntimeMgr_1.default.ins.currentScore) {
          this.scoreLable.string = "" + RuntimeMgr_1.default.ins.currentScore;
          this.scoreLable.getComponent(cc.Animation).play("scoreJump");
        }
      };
      InfoPanelCtrl.prototype.initCollectTarget = function() {
        var _this = this;
        var cs = GameModel_1.default.ins.getCollect();
        this.colletctPool = new Map();
        if (cs) {
          this.collectContent.width = [ 158, 208, 258 ][cs.size - 1];
          cs.size > 1;
          this.collectContent.destroyAllChildren();
          cs.forEach(function(collect, key) {
            var item = M_1.default.nodePool.createItem(_this.collectItemPrefab);
            var itemCtrl = item.getComponent(CollectItemCtrl_1.default);
            itemCtrl.init(key, collect);
            item.parent = _this.collectContent;
            _this.colletctPool.set(key, item);
          });
        }
      };
      InfoPanelCtrl.prototype.getLevelLabPos = function() {
        var pos = Common_1.default.getWorldPos(this.currentLvLable.node);
        return pos;
      };
      InfoPanelCtrl.prototype.getStepPos = function() {
        return Common_1.default.getWorldPos(this.stepLable.node);
      };
      InfoPanelCtrl.prototype.getCollectPos = function(type) {
        var pos = cc.v2(0, 0);
        var cNode = this.colletctPool.get(type + "");
        cNode && (pos = Common_1.default.getWorldPos(cNode));
        return pos;
      };
      InfoPanelCtrl.prototype.updataEnergy = function(progress, max) {
        this.progress = progress;
        this.max = max;
      };
      InfoPanelCtrl.prototype.update = function() {
        if (this.max) {
          var progress = Math.floor(this.energyProgress.progress * this.max);
          if (progress < this.progress) progress++; else if (progress == this.progress && progress == this.max) {
            progress = 0;
            this.progress = 0;
          } else progress >= this.progress && (progress = this.progress);
          this.energyProgress.progress = progress / this.max;
        }
      };
      __decorate([ property(cc.Label) ], InfoPanelCtrl.prototype, "stepLable", void 0);
      __decorate([ property(cc.Label) ], InfoPanelCtrl.prototype, "currentLvLable", void 0);
      __decorate([ property(cc.Label) ], InfoPanelCtrl.prototype, "scoreLable", void 0);
      __decorate([ property(cc.Node) ], InfoPanelCtrl.prototype, "collectContent", void 0);
      __decorate([ property(cc.Prefab) ], InfoPanelCtrl.prototype, "collectItemPrefab", void 0);
      __decorate([ property(cc.ProgressBar) ], InfoPanelCtrl.prototype, "energyProgress", void 0);
      InfoPanelCtrl = __decorate([ ccclass ], InfoPanelCtrl);
      return InfoPanelCtrl;
    }(cc.Component);
    exports.default = InfoPanelCtrl;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../Common/Common": "Common",
    "../../../Data/Const/Event": "Event",
    "../../../Data/RuntimeMgr": "RuntimeMgr",
    "../../Model/EnergyModel": "EnergyModel",
    "../../Model/GameModel": "GameModel",
    "./CollectItemCtrl": "CollectItemCtrl"
  } ],
  InitAD: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "92f06iHC9lKZoDlQ7wuQBV6", "InitAD");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var AdManager_1 = require("./AdManager");
    var AdsIdConfig_1 = require("./AdsIdConfig");
    var AdLogUtil_1 = require("./Util/AdLogUtil");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var InitAD = function(_super) {
      __extends(InitAD, _super);
      function InitAD() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.platfrom = AdsIdConfig_1.EPlatform.Close;
        return _this;
      }
      InitAD_1 = InitAD;
      InitAD.prototype.onLoad = function() {
        if (this.platfrom == AdsIdConfig_1.EPlatform.Close) return;
        if (this.platfrom == AdsIdConfig_1.EPlatform.Android) return;
        AdsIdConfig_1.default.platform = this.platfrom;
        AdLogUtil_1.AdLogUtil.InitLogUtil(true);
        this.StartInitAd();
      };
      InitAD.prototype.onEnable = function() {
        cc.director.on("AccetPrivacy", this.StartInitAd, this);
      };
      InitAD.prototype.onDisable = function() {
        cc.director.off("AccetPrivacy", this.StartInitAd, this);
      };
      InitAD.prototype.StartInitAd = function() {
        var _this = this;
        console.log("StartInitAd");
        AdLogUtil_1.AdLogUtil.Log("StartInitAd1 ");
        if (this.platfrom == AdsIdConfig_1.EPlatform.Close) return;
        if (InitAD_1.isInitAd) {
          this.unschedule(this.StartInitAd);
          return;
        }
        AdsIdConfig_1.default.platform = this.platfrom;
        AdManager_1.default.getInstance().platform = this.platfrom;
        this.scheduleOnce(function() {
          if (_this.platfrom != AdsIdConfig_1.EPlatform.Close) {
            AdManager_1.default.getInstance().onInit(_this.GoLoadView.bind(_this));
            InitAD_1.isInitAd = true;
          } else {
            AdManager_1.default.getInstance().onInit(_this.GoLoadView.bind(_this));
            InitAD_1.isInitAd = true;
          }
        }, .01);
      };
      InitAD.prototype.GoLoadView = function() {
        AdManager_1.default.getInstance().setGroup(33554432);
        if (AdsIdConfig_1.default.platform == AdsIdConfig_1.EPlatform.HUAWEI) {
          this.HUAWEILogin();
          return;
        }
      };
      InitAD.prototype.HUAWEILogin = function() {
        AdLogUtil_1.AdLogUtil.Log("HUAWEILogin");
        cc.director.pause();
        AdManager_1.default.getInstance().onLogin(this.HuaweiLoginCallBack.bind(this));
      };
      InitAD.prototype.HuaweiLoginCallBack = function(res) {
        AdLogUtil_1.AdLogUtil.Log("Huawei login result:" + res);
      };
      InitAD.prototype.XiaoMiLogin = function() {
        AdLogUtil_1.AdLogUtil.Log("XiaoMiLogin");
        AdManager_1.default.getInstance().onLogin(function(res) {});
      };
      InitAD.prototype.StartInitYM = function() {
        console.log("StartInitYM");
      };
      var InitAD_1;
      InitAD.isInitAd = false;
      InitAD.isInitYM = false;
      __decorate([ property({
        type: cc.Enum(AdsIdConfig_1.EPlatform)
      }) ], InitAD.prototype, "platfrom", void 0);
      InitAD = InitAD_1 = __decorate([ ccclass ], InitAD);
      return InitAD;
    }(cc.Component);
    exports.default = InitAD;
    cc._RF.pop();
  }, {
    "./AdManager": "AdManager",
    "./AdsIdConfig": "AdsIdConfig",
    "./Util/AdLogUtil": "AdLogUtil"
  } ],
  IslandUnlockCfg: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e57d7cAwSxI4Y5ormUACTZQ", "IslandUnlockCfg");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var IslandUnlockCfg = function() {
      function IslandUnlockCfg(data) {
        this.id = data.id;
        this.starlv = data.starlv;
        this.buildId = data.buildId;
        this.buildName = data.buildName;
        this.desc = data.desc;
        this.choose = data.choose;
        this.price = data.price;
        this.iconId = data.iconId;
        this.isShare = data.isShare;
      }
      return IslandUnlockCfg;
    }();
    exports.default = IslandUnlockCfg;
    cc._RF.pop();
  }, {} ],
  ItemBasicCellCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "88928TPU7VDA6C9KI6Sae2g", "ItemBasicCellCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var M_1 = require("../../../Base/Manager/M");
    var BaseItemView_1 = require("./BaseItemView");
    var CellBase_1 = require("../Model/CellBase");
    var Constant_1 = require("../../Data/Const/Constant");
    var Event_1 = require("../../Data/Const/Event");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var Util_1 = require("../../../Base/Utils/Util");
    var RotatingCtrl_1 = require("../Control/RotatingCtrl");
    var GameModel_1 = require("../Model/GameModel");
    var AudioCtrl_1 = require("../../Common/AudioCtrl");
    var ResCtrl_1 = require("../ResCtrl");
    var CollectModel_1 = require("../Model/CollectModel");
    var Apps_1 = require("../../../Base/Apps");
    var GroupAnimatCtrl_1 = require("../../Common/GroupAnimatCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var AniName = {
      fall: "fall",
      fallPause: "fallPause",
      elimate: "elimate",
      fallOver: "fallOver",
      bombCreate: "bombCreate",
      bombIdle: "bombIdle",
      portalIn: "portalIn",
      portalOut: "portalOut",
      prompt: "prompt",
      collect: "collect",
      shaking: "shaking",
      change2cell: "change2cell"
    };
    var BombGap = 100;
    var SpineCellIdelName = [ "beike_xiuxian", "hengsudan_xiuxian", "hengsudan_xiuxian2", "zhangyu_xiuxian", "idle_haima", "", "", "", "baozhayu_xiuxian" ];
    var SpineCellBombName = [ "", "hengsudan_bao", "hengsudan_bao", "", "" ];
    var MoveGroundNames = [ "up", "down", "left", "right" ];
    var ItemBasicCellCtrl = function(_super) {
      __extends(ItemBasicCellCtrl, _super);
      function ItemBasicCellCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.cellSprite = null;
        _this.ground = null;
        _this.levelSprite = null;
        _this.lowerNode = null;
        _this.shadowNode = null;
        _this.teshuLight = null;
        _this.BindAddScoreTask = null;
        _this.showType = Constant_1.CellType.Empty;
        _this._showLv = 0;
        _this.animation = null;
        _this.animationState = null;
        _this.moveActionAry = [];
        _this.isRunMove = false;
        _this.isPlayFall = false;
        _this.isPlayBombShocks = false;
        _this.spineCellCtrl = null;
        _this.prefabAnimation = null;
        _this.elimateType = Constant_1.ElimateType.Default;
        _this.elimateSize = 0;
        _this.elimateNotify = null;
        _this.portalResolve = null;
        _this.destoryTime = null;
        _this.deathTimeout = 0;
        _this.rotatingCtrl = null;
        _this.createType = null;
        _this.meirenyuJumpPool = [];
        _this.isJumping = false;
        return _this;
      }
      ItemBasicCellCtrl.prototype.onLoad = function() {};
      ItemBasicCellCtrl.prototype.init = function(model, createType) {
        _super.prototype.init.call(this, model);
        this.initAnimation();
        this.updatePosition();
        if (!model.isEmpty) {
          this.resetDisplayInfo();
          this.updateDisplay();
          this.BindAddScoreTask = null;
          this.createType = createType;
          createType ? this.initPlayCreateAnimation(createType) : (Common_1.default.isBombType(model.getType()) || model.getType() == Constant_1.CellType.Fish) && this.scheduleOnce(this.playBombIdel.bind(this), 0);
        }
      };
      ItemBasicCellCtrl.prototype.easyInit = function(type) {
        this.resetDisplayInfo();
        this.updateDisplay(type);
      };
      ItemBasicCellCtrl.prototype.exchange = function(targetPos, time, ep) {
        if (this.moveActionAry) {
          this.moveActionAry.push({
            t: time,
            pos: targetPos,
            ep: ep
          });
          this.execExchangeAni();
        }
      };
      ItemBasicCellCtrl.prototype.elimate = function(count, basePos, type, callback) {
        void 0 === type && (type = Constant_1.ElimateType.Default);
        if (this.model) {
          if (!this.model.isDeath) {
            this.model.execUpElimate(type);
            return;
          }
          this.elimateType = type;
          this.elimateSize = count;
          this.elimateNotify = callback;
          this._execBindAddScoreFun(count);
          count > 3 && type == Constant_1.ElimateType.Default ? this.playMergeNormalBomb(basePos) : this.model.isBomb && type != Constant_1.ElimateType.Girl && !this.isPreDestory() ? this.execBomb() : this.playElimate();
        }
      };
      ItemBasicCellCtrl.prototype.execBomb = function(data) {
        void 0 === data && (data = null);
        var extBombData = null;
        if (this.model.getType() == Constant_1.CellType.Bomb5) {
          var pos = Common_1.default.getRoundOnePos(this.model.pos);
          extBombData = {
            pos: pos
          };
        } else this.model.isRocket && this.execRoket();
        this.model.onMsg(CellBase_1.MsgType.Bomb, data || extBombData);
      };
      ItemBasicCellCtrl.prototype.initAnimation = function() {
        this.animation = this.getComponent(cc.Animation);
        this.animation.on("stop", this.onAnimationStop, this);
      };
      ItemBasicCellCtrl.prototype.resetDisplayInfo = function() {
        this.node.angle = 0;
        this.node.scale = 1;
        this.node.zIndex = 0;
        this.node.opacity = 255;
        this.isRunMove = false;
        this.spineCellCtrl = null;
        this.prefabAnimation = null;
        this.showType = Constant_1.CellType.Empty;
        this.destoryTime = null;
        this.portalResolve = null;
        this.rotatingCtrl = null;
        this.deathTimeout = 0;
        this.cellSprite.node.active = true;
        this.cellSprite.node.scale = 1;
        this.cellSprite.node.angle = 0;
        this.cellSprite.node.opacity = 255;
        this.cellSprite.node.setPosition(0, 0);
        this.shadowNode.active = false;
        this.levelSprite.node.active = false;
        this.ground.node.active = false;
        this.cellSprite.node.destroyAllChildren();
        this.lowerNode.destroyAllChildren();
        this.lowerNode.active = false;
        this.model && this.model.getType() == Constant_1.CellType.Girl && (this.node.zIndex = 10);
      };
      ItemBasicCellCtrl.prototype.initPlayCreateAnimation = function(createType) {
        if (createType == GameModel_1.CreateType.Nov || this.model.isEmpty) return;
        if (this.model.isBomb) this.playCreateBombAni(); else if (createType == GameModel_1.CreateType.Bron) {
          this.playEnterAni();
          this.node.active = false;
        } else this.model.onMsg(CellBase_1.MsgType.Fall);
      };
      ItemBasicCellCtrl.prototype.isPreDestory = function() {
        return !this.cellSprite.node.active;
      };
      ItemBasicCellCtrl.prototype.isHavaSpe = function() {
        if (this.model && this.model.bindUpGModel && this.model.bindUpGModel.isHavaSpe) return true;
        return false;
      };
      ItemBasicCellCtrl.prototype._updateLvDisplay = function() {
        if (this.model && this.model.isGround && this.model.getLv() != this._showLv) {
          this._showLv = this.model.getLv();
          this.levelSprite.node.active = true;
          this.levelSprite.spriteFrame = ResCtrl_1.default.ins.getGroundFrame(this._showLv - 1);
        }
      };
      ItemBasicCellCtrl.prototype.updateDisplay = function(t) {
        var _this = this;
        void 0 === t && (t = null);
        if (this.model && !this.model.isEmpty && this.showType != this.model.getType() || null != t) {
          var displayType = Number(null === t ? this.model.getType() : t);
          var spritIndex_1 = null;
          this.prefabAnimation = null;
          this.spineCellCtrl = null;
          switch (displayType) {
           case Constant_1.CellType.Bomb1:
           case Constant_1.CellType.Bomb2:
           case Constant_1.CellType.Bomb3:
           case Constant_1.CellType.Bomb4:
           case Constant_1.CellType.Bomb5:
            this.createSpineCell(displayType, ResCtrl_1.default.ins.getCellPrefab(displayType - BombGap));
            spritIndex_1 -= BombGap;
            this.addTeshuLight();
            break;

           case Constant_1.CellType.Fish:
            this.createSpineCell(displayType, ResCtrl_1.default.ins.getCellPrefab(5));
            break;

           case Constant_1.CellType.Girl:
            this.createSpineCell(displayType, ResCtrl_1.default.ins.getCellPrefab(6));
            break;

           case Constant_1.CellType.Conch:
            this.createSpineCell(displayType, ResCtrl_1.default.ins.getCellPrefab(7));
            break;

           case Constant_1.CellType.Banana:
            this.createPrefab(ResCtrl_1.default.ins.getCellPrefab(8));
            break;

           case Constant_1.CellType.IceCream:
            this.createPrefab(ResCtrl_1.default.ins.getCellPrefab(9));
            break;

           default:
            spritIndex_1 = displayType;
          }
          if (displayType != Constant_1.CellType.Ground) {
            this.model && this.model.isRocket ? this.createPrefab(ResCtrl_1.default.ins.getRoketPrefab()) : null != spritIndex_1 && (this.cellSprite.spriteFrame = ResCtrl_1.default.ins.getCellFrame(displayType, spritIndex_1));
            this.showLv();
          } else {
            this.showGround();
            this._addGem();
          }
          this.showType = displayType;
          (this.spineCellCtrl || this.prefabAnimation) && this.model && this.scheduleOnce(function() {
            _this.playBombIdel(spritIndex_1);
            _this.createType == GameModel_1.CreateType.Nov && _this.model.isExecBomb && _this.execBomb();
          }, 0);
        }
        this._updateLvDisplay();
      };
      ItemBasicCellCtrl.prototype._addGem = function() {
        if (this.model && this.model.GemLv > 0) {
          var sprite = Common_1.default.createSprite(null, ResCtrl_1.default.ins.getGemFrame(this.model.GemLv - 1));
          sprite.node.setScale(.8);
          sprite.node.parent = this.ground.node;
        }
      };
      ItemBasicCellCtrl.prototype.updateGroundView = function() {
        if (GameModel_1.default.ins.isHavaMoveGround) {
          var dirs = [ cc.v2(0, 1), cc.v2(0, -1), cc.v2(1, 0), cc.v2(-1, 0) ];
          for (var index = 0; index < dirs.length; index++) {
            var targetPos = this.model.pos.add(dirs[index]);
            var cell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, targetPos);
            cell && cell.extCtrl && cell.extCtrl.showGround();
          }
        }
      };
      ItemBasicCellCtrl.prototype.showGround = function() {
        if (this.model && this.model.isGround) {
          this.ground.node.active = true;
          this.shadowNode.active = false;
          var opt = Common_1.default.testGroundBorderDisplay(this.model.pos.x, this.model.pos.y, GameModel_1.default.ins.CellList, this.model.getType());
          for (var i = 4; i--; ) {
            var name = MoveGroundNames[i];
            var border = this.ground.node.getChildByName(name);
            if (opt[i]) {
              if (!border) {
                border = M_1.default.nodePool.createItem(ResCtrl_1.default.ins.getGroundBorderPrefab(i));
                border.parent = this.ground.node;
                border.name = name;
              }
            } else border && border.destroy();
          }
          this.ground.sizeMode = cc.Sprite.SizeMode.CUSTOM;
          this.ground.spriteFrame = ResCtrl_1.default.ins.groundCenter;
          this.ground.node.setContentSize(cc.size(Common_1.default.GRID_W, Common_1.default.GRID_H));
        }
      };
      ItemBasicCellCtrl.prototype.showLv = function() {
        if (this.model && this.model.getLv()) {
          var lv = cc.instantiate(this.node.getChildByName("pos"));
          lv.name = "lv";
          lv.active = true;
          lv.parent = this.cellSprite.node;
          lv.getComponent(cc.Label).string = this.model.getLv() + "";
        }
      };
      ItemBasicCellCtrl.prototype.addTeshuLight = function() {
        this.lowerNode.active = true;
        var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.TeshuLight, this.teshuLight);
        node.getComponent(cc.Sprite).spriteFrame = ResCtrl_1.default.ins.getBombBg(this.model.getType() - BombGap);
        node.parent = this.lowerNode;
      };
      ItemBasicCellCtrl.prototype.createPrefab = function(pb) {
        var result = Common_1.default.createEffPrefab(this.cellSprite.node, null, pb);
        this.prefabAnimation = result.ctrl;
      };
      ItemBasicCellCtrl.prototype.createSpineCell = function(type, cellPrefab) {
        this.cellSprite.node.destroyAllChildren();
        var result = Common_1.default.createSpineNode(this.cellSprite.node, cellPrefab, type);
        this.spineCellCtrl = result.ctrl;
      };
      ItemBasicCellCtrl.prototype.notifyDestory = function() {
        if (this.elimateNotify) {
          var isBorn = !!this.model.bindGModel && this.model.bindGModel.isBorn;
          this.elimateNotify(isBorn);
        }
      };
      ItemBasicCellCtrl.prototype.checkSpecialCollect = function() {
        M_1.default.event.send(Event_1.Event.GameCMD.SpeCollect, this.model);
      };
      ItemBasicCellCtrl.prototype.preDestory = function() {
        if (this.cellSprite) {
          this.cellSprite.node.active = false;
          this.checkSpecialCollect();
          this.model.GemLv > 0 && GameModel_1.default.ins.updateCollectCount(CollectModel_1.CollectType.gem, this.node.getPosition(), null, this.model.GemLv);
          this.model && this.model.preDestory();
          this.animation.stop();
          this.animation.off("off", this.onAnimationStop, this);
          this.updateGroundView();
        }
        this.isDelayType() ? this.destoryTime = this.getDelayElimateTime() : this.destoryTime = 0;
      };
      ItemBasicCellCtrl.prototype.execDestory = function() {
        this.notifyDestory();
        this.model.destory(this.elimateType);
        this.model.onUnBind(this.model.pos);
        this.model = null;
        this.destoryTime = null;
        this.animationState = null;
        this.BindAddScoreTask = null;
        this.showType = Constant_1.CellType.Empty;
        this.cellSprite.node.stopAllActions();
        this.node.stopAllActions();
        this.unscheduleAllCallbacks();
        this.cellSprite.spriteFrame = null;
        if (this.spineCellCtrl) {
          M_1.default.nodePool.freeItem(this.showType, this.spineCellCtrl.node);
          this.spineCellCtrl = null;
        }
        this.prefabAnimation && (this.prefabAnimation = null);
        M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.Cell, this.node);
      };
      ItemBasicCellCtrl.prototype.getDelayElimateTime = function() {
        var time = 0;
        switch (this.elimateType) {
         case Constant_1.ElimateType.Bomb2:
         case Constant_1.ElimateType.Bomb3:
          time = TimeConfig_1.GapTime.DelayDestoryColAndRow;
          break;

         case Constant_1.ElimateType.Bomb1:
          time = TimeConfig_1.GapTime.DelayDestoryBomb;
          break;

         case Constant_1.ElimateType.Bomb4:
          time = TimeConfig_1.GapTime.DelayDestoryOctopus;
          break;

         default:
          this.isFishBomb() && (time = TimeConfig_1.GapTime.DelayDestoryFishBomb);
        }
        return time;
      };
      ItemBasicCellCtrl.prototype.isDelayType = function() {
        if (this.elimateType == Constant_1.ElimateType.Bomb3 || this.elimateType == Constant_1.ElimateType.Bomb2 || this.elimateType <= Constant_1.ElimateType.All && this.elimateType > Constant_1.ElimateType.Default || this.isFishBomb()) return true;
        return false;
      };
      ItemBasicCellCtrl.prototype.checkBomb = function(targetModel) {
        var _this = this;
        var isBomb = false;
        if (this.model && this.model.isBomb) {
          var pos_1 = null;
          if (targetModel) {
            pos_1 = targetModel.pos;
            if (targetModel.isBomb) return;
          }
          isBomb = true;
          this.scheduleOnce(function() {
            _this.execBomb({
              pos: pos_1
            });
          }, .1);
        }
        return isBomb;
      };
      ItemBasicCellCtrl.prototype.updatePosition = function() {
        this.node.setPosition(this.model.getPosition());
        this.cellSprite.node.setPosition(0, 0);
      };
      ItemBasicCellCtrl.prototype.onAnimationStop = function(eventName, aniState) {
        if (!this.model) return;
        switch (aniState.name) {
         case AniName.elimate:
         case AniName.collect:
          this.preDestory();
          break;

         case AniName.fallOver:
          this.model.isBomb && this.playBombIdel();
          break;

         case AniName.bombCreate:
          if (this.model.isBomb) {
            this.cellSprite.node.angle = 0;
            this.playBombIdel();
            this.model.isBombReady = true;
            this.model.unlockCreateBombPos();
            this.model.isExecBomb ? this.execBomb() : this.model.continue2Fall();
          }
          break;

         case AniName.portalIn:
         case AniName.portalOut:
          this.execPortalResolve();
        }
      };
      ItemBasicCellCtrl.prototype.execExchangeAni = function() {
        var _this = this;
        if (!this.isRunMove && this.moveActionAry.length > 0) {
          this.isRunMove = true;
          var moveData_1 = this.moveActionAry.shift();
          var a1 = cc.moveTo(moveData_1.t, Common_1.default.getPos(moveData_1.pos.x, moveData_1.pos.y));
          var a2 = cc.callFunc(function() {
            _this.checkBomb(moveData_1.ep);
            _this.isRunMove = false;
            _this.execExchangeAni();
          }, this);
          this.node.runAction(cc.sequence(a1, a2));
        }
      };
      ItemBasicCellCtrl.prototype.mermaidJumpTo = function(targetPos, callback) {
        this.meirenyuJumpPool.push({
          pos: targetPos,
          cb: callback
        });
        this.isJumping || this._execMermaidJumpTask();
      };
      ItemBasicCellCtrl.prototype._execMermaidJumpTask = function() {
        var _this = this;
        var item = this.meirenyuJumpPool.shift();
        if (item) {
          this.isJumping = true;
          this.spineCellCtrl.play("meirenyu_tiao", 0, false, null, null, {
            name: "meirenyu_xiuxian",
            loop: true
          });
          this.moveTo(item.pos, function() {
            GameModel_1.default.ins.execElimateOne(item.pos, Constant_1.ElimateType.Girl, true);
            _this.isJumping = false;
            item.cb && item.cb();
            _this._execMermaidJumpTask();
          });
        }
      };
      ItemBasicCellCtrl.prototype.moveTo = function(targetPos, callback) {
        var pos = Common_1.default.getPos(targetPos.x, targetPos.y);
        var a0 = cc.delayTime(.2);
        var a1 = cc.moveTo(.2, pos);
        var a2 = cc.callFunc(function() {
          callback && callback();
        });
        this.node.runAction(cc.sequence(a0, a1, a2));
      };
      ItemBasicCellCtrl.prototype.playComplexBombAni = function(type) {
        var _this = this;
        return new Promise(function(resolve) {
          type;
          _this.scheduleOnce(resolve, 0);
        });
      };
      ItemBasicCellCtrl.prototype.playChange2Cell = function() {
        this.animation.play(AniName.change2cell);
      };
      ItemBasicCellCtrl.prototype.exchangeDoubleBombAni = function(targetModel) {
        var _this = this;
        if (targetModel) {
          var a1 = cc.moveTo(.15, Common_1.default.getPos(targetModel.pos.x, targetModel.pos.y));
          var a2 = cc.callFunc(function() {
            return __awaiter(_this, void 0, void 0, function() {
              var groupId;
              return __generator(this, function(_a) {
                groupId = GameModel_1.default.ins.seq.next();
                targetModel.onMsg(CellBase_1.MsgType.ComplexBomb, {
                  type1: this.model.getType(),
                  type2: targetModel.getType(),
                  groupId: groupId
                });
                this.playBombSingleDestoryEff(.1, TimeConfig_1.GapTime.BombMergeBombChangeTime, false, groupId);
                return [ 2 ];
              });
            });
          }, this);
          this.node.runAction(cc.sequence(a1, a2));
        }
      };
      ItemBasicCellCtrl.prototype.execFishBomb = function() {
        this.model.initBombModel(Constant_1.CellType.Fish);
        this.model.onMsg(CellBase_1.MsgType.Bomb);
        this.model.isBomb = false;
      };
      ItemBasicCellCtrl.prototype.execRoket = function() {
        var _this = this;
        var timeLine = GroupAnimatCtrl_1.default.ins.createTimeLine();
        var groundId = this.model.GroupId;
        var count = 0;
        for (var i = 3; i--; ) timeLine.add(gsap.TweenLite.delayedCall(TimeConfig_1.GapTime.ThreePlaneCreate, function() {
          GameModel_1.default.ins.execElimate(_this.model, null, Constant_1.ElimateType.Rocket, null, null, groundId);
          count++;
          count >= 3;
        }));
      };
      ItemBasicCellCtrl.prototype.isFishSingleBomb = function() {
        return this.model.getType() == Constant_1.CellType.Fish && this.elimateType != Constant_1.ElimateType.Default;
      };
      ItemBasicCellCtrl.prototype.isFishBomb = function() {
        return this.model.getType() == Constant_1.CellType.Fish && (3 == this.elimateSize || this.elimateType != Constant_1.ElimateType.Default);
      };
      ItemBasicCellCtrl.prototype.playElimate = function() {
        this.isFishSingleBomb() && !this.animationState && this.elimateType != Constant_1.ElimateType.Girl && this.execFishBomb();
        if (this.model && !this.model.isEmpty) if (this.model.isRocket && 0 != this.elimateSize) this.execRoket(); else if (this.model.isCollect && GameModel_1.default.ins.getCollect().get(this.model.getType() + "") > 0 && this.elimateType == Constant_1.ElimateType.Default) this.playCollectAni(); else {
          this._isPlayElimateAnimation() && (!this.animationState || this.animationState && this.animationState.name != AniName.elimate) && (this.animationState = this.animation.play(AniName.elimate));
          this.playLittleElimateEff();
        }
      };
      ItemBasicCellCtrl.prototype._isPlayElimateAnimation = function() {
        return this.model.getType() != Constant_1.CellType.Banana;
      };
      ItemBasicCellCtrl.prototype.playCreateBombAni = function() {
        this.animation || this.initAnimation();
        this.model.isBombReady = false;
        this.animation.play(AniName.bombCreate);
      };
      ItemBasicCellCtrl.prototype.playLittleElimateEff = function() {
        var wolrdPos = Common_1.default.getWorldPos(this.node);
        if (this.model.getType() == Constant_1.CellType.Banana) if (this.prefabAnimation) {
          this.prefabAnimation.play();
          this.scheduleOnce(this.preDestory.bind(this), .5);
        } else this.preDestory(); else if (this.elimateType != Constant_1.ElimateType.Bomb1 && this.model.getType() != Constant_1.CellType.IceCream) {
          this.model.isGround ? this.playBrokenEff(wolrdPos) : M_1.default.event.send(Event_1.Event.Effect.LittleBomb, wolrdPos);
          M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.Elimate);
        }
        this.model.notifyRoundElimate(this.elimateType);
      };
      ItemBasicCellCtrl.prototype.playBrokenEff = function(pos) {
        pos = pos || Common_1.default.getWorldPos(this.node);
        M_1.default.event.send(Event_1.Event.Effect.Broken, pos);
        this.model && this.model.getLv() <= 0 && this.updateGroundView();
      };
      ItemBasicCellCtrl.prototype.playBombIdel = function(type) {
        if (this.spineCellCtrl) {
          this.cellSprite.spriteFrame = null;
          var name = null;
          this.model.getType() == Constant_1.CellType.Fish ? name = SpineCellIdelName[SpineCellIdelName.length - 1] : this.spineCellCtrl.curPlay != SpineCellBombName[this.model.getType() - BombGap] && (name = SpineCellIdelName[this.model.getType() - BombGap]);
          this.spineCellCtrl.play(name, 0, true);
        } else if (this.model.isRocket) {
          if (this.prefabAnimation) {
            this.prefabAnimation.play(type + "_zhangyuGGIdle");
            console.error("prefabAnimation:", type + "_zhangyuGGIdle");
          }
        } else this.animation && this.model.isBomb && this.animation.play(AniName.bombIdle);
      };
      ItemBasicCellCtrl.prototype._execBindAddScoreFun = function(count) {
        void 0 === count && (count = null);
        if (this.BindAddScoreTask) {
          this.BindAddScoreTask(Common_1.default.getWorldPos(this.node), count);
          this.BindAddScoreTask = null;
        }
      };
      ItemBasicCellCtrl.prototype.playBombSingleDestoryEff = function(keepTime, playTime, isSpineEff, groupId) {
        var _this = this;
        void 0 === keepTime && (keepTime = .2);
        void 0 === playTime && (playTime = .2);
        void 0 === isSpineEff && (isSpineEff = false);
        void 0 === groupId && (groupId = null);
        return new Promise(function(resolve) {
          if (!_this.model) return resolve();
          groupId && !_this.model.GroupId && (_this.model.GroupId = groupId);
          _this.model.onMsg(CellBase_1.MsgType.Elimate, {
            id: groupId,
            isForced: true
          });
          var over = function() {
            _this.model && _this.model.unlockCreateBombPos();
            _this.preDestory();
            resolve();
          };
          _this.elimateType = _this.model.getType();
          _this._execBindAddScoreFun();
          if (isSpineEff && _this.spineCellCtrl && !_this.isPreDestory()) {
            var name = SpineCellBombName[_this.model.getType() - BombGap];
            _this.spineCellCtrl.play(name, 0, false);
            _this.scheduleOnce(over, .3 + playTime);
          } else if (_this.model.isRocket) {
            if (_this.prefabAnimation) {
              _this.prefabAnimation.play(_this.model.getType() + "_zhangyuGG");
              _this.scheduleOnce(over, .3 + playTime);
            }
          } else {
            var a0 = cc.fadeOut(keepTime);
            var a1 = cc.callFunc(function() {
              _this.cellSprite.node.active = false;
            }, _this);
            var a2 = cc.delayTime(playTime);
            var a3 = cc.callFunc(over, _this);
            _this.node.runAction(cc.sequence(a0, a1, a2, a3));
          }
        });
      };
      ItemBasicCellCtrl.prototype.execBombAfterShocks = function(bombLv, centerPos) {
        var _this = this;
        if (this.model && !this.model.isDeath && !this.isHavaSpe() && !this.isPlayBombShocks) {
          this.isPlayBombShocks = true;
          var cp = Common_1.default.getPos(centerPos.x, centerPos.y);
          var sp = this.model.getPosition();
          var radians = Math.atan2(cp.x - sp.x, cp.y - sp.y);
          var degrees = -180 * radians / Math.PI;
          var dir = Common_1.default.getDirction(cp, sp);
          var a0 = cc.moveBy(.2, cc.v2(-dir.x * (4 * bombLv), -dir.y * (4 * bombLv)));
          var a1 = cc.moveBy(.2, cc.v2(dir.x * (8 * bombLv), dir.y * (8 * bombLv)));
          var a2 = cc.moveTo(.2, cc.v2(0, 0));
          var a3 = cc.sequence(cc.rotateTo(.1, .1 * degrees * (.5 * bombLv)), cc.rotateTo(.1, 0));
          var over = cc.callFunc(function() {
            _this.cellSprite.node.setPosition(0, 0);
            _this.cellSprite.node.angle = 0;
            _this.isPlayBombShocks = false;
          }, this);
          this.cellSprite.node.runAction(cc.sequence(cc.spawn(cc.sequence(a0, a1, a2), a3), over));
        }
      };
      ItemBasicCellCtrl.prototype.change2Bomb = function(type) {
        if (this.model) {
          this.model.change2Bomb(type);
          this.cellSprite.node.active = true;
          this.updatePosition();
          this.updateDisplay();
          this.playCreateBombAni();
        }
      };
      ItemBasicCellCtrl.prototype.playEnterAni = function() {
        this.node.opacity = 0;
        this.node.runAction(cc.fadeIn(.15));
      };
      ItemBasicCellCtrl.prototype.playFallStartAni = function() {
        if (!this.isPlayFall && !this.isHavaSpe()) {
          this.isPlayFall = true;
          this.animation.playAdditive(AniName.fall);
        }
      };
      ItemBasicCellCtrl.prototype.playShaking = function() {
        var a0 = cc.moveBy(.05, cc.v2(Util_1.Util.Tool.rangeInt(2, 5), Util_1.Util.Tool.rangeInt(2, 5)));
        var a1 = a0.reverse();
        this.cellSprite.node.runAction(cc.repeatForever(cc.sequence(a0, a1)));
      };
      ItemBasicCellCtrl.prototype.playFallPauseAni = function() {
        if (this.isPlayFall) {
          this.isPlayFall = false;
          this.animation.play(AniName.fallPause);
        }
      };
      ItemBasicCellCtrl.prototype.playFallOverAni = function() {
        if (!this.portalResolve && !this.isHavaSpe()) {
          this.isPlayFall = false;
          this.model.getType() == Constant_1.CellType.IceCream ? this.prefabAnimation && this.prefabAnimation.play() : this.animation.play(AniName.fallOver);
        }
      };
      ItemBasicCellCtrl.prototype.playSinglePrompt = function(mulPos) {
        if (this.model) {
          var dir = Common_1.default.getDirction(mulPos, this.model.pos);
          var gap = 6;
          var shockGap = 5;
          var a1 = cc.spawn(cc.scaleTo(.5, 1.05), cc.moveTo(.5, cc.v2(dir.x * gap, dir.y * -gap)));
          var a2 = cc.repeat(cc.sequence(cc.moveBy(.2, cc.v2(dir.x * shockGap, dir.y * -shockGap)), cc.moveBy(.2, cc.v2(dir.x * -shockGap, dir.y * shockGap))), 2);
          var a3 = cc.spawn(cc.scaleTo(.2, 1), cc.moveTo(.2, cc.v2(0, 0)));
          var a4 = cc.delayTime(.5);
          this.cellSprite.node.runAction(cc.repeatForever(cc.sequence(a1, a2, a3, a4)));
        }
      };
      ItemBasicCellCtrl.prototype.playMulPrompt = function() {
        this.animation && this.animation.playAdditive(AniName.prompt);
      };
      ItemBasicCellCtrl.prototype.playRotatingMerge = function(centerPos) {
        var _this = this;
        this.rotatingCtrl = new RotatingCtrl_1.default(this.node, centerPos);
        this.rotatingCtrl.start().then(function() {
          _this.cellSprite && (_this.cellSprite.node.active = false);
          _this.rotatingCtrl = null;
        });
      };
      ItemBasicCellCtrl.prototype.playMergeNormalBomb = function(centerPos, time, isNeedDestory, isShowSpeedLine) {
        var _this = this;
        void 0 === time && (time = TimeConfig_1.GapTime.MergeBombSpeed);
        void 0 === isNeedDestory && (isNeedDestory = true);
        void 0 === isShowSpeedLine && (isShowSpeedLine = true);
        if (this.model.isRocket && 0 != this.elimateSize) {
          this.execRoket();
          return;
        }
        var dir = Common_1.default.getDirction(centerPos, this.model.pos);
        var centerPosition = Common_1.default.getPos(centerPos.x, centerPos.y);
        var _a = {
          sx: 1,
          sy: 1
        }, sx = _a.sx, sy = _a.sy;
        if (0 != dir.x) {
          sx = 1.2;
          sy = .8;
        } else if (0 != dir.y) {
          sx = .8;
          sy = 1.2;
        }
        var a0 = cc.scaleTo(.05, sx, sy);
        var a1 = cc.moveTo(time, centerPosition);
        var a2 = cc.callFunc(function() {
          isNeedDestory ? _this.preDestory() : _this.cellSprite.node.active = false;
        }, this);
        this.model.notifyRoundElimate(this.elimateType);
        isShowSpeedLine && M_1.default.event.send(Event_1.Event.Effect.SpeedLine, Common_1.default.getWorldPos(this.node), dir);
        this.node.runAction(cc.sequence(cc.spawn(a0, a1), a2));
      };
      ItemBasicCellCtrl.prototype.stopPromptAction = function() {
        if (this.cellSprite) {
          this.animation.stop();
          this.cellSprite.node.stopAllActions();
          this.cellSprite.node.setPosition(0, 0);
        }
      };
      ItemBasicCellCtrl.prototype.portalOut = function() {
        var _this = this;
        if (!this.portalResolve) return new Promise(function(resolve) {
          _this.portalResolve = resolve;
          _this.animation.play(AniName.portalOut);
        });
        return null;
      };
      ItemBasicCellCtrl.prototype.portalIn = function() {
        var _this = this;
        if (!this.portalResolve) return new Promise(function(resolve) {
          _this.portalResolve = resolve;
          _this.animation.play(AniName.portalIn);
        });
        return null;
      };
      ItemBasicCellCtrl.prototype.execPortalResolve = function() {
        this.portalResolve && this.portalResolve(true);
        this.portalResolve = null;
      };
      ItemBasicCellCtrl.prototype.playCollectAni = function() {
        this.node.zIndex = 100;
        this.animationState = this.animation.play(AniName.collect);
        this.playLittleElimateEff();
      };
      ItemBasicCellCtrl.prototype.checkDestory = function(dt) {
        if (null != this.destoryTime) {
          this.destoryTime -= dt;
          this.destoryTime <= 0 && this.execDestory();
        }
        if (this.model && this.model.isDeath) {
          this.deathTimeout += dt;
          if (this.deathTimeout > 5) {
            this.deathTimeout = 0;
            this.playElimate();
          }
        }
      };
      ItemBasicCellCtrl.prototype.updateTestLabel = function() {
        this.model && (this.node.getChildByName("pos").getComponent(cc.Label).string = this.model.pos.x + "-" + this.model.pos.y);
      };
      ItemBasicCellCtrl.prototype.orderlyUpdate = function(dt) {
        dt > Constant_1.FallMaxGateLimit && (dt = Constant_1.FallMaxGateLimit);
        if (this.model && this.model.isFall && !this.isRunMove) {
          var x = this.node.x + this.model.speed.x * this.model.fallingDir.x * dt;
          var y = this.node.y - this.model.speed.y * this.model.fallingDir.y * dt;
          if (!this.model.isBomb || this.model.isBomb && this.model.isBombReady) {
            if (this.model.fallDes) {
              x = this.model.fallingDir.x > 0 ? x > this.model.fallDes.x ? this.model.fallDes.x : x : x < this.model.fallDes.x ? this.model.fallDes.x : x;
              y = y < this.model.fallDes.y ? this.model.fallDes.y : y;
            }
            0 == x && 0 == y && this.node.active || (this.node.active = true);
            this.node.setPosition(x, y);
            this.model.posDetection(this.node.position) && this.updatePosition();
          }
        }
      };
      ItemBasicCellCtrl.prototype.update = function(dt) {
        this.updateDisplay();
        this.checkDestory(dt);
        Apps_1.default.isDebug && this.updateTestLabel();
      };
      __decorate([ property(cc.Sprite) ], ItemBasicCellCtrl.prototype, "cellSprite", void 0);
      __decorate([ property(cc.Sprite) ], ItemBasicCellCtrl.prototype, "ground", void 0);
      __decorate([ property(cc.Sprite) ], ItemBasicCellCtrl.prototype, "levelSprite", void 0);
      __decorate([ property(cc.Node) ], ItemBasicCellCtrl.prototype, "lowerNode", void 0);
      __decorate([ property(cc.Node) ], ItemBasicCellCtrl.prototype, "shadowNode", void 0);
      __decorate([ property(cc.Prefab) ], ItemBasicCellCtrl.prototype, "teshuLight", void 0);
      ItemBasicCellCtrl = __decorate([ ccclass ], ItemBasicCellCtrl);
      return ItemBasicCellCtrl;
    }(BaseItemView_1.default);
    exports.default = ItemBasicCellCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Apps": "Apps",
    "../../../Base/Manager/M": "M",
    "../../../Base/Utils/Util": "Util",
    "../../Common/AudioCtrl": "AudioCtrl",
    "../../Common/Common": "Common",
    "../../Common/GroupAnimatCtrl": "GroupAnimatCtrl",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Const/TimeConfig": "TimeConfig",
    "../Control/RotatingCtrl": "RotatingCtrl",
    "../Model/CellBase": "CellBase",
    "../Model/CollectModel": "CollectModel",
    "../Model/GameModel": "GameModel",
    "../ResCtrl": "ResCtrl",
    "./BaseItemView": "BaseItemView"
  } ],
  ItemGroundCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "edc59dLu7NC9ruCos3FByBh", "ItemGroundCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BaseItemView_1 = require("./BaseItemView");
    var M_1 = require("../../../Base/Manager/M");
    var Constant_1 = require("../../Data/Const/Constant");
    var SpinePlayerCtrl_1 = require("../../../Base/CustomComponent/SpinePlayerCtrl");
    var Event_1 = require("../../Data/Const/Event");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var ResCtrl_1 = require("../ResCtrl");
    var Common_1 = require("../../Common/Common");
    var Tuituji_1 = require("./Comp/Tuituji");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ShuiCaoIdleAniName = [ "shuicao_2", "shuicao" ];
    var ShuiCaoHitAni = [ "shuicao_hit2", "shuicao_hit" ];
    var ItemGroundCtrl = function(_super) {
      __extends(ItemGroundCtrl, _super);
      function ItemGroundCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.elementSprite = null;
        _this.buriedSprite = null;
        _this.WallPrefab = null;
        _this.tuitujiPrefab = null;
        _this.LotusleafFrame = null;
        _this.girlRoadFrame = null;
        _this.Ivy = null;
        _this.exitPrefab = null;
        _this.shanhuAni = null;
        _this.ivyCtrl = null;
        _this.showLv = -1;
        _this._downLayer = null;
        _this._tuitujiCtrl = null;
        _this.complexViewNode = null;
        return _this;
      }
      ItemGroundCtrl.prototype.onLoad = function() {};
      ItemGroundCtrl.prototype.start = function() {};
      ItemGroundCtrl.prototype.init = function(model, downLayer) {
        _super.prototype.init.call(this, model);
        if (model) {
          this._downLayer = downLayer;
          this.cleanDisplay();
          this.buriedSprite.node.active = false;
          this.node.setPosition(model.getPosition());
          this.showPlug();
          this.showExit();
          this.showWall();
        }
      };
      ItemGroundCtrl.prototype.cleanDisplay = function() {
        this.elementSprite.node.scale = 1;
        this.elementSprite.node.angle = 0;
        this.elementSprite.node.active = false;
        this.elementSprite.node.destroyAllChildren();
      };
      ItemGroundCtrl.prototype.PlayShanhuAnim = function() {
        if (this.model.getType() == Constant_1.GroundType.Mushroom) {
          var node_1 = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.ShanhuAnim, this.shanhuAni);
          var _animation = node_1.getComponent(cc.Animation);
          node_1.parent = this.elementSprite.node;
          _animation.play("shanhuFX");
          var a1 = cc.delayTime(1.2);
          var a2 = cc.callFunc(function() {
            M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.ShanhuAnim, node_1);
          });
          node_1.runAction(cc.sequence(a1, a2));
        }
      };
      ItemGroundCtrl.prototype.updateView = function() {
        if (this.showLv != this.model.getLv()) switch (this.model.getType()) {
         case Constant_1.GroundType.Water:
          break;

         case Constant_1.GroundType.Leaves:
          this.showLeaves();
          break;

         case Constant_1.GroundType.Ivy:
          this.showIvy();
          break;

         case Constant_1.GroundType.Flower:
          this.showFlower();
          break;

         case Constant_1.GroundType.Firefly:
          this.showFirefly();
          break;

         case Constant_1.GroundType.Tuituji:
          this.showTuituji();
          break;

         case Constant_1.GroundType.Mushroom:
          this.showMushroom();
          break;

         case Constant_1.GroundType.None:
          this.elementSprite.node.active = false;
        }
      };
      ItemGroundCtrl.prototype.showExit = function() {
        if (this.model.isExit) {
          var exitNode = M_1.default.nodePool.createItem(this.exitPrefab);
          exitNode.parent = this.node;
        }
      };
      ItemGroundCtrl.prototype.showPlug = function() {
        this.model.isGirlRoad ? this.node["baseSprite"].spriteFrame = this.girlRoadFrame : this.model.isConveyer && this.addLotusleaf();
      };
      ItemGroundCtrl.prototype.updateTuitujiPower = function() {
        this._tuitujiCtrl && this._tuitujiCtrl.collectItem();
      };
      ItemGroundCtrl.prototype.hideMushroom = function() {
        this.cleanDisplay();
      };
      ItemGroundCtrl.prototype.showMushroom = function() {
        this.elementSprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
        this.elementSprite.node.active = true;
        this.elementSprite.spriteFrame = ResCtrl_1.default.ins.getMushroomFrame(this.model.getLv());
        this.elementSprite.node.setScale(90 / this.elementSprite.node.width);
        this.showLv = this.model.getLv();
        0 == this.model.getLv() && this.PlayShanhuAnim();
      };
      ItemGroundCtrl.prototype.showTuituji = function() {
        this.elementSprite.node.active = true;
        var node = cc.instantiate(this.tuitujiPrefab);
        node.parent = this.elementSprite.node;
        this._tuitujiCtrl = node.getComponent(Tuituji_1.default);
        this._tuitujiCtrl.init(this.model.tuitujiCfg);
        this.showLv = this.model.getLv();
      };
      ItemGroundCtrl.prototype.showFirefly = function() {
        this.elementSprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
        this.elementSprite.node.active = true;
        this.elementSprite.spriteFrame = ResCtrl_1.default.ins.getFirefly(this.model.getLv() - 1);
        this.elementSprite.node.setScale(86 / this.elementSprite.node.width);
        this.showLv = this.model.getLv();
      };
      ItemGroundCtrl.prototype.showFlower = function() {
        this.elementSprite.sizeMode = cc.Sprite.SizeMode.TRIMMED;
        this.elementSprite.node.active = true;
        this.elementSprite.spriteFrame = ResCtrl_1.default.ins.getFlowerFrame(this.model.getLv() - 1);
        this.showLv = this.model.getLv();
        if (this.showLv <= 0) {
          M_1.default.event.send(Event_1.Event.GameCMD.ChangeCell, Constant_1.CellType.Flower, 4, false);
          this.model.setLv(this.model.gridData.flowers);
        }
      };
      ItemGroundCtrl.prototype.showWall = function() {
        if (this.model && this.model.Wall) for (var key in this.model.Wall) {
          var angle = this.model.Wall[key];
          if (void 0 != angle) {
            var wn = cc.instantiate(this.WallPrefab);
            wn.parent = this.node;
            wn.angle = angle;
            var gap = angle < 90 ? 7 : -7;
            Math.abs(angle) / 90 == 1 ? wn.x += gap : wn.y += gap;
          }
        }
      };
      ItemGroundCtrl.prototype.showIvy = function() {
        var _this = this;
        if (this.ivyCtrl) this.ivyCtrl.play(ShuiCaoHitAni[this.showLv - 1], 0, false, function() {
          0 != _this.model.getLv() ? _this.ivyCtrl.play(ShuiCaoIdleAniName[_this.model.getLv() - 1], 0, true) : M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.ShuiCao, _this.ivyCtrl.node);
        }); else {
          this.elementSprite.node.active = true;
          var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.ShuiCao, this.Ivy);
          this.ivyCtrl = node.getComponent(SpinePlayerCtrl_1.default);
          if (-1 == this.model.zIndex) {
            node.parent = this._downLayer;
            node.zIndex = 3;
            node.setPosition(this.model.getPosition());
          } else {
            node.parent = this.elementSprite.node;
            node.setPosition(0, 0);
          }
          this.ivyCtrl.play(ShuiCaoIdleAniName[this.model.getLv() - 1], 0, true);
          node.y -= Common_1.default.GRID_H / 2 - 10;
        }
        this.showLv = this.model.getLv();
      };
      ItemGroundCtrl.prototype.addBorder = function(border) {
        this.elementSprite.node.active = true;
        border.parent = this.elementSprite.node;
      };
      ItemGroundCtrl.prototype.cleanOtherDisplay = function() {
        this.buriedSprite.spriteFrame = null;
        this.buriedSprite.node.active = false;
      };
      ItemGroundCtrl.prototype.addLotusleaf = function() {
        this.elementSprite.node.active = true;
        var node = cc.instantiate(this.elementSprite.node);
        node.name = "Lotusleaf";
        node.parent = this.elementSprite.node;
        node.getComponent(cc.Sprite).spriteFrame = this.LotusleafFrame;
      };
      ItemGroundCtrl.prototype.playAnimation = function() {
        var _this = this;
        return new Promise(function(resolve) {
          var score = Common_1.default.getSpecialAddScoreByType(_this.model.getType());
          var wpos = Common_1.default.convertCurWorldPos(_this.model.getPosition());
          M_1.default.event.send(Event_1.Event.Effect.Broken, wpos, null, _this.model.getType());
          score && M_1.default.event.send(Event_1.Event.UI.AddScore, score, wpos);
          _this.scheduleOnce(resolve, TimeConfig_1.GapTime.DelayChangeBroken);
        });
      };
      ItemGroundCtrl.prototype.showLeaves = function() {
        this.elementSprite.node.active = true;
        this.elementSprite.spriteFrame = ResCtrl_1.default.ins.getLeavesFrame(this.model.getLv() - 1);
        this.showLv = this.model.getLv();
      };
      ItemGroundCtrl.prototype.update = function(dt) {
        this.model && this.updateView();
      };
      __decorate([ property(cc.Sprite) ], ItemGroundCtrl.prototype, "elementSprite", void 0);
      __decorate([ property(cc.Sprite) ], ItemGroundCtrl.prototype, "buriedSprite", void 0);
      __decorate([ property(cc.Prefab) ], ItemGroundCtrl.prototype, "WallPrefab", void 0);
      __decorate([ property(cc.Prefab) ], ItemGroundCtrl.prototype, "tuitujiPrefab", void 0);
      __decorate([ property(cc.SpriteFrame) ], ItemGroundCtrl.prototype, "LotusleafFrame", void 0);
      __decorate([ property(cc.SpriteFrame) ], ItemGroundCtrl.prototype, "girlRoadFrame", void 0);
      __decorate([ property(cc.Prefab) ], ItemGroundCtrl.prototype, "Ivy", void 0);
      __decorate([ property(cc.Prefab) ], ItemGroundCtrl.prototype, "exitPrefab", void 0);
      __decorate([ property(cc.Prefab) ], ItemGroundCtrl.prototype, "shanhuAni", void 0);
      ItemGroundCtrl = __decorate([ ccclass ], ItemGroundCtrl);
      return ItemGroundCtrl;
    }(BaseItemView_1.default);
    exports.default = ItemGroundCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/CustomComponent/SpinePlayerCtrl": "SpinePlayerCtrl",
    "../../../Base/Manager/M": "M",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Const/TimeConfig": "TimeConfig",
    "../ResCtrl": "ResCtrl",
    "./BaseItemView": "BaseItemView",
    "./Comp/Tuituji": "Tuituji"
  } ],
  ItemUpgroundCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "67adbiMeRZMFZWjsInFMQV8", "ItemUpgroundCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BaseItemView_1 = require("./BaseItemView");
    var M_1 = require("../../../Base/Manager/M");
    var Event_1 = require("../../Data/Const/Event");
    var Common_1 = require("../../Common/Common");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var Constant_1 = require("../../Data/Const/Constant");
    var ResCtrl_1 = require("../ResCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ItemUpgroundCtrl = function(_super) {
      __extends(ItemUpgroundCtrl, _super);
      function ItemUpgroundCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.ice = null;
        _this.lock = null;
        _this.box = null;
        _this.portal = null;
        _this.portalPrefab = null;
        _this.novicePrefab = [];
        _this.n_conchItem = null;
        _this.n_grassItem = null;
        _this.curShowType = -1;
        _this.curShowLv = -1;
        return _this;
      }
      ItemUpgroundCtrl.prototype.onLoad = function() {};
      ItemUpgroundCtrl.prototype.start = function() {};
      ItemUpgroundCtrl.prototype.onDestroy = function() {
        this.unscheduleAllCallbacks();
      };
      ItemUpgroundCtrl.prototype.registerEvent = function() {};
      ItemUpgroundCtrl.prototype.init = function(model) {
        var _this = this;
        _super.prototype.init.call(this, model);
        if (model) {
          if (model.isHavaSpe) {
            this.node.scale = 1;
            this.node.angle = 0;
            var specials = model.getSpecials();
            specials.forEach(function(spe) {
              _this.showItem(spe.type, spe.lv);
            });
          }
          this.node.setPosition(model.getPosition());
        }
        this.registerEvent();
      };
      ItemUpgroundCtrl.prototype.setBox = function(lv) {
        this.setFrame(this.box, ResCtrl_1.default.ins.getBoxFrame(lv - 1, this.model.boxType));
      };
      ItemUpgroundCtrl.prototype.setStone = function(lv) {
        this.box.sizeMode = cc.Sprite.SizeMode.TRIMMED;
        this.setFrame(this.box, ResCtrl_1.default.ins.getStoneFrame(lv - 1));
      };
      ItemUpgroundCtrl.prototype.setIce = function(lv) {
        this.setFrame(this.ice, ResCtrl_1.default.ins.getIceFrame(lv - 1));
      };
      ItemUpgroundCtrl.prototype.setLock = function(lv) {
        this.setFrame(this.lock, ResCtrl_1.default.ins.getLockFrame(lv - 1));
      };
      ItemUpgroundCtrl.prototype.setFrame = function(target, frame) {
        if (!target) return;
        target.node.setScale(90 / target.node.width);
        target.node.setPosition(0, 0);
        target.node.setAnchorPoint(cc.v2(.5, .5));
        if (frame) {
          target.node.active = true;
          target.spriteFrame = frame;
        } else target.node.active = false;
      };
      ItemUpgroundCtrl.prototype.syncShowData = function() {
        this.curShowLv = this.model.getLv();
        this.curShowType = this.model.getType();
      };
      ItemUpgroundCtrl.prototype.showItem = function(type, lv) {
        switch (type) {
         case Constant_1.UpGroundType.Box:
          this.setBox(lv);
          break;

         case Constant_1.UpGroundType.Ice:
          this.setIce(lv);
          break;

         case Constant_1.UpGroundType.Lock:
          this.setLock(lv);
          break;

         case Constant_1.UpGroundType.Stone:
          this.setStone(lv);
          break;

         case Constant_1.UpGroundType.Nov_grass:
          this.showCloseGrass(type);
          break;

         case Constant_1.UpGroundType.Nov_conch:
          this.showConchNov(type);
          break;

         case Constant_1.UpGroundType.None:
          var names = [ , "box", "lock", "ice" ];
          this.setFrame(this[names[this.curShowType]], null);
        }
        this.syncShowData();
      };
      ItemUpgroundCtrl.prototype.hideConchNov = function() {
        this.box.node.destroyAllChildren();
        this.box.spriteFrame = null;
      };
      ItemUpgroundCtrl.prototype.showCloseGrass = function(type) {
        this.n_grassItem = Common_1.default.createSpineNode(this.box.node, this.novicePrefab[type - 100]);
      };
      ItemUpgroundCtrl.prototype.showConchNov = function(type) {};
      ItemUpgroundCtrl.prototype.updateShowSp = function() {
        if (this.curShowType != this.model.getType() || this.curShowLv != this.model.getLv()) {
          if (this.curShowType != this.model.getType()) {
            this.box.node.active = false;
            this.ice.node.active = false;
            this.lock.node.active = false;
          }
          this.showItem(this.model.getType(), this.model.getLv());
        }
      };
      ItemUpgroundCtrl.prototype.updateBindCellPos = function() {
        this.model.isFollowNode && this.model.BindCell && this.model.BindCell.extData && this.node.setPosition(this.model.BindCell.extData.getPosition());
      };
      ItemUpgroundCtrl.prototype.playAnimation = function(type) {
        var _this = this;
        return new Promise(function(resolve) {
          if (_this.model && _this.model.isHavaSpe) {
            var worldPos = Common_1.default.convertCurWorldPos(_this.model.getPosition());
            var name = null;
            if (type == Constant_1.UpGroundType.Box) {
              0 != _this.model.getType() && (name = "box" + _this.model.getLv() + "to" + (_this.model.getLv() - 1));
              resolve();
            } else _this.scheduleOnce(resolve, TimeConfig_1.GapTime.DelayChangeBroken);
            M_1.default.event.send(Event_1.Event.Effect.Broken, worldPos, null, type, name);
            var score = Common_1.default.getSpecialAddScoreByType(_this.model.getType());
            score && M_1.default.event.send(Event_1.Event.UI.AddScore, score, worldPos);
          } else resolve(true);
        });
      };
      ItemUpgroundCtrl.prototype.update = function(dt) {
        if (this.model) {
          this.updateShowSp();
          this.updateBindCellPos();
        }
      };
      __decorate([ property(cc.Sprite) ], ItemUpgroundCtrl.prototype, "ice", void 0);
      __decorate([ property(cc.Sprite) ], ItemUpgroundCtrl.prototype, "lock", void 0);
      __decorate([ property(cc.Sprite) ], ItemUpgroundCtrl.prototype, "box", void 0);
      __decorate([ property(cc.Node) ], ItemUpgroundCtrl.prototype, "portal", void 0);
      __decorate([ property(cc.Prefab) ], ItemUpgroundCtrl.prototype, "portalPrefab", void 0);
      __decorate([ property([ cc.Prefab ]) ], ItemUpgroundCtrl.prototype, "novicePrefab", void 0);
      ItemUpgroundCtrl = __decorate([ ccclass ], ItemUpgroundCtrl);
      return ItemUpgroundCtrl;
    }(BaseItemView_1.default);
    exports.default = ItemUpgroundCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Const/TimeConfig": "TimeConfig",
    "../ResCtrl": "ResCtrl",
    "./BaseItemView": "BaseItemView"
  } ],
  ItemZIndex: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b3722ognK9IMJHqoHDb5MBs", "ItemZIndex");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property, executeInEditMode = _a.executeInEditMode;
    var ItemZIndex = function(_super) {
      __extends(ItemZIndex, _super);
      function ItemZIndex() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.zIndex = 0;
        return _this;
      }
      ItemZIndex.prototype.onLoad = function() {};
      __decorate([ property(cc.Integer) ], ItemZIndex.prototype, "zIndex", void 0);
      ItemZIndex = __decorate([ ccclass, executeInEditMode ], ItemZIndex);
      return ItemZIndex;
    }(cc.Component);
    exports.ItemZIndex = ItemZIndex;
    cc._RF.pop();
  }, {} ],
  JumpUtils: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "a4de5XknPVK4Z2dvuJnRI8r", "JumpUtils");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIMgr_1 = require("../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Data/Interface/UIData");
    var Common_1 = require("../../Common/Common");
    var JumpUtils = function() {
      function JumpUtils() {}
      JumpUtils.jump = function(content) {
        var _this = this;
        if (!content) return;
        var _a = content.split("#"), cmd = _a[0], parameter = _a[1];
        var _b = parameter.split("*"), delay = _b[0], param = _b[1];
        delay && void 0 != param ? setTimeout(function() {
          _this.doAction(cmd, param);
        }, 1e3 * Number(delay)) : this.doAction(cmd, parameter);
      };
      JumpUtils.doAction = function(cmd, param) {
        switch (cmd) {
         case "scene":
          Common_1.default.jumpScene(param);
          break;

         case "talk":
          UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.TalkPanel, param);
          break;

         case "guide":
          UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GuideLayer, null, function(guideLayer) {
            cc.loader.loadRes("config/guide/guide_" + param, cc.JsonAsset, function(err, resource) {
              if (err) return;
              var task = resource.json;
              guideLayer.setTask(task);
              guideLayer.run();
            });
          });
        }
      };
      return JumpUtils;
    }();
    exports.default = JumpUtils;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/UIMgr": "UIMgr",
    "../../Common/Common": "Common",
    "../../Data/Interface/UIData": "UIData"
  } ],
  KSADApi: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "a6892LSTvRDvoXtK6oZOfJ9", "KSADApi");
    "use strict";
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var KSADApi = function() {
      function KSADApi() {
        this.SystemBannerData = null;
        this.SystemIntersData = null;
        this.VideoData = null;
        this.PassiveVideoData = null;
        this.NativeBannerData = null;
        this.NativeIntersData = null;
        this.NativeIconData = null;
        this.JGGBoxData = null;
        this.TIMingData = null;
        this.BlockData = null;
        this.AdCustomIntersData = null;
        this.AdCustomBannerData = null;
        this.ADNewNativeAdData = null;
        this.ADNewNativeTypeData = null;
        this.wx = window["wx"];
        this.bannerAd = null;
        this._autoBannerClose = false;
        this.interstitialAd = null;
        this.rewardedVideoAd = null;
        this.m_videoAdIsLoaded = false;
        this.nativeAd = null;
        this.resTemp = null;
        this.gridAd = null;
        this.title = "\u8d85\u4e0a\u763e\u7684\u89e3\u5bc6\u6e38\u620f\uff0c\u6311\u6218\u4f60\u7684\u667a\u5546\uff01";
        this.shareUrl = "https://res.efunent.com/dev2/web2/LceFirePeople/qq/data/share.jpg";
        this.systemInfo = null;
        this.customIntersAd = null;
        this.customIconAd = null;
        this.loadSucc_IconAd = false;
        this.loadSucc_CuctomInters = false;
        this.CuctomIntervalTime = true;
        this.Time = new Date().getTime();
        this.MinTime = 6e4;
      }
      KSADApi.prototype.setGroup = function(group) {};
      KSADApi.prototype.onInit = function(_callback) {
        if (null !== this.wx && void 0 !== this.wx) {
          this.systemInfo = this.wx.getSystemInfoSync();
          this.Time = new Date().getTime();
          this.createInsertAd();
          this.createVideo();
        } else this.wx = null;
        _callback && _callback();
        console.log("wx ===================> onInit   ok");
      };
      KSADApi.prototype.onLogin = function() {};
      KSADApi.prototype.onShare = function(_callback) {
        if (null != this.wx && void 0 != this.wx) {
          console.log("wx\u5e73\u53f0 \u5206\u4eab");
          this.wx.shareAppMessage({
            title: this.title,
            imageUrl: this.shareUrl,
            success: function() {
              _callback && _callback(1);
            },
            fail: function() {
              _callback && _callback(0);
            }
          });
        }
      };
      KSADApi.prototype.ShareVideo = function(_title, templateId, _callback) {
        this.recorder && this.recorder.publishVideo({
          callback: function(error) {
            if (null != error && void 0 != error) {
              console.log("\u5206\u4eab\u5f55\u5c4f\u5931\u8d25: " + JSON.stringify(error));
              _callback && _callback("\u5206\u4eab\u5931\u8d25");
              return;
            }
            console.log("\u5206\u4eab\u5f55\u5c4f\u6210\u529f");
            _callback && _callback("1");
          }
        });
      };
      KSADApi.prototype.createBanner = function() {};
      KSADApi.prototype.showBanner = function() {};
      KSADApi.prototype.hideBanner = function(close) {
        void 0 === close && (close = false);
      };
      KSADApi.prototype.showNativeBanner = function() {};
      KSADApi.prototype.hideNativeBanner = function() {};
      KSADApi.prototype.createVideo = function() {
        if (null == this.wx && void 0 == this.wx) return;
        if (this.VideoData && this.VideoData.enabled && "" != this.VideoData.vendor_position) {
          console.log("wx\u5e73\u53f0 \u521b\u5efa\u6fc0\u52b1\u89c6\u9891\u5e7f\u544a");
          this.rewardedVideoAd = this.wx.createRewardedVideoAd({
            adUnitId: this.VideoData.vendor_position
          });
          this.rewardedVideoAd.onError(function(err) {
            console.log("wxH5GameAPI \u6fc0\u52b1\u89c6\u9891 \u52a0\u8f7d\u5931\u8d25:code =====>:" + err.code + "message ======>:" + JSON.stringify(err));
          });
        }
      };
      KSADApi.prototype.showVideo = function(_successCallback) {
        var _this = this;
        if (null == this.wx && void 0 == this.wx) return;
        if (this.VideoData && this.VideoData.enabled && "" != this.VideoData.vendor_position) {
          this.rewardedVideoAd.show();
          var onClose_1 = function(res) {
            if (res.isEnded) {
              console.log("\u6fc0\u52b1\u89c6\u9891\u5e7f\u544a\u5b8c\u6210\uff0c\u53d1\u653e\u5956\u52b1");
              _successCallback && _successCallback(true);
            } else {
              console.log("\u6fc0\u52b1\u89c6\u9891\u5e7f\u544a\u53d6\u6d88\u5173\u95ed\uff0c\u4e0d\u53d1\u653e\u5956\u52b1");
              _successCallback && _successCallback(false);
            }
            _this.Time = new Date().getTime();
            _this.rewardedVideoAd.offClose(onClose_1);
          };
          this.rewardedVideoAd.onClose(onClose_1);
        }
      };
      KSADApi.prototype.showPassiveVideo = function(_successCallback) {};
      KSADApi.prototype.showVideoAward = function() {};
      KSADApi.prototype.showVideoFail = function() {};
      KSADApi.prototype.createInsertAd = function() {
        if (null == this.wx && void 0 == this.wx) return;
        if (this.SystemIntersData && this.SystemIntersData.enabled && "" != this.SystemIntersData.vendor_position) {
          this.interstitialAd = this.wx.createInterstitialAd({
            adUnitId: this.SystemIntersData.vendor_position
          });
          this.interstitialAd.onError(function(res) {
            console.log("wx InsertAd load Error:" + JSON.stringify(res));
          });
        }
      };
      KSADApi.prototype.showInsertAd = function() {
        var _this = this;
        if (null == this.wx && void 0 == this.wx) return;
        if (false == this.Timing()) return;
        if (this.SystemIntersData && this.SystemIntersData.enabled && "" != this.SystemIntersData.vendor_position) {
          null == this.interstitialAd && this.createInsertAd();
          if (this.interstitialAd) {
            this.interstitialAd.show();
            var onClose_2 = function(res) {
              _this.interstitialAd.offClose(onClose_2);
              _this.interstitialAd.destroy();
              _this.interstitialAd = null;
              _this.Time = new Date().getTime();
            };
            this.interstitialAd.onClose(onClose_2);
          }
        }
      };
      KSADApi.prototype.showCustomAd = function() {};
      KSADApi.prototype.hideCustomAd = function() {};
      KSADApi.prototype.showCustomIconAd = function() {};
      KSADApi.prototype.hideCustomIconAd = function() {};
      KSADApi.prototype.createNativeAd = function() {};
      KSADApi.prototype.showNativeAd = function(adIdKey, _callback, openIdKey) {};
      KSADApi.prototype.onNativeAdClick = function(_id) {};
      KSADApi.prototype.onNativeReportAdShow = function(_id) {};
      KSADApi.prototype.createNativeIconAd = function() {};
      KSADApi.prototype.showNativeIconAd = function() {};
      KSADApi.prototype.onNativeIconAdClick = function(_id) {};
      KSADApi.prototype.showGridAd = function() {};
      KSADApi.prototype.hideGridAd = function() {};
      KSADApi.prototype.saveDataToCache = function(_key, _value) {};
      KSADApi.prototype.readDataFromCache = function(_key) {};
      KSADApi.prototype.addDesktop = function(_callback) {
        this.wx.addShortcut({
          success: function(res) {
            console.log("MINIGAME ===> ", "\u6dfb\u52a0\u684c\u9762\u6210\u529f");
            _callback(true);
          },
          fail: function(res) {
            console.log("MINIGAME ===> ", "\u6dfb\u52a0\u684c\u9762\u5931\u8d25\uff1a", JSON.stringify(res));
            _callback(false);
          }
        });
      };
      KSADApi.prototype.hasShortcutInstalled = function(_callback) {};
      KSADApi.prototype.StartRecorder = function(_duration) {
        this.recorder = this.wx.getGameRecorder();
        this.recorder.start();
      };
      KSADApi.prototype.stopRecordScreen = function() {
        this.recorder && this.recorder.stop();
      };
      KSADApi.prototype.createMoreGamesBtn = function() {};
      KSADApi.prototype.showMoreGamesBtn = function() {};
      KSADApi.prototype.jumpToGame = function(_packageName) {};
      KSADApi.prototype.addColorBookmark = function() {};
      KSADApi.prototype.addSubscribeApp = function() {};
      KSADApi.prototype.vibrateShort = function() {
        null !== this.wx && void 0 !== this.wx && this.wx.vibrateShort && this.wx.vibrateShort();
      };
      KSADApi.prototype.vibrateLong = function() {
        null !== this.wx && void 0 !== this.wx && this.wx.vibrateLong && this.wx.vibrateLong();
      };
      KSADApi.prototype.recordClipRecorder = function(data) {};
      KSADApi.prototype.pauseGameVideo = function() {};
      KSADApi.prototype.resumeGameVideo = function() {};
      KSADApi.prototype.getNativeAdInfo = function(type) {};
      KSADApi.prototype.getHWNativeAdInfo = function(_infoCallback) {};
      KSADApi.prototype.reportNativeImageClick = function(id) {};
      KSADApi.prototype.reportNativeImageShow = function(id) {};
      KSADApi.prototype.loadNativeImage = function() {};
      KSADApi.prototype.getNativeIconAdInfo = function(type) {};
      KSADApi.prototype.reportNativeIconClick = function(_id) {};
      KSADApi.prototype.reportNativeIconShow = function(_id) {};
      KSADApi.prototype.loadNativeIcon = function() {};
      KSADApi.prototype.showNavigateBoxPortal = function() {};
      KSADApi.prototype.showNavigateBoxBanner = function() {};
      KSADApi.prototype.hideNavigateBoxBanner = function() {};
      KSADApi.prototype.phoneVibrate = function(isLong) {};
      KSADApi.prototype.reportAnalytics = function(name, value) {};
      KSADApi.prototype.navigateToScene = function(_succeedcallback, _failcallback) {};
      KSADApi.prototype.Share = function(_succeedcallback, _failcallback) {};
      KSADApi.prototype.showNewNativeAd = function() {};
      KSADApi.prototype.hideNewNativeAd = function() {};
      KSADApi.prototype.showCustomBanner = function() {};
      KSADApi.prototype.hideCustomBanner = function() {};
      KSADApi.prototype.showCustomType12 = function(type, playSuccessCall) {};
      KSADApi.prototype.showADNewNativeType12 = function(type, playSuccessCall) {};
      KSADApi.prototype.ShowGameIconAd = function() {};
      KSADApi.prototype.HideGameIconAd = function() {};
      KSADApi.prototype.Timing = function() {
        var nowTime = new Date().getTime();
        if (nowTime - this.Time > this.MinTime) {
          this.Time = nowTime;
          return true;
        }
        console.log("\u70b9\u6162\u70b9");
        return false;
      };
      KSADApi = __decorate([ ccclass ], KSADApi);
      return KSADApi;
    }();
    exports.default = KSADApi;
    cc._RF.pop();
  }, {} ],
  LRUCache: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "5d097H4LQlJ0YYSa/9oIwSC", "LRUCache");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Node = function() {
      function Node(key, data) {
        this.key = key;
        this.data = data;
      }
      return Node;
    }();
    var LRUCache = function() {
      function LRUCache(capacity) {
        this.capacity = 0;
        this._hashmap = {};
        this.capacity = capacity;
        this.head = new Node();
        this.tail = new Node();
        this.head.next = this.tail;
        this.tail.prev = this.head;
      }
      LRUCache.prototype.print = function() {
        console.log(this._hashmap);
      };
      LRUCache.prototype.get = function(key) {
        var node = this._hashmap[key];
        if (!node) return "";
        if (1 == this.count) return node.data;
        this.detach(node);
        this.attach(this.head, node);
        return node.data;
      };
      LRUCache.prototype.pack = function(key, data) {
        if (this.capacity <= 0) return;
        var node = this._hashmap[key];
        if (node) {
          this.detach(node);
          this.attach(this.head, node);
          node.data = data;
        } else {
          node = new Node(key, data);
          this._hashmap[key] = node;
          this.attach(this.head, node);
          if (this.count > this.capacity) {
            var nodeToRemove = this.tail.prev;
            return nodeToRemove;
          }
        }
        return null;
      };
      LRUCache.prototype.remove = function(key) {
        var nodeToRemove = this._hashmap[key];
        if (!nodeToRemove) return;
        this.detach(nodeToRemove);
        this._hashmap[key] = null;
        delete this._hashmap[key];
      };
      LRUCache.prototype.removeAll = function() {
        var keys = Object.keys(this._hashmap);
        for (var i = 0; i < keys.length; i++) this.remove(keys[i]);
      };
      Object.defineProperty(LRUCache.prototype, "hashmap", {
        get: function() {
          return this._hashmap;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(LRUCache.prototype, "count", {
        get: function() {
          var keys = Object.keys(this._hashmap);
          return keys.length;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(LRUCache.prototype, "oldNode", {
        get: function() {
          return this.tail.prev;
        },
        enumerable: true,
        configurable: true
      });
      LRUCache.prototype.attach = function(head, node) {
        node.prev = head;
        node.next = head.next;
        node.next.prev = node;
        node.prev.next = node;
      };
      LRUCache.prototype.detach = function(node) {
        node.prev.next = node.next;
        node.next.prev = node.prev;
      };
      return LRUCache;
    }();
    exports.LRUCache = LRUCache;
    cc._RF.pop();
  }, {} ],
  LevelGoMapBtn: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f540cZpeHtKd6OyKO0TkDxv", "LevelGoMapBtn");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Logic/Data/Const/Event");
    var M_1 = require("../../../Base/Manager/M");
    var MapIslandUtils_1 = require("../../../Logic/SimulationOperation/View/Map/MapIslandUtils");
    var HotelData_1 = require("../../../Logic/Hotel/HotelData");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var LevelGoMapBtn = function(_super) {
      __extends(LevelGoMapBtn, _super);
      function LevelGoMapBtn() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.openNode = null;
        _this.starLabel = null;
        _this.animation = null;
        return _this;
      }
      LevelGoMapBtn.prototype.onDestroy = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.UnLockIsland, this.doAnimation, this);
      };
      LevelGoMapBtn.prototype.onLoad = function() {
        EventMgr_1.default.ins.register(Event_1.Event.Map.UnLockIsland, this.doAnimation, this);
      };
      LevelGoMapBtn.prototype.start = function() {
        var roomConfig = HotelData_1.HotelData.getHotelRoomConfig(1);
        var lvData = M_1.default.runtime.getNativeLvData(roomConfig.openLevel);
        lvData && lvData.star > 0 && lvData.score > 0 ? this.openNode.opacity = 0 : this.starLabel.string = "\u7b2c" + roomConfig.openLevel + "\u5173\u5f00\u542f";
      };
      LevelGoMapBtn.prototype.doAnimation = function() {
        this.openNode.opacity = 255;
        this.animation.play();
      };
      LevelGoMapBtn.prototype.onFinished = function() {
        EventMgr_1.default.ins.send(Event_1.Event.UI.LevelSceneTouched, true);
      };
      LevelGoMapBtn.prototype.onClickBtn = function() {
        var roomConfig = HotelData_1.HotelData.getHotelRoomConfig(1);
        var lvData = M_1.default.runtime.getNativeLvData(roomConfig.openLevel);
        MapIslandUtils_1.default.openMapIsland();
      };
      __decorate([ property(cc.Node) ], LevelGoMapBtn.prototype, "openNode", void 0);
      __decorate([ property(cc.Label) ], LevelGoMapBtn.prototype, "starLabel", void 0);
      __decorate([ property(cc.Animation) ], LevelGoMapBtn.prototype, "animation", void 0);
      LevelGoMapBtn = __decorate([ ccclass ], LevelGoMapBtn);
      return LevelGoMapBtn;
    }(cc.Component);
    exports.default = LevelGoMapBtn;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/Manager/M": "M",
    "../../../Logic/Data/Const/Event": "Event",
    "../../../Logic/Hotel/HotelData": "HotelData",
    "../../../Logic/SimulationOperation/View/Map/MapIslandUtils": "MapIslandUtils"
  } ],
  LevelMapCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "6b61cG3Z/BDX5skXT+Nsw2Z", "LevelMapCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIMgr_1 = require("../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Logic/Data/Interface/UIData");
    var Common_1 = require("../../Logic/Common/Common");
    var Constant_1 = require("../../Logic/Data/Const/Constant");
    var M_1 = require("../../Base/Manager/M");
    var Util_1 = require("../../Base/Utils/Util");
    var BaseConst_1 = require("../../Base/BaseConst");
    var Event_1 = require("../../Logic/Data/Const/Event");
    var SelectChapterCtrl_1 = require("./SelectChapterCtrl");
    var SelectLevelCtrl_1 = require("../../Logic/Common/UI/SelectLevelCtrl");
    var ChapterItemCtrl_1 = require("./ChapterItemCtrl");
    var BoxGiftCtrl_1 = require("../../Logic/Common/UI/BoxGiftCtrl");
    var RankPanelCtrl_1 = require("./RankPanelCtrl");
    var GuideUtils_1 = require("../../../GodGuide/GuideUtils");
    var MapIslandUtils_1 = require("../../Logic/SimulationOperation/View/Map/MapIslandUtils");
    var Apps_1 = require("../../Base/Apps");
    var BuyPowerCtrl_1 = require("../../Logic/Common/UI/BuyPowerCtrl");
    var AudioCtrl_1 = require("../../Logic/Common/AudioCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var LevelMapCtrl = function(_super) {
      __extends(LevelMapCtrl, _super);
      function LevelMapCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.curLvLab = null;
        _this.powerLab = null;
        _this.coinLab = null;
        _this.diamondLab = null;
        _this.starLab = null;
        _this.remainTimeLab = null;
        _this.avatarSprite = null;
        _this.islandParent = null;
        _this.chapterNode = null;
        _this.boxGiftNode = null;
        _this.uiNode = null;
        _this.rankPanel = null;
        _this.buyPowerPanel = null;
        _this.selectLvNode = null;
        _this.chapterItemPrefab = null;
        _this.goMapBtn = null;
        _this.buyPowerBtn = null;
        _this.guidePrefab = null;
        _this.btnGoMatchBtn = null;
        _this.tili = null;
        _this._selectChapterCtrl = null;
        _this._selectLevelCtrl = null;
        _this._mainPageView = null;
        _this._boxGiftCtrl = null;
        return _this;
      }
      LevelMapCtrl.prototype.onLoad = function() {
        this._initView();
        this._initEvent();
        this._checkOfflineReward();
        this._checkJumpSceneTask();
        this._checkHavaReward();
        this._onUpdateReminTime();
        M_1.default.event.send(Event_1.Event.Sound.PlayBGM, AudioCtrl_1.AudioID.BGM1);
      };
      LevelMapCtrl.prototype.start = function() {};
      LevelMapCtrl.prototype.onDestroy = function() {
        this._destoryEvent();
      };
      LevelMapCtrl.prototype._initView = function() {
        this._initChapter();
        this._initLevelDisplay();
        this._initIslandDisplay();
        this._initCrrencyDisplay();
        this._checkAuth();
        if (Util_1.Util.Tool.isIpx()) {
          var widget = this.uiNode.getChildByName("Top").getComponent(cc.Widget);
          widget.top = 70;
          widget.updateAlignment();
        }
      };
      LevelMapCtrl.prototype._checkAuth = function() {
        var _this = this;
        M_1.default.platform.getUserInfo().then(function(info) {
          var result = null;
          result = info ? new Promise(function(resolve) {
            return resolve(info);
          }) : M_1.default.platform.createAuthButton({
            x: 0,
            y: 0,
            w: cc.winSize.width,
            h: cc.winSize.height
          });
          return result;
        }).then(function(userinfo) {
          if (userinfo) {
            M_1.default.net.login(true);
            _this._updateAvatar(userinfo);
          }
        });
      };
      LevelMapCtrl.prototype._initEvent = function() {
        M_1.default.event.register(Event_1.Event.UI.UpdateCurrency, this._onUpdateCrrencyView, this);
        M_1.default.event.register(Event_1.Event.UI.HideSelectLevelView, this.onHideSelectLevelView, this);
        M_1.default.event.register(Event_1.Event.UI.UpdateRemainAddPowerTime, this._onUpdateReminTime, this);
        M_1.default.event.register(Event_1.Event.UI.LevelSceneTouched, this.onTouchLayerEnable, this);
        M_1.default.event.register(Event_1.Event.UI.ChapterUnlock, this.doChapterUnlock, this);
      };
      LevelMapCtrl.prototype._destoryEvent = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.UpdateCurrency, this._onUpdateCrrencyView, this);
        M_1.default.event.unRegister(Event_1.Event.UI.HideSelectLevelView, this.onHideSelectLevelView, this);
        M_1.default.event.unRegister(Event_1.Event.UI.UpdateRemainAddPowerTime, this._onUpdateReminTime, this);
        M_1.default.event.unRegister(Event_1.Event.UI.ChapterUnlock, this.doChapterUnlock, this);
      };
      LevelMapCtrl.prototype._showSelectDlg = function() {
        var next = GuideUtils_1.GuideUtils.checkMatchNext();
        next && UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.SelectShowTarget, {
          type: UIData_1.UIHudDef.SelectShowTarget,
          data: M_1.default.runtime.SelectLevel || null
        });
      };
      LevelMapCtrl.prototype.onLevelBtnClick = function() {
        M_1.default.runtime.SelectLevel = 0;
        this._showSelectDlg();
      };
      LevelMapCtrl.prototype.onGoMapSceneBtnClick = function() {
        MapIslandUtils_1.default.openMapIsland();
      };
      LevelMapCtrl.prototype.onShareBtnClick = function() {
        M_1.default.platform.share("\u5206\u4eab\u6d4b\u8bd5.....", "https://mini-ga0.cos.ap-guangzhou.myloud.com/soe/Share/testshare.png");
      };
      LevelMapCtrl.prototype.onShowDailyTaskBtnClick = function() {
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.DailyTaskPanel);
      };
      LevelMapCtrl.prototype._checkOfflineReward = function() {
        var _this = this;
        M_1.default.runtime.getServerConfig().then(function(config) {
          config && _this._showOfflineRewar(config.time);
        });
      };
      LevelMapCtrl.prototype._checkHavaReward = function() {
        if (M_1.default.runtime.RewardTask && M_1.default.runtime.RewardTask.reward) {
          var rewards = Common_1.default.getRewardArray(M_1.default.runtime.RewardTask.reward);
          M_1.default.ui.showUI(UIData_1.UIHudDef.OpenBox, {
            config: {
              rewards: rewards,
              text: M_1.default.runtime.RewardTask.text
            }
          });
          M_1.default.runtime.RewardTask = null;
          GuideUtils_1.GuideUtils.stopGuide = true;
        }
      };
      LevelMapCtrl.prototype.onAddBtnClick = function(event, customValue) {
        var type = BaseConst_1.CurrencyId.Diamond;
        switch (customValue) {
         case "coin":
          type = BaseConst_1.CurrencyId.Coin;
          this._addCrrencyClick(type);
          break;

         case "power":
          type = BaseConst_1.CurrencyId.Power;
          this.buyPowerPanel.getComponent(BuyPowerCtrl_1.default).show();
          break;

         case "diamond":
          type = BaseConst_1.CurrencyId.Diamond;
          this._addCrrencyClick(type);
        }
      };
      LevelMapCtrl.prototype._checkJumpSceneTask = function() {
        if (M_1.default.runtime.SceneTask && M_1.default.runtime.SceneTask.length > 0) {
          var task = M_1.default.runtime.SceneTask.shift();
          switch (task) {
           case Constant_1.SceneTaskKey.ShowTargetDlg:
            M_1.default.ui.closeAllUI();
            this._showSelectDlg();
          }
          this._checkJumpSceneTask();
        }
      };
      LevelMapCtrl.prototype._initLevelDisplay = function() {
        this.curLvLab.string = "\u7b2c" + M_1.default.runtime.getMatch3Level() + "\u5173";
      };
      LevelMapCtrl.prototype._initChapter = function() {
        this._boxGiftCtrl = this.boxGiftNode.getComponent(BoxGiftCtrl_1.default);
        this._mainPageView = this.islandParent.parent.getComponent(cc.PageView);
        this._selectChapterCtrl = this.chapterNode.getComponent(SelectChapterCtrl_1.default);
        this._selectLevelCtrl = this.selectLvNode.getComponent(SelectLevelCtrl_1.default);
        this._selectChapterCtrl && this._selectChapterCtrl.init(this._onShowSelectLevelView.bind(this));
      };
      LevelMapCtrl.prototype._initIslandDisplay = function() {
        var _this = this;
        var datas = M_1.default.table.ChapterInfo.getData();
        var curIndex = 0;
        datas.forEach(function(info, i) {
          var kk = M_1.default.nodePool.createItem(null);
          kk.setContentSize(cc.winSize.width, 0);
          _this._mainPageView.addPage(kk);
          var item = M_1.default.nodePool.createItem(_this.chapterItemPrefab);
          item.parent = kk;
          item.getComponent(ChapterItemCtrl_1.default).init(info, 1, _this._onIslandClick.bind(_this));
          var curLv = M_1.default.runtime.getMatch3Level();
          curLv > info.minLv && curLv < info.maxLv && (curIndex = i);
        });
        if (3001 == GuideUtils_1.GuideUtils.curGuideId) {
          this.onTouchLayerEnable(false);
          curIndex = 0;
        }
        this.scheduleOnce(function() {
          _this._mainPageView.scrollToPage(curIndex, .04);
          _this.onPageViewChanged();
        }, .1);
      };
      LevelMapCtrl.prototype._updateAvatar = function(userinfo) {
        var _this = this;
        userinfo.avatarUrl && Common_1.default.getRemotPic(userinfo.avatarUrl).then(function(frame) {
          frame && (_this.avatarSprite.spriteFrame = frame);
        });
      };
      LevelMapCtrl.prototype._initCrrencyDisplay = function() {
        this.coinLab.string = M_1.default.runtime.getFormateCoin();
        this.diamondLab.string = M_1.default.runtime.getCurrencyStr(BaseConst_1.CurrencyId.Diamond);
        this.starLab.string = M_1.default.runtime.getStarCount().toString();
        var curPower = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power);
        this.powerLab.string = curPower + "/" + Constant_1.MaxPowerCount;
        this.buyPowerBtn.active = !(curPower > Constant_1.MaxPowerCount);
      };
      LevelMapCtrl.prototype._addCrrencyClick = function(type) {
        Apps_1.default.isDebug && M_1.default.runtime.addCurrency(type, 1e7);
      };
      LevelMapCtrl.prototype._onIslandClick = function() {
        this._showSelectChapterView();
      };
      LevelMapCtrl.prototype._onUpdateCrrencyView = function(type, count) {
        void 0 === count && (count = 0);
        var label = this[M_1.default.runtime.getCurrencyKey(type) + "Lab"];
        if (label) if (type == BaseConst_1.CurrencyId.Power) {
          var curPower = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power);
          label.string = curPower + "/" + Constant_1.MaxPowerCount;
          this.buyPowerBtn.active = !(curPower >= Constant_1.MaxPowerCount);
        } else if (type == BaseConst_1.CurrencyId.Coin) {
          var v = count.toString();
          type == BaseConst_1.CurrencyId.Coin && (v = Common_1.default.bytesToSize(count));
          label.string = v;
        } else type == BaseConst_1.CurrencyId.Diamond && (label.string = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Diamond));
      };
      LevelMapCtrl.prototype._onShowSelectLevelView = function(data) {
        this.selectLvNode.active = true;
        this._selectLevelCtrl.init(data);
        var animation = this.selectLvNode.getComponent(cc.Animation);
        animation.play("ShowSelectLevel");
      };
      LevelMapCtrl.prototype._showOfflineRewar = function(currentSerTime) {
        var lastTime = M_1.default.runtime.getLastTime();
        var gapTime = currentSerTime - lastTime;
        if (lastTime > 1e6 && gapTime > Constant_1.PowerConfig.NormalTime) {
          var offlinePower = gapTime / Constant_1.PowerConfig.NormalTime >> 0;
          var cpower = M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power);
          if (cpower < Constant_1.MaxPowerCount) {
            var power = cpower + offlinePower > Constant_1.MaxPowerCount ? Constant_1.MaxPowerCount - cpower : offlinePower;
            if (power > 0) {
              M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, power);
              M_1.default.tips.show("" + Constant_1.WaringTips.OfflineReward + power + "\u80fd\u91cf");
            }
          }
        }
        M_1.default.runtime.setServerTime(currentSerTime);
        this._onUpdateReminTime();
      };
      LevelMapCtrl.prototype._showSelectChapterView = function() {
        this.chapterNode.active = true;
        this._boxGiftCtrl.onOtherClick();
      };
      LevelMapCtrl.prototype._onUpdateReminTime = function(curTimeCount) {
        void 0 === curTimeCount && (curTimeCount = 0);
        if (M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power) >= Constant_1.MaxPowerCount) this.remainTimeLab.string = "\u6ee1\u4e86!"; else if (curTimeCount) {
          var time = Constant_1.PowerConfig.NormalTime - curTimeCount % Constant_1.PowerConfig.NormalTime;
          this.remainTimeLab.string = Util_1.Util.Timer.conversionTime(time, true, {
            m: true
          }) + " \u540e +" + Constant_1.PowerConfig.NormalCount;
        }
      };
      LevelMapCtrl.prototype.onHideSelectChapterView = function() {
        this.chapterNode.active = false;
      };
      LevelMapCtrl.prototype.onPageViewChanged = function() {
        var data = M_1.default.table.ChapterInfo.getByPrimaryKey(this._mainPageView.getCurrentPageIndex() + 1);
        this._boxGiftCtrl.updatePage(data.minLv, data.maxLv);
      };
      LevelMapCtrl.prototype.onRankBtnClick = function() {
        this.rankPanel.getComponent(RankPanelCtrl_1.default).onInit();
      };
      LevelMapCtrl.prototype.onHideSelectLevelView = function() {
        var _this = this;
        var animation = this.selectLvNode.getComponent(cc.Animation);
        animation.play("HideSelectLevel");
        this.scheduleOnce(function() {
          _this.selectLvNode.active = false;
        }, .5);
      };
      LevelMapCtrl.prototype.onTouchLayerEnable = function(data) {
        var touchLayer = cc.find("TouchLayer");
        if (touchLayer) {
          var blockInputEvents = touchLayer.getComponent(cc.BlockInputEvents);
          blockInputEvents && (blockInputEvents.enabled = !data);
        }
      };
      LevelMapCtrl.prototype.onShopBtnClick = function() {
        M_1.default.ui.showUI(UIData_1.UIHudDef.ShopPanel);
      };
      LevelMapCtrl.prototype.onClickHead = function() {
        Apps_1.default.isOpenGM && UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GMView);
      };
      LevelMapCtrl.prototype.doChapterUnlock = function(data) {
        this._mainPageView.scrollToPage(data.index, 1);
        if (data.play) {
          var node = this._mainPageView.getPages()[data.index];
          if (node) {
            var itemCtrl = node.getComponentInChildren(ChapterItemCtrl_1.default);
            itemCtrl && itemCtrl.doCloudUnlock();
          }
        }
      };
      __decorate([ property(cc.Label) ], LevelMapCtrl.prototype, "curLvLab", void 0);
      __decorate([ property(cc.Label) ], LevelMapCtrl.prototype, "powerLab", void 0);
      __decorate([ property(cc.Label) ], LevelMapCtrl.prototype, "coinLab", void 0);
      __decorate([ property(cc.Label) ], LevelMapCtrl.prototype, "diamondLab", void 0);
      __decorate([ property(cc.Label) ], LevelMapCtrl.prototype, "starLab", void 0);
      __decorate([ property(cc.Label) ], LevelMapCtrl.prototype, "remainTimeLab", void 0);
      __decorate([ property(cc.Sprite) ], LevelMapCtrl.prototype, "avatarSprite", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "islandParent", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "chapterNode", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "boxGiftNode", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "uiNode", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "rankPanel", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "buyPowerPanel", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "selectLvNode", void 0);
      __decorate([ property(cc.Prefab) ], LevelMapCtrl.prototype, "chapterItemPrefab", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "goMapBtn", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "buyPowerBtn", void 0);
      __decorate([ property(cc.Prefab) ], LevelMapCtrl.prototype, "guidePrefab", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "btnGoMatchBtn", void 0);
      __decorate([ property(cc.Node) ], LevelMapCtrl.prototype, "tili", void 0);
      LevelMapCtrl = __decorate([ ccclass ], LevelMapCtrl);
      return LevelMapCtrl;
    }(cc.Component);
    exports.default = LevelMapCtrl;
    cc._RF.pop();
  }, {
    "../../../GodGuide/GuideUtils": "GuideUtils",
    "../../Base/Apps": "Apps",
    "../../Base/BaseConst": "BaseConst",
    "../../Base/Manager/M": "M",
    "../../Base/Manager/UIMgr": "UIMgr",
    "../../Base/Utils/Util": "Util",
    "../../Logic/Common/AudioCtrl": "AudioCtrl",
    "../../Logic/Common/Common": "Common",
    "../../Logic/Common/UI/BoxGiftCtrl": "BoxGiftCtrl",
    "../../Logic/Common/UI/BuyPowerCtrl": "BuyPowerCtrl",
    "../../Logic/Common/UI/SelectLevelCtrl": "SelectLevelCtrl",
    "../../Logic/Data/Const/Constant": "Constant",
    "../../Logic/Data/Const/Event": "Event",
    "../../Logic/Data/Interface/UIData": "UIData",
    "../../Logic/SimulationOperation/View/Map/MapIslandUtils": "MapIslandUtils",
    "./ChapterItemCtrl": "ChapterItemCtrl",
    "./RankPanelCtrl": "RankPanelCtrl",
    "./SelectChapterCtrl": "SelectChapterCtrl"
  } ],
  LevelMarkItem: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "99d13k/ZZZGvrUqgkxgjQtO", "LevelMarkItem");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIMgr_1 = require("../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Logic/Data/Interface/UIData");
    var RuntimeMgr_1 = require("../../Logic/Data/RuntimeMgr");
    var M_1 = require("../../Base/Manager/M");
    var Event_1 = require("../../Logic/Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var LevelMarkItem = function(_super) {
      __extends(LevelMarkItem, _super);
      function LevelMarkItem() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.LabelLevel = null;
        _this.SpBg = null;
        _this.StarNode = null;
        _this.stars = [];
        _this.SpState_complete = null;
        _this.SpState_disable = null;
        _this.SpState_open = null;
        return _this;
      }
      LevelMarkItem.prototype.updateData = function(levelNum) {
        this.curLevelNum = levelNum;
        this.LabelLevel.string = levelNum.toString();
        var curLevel = RuntimeMgr_1.default.ins.getMatch3Level();
        if (levelNum > curLevel) this.SpBg.spriteFrame = this.SpState_disable; else if (levelNum == curLevel) {
          this.SpBg.spriteFrame = this.SpState_open;
          this.setStar(0);
        } else {
          this.SpBg.spriteFrame = this.SpState_complete;
          this.StarNode.active = true;
          var lvData = RuntimeMgr_1.default.ins.getNativeLvData(levelNum);
          this.setStar(lvData.score);
        }
      };
      LevelMarkItem.prototype.setStar = function(star) {
        for (var i = 1; i <= 3; ++i) this.stars[i - 1].active = star >= i;
      };
      LevelMarkItem.prototype.onClickLevel = function() {
        if (this.curLevelNum > RuntimeMgr_1.default.ins.getMatch3Level()) return;
        M_1.default.event.send(Event_1.Event.UI.HideSelectLevelView);
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.SelectShowTarget, {
          type: UIData_1.UIHudDef.SelectShowTarget,
          data: this.curLevelNum
        });
      };
      __decorate([ property(cc.Label) ], LevelMarkItem.prototype, "LabelLevel", void 0);
      __decorate([ property(cc.Sprite) ], LevelMarkItem.prototype, "SpBg", void 0);
      __decorate([ property(cc.Node) ], LevelMarkItem.prototype, "StarNode", void 0);
      __decorate([ property([ cc.Node ]) ], LevelMarkItem.prototype, "stars", void 0);
      __decorate([ property(cc.SpriteFrame) ], LevelMarkItem.prototype, "SpState_complete", void 0);
      __decorate([ property(cc.SpriteFrame) ], LevelMarkItem.prototype, "SpState_disable", void 0);
      __decorate([ property(cc.SpriteFrame) ], LevelMarkItem.prototype, "SpState_open", void 0);
      LevelMarkItem = __decorate([ ccclass ], LevelMarkItem);
      return LevelMarkItem;
    }(cc.Component);
    exports.default = LevelMarkItem;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "../../Base/Manager/UIMgr": "UIMgr",
    "../../Logic/Data/Const/Event": "Event",
    "../../Logic/Data/Interface/UIData": "UIData",
    "../../Logic/Data/RuntimeMgr": "RuntimeMgr"
  } ],
  LevelUpReward: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "70eadDtb0hJsJLVa4fJ+s/d", "LevelUpReward");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var LevelUpReward = function() {
      function LevelUpReward(data) {
        this.id = null;
        this.rewards = null;
        this.id = data.id;
        this._parseRewardInfo(data.reward);
      }
      LevelUpReward.prototype._parseRewardInfo = function(reward) {
        var _this = this;
        if (reward) {
          this.rewards = [];
          reward.forEach(function(item) {
            if (item) {
              var sc = item.split("|");
              var type = Number(sc[0]);
              null != type && void 0 != type && _this.rewards.push({
                type: type,
                count: Number(sc[1])
              });
            }
          });
        }
      };
      return LevelUpReward;
    }();
    exports.default = LevelUpReward;
    cc._RF.pop();
  }, {} ],
  Level: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "14628GHFeBNoI5fGpDGpjdM", "Level");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SingletonFactory_1 = require("../../../Base/Utils/SingletonFactory");
    var RuntimeMgr_1 = require("../RuntimeMgr");
    var Paths_1 = require("../../../Base/Utils/Paths");
    var Level = function() {
      function Level() {
        this.LvDataPool = new Map();
        this.retryCount = 0;
      }
      Level.prototype.preLoadNextCfg = function(lv) {
        this._request((lv || RuntimeMgr_1.default.ins.getMatch3Level()) + 1);
      };
      Level.prototype.getLvCfgData = function(lv, callback) {
        void 0 === lv && (lv = null);
        return __awaiter(this, void 0, Promise, function() {
          var cfg;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              lv = lv || RuntimeMgr_1.default.ins.getMatch3Level();
              lv > RuntimeMgr_1.default.ins.maxMatch3Level && (lv = RuntimeMgr_1.default.ins.maxMatch3Level);
              RuntimeMgr_1.default.ins.CurLevel = lv;
              cfg = this.LvDataPool.get(lv);
              if (cfg) {
                callback && callback(cfg);
                return [ 2, cfg ];
              }
              return [ 4, this._request(lv) ];

             case 1:
              cfg = _a.sent();
              callback && callback(cfg);
              return [ 2, cfg ];
            }
          });
        });
      };
      Level.prototype._request = function(lv) {
        return __awaiter(this, void 0, void 0, function() {
          var isRemotReqeust, version, path, cfg;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              isRemotReqeust = false;
              return [ 4, this._getLevelVersion() ];

             case 1:
              version = _a.sent();
              path = isRemotReqeust ? Paths_1.default.LevelRemotPath + version + "/" : Paths_1.default.LevelCfgPath;
              return [ 4, this._execRequest(lv, path, isRemotReqeust) ];

             case 2:
              cfg = _a.sent();
              if (cfg) {
                this.retryCount = 0;
                this.LvDataPool.set(lv, cfg);
                return [ 2, cfg ];
              }
              this.retryCount++;
              if (this.retryCount > 5) return [ 2, null ];
              return [ 2, this._request(lv) ];
            }
          });
        });
      };
      Level.prototype._getLevelVersion = function() {
        return __awaiter(this, void 0, Promise, function() {
          var version;
          return __generator(this, function(_a) {
            version = "1.0.0";
            return [ 2, version ];
          });
        });
      };
      Level.prototype._execRequest = function(lv, p, isRemotReqeust) {
        var lvStr = "0000" + lv;
        var path = p + "levels-0" + (Math.floor((lv - 1) / 100) + 1) + "/" + lvStr.slice(-4) + ".json";
        var loadStr = isRemotReqeust ? "load" : "loadRes";
        console.log(loadStr, path);
        return new Promise(function(resolve, reject) {
          var isTimeout = false;
          var timeout = setTimeout(function() {
            isTimeout = true;
            resolve(null);
          }, 3e3);
          cc.loader[loadStr](path, function(err, res) {
            if (isTimeout) return reject();
            clearTimeout(timeout);
            if (err || !res) return resolve(null);
            resolve(isRemotReqeust ? res : res.json);
          });
        });
      };
      Level.prototype.destory = function() {
        this.LvDataPool.clear();
      };
      Level.ins = SingletonFactory_1.SingletonFactory.getInstance(Level);
      return Level;
    }();
    exports.default = Level;
    cc._RF.pop();
  }, {
    "../../../Base/Utils/Paths": "Paths",
    "../../../Base/Utils/SingletonFactory": "SingletonFactory",
    "../RuntimeMgr": "RuntimeMgr"
  } ],
  LoadGuide: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "ea46clZRZ5CV5m49ThgGmCR", "LoadGuide");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Locator_1 = require("./Locator");
    var GuideUtils_1 = require("./GuideUtils");
    var GuideData_1 = require("./GuideData");
    var async = require("async");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var LoadGuide = function(_super) {
      __extends(LoadGuide, _super);
      function LoadGuide() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.PREFAB = null;
        _this.parent = null;
        _this.zIndex = 0;
        _this.tasks = [];
        _this.taskFiles = [ "_Guide_level1", "_Guide_level3", "_Guide_level3_1", "_Guide_level3_2", "_Guide_level4", "_Guide_level10", "_Guide_level11", "_Guide_level11_1", "_Guide_level15_rank", "_Guide_level21", "_Guide_level30" ];
        return _this;
      }
      LoadGuide.prototype.loadPrefab = function() {
        try {
          var node = cc.instantiate(this.PREFAB);
          node.zIndex = this.zIndex;
          node.setPosition(cc.v2(0, 0));
          node.parent = this.parent || this.node;
          this._godGuide = node.getComponent("GodGuide");
        } catch (error) {
          cc.error(this.PREFAB);
          cc.error(error);
        }
      };
      LoadGuide.prototype.init = function() {
        this.loadPrefab();
        this.runTask();
        Locator_1.Locator.init();
      };
      LoadGuide.prototype.runTask = function() {
        var _this = this;
        GuideUtils_1.GuideUtils.logError("LoadGuide runTask");
        async.eachSeries(this.tasks, function(taskFile, cb) {
          GuideUtils_1.GuideUtils.logError("taskFile----------\x3e", taskFile);
          var task = require(taskFile).task;
          _this._godGuide.setTask(task);
          _this._godGuide.run(cb);
        }, function(err) {
          GuideUtils_1.GuideUtils.logError("\u4efb\u52a1\u5168\u90e8\u5b8c\u6210");
          _this.checkTaskFile();
        });
      };
      LoadGuide.prototype.checkTaskFile = function() {
        var finishedTask = GuideData_1.GuideData.finishedTaskName;
        var noConditionTask = GuideData_1.GuideData.markNoConditionTask;
        for (var j = 0; j < this.tasks.length; ++j) if (-1 != finishedTask.indexOf(this.tasks[j]) && -1 == noConditionTask.indexOf(this.tasks[j])) {
          this.tasks.splice(j, 1);
          j -= 1;
        }
        GuideData_1.GuideData.clearMarkTasks();
      };
      LoadGuide.prototype.pushTask = function(taskName, forceRun) {
        if (!taskName) return;
        if (-1 == this.tasks.indexOf(taskName)) {
          var newTask = [];
          var taskIndex = this.taskFiles.indexOf(taskName);
          if (-1 == taskIndex) {
            console.error("\u6ca1\u6709\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6\u5230TaskFiles\u4e2d", taskName);
            return;
          }
          newTask[taskIndex] = taskName;
          for (var i = 0; i < this.tasks.length; ++i) {
            taskIndex = this.taskFiles.indexOf(this.tasks[i]);
            if (-1 == taskIndex) {
              console.error("\u6ca1\u6709\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6\u5230TaskFiles\u4e2d", this.tasks[i]);
              break;
            }
            newTask[taskIndex] = this.tasks[i];
          }
          for (var j = 0; j < newTask.length; ++j) if (null == newTask[j]) {
            newTask.splice(j, 1);
            j -= 1;
          }
          this.tasks = newTask;
          this.runTask();
        } else forceRun && this.runTask();
      };
      LoadGuide.prototype.removeTask = function(taskName) {
        console.error(taskName);
      };
      __decorate([ property(cc.Prefab) ], LoadGuide.prototype, "PREFAB", void 0);
      __decorate([ property(cc.Node) ], LoadGuide.prototype, "parent", void 0);
      __decorate([ property() ], LoadGuide.prototype, "zIndex", void 0);
      __decorate([ property([ cc.String ]) ], LoadGuide.prototype, "tasks", void 0);
      LoadGuide = __decorate([ ccclass ], LoadGuide);
      return LoadGuide;
    }(cc.Component);
    exports.default = LoadGuide;
    cc._RF.pop();
  }, {
    "./GuideData": "GuideData",
    "./GuideUtils": "GuideUtils",
    "./Locator": "Locator",
    async: "async"
  } ],
  LoadingScene: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "2e934QmhcRJrJAW1PYlvuYi", "LoadingScene");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../Base/Manager/M");
    var Common_1 = require("../Common/Common");
    var Constant_1 = require("../Data/Const/Constant");
    var Level_1 = require("../Data/Interface/Level");
    var UIData_1 = require("../Data/Interface/UIData");
    var Apps_1 = require("../../Base/Apps");
    var HotelData_1 = require("../Hotel/HotelData");
    var Paths_1 = require("../../Base/Utils/Paths");
    var DailyTaskInfo_1 = require("../../Base/Tabls/DailyTaskInfo");
    var BaseTable_1 = require("../../Base/Manager/Table/BaseTable");
    var GameTableMgr_1 = require("../../Base/Manager/GameTableMgr");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var LoadingScene = function(_super) {
      __extends(LoadingScene, _super);
      function LoadingScene() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.loadingLabel = null;
        _this.versionLabel = null;
        _this.loding = null;
        _this.progress = null;
        _this.startButton = null;
        return _this;
      }
      LoadingScene.prototype.onLoad = function() {
        return __awaiter(this, void 0, void 0, function() {
          var data;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              M_1.default.init();
              M_1.default.platform.init({
                appId: Constant_1.APPID
              });
              return [ 4, M_1.default.net.login() ];

             case 1:
              data = _a.sent();
              M_1.default.runtime.initRemotData(data);
              M_1.default.runtime.getServerConfig();
              return [ 4, GameTableMgr_1.GameTableMgr.ins.execute() ];

             case 2:
              _a.sent();
              this._updateProgress(10);
              HotelData_1.HotelData.initData();
              this._preLoadLevelMap();
              this._initDailyTask();
              return [ 2 ];
            }
          });
        });
      };
      LoadingScene.prototype._preLoadLevelMap = function() {
        var _this = this;
        cc.director.preloadScene(Constant_1.Scene.Hotel, function(completedCount, totalCount, item) {
          _this._updateProgress(Math.ceil(10 + completedCount / totalCount * 20));
        }, function(error, asset) {
          var preloadArr = [ "prefab/ui/SelectShowTarget", "prefab/ui/GameLoading", "prefab/ui/CloudView", "prefab/ui/GameShowTarget" ];
          for (var i = 3; i--; ) preloadArr.push("prefab/LevelMap/island_" + (i + 1));
          preloadArr.push("texture/guide/guide_role_2");
          cc.loader.loadResArray(preloadArr, function(completedCount, totalCount, item) {
            _this._updateProgress(Math.ceil(30 + completedCount / totalCount * 70));
          }, function(err, resource) {
            if (!err) {
              cc.director.preloadScene(Constant_1.Scene.Match);
              Level_1.default.ins.getLvCfgData(null);
              M_1.default.runtime.getServerConfig().then(function(config) {
                !Apps_1.default.isDebug && config && "on" == config.maintain_status ? M_1.default.ui.showUI(UIData_1.UIHudDef.NoticePanel, true) : _this.scheduleOnce(function() {
                  Common_1.default.jumpScene(Constant_1.Scene.Hotel);
                }, 1);
              });
            }
          });
        });
      };
      LoadingScene.prototype._initDailyTask = function() {
        var _this = this;
        cc.loader.load(Paths_1.default.DailyTaskConfig, function(err, tex) {
          return __awaiter(_this, void 0, void 0, function() {
            var _a;
            return __generator(this, function(_b) {
              switch (_b.label) {
               case 0:
                if (err || !tex) {
                  console.error("\u83b7\u53d6\u4efb\u52a1\u914d\u7f6e\u51fa\u9519!");
                  return [ 2 ];
                }
                GameTableMgr_1.GameTableMgr.ins.DailyTaskInfo = new BaseTable_1.BaseTable("id", "DailyTaskInfo", DailyTaskInfo_1.default, null);
                GameTableMgr_1.GameTableMgr.ins.DailyTaskInfo["readyOK"](tex);
                _a = M_1.default.runtime;
                return [ 4, M_1.default.net.getDailyTask() ];

               case 1:
                _a.DailyTaskProgress = _b.sent();
                M_1.default.runtime.initTaskNativeData();
                console.error(" M.runtime.DailyTaskProgress: ", M_1.default.runtime.DailyTaskProgress);
                return [ 2 ];
              }
            });
          });
        });
      };
      LoadingScene.prototype._updateProgress = function(progress) {
        this.loadingLabel.string = "\u52a0\u8f7d\u4e2d " + progress + "%";
      };
      LoadingScene.prototype.testDownloadZip = function() {
        return __awaiter(this, void 0, void 0, function() {
          var url, result;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              url = "https://mini-game-cent251001060.cos.ap-guangzhou.myqcloud.com/soe/test.zip";
              return [ 4, M_1.default.platform.downLoadFile({
                url: url,
                filePath: null
              }) ];

             case 1:
              result = _a.sent();
              return [ 2 ];
            }
          });
        });
      };
      __decorate([ property(cc.Label) ], LoadingScene.prototype, "loadingLabel", void 0);
      __decorate([ property(cc.Label) ], LoadingScene.prototype, "versionLabel", void 0);
      __decorate([ property(cc.Node) ], LoadingScene.prototype, "loding", void 0);
      __decorate([ property(cc.Node) ], LoadingScene.prototype, "progress", void 0);
      __decorate([ property(cc.Node) ], LoadingScene.prototype, "startButton", void 0);
      LoadingScene = __decorate([ ccclass ], LoadingScene);
      return LoadingScene;
    }(cc.Component);
    exports.default = LoadingScene;
    cc._RF.pop();
  }, {
    "../../Base/Apps": "Apps",
    "../../Base/Manager/GameTableMgr": "GameTableMgr",
    "../../Base/Manager/M": "M",
    "../../Base/Manager/Table/BaseTable": "BaseTable",
    "../../Base/Tabls/DailyTaskInfo": "DailyTaskInfo",
    "../../Base/Utils/Paths": "Paths",
    "../Common/Common": "Common",
    "../Data/Const/Constant": "Constant",
    "../Data/Interface/Level": "Level",
    "../Data/Interface/UIData": "UIData",
    "../Hotel/HotelData": "HotelData"
  } ],
  Locator: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "71c10J7fzpJspAGp3Oow6Hq", "Locator");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Locator = function() {
      function Locator() {}
      Locator.init = function() {
        this.locating = false;
        this.startTime = 0;
        this.timeout = 5e3;
      };
      Locator.parse = function(locator) {
        cc["assert"](locator, "locator string is null");
        var names = locator.split(/[.,//,>,#]/g);
        var segments = names.map(function(name) {
          var index = locator.indexOf(name);
          var symbol = locator[index - 1] || ">";
          return {
            symbol: symbol,
            name: name.trim()
          };
        });
        return segments;
      };
      Locator.seekNodeByName = function(root, name) {
        if (!root) return null;
        if (root.getName() == name) return root;
        var arrayRootChildren = root.getChildren();
        var length = arrayRootChildren.length;
        for (var i = 0; i < length; i++) {
          var child = arrayRootChildren[i];
          var res = this.seekNodeByName(child, name);
          if (null != res) return res;
        }
        return null;
      };
      Locator.locateNode = function(root, locator, cb) {
        var _this = this;
        if (!Locator.locating) {
          this.startTime = Date.now();
          this.locating = true;
        }
        var segments = Locator.parse(locator);
        cc["assert"](segments && segments.length);
        var child, node = root;
        for (var i = 0; i < segments.length; i++) {
          var item = segments[i];
          switch (item.symbol) {
           case "/":
            child = node.getChildByName(item.name);
            break;

           case ".":
            child = node[item.name];
            break;

           case ">":
            child = this.seekNodeByName(node, item.name);
          }
          if (!child) {
            node = null;
            break;
          }
          node = child;
        }
        if (node && node.active && cb) {
          this.locating = false;
          cb(null, node);
        } else cb && (Date.now() - this.startTime > this.timeout ? cb({
          error: "timeout",
          locator: locator
        }) : setTimeout(function() {
          _this.locateNode(root, locator, cb);
        }, 10));
        return node;
      };
      Locator.getNodeFullPath = function(node) {
        var array = [];
        var temp = node;
        do {
          array.unshift(temp.name);
          temp = temp.parent;
        } while (temp && "Canvas" !== temp.name);
        return array.join("/");
      };
      Locator.timeout = 5e3;
      return Locator;
    }();
    exports.Locator = Locator;
    window["Locator"] = Locator;
    cc._RF.pop();
  }, {} ],
  LockCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "06addOU3PFBj53mFqsdwoeP", "LockCtrl");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var Util_1 = require("../../../Base/Utils/Util");
    var GameModel_1 = require("../Model/GameModel");
    var LockCtrl = function() {
      function LockCtrl() {
        this.bornLock = {};
        this.fallLock = {};
        this.autoChangeLock = new Set();
      }
      LockCtrl.prototype.isBornPosLocked = function(pos) {
        return !!this.bornLock[Common_1.default.getStringkey(pos)];
      };
      LockCtrl.prototype.lockBornPos = function(pos) {
        this.bornLock[Common_1.default.getStringkey(pos)] = Date.now();
      };
      LockCtrl.prototype.unLockBornPos = function(pos) {
        delete this.bornLock[Common_1.default.getStringkey(pos)];
      };
      LockCtrl.prototype.isBombBornPos = function(pos) {
        var lockEntity = this.fallLock[Common_1.default.getStringkey(pos)];
        if (lockEntity && Util_1.Util.Tool.compareV2(pos, lockEntity.pos)) return true;
        return false;
      };
      LockCtrl.prototype.isFallLocked = function(pos) {
        return !!this.fallLock[Common_1.default.getStringkey(pos)];
      };
      LockCtrl.prototype.isMyLocked = function(pos, keyPos) {
        var lock = this.fallLock[Common_1.default.getStringkey(pos)];
        return !lock || Util_1.Util.Tool.compareV2(lock.pos, keyPos);
      };
      LockCtrl.prototype.unLockFallLockByKey = function(keyPos) {
        for (var key in this.fallLock) {
          var keyEntity = this.fallLock[key];
          if (keyEntity && Util_1.Util.Tool.compareV2(keyEntity.pos, keyPos)) {
            delete this.fallLock[key];
            break;
          }
        }
      };
      LockCtrl.prototype.unLockFallPos = function(pos) {
        delete this.fallLock[Common_1.default.getStringkey(pos)];
      };
      LockCtrl.prototype.lockFallPos = function(pos, keyPos, isForced) {
        void 0 === isForced && (isForced = false);
        var key = Common_1.default.getStringkey(pos);
        var keyEntity = this.fallLock[key];
        (isForced || !keyEntity || keyEntity && keyEntity.pos == keyPos) && (this.fallLock[key] = {
          pos: keyPos,
          time: Date.now()
        });
      };
      LockCtrl.prototype.addAutoExchange = function(pos) {
        this.autoChangeLock.add(Common_1.default.getStringkey(pos));
      };
      LockCtrl.prototype.isAutoExchangeLocked = function(pos) {
        return this.autoChangeLock.has(Common_1.default.getStringkey(pos));
      };
      LockCtrl.prototype.deleteAutoExchangeLock = function(pos) {
        this.autoChangeLock.delete(Common_1.default.getStringkey(pos));
      };
      LockCtrl.prototype.deleteAutoExchangeAll = function() {
        this.autoChangeLock.clear();
      };
      LockCtrl.prototype.update = function() {
        if (this.fallLock) for (var key in this.fallLock) {
          var lockItem = this.fallLock[key];
          var owner = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, lockItem.pos);
          (!owner || owner && (owner.isRemoved() || owner.isDestoryed)) && delete this.fallLock[key];
        }
      };
      return LockCtrl;
    }();
    exports.default = LockCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Utils/Util": "Util",
    "../../Common/Common": "Common",
    "../Model/GameModel": "GameModel"
  } ],
  Log: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9e0b0hp2d1P6azFHsIT9cLM", "Log");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Apps_1 = require("../Apps");
    exports.LOG_TAG = {
      SOCKET: {
        desc: "LOG_SOCKET",
        isOpen: true
      },
      TEST: {
        desc: "LOG_TEST",
        isOpen: false
      },
      CACHE: {
        desc: "LOG_CACHE",
        isOpen: false
      },
      GUIDE: {
        desc: "LOG_GUIDE",
        isOpen: true
      }
    };
    var LEVEL;
    (function(LEVEL) {
      LEVEL[LEVEL["DEBUG"] = 0] = "DEBUG";
      LEVEL[LEVEL["INFO"] = 1] = "INFO";
      LEVEL[LEVEL["WARN"] = 2] = "WARN";
      LEVEL[LEVEL["ERROR"] = 3] = "ERROR";
    })(LEVEL || (LEVEL = {}));
    var CURRENT_LEVEL = LEVEL.DEBUG;
    var TARGET_TAG = "SOE => ";
    var ShowStackAndTime = false;
    var Log = function() {
      function Log() {}
      Log.d = function(msg) {
        var subst = [];
        for (var _i = 1; _i < arguments.length; _i++) subst[_i - 1] = arguments[_i];
        CURRENT_LEVEL < LEVEL.INFO && Apps_1.default.isDebug && console.log.apply(console, [ TARGET_TAG, msg ].concat(subst));
      };
      Log.i = function(msg) {
        var subst = [];
        for (var _i = 1; _i < arguments.length; _i++) subst[_i - 1] = arguments[_i];
        CURRENT_LEVEL < LEVEL.WARN && Apps_1.default.isDebug && console.log.apply(console, [ TARGET_TAG, msg ].concat(subst));
      };
      Log.w = function(msg) {
        var subst = [];
        for (var _i = 1; _i < arguments.length; _i++) subst[_i - 1] = arguments[_i];
        CURRENT_LEVEL < LEVEL.ERROR && Apps_1.default.isDebug && console.warn.apply(console, [ TARGET_TAG, msg ].concat(subst));
      };
      Log.e = function(msg) {
        var subst = [];
        for (var _i = 1; _i < arguments.length; _i++) subst[_i - 1] = arguments[_i];
        Apps_1.default.isDebug && console.error.apply(console, [ TARGET_TAG, msg ].concat(subst));
      };
      Log.log = function(tag) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) args[_i - 1] = arguments[_i];
        var backLog = console.log || cc.log;
        if (!tag || !tag.isOpen) return;
        var arr = Array.prototype.slice.call(arguments);
        arr.splice(0, 1, "[" + tag.desc + "]");
        this.addStackAndTime(arr);
        backLog.apply(backLog, arr);
      };
      Log.warn = function() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) args[_i] = arguments[_i];
        var backLog = console.warn || cc.warn;
        var arr = Array.prototype.slice.call(arguments);
        this.addStackAndTime(arr);
        backLog.apply(backLog, arr);
      };
      Log.error = function() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) args[_i] = arguments[_i];
        var backLog = console.error || cc.error;
        var arr = Array.prototype.slice.call(arguments);
        this.addStackAndTime(arr);
        backLog.apply(backLog, arr);
      };
      Log.addStackAndTime = function(arr) {
        if (ShowStackAndTime) {
          var info = Log.stack(2) + Log.getDateString() + " ";
          arr.splice(0, 0, info);
        }
      };
      Log.getDateString = function() {
        var d = new Date();
        var str = d.getHours().toString();
        var timeStr = "";
        timeStr += (1 == str.length ? "0" + str : str) + ":";
        str = d.getMinutes().toString();
        timeStr += (1 == str.length ? "0" + str : str) + ":";
        str = d.getSeconds().toString();
        timeStr += (1 == str.length ? "0" + str : str) + ":";
        str = d.getMilliseconds().toString();
        1 == str.length && (str = "00" + str);
        2 == str.length && (str = "0" + str);
        timeStr += str;
        timeStr = "[" + timeStr + "]";
        return timeStr;
      };
      Log.stack = function(index) {
        void 0 === index && (index = 2);
        var e = new Error();
        var lines = e.stack.split("\n");
        lines.shift();
        var result = [];
        lines.forEach(function(line) {
          var _a;
          line = line.substring(7);
          var lineBreak = line.split(" ");
          lineBreak.length < 2 ? result.push(lineBreak[0]) : result.push((_a = {}, _a[lineBreak[0]] = lineBreak[1], 
          _a));
        });
        var list = [];
        if (index < result.length - 1) for (var a in result[index]) list.push(a);
        var splitList = list[0].split(".");
        return splitList[0] + ".js->" + splitList[1] + ":";
      };
      return Log;
    }();
    exports.Log = Log;
    cc._RF.pop();
  }, {
    "../Apps": "Apps"
  } ],
  MainCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9517dpB0FtF360gsWHLfv7H", "MainCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../Common/Common");
    var M_1 = require("../../Base/Manager/M");
    var Level_1 = require("../Data/Interface/Level");
    var Tutorial_1 = require("../Data/Interface/Tutorial");
    var GameModel_1 = require("./Model/GameModel");
    var Paths_1 = require("../../Base/Utils/Paths");
    var Log_1 = require("../../Base/Utils/Log");
    var Event_1 = require("../Data/Const/Event");
    var MainUiCtrl_1 = require("./View/UI/MainUiCtrl");
    var GroundViewCtrl_1 = require("./View/GroundViewCtrl");
    var UpGroundViewCtrl_1 = require("./View/UpGroundViewCtrl");
    var BasicCellViewCtrl_1 = require("./View/BasicCellViewCtrl");
    var EffLayerCtrl_1 = require("./View/EffLayerCtrl");
    var Util_1 = require("../../Base/Utils/Util");
    var Constant_1 = require("../Data/Const/Constant");
    var ActionCtrl_1 = require("../Common/ActionCtrl");
    var CollectModel_1 = require("./Model/CollectModel");
    var GroupAnimatCtrl_1 = require("../Common/GroupAnimatCtrl");
    var TimeConfig_1 = require("../Data/Const/TimeConfig");
    var CellBase_1 = require("./Model/CellBase");
    var UIMgr_1 = require("../../Base/Manager/UIMgr");
    var UIData_1 = require("../Data/Interface/UIData");
    var Match3TutorialCtrl_1 = require("./View/Match3TutorialCtrl");
    var Apps_1 = require("../../Base/Apps");
    var GuideUtils_1 = require("../../../GodGuide/GuideUtils");
    var ShaderHelper_1 = require("../../Base/Shader/ShaderHelper");
    var ShaderTime_1 = require("../../Base/Shader/ShaderTime");
    var AudioCtrl_1 = require("../Common/AudioCtrl");
    var OverHightLightCtrl_1 = require("../Common/UI/OverHightLightCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var MainCtrl = function(_super) {
      __extends(MainCtrl, _super);
      function MainCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.bg = null;
        _this.uiNode = null;
        _this.effNode = null;
        _this.gridBoard = null;
        _this.planePrefab = null;
        _this.maskNode = null;
        _this.TutorialPanel = null;
        _this.overMask = null;
        _this.overHightLightNode = null;
        _this.gameModel = null;
        _this.touchCount = 0;
        _this.groundType = null;
        _this.uiCtrl = null;
        _this.effCtrl = null;
        _this.touchTimer = null;
        _this.touchLock = false;
        _this.touchOpenGMPanelCount = 0;
        _this.touchStartPos = cc.v2(0, 0);
        _this.groundViewCtrl = null;
        _this.basicCellViewCtrl = null;
        _this.upGroundViewCtrl = null;
        _this.gridCtrlPool = null;
        _this.gridViewPool = null;
        _this.currentBgIndex = null;
        _this.currentCtrlView = null;
        _this.isShowEndView = false;
        _this._isOverMark = null;
        _this.tutorialData = null;
        _this._useStepCount = 0;
        _this._loadingCount = 0;
        _this._loadingProgre = 0;
        _this._overClickCount = -1;
        _this._moveRowLock = false;
        _this._moveCrossLock = false;
        return _this;
      }
      MainCtrl.prototype.onLoad = function() {
        cc.game.setFrameRate(Constant_1.RunTimeGate);
        Apps_1.default.isDebug && Util_1.Util.Tool.showDebugView(true);
        M_1.default.init();
        M_1.default.changeScene();
        this.initGame();
        this.initEvent();
        this.initTimerEvent();
      };
      MainCtrl.prototype.onDestroy = function() {
        this.removeEvent();
        GameModel_1.default.destory();
        M_1.default.nodePool.destory();
        GroupAnimatCtrl_1.default.ins.destory();
        Common_1.default.CurrentCtrlView = null;
        this.unscheduleAllCallbacks();
        clearTimeout(this.touchTimer);
      };
      MainCtrl.prototype.removeEvent = function() {
        M_1.default.event.unRegister(Event_1.Event.GameCMD.GameOver, this.onGameOver, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.GameResume, this.onGameResume, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.MoveGrid, this.onMoveGrid, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.GameReset, this.reStartGame, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.MainCMD, this.onGameViewTask, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.StopPrompts, this.onStopPrompts, this);
        M_1.default.event.unRegister(Event_1.Event.UI.CollectComplet, this.onCollectComplet, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.SpeCollect, this.onSpeCollectComplet, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.ChangeCell, this.onChangeCellType, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.ShowGameResult, this.showGameOverDialog, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.UpdateComplexView, this.onUpdateComplexView, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.UpdateCollectPower, this.collectPower, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.GameOverFall, this._startFall, this);
      };
      MainCtrl.prototype.initEvent = function() {
        M_1.default.event.register(Event_1.Event.GameCMD.GameOver, this.onGameOver, this);
        M_1.default.event.register(Event_1.Event.GameCMD.GameResume, this.onGameResume, this);
        M_1.default.event.register(Event_1.Event.GameCMD.MoveGrid, this.onMoveGrid, this);
        M_1.default.event.register(Event_1.Event.GameCMD.GameReset, this.reStartGame, this);
        M_1.default.event.register(Event_1.Event.GameCMD.MainCMD, this.onGameViewTask, this);
        M_1.default.event.register(Event_1.Event.GameCMD.StopPrompts, this.onStopPrompts, this);
        M_1.default.event.register(Event_1.Event.UI.CollectComplet, this.onCollectComplet, this);
        M_1.default.event.register(Event_1.Event.GameCMD.ChangeCell, this.onChangeCellType, this);
        M_1.default.event.register(Event_1.Event.GameCMD.SpeCollect, this.onSpeCollectComplet, this);
        M_1.default.event.register(Event_1.Event.GameCMD.UpdateComplexView, this.onUpdateComplexView, this);
        M_1.default.event.register(Event_1.Event.GameCMD.UpdateCollectPower, this.collectPower, this);
        M_1.default.event.register(Event_1.Event.GameCMD.ShowGameResult, this.showGameOverDialog, this);
        M_1.default.event.register(Event_1.Event.GameCMD.GameOverFall, this._startFall, this);
      };
      MainCtrl.prototype.initGame = function() {
        return __awaiter(this, void 0, void 0, function() {
          var lv, data, _a;
          return __generator(this, function(_b) {
            switch (_b.label) {
             case 0:
              M_1.default.runtime.addGameCount();
              this.setZorder(0);
              this.overHightLightNode.getComponent(OverHightLightCtrl_1.default).showStepNode();
              this._useStepCount = M_1.default.runtime.MatchGameTime = 0;
              this._isOverMark = null;
              this.overMask.active = false;
              this._overClickCount = -1;
              this.isShowEndView = false;
              lv = M_1.default.runtime.SelectLevel || null;
              return [ 4, Level_1.default.ins.getLvCfgData(lv) ];

             case 1:
              data = _b.sent();
              M_1.default.event.send(Event_1.Event.UI.UpdateTmpLoadingProgress, 60);
              if (!Constant_1.NewbieOpt) return [ 3, 3 ];
              _a = this;
              return [ 4, Tutorial_1.default.ins.getTurCfgData(lv) ];

             case 2:
              _a.tutorialData = _b.sent();
              _b.label = 3;

             case 3:
              if (!data) return [ 2 ];
              Level_1.default.ins.preLoadNextCfg(lv);
              M_1.default.runtime.gameStar();
              M_1.default.runtime.GameState = Constant_1.GameState.preReady;
              this.uiCtrl = this.uiNode.getComponent(MainUiCtrl_1.default);
              this.effCtrl = this.effNode.getComponent(EffLayerCtrl_1.default);
              this.gameModel = new GameModel_1.default(data);
              this.initBg();
              this.initMapGridView();
              this.uiCtrl.init(this, data);
              return [ 2 ];
            }
          });
        });
      };
      MainCtrl.prototype.setZorder = function(index) {
        void 0 === index && (index = 0);
        if (0 == index) {
          this.node.zIndex = 0;
          this.uiNode.zIndex = 1;
        } else {
          this.node.zIndex = 1;
          this.uiNode.zIndex = 0;
        }
      };
      MainCtrl.prototype.startGame = function() {
        var _this = this;
        UIMgr_1.default.ins.isShowing(UIData_1.UIHudDef.GameLoading) ? this.scheduleOnce(function() {
          UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.GameLoading, false, function() {
            _this.showTargetView();
          });
        }, 1) : this.showTargetView();
      };
      MainCtrl.prototype.reStartGame = function() {
        this.removeCurrentGame();
        this.initGame();
      };
      MainCtrl.prototype.removeCurrentGame = function() {
        GameModel_1.default.destory();
        GroupAnimatCtrl_1.default.ins.destory();
        Common_1.default.CurrentCtrlView = null;
        this.gameModel = null;
        this.maskNode.destroyAllChildren();
      };
      MainCtrl.prototype.showTargetView = function() {
        M_1.default.event.send(Event_1.Event.Sound.PlayBGM, AudioCtrl_1.AudioID.BGM2);
        this.uiCtrl.showTargetDialog(this.preStartShowGrid.bind(this));
        GuideUtils_1.GuideUtils.onMatch3Begin(M_1.default.runtime.SelectLevel || M_1.default.runtime.CurLevel);
      };
      MainCtrl.prototype.initTimerEvent = function() {
        var _this = this;
        this.schedule(function() {
          _this.gameModel && _this.gameModel.timerTrigger();
          _this.checkShowGameOver();
          M_1.default.runtime.MatchGameTime++;
        }, 1, cc.macro.REPEAT_FOREVER, 1);
      };
      MainCtrl.prototype.showCurrentMemory = function() {
        var deps = cc.loader.getDependsRecursively(this.node);
        console.error("m:", deps);
      };
      MainCtrl.prototype.initBg = function() {
        return __awaiter(this, void 0, void 0, function() {
          var lvData, bgIndex, bgInfo, task;
          var _this = this;
          return __generator(this, function(_a) {
            lvData = this.gameModel.getLvData();
            bgIndex = M_1.default.runtime.CurBgIndex = lvData.levelInfo.background || 1;
            if (this.currentBgIndex != bgIndex) {
              this.currentBgIndex = bgIndex;
              this.bg.node.destroyAllChildren();
              this.bg.node.parent.getChildByName("bbg").destroyAllChildren();
              cc.find("top/Auto_record/collectNode/role", this.uiNode).destroyAllChildren();
              bgInfo = Common_1.default.getBgInfo(bgIndex);
              this.groundType = bgInfo.type;
              if (!bgInfo.isWater) {
                this.bg.node.removeComponent(ShaderHelper_1.default);
                this.bg.node.removeComponent(ShaderTime_1.default);
              }
              task = [];
              task.push(Common_1.default.getRes("" + Paths_1.default.Match3Bg + bgIndex + "/" + bgInfo.name, cc.SpriteFrame));
              task.push(Common_1.default.getRes("" + Paths_1.default.Match3Bg + bgIndex + "/" + bgInfo.cfg, cc.JsonAsset));
              Promise.all(task).then(function(data) {
                _this.bg.spriteFrame = data[0];
                var cfg = data[1];
                if (cfg && cfg.json) {
                  _this.updateBgTopAlign(cfg.json.top);
                  var t1 = [];
                  var sub = cfg.json.sub;
                  if (sub) for (var i = sub.length; i--; ) t1.push(_this.addItem2Bg(sub[i]));
                  var txu = cfg.json.texture;
                  if (txu) for (var i = txu.length; i--; ) t1.push(_this.fillItemTexture(txu[i]));
                  _this._loadingCount = t1.length;
                  Promise.all(t1).then(function(res) {
                    console.error("\u5168\u90e8\u52a0\u8f7d\u5b8c\u6210!!!!", res.length);
                    _this.sendUpdateLoadingEvent(100);
                    _this.startGame();
                  });
                }
              });
            } else this.startGame();
            return [ 2 ];
          });
        });
      };
      MainCtrl.prototype.fillItemTexture = function(textureCfg) {
        var _this = this;
        if (textureCfg) {
          var path = "" + Paths_1.default.Match3Bg + this.currentBgIndex + "/" + textureCfg.path;
          return Common_1.default.getRes(path, cc.SpriteFrame).then(function(res) {
            if (res) {
              var node = cc.find("Canvas/" + textureCfg.parent);
              node && (node.getComponent(cc.Sprite).spriteFrame = res);
              _this.sendUpdateLoadingEvent();
            }
          });
        }
      };
      MainCtrl.prototype.addItem2Bg = function(itemCfg) {
        var _this = this;
        if (itemCfg) {
          var path = "" + Paths_1.default.Match3Bg + this.currentBgIndex + "/" + itemCfg.path;
          var type = null;
          switch (itemCfg.type) {
           case "sprite":
            type = cc.SpriteFrame;
            break;

           case "prefab":
            type = cc.Prefab;
          }
          return Common_1.default.getRes(path, type).then(function(res) {
            if (res) {
              var node_1 = null;
              switch (itemCfg.type) {
               case "sprite":
                node_1 = M_1.default.nodePool.createItem(null);
                var sprite = node_1.addComponent(cc.Sprite);
                sprite.spriteFrame = res;
                break;

               case "prefab":
                node_1 = M_1.default.nodePool.createItem(res);
              }
              if (node_1) {
                node_1.parent = cc.find("Canvas/" + itemCfg.parent);
                itemCfg.pos && node_1.setPosition(itemCfg.pos[0], itemCfg.pos[1]);
                var dirs = [ "top", "left", "right", "bottom" ];
                dirs.forEach(function(d) {
                  null != itemCfg[d] && void 0 != itemCfg[d] && Common_1.default.setAlignment(node_1, d, itemCfg[d]);
                });
                var anc = itemCfg.anchor;
                anc && node_1.setAnchorPoint(anc[0], anc[1]);
                var z = itemCfg.z;
                null != z && void 0 != z && (node_1.zIndex = z);
              }
            }
            _this.sendUpdateLoadingEvent();
          });
        }
      };
      MainCtrl.prototype.sendUpdateLoadingEvent = function(zdtarget) {
        void 0 === zdtarget && (zdtarget = null);
        this._loadingProgre++;
        M_1.default.event.send(Event_1.Event.UI.UpdateTmpLoadingProgress, zdtarget || Math.ceil(60 + this._loadingProgre / this._loadingCount * 60));
      };
      MainCtrl.prototype.updateBgTopAlign = function(top) {
        var lvLabPos = this.uiCtrl.getLevelLabelPos();
        var topGap = 0;
        1 == this.currentBgIndex && (topGap = cc.winSize.height - lvLabPos.y - 307);
        Common_1.default.setAlignment(this.bg.node, "top", top + topGap);
      };
      MainCtrl.prototype.onSpeCollectComplet = function(cm) {
        var _this = this;
        var type = cm.getType();
        var pos = cm.getPosition();
        if (type == Constant_1.CellType.Banana) {
          var tree_1 = this.groundViewCtrl.getRandMonkeyTree();
          if (tree_1) {
            var targetPos = Common_1.default.getWorldPos(tree_1.data.tree.node);
            var offset = cc.v2(50, 50);
            this.basicCellViewCtrl.playCollectAni(this.uiNode, type, pos, targetPos.add(offset), null, function() {
              _this.groundViewCtrl.monkeyTreeExpUp(_this.uiNode, tree_1.index);
            });
          }
        } else type == Constant_1.CellType.BottleCaps && this.basicCellViewCtrl.playCollectStepAni(this.uiCtrl, cm);
      };
      MainCtrl.prototype.onCollectComplet = function(type, index, elimateType) {
        var targetPos = this.gameModel.CollectPos || this.uiCtrl.getCollectPos(type);
        var isCanCollect = true;
        switch (type) {
         case CollectModel_1.CollectType.gnome:
          this.groundViewCtrl.playGnomeAni(this.uiNode, index, targetPos);
          break;

         case CollectModel_1.CollectType.box:
          this.upGroundViewCtrl.playCollectAniByType(this.uiNode, index, targetPos, CollectModel_1.CollectType.box);
          break;

         case CollectModel_1.CollectType.colorbox:
          this.upGroundViewCtrl.playCollectAniByType(this.uiNode, index, targetPos, CollectModel_1.CollectType.colorbox);
          break;

         case CollectModel_1.CollectType.gem:
          this.groundViewCtrl.playGemAni(this.uiNode, index, targetPos);
          break;

         case CollectModel_1.CollectType.firefly:
          this.groundViewCtrl.playFireflyAni(this.uiNode, index, targetPos);
          break;

         case CollectModel_1.CollectType.turtles:
          this.groundViewCtrl.playTurtlesAni(this.uiNode, index);
          break;

         case CollectModel_1.CollectType.crab:
          this.groundViewCtrl.playCrabAni(this.uiNode, index);
          break;

         case Constant_1.CellType.Conch:
          console.error("\u6536\u96c6\u6536\u96c6\u6536\u96c6\u6536\u96c6\u6536\u96c6\u8d1d\u58f3");
          isCanCollect = false;
          break;

         default:
          isCanCollect = false;
          this.basicCellViewCtrl.playCollectAni(this.uiNode, type, index, targetPos, elimateType);
        }
        isCanCollect && M_1.default.runtime.addCollectCount(type);
      };
      MainCtrl.prototype.syncGridBoard = function() {
        var index = this.gameModel.mapIndex;
        var cd = this.gridCtrlPool.get(index);
        Common_1.default.CurrentCtrlView = this.currentCtrlView = this.gridViewPool.get(index);
        if (cd) {
          this.groundViewCtrl = cd.gc;
          this.basicCellViewCtrl = cd.mc;
          this.upGroundViewCtrl = cd.ugc;
        }
        this.gridViewPool.forEach(function(item, key) {
          key != index && (item.active = false);
        });
      };
      MainCtrl.prototype.initMapGridView = function() {
        var maps = this.gameModel.getMaps();
        this.gridCtrlPool = new Map();
        this.gridViewPool = new Map();
        for (var i = 0; i < this.gameModel.mapCount; i++) {
          var gridCtrlView = cc.instantiate(this.gridBoard);
          var gridData = maps[i];
          var gc = this.initGround(gridCtrlView, gridData);
          var mc = this.initMainLayer(gridCtrlView, gridData);
          var ugc = this.initUpGround(gridCtrlView, gridData);
          this.gridCtrlPool.set(i, {
            gc: gc,
            mc: mc,
            ugc: ugc
          });
          this.gridViewPool.set(i, gridCtrlView);
          this.setGirdViewSize(gridCtrlView, i);
          gridCtrlView.parent = this.maskNode;
          gridCtrlView.x = i * cc.winSize.width;
        }
      };
      MainCtrl.prototype.setGirdViewSize = function(view, index) {
        var topPos = this.gameModel.getTopPosition(index);
        var height = 2 * topPos.y + Common_1.default.GRID_H;
        if (height > this.maskNode.height) {
          this.gameModel.setLongHeight(true);
          view.setContentSize(this.node.width, height);
        }
      };
      MainCtrl.prototype.gameReadyOK = function() {
        this.syncGridBoard();
        M_1.default.runtime.GameState = Constant_1.GameState.Normal;
        Log_1.Log.w("\u51c6\u5907\u5b8c\u6bd5,\u5f00\u542f\u89e6\u6478!");
        this.gameModel.openAutoCheckOpt();
        this.checkUseProp();
        this.initTouch();
        this.checkTutorial();
      };
      MainCtrl.prototype.onMoveGrid = function(target, type) {
        var _this = this;
        var checkIsNoFall = function() {
          if (!_this.gameModel.isFalling) {
            Log_1.Log.i("\u5f00\u59cb\u68c0\u6d4b\u68cb\u76d8\u79fb\u52a8!");
            if (0 == type) {
              M_1.default.runtime.GameState = Constant_1.GameState.preReady;
              _this.moveCross(target);
            } else _this.moveRow(_this.groundViewCtrl.checkCollectMoveDistance(_this.currentCtrlView, _this.maskNode));
            _this.unschedule(checkIsNoFall);
          }
        };
        this.schedule(checkIsNoFall, 1);
      };
      MainCtrl.prototype.moveRow = function(distance) {
        var _this = this;
        if (0 != distance && !this._moveRowLock) {
          this._moveRowLock = true;
          M_1.default.runtime.GameState = Constant_1.GameState.preReady;
          ActionCtrl_1.default.ins.runMoveRow(this.currentCtrlView, distance).then(function() {
            _this._moveRowLock = false;
            M_1.default.runtime.GameState = Constant_1.GameState.Normal;
          });
        }
      };
      MainCtrl.prototype.moveCross = function(nextIndex) {
        var _this = this;
        if (!this._moveCrossLock) {
          this._moveCrossLock = true;
          if (this.gridViewPool.size > 0) {
            this._moveCrossLock = false;
            this.gridViewPool.forEach(function(value, key) {
              value.active = true;
              ActionCtrl_1.default.ins.runMoveCross(value).then(function() {
                console.error("\u79fb\u52a8\u7ed3\u675f!!");
                M_1.default.runtime.GameState = Constant_1.GameState.Normal;
                _this.gameModel.changeMap(nextIndex);
                _this.syncGridBoard();
              });
            });
          } else this._moveCrossLock = false;
        }
      };
      MainCtrl.prototype.preStartShowGrid = function() {
        var gridView = this.gridViewPool.get(this.gameModel.mapIndex);
        if (this.gameModel.mapCount > 1) {
          this.maskNode.removeComponent(cc.Mask);
          this.playShowCross();
        } else gridView.height > 0 ? this.playShowRow(gridView) : this.gameReadyOK();
      };
      MainCtrl.prototype.playShowRow = function(gridView) {
        ActionCtrl_1.default.ins.runShowRow(gridView, this.maskNode.height).then(this.gameReadyOK.bind(this));
      };
      MainCtrl.prototype.playShowCross = function() {
        ActionCtrl_1.default.ins.runShowCross(this.node, this.gridViewPool).then(this.gameReadyOK.bind(this));
      };
      MainCtrl.prototype.initGround = function(node, data) {
        node = node.getChildByName("ground");
        var gCtrl = node.getComponent(GroundViewCtrl_1.default);
        gCtrl.initView(data.gm.getGroupCellList(), data, this.gameModel.getLvData(), this.groundType);
        return gCtrl;
      };
      MainCtrl.prototype.initMainLayer = function(node, data) {
        node = node.getChildByName("mainLayer");
        var mCtrl = node.getComponent(BasicCellViewCtrl_1.default);
        mCtrl.initView(data.cellList);
        return mCtrl;
      };
      MainCtrl.prototype.initUpGround = function(node, data) {
        node = node.getChildByName("upGround");
        var ugCtrl = node.getComponent(UpGroundViewCtrl_1.default);
        ugCtrl.initView(data.ugm.getUGroupCellList());
        return ugCtrl;
      };
      MainCtrl.prototype.initTouch = function() {
        var curMapView = this.gridViewPool.get(this.gameModel.mapIndex);
        var node = this.node;
        curMapView.height > 0 && (node = curMapView);
        node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);
        node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);
        node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);
      };
      MainCtrl.prototype.onTouchStart = function(event) {
        this.touchStartPos = event.touch.getLocation();
      };
      MainCtrl.prototype.onTouchMove = function(event) {
        this.checkMoveCell(event.touch.getLocation());
      };
      MainCtrl.prototype.onTouchEnd = function(event) {
        var _this = this;
        var pos = this.currentCtrlView.convertToNodeSpaceAR(event.touch.getLocation());
        this._overClick(event.touch.getLocation());
        if (M_1.default.runtime.GameState != Constant_1.GameState.Normal) return;
        this.touchLock = false;
        clearTimeout(this.touchTimer);
        this.touchCount++;
        if (this.touchCount >= 2) {
          this.touchCount = 0;
          this.doubleClick(pos);
        }
        this.touchTimer = setTimeout(function() {
          _this.touchCount = 0;
          _this.touchOpenGMPanelCount = 0;
        }, 500);
        (!event || event && !event.istutorial) && this.click(pos);
      };
      MainCtrl.prototype.click = function(curPos) {
        this.gameModel.onClick(curPos, true);
      };
      MainCtrl.prototype.doubleClick = function(curPos) {
        this.gameModel.onDoubleClick(Common_1.default.convetPos(curPos));
      };
      MainCtrl.prototype.checkMoveCell = function(curPos) {
        if (this.touchLock || M_1.default.runtime.GameState != Constant_1.GameState.Normal) return;
        var sp = curPos.sub(this.touchStartPos);
        if (Math.abs(sp.x) > Common_1.default.GRID_W / 3 || Math.abs(sp.y) > Common_1.default.GRID_H / 3) {
          var dir = cc.v2(0, 0);
          Math.abs(sp.x) > Math.abs(sp.y) ? dir.x = sp.x > 0 ? 1 : -1 : dir.y = sp.y > 0 ? -1 : 1;
          var pos = this.currentCtrlView.convertToNodeSpaceAR(this.touchStartPos);
          this.gameModel.touchMove(Common_1.default.convetPos(pos), dir);
          this.touchLock = true;
        }
      };
      MainCtrl.prototype.onGameViewTask = function(task) {
        switch (task.action) {
         case Event_1.Event.GameCMD.Elimate:
          this.execElimate(task);
          break;

         case Event_1.Event.GameCMD.Exchange:
          this.execExchange(task);
          break;

         case Event_1.Event.GameCMD.AddNewCell:
          this.execAddNewCell(task);
          break;

         case Event_1.Event.GameCMD.PromptCanElimate:
          this.execTisAnimation(task);
        }
      };
      MainCtrl.prototype.testGameOver = function() {
        this.reStartGame();
      };
      MainCtrl.prototype.onGameResume = function() {
        null != this._isOverMark && this.onGameOver(this._isOverMark);
      };
      MainCtrl.prototype.onGameOver = function(result) {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            console.error("\u6e38\u620f\u7ed3\u675f", result);
            if (M_1.default.runtime.GameState == Constant_1.GameState.Normal) {
              this._useStepCount = this.gameModel.stepCount - this.gameModel.stepLimit;
              if (result) {
                M_1.default.runtime.GameState = Constant_1.GameState.Win;
                this.gameOverStartBomb();
              } else {
                M_1.default.runtime.GameState = Constant_1.GameState.Fail;
                this.showGameOverDialog(result);
              }
            } else this._isOverMark = true;
            return [ 2 ];
          });
        });
      };
      MainCtrl.prototype._startOverClick = function() {
        var _this = this;
        M_1.default.runtime.GameState = Constant_1.GameState.End;
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.OverShow, {
          type: UIData_1.UIHudDef.OverShow
        }, null, function() {
          _this.setZorder(1);
          _this.overMask.active = true;
          _this.overHightLightNode.getComponent(OverHightLightCtrl_1.default).showCountDown();
        });
      };
      MainCtrl.prototype._overClick = function(pos) {
        this.gameModel.onClick(pos, false);
      };
      MainCtrl.prototype.checkShowGameOver = function() {
        var _this = this;
        if (M_1.default.runtime.GameState == Constant_1.GameState.Win) {
          if (!this.gameModel.isFalling) {
            M_1.default.runtime.GameState = Constant_1.GameState.ChangeBomb;
            this.gameModel.CellDict.size <= 0 || this.gameModel.stepLimit <= 0 ? this.showGameOverDialog(true) : UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.OverShow, {
              type: UIData_1.UIHudDef.OverShow
            }, null, function() {
              _this.delayExecFun(.2, _this.conversionStep2Bomb.bind(_this));
            });
          }
        } else M_1.default.runtime.GameState != Constant_1.GameState.End || this.isShowEndView || this.gameModel.isFalling || this.showGameOverDialog(true);
      };
      MainCtrl.prototype.conversionStep2Bomb = function() {
        var _this = this;
        if (!this.gameModel) return;
        var closeAry = new Set();
        M_1.default.runtime.OverStepCount = 0;
        this.gameModel.CellDict.forEach(function(cell) {
          !cell || cell.isEmpty || cell.isDeath || cell.isBomb || cell.isGround || _this.gameModel.isHavaSpe(cell.pos) || closeAry.size < _this.gameModel.stepLimit && closeAry.add(cell);
        });
        var centerPos = this.uiCtrl.getStepPos();
        GroupAnimatCtrl_1.default.ins.overShootEff(closeAry, centerPos, function() {
          _this && _this.gameOverStartBomb(.3, true);
        });
      };
      MainCtrl.prototype._startFall = function() {
        this.gameModel.startOverFall();
      };
      MainCtrl.prototype.showGameOverDialog = function(result) {
        var _this = this;
        this.isShowEndView = true;
        var storyData = M_1.default.table.ChapterStory.getByPrimaryKey(M_1.default.runtime.CurLevel);
        this.gameModel.stopOverFall();
        result && storyData ? UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.StoryTalkPanel, storyData, null, function() {
          _this.delayExecFun(1, function() {
            _this.uiCtrl.showResultDialog(result, _this._useStepCount, M_1.default.runtime.MatchGameTime);
          });
        }) : this.delayExecFun(1, function() {
          _this.uiCtrl.showResultDialog(result, _this._useStepCount, M_1.default.runtime.MatchGameTime);
        });
      };
      MainCtrl.prototype.gameOverStartBomb = function(gaptime, isOver) {
        var _this = this;
        void 0 === gaptime && (gaptime = 0);
        void 0 === isOver && (isOver = false);
        var index = 0;
        this.gameModel.CellDict.forEach(function(cell) {
          if (cell && cell.isBomb) {
            index++;
            var time = gaptime;
            gaptime ? time *= index : time = .1;
            _this.delayExecFun(time, function() {
              cell.onMsg(CellBase_1.MsgType.Bomb);
              isOver && (M_1.default.runtime.GameState = Constant_1.GameState.End);
            });
          }
        });
      };
      MainCtrl.prototype.onStopPrompts = function(task) {
        task.model1 && task.model1.extCtrl && task.model1.extCtrl.stopPromptAction();
        task.closeAry.forEach(function(cm) {
          cm.extCtrl && cm.extCtrl.stopPromptAction();
        });
      };
      MainCtrl.prototype.execTisAnimation = function(task) {
        task.model1 && task.model1.extCtrl && task.model1.extCtrl.playSinglePrompt(task.cp1);
        task.closeAry.forEach(function(cm) {
          cm.extCtrl && cm.extCtrl.playMulPrompt();
        });
      };
      MainCtrl.prototype.execAddNewCell = function(task) {
        this.basicCellViewCtrl.createNewCell(task.model1, task.extData);
        this.gameModel.task.freeTask(task);
      };
      MainCtrl.prototype.execElimate = function(task) {
        switch (task.type) {
         case Constant_1.ElimateType.Default:
          this.checkMergeBomb(task);
          break;

         case Constant_1.ElimateType.All:
          this.execDoubleRainbow(task);
          break;

         case Constant_1.ElimateType.Bomb6:
          GroupAnimatCtrl_1.default.ins.playCrabBomb(task.closeAry);
          break;

         case Constant_1.ElimateType.ThreeRowAndCol:
          this.execThreeRowAndCol(task);
          break;

         default:
          this.execBomb(task);
        }
        task.type > Constant_1.ElimateType.Prop;
      };
      MainCtrl.prototype.execNormalElimate = function(task, forcedElimate) {
        var _this = this;
        void 0 === forcedElimate && (forcedElimate = false);
        0 == task.size ? task.model1.extCtrl && task.model1.isDeath && task.model1.extCtrl.elimate(task.size, task.model1.pos, task.type) : this.delayExecFun(task.keepTime, function() {
          _this.checkFishBomb(task.model1, task.size);
          task.closeAry.forEach(function(m) {
            if (m && m.extCtrl && m.isDeath) {
              m.isBomb = !forcedElimate && m.isBomb;
              m.extCtrl.elimate(task.size, task.model1.pos, task.type);
            }
            m && m.execUpElimate(task.type);
          });
          _this.gameModel.task.freeTask(task);
        });
      };
      MainCtrl.prototype.execExchange = function(task) {
        var c2 = task.model2.extCtrl;
        if (task.model1.isBomb && task.model2.isBomb || task.extData) c2 && c2.exchangeDoubleBombAni(task.model1); else {
          var c1 = task.model1.extCtrl;
          c1 && c1.exchange(task.cp1, task.keepTime, task.model2);
          c2 && c2.exchange(task.cp2, task.keepTime, task.model1);
        }
        this.gameModel.task.freeTask(task);
      };
      MainCtrl.prototype.checkFishBomb = function(model, size) {
        model && model.getType() == Constant_1.CellType.Fish && 3 == size && model.extCtrl && model.extCtrl.execFishBomb();
      };
      MainCtrl.prototype.checkMergeBomb = function(task) {
        var _this = this;
        var scoreModel = task.model1;
        if (task.size >= 4) if (this.gameModel.isCanMergeBomb(task.extData, task.model1)) {
          M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.merge_boom);
          var isExec = false;
          M_1.default.runtime.GameState == Constant_1.GameState.End && (isExec = true);
          GroupAnimatCtrl_1.default.ins.playCreateBomb(task.extData, task.model1.pos, isExec, TimeConfig_1.GapTime.MergeBombSpeed + .2, true, scoreModel.GroupId);
          M_1.default.runtime.addMergeCount(task.extData);
        } else task.model1.unlockCreateBombPos(); else if (task.closeAry) {
          var tempModel_1 = null;
          task.closeAry.forEach(function(model) {
            tempModel_1 ? tempModel_1.pos.x == model.pos.x && model.pos.y < tempModel_1.pos.y ? tempModel_1 = model : tempModel_1.pos.y == model.pos.y && model.pos.x < tempModel_1.pos.x && (tempModel_1 = model) : tempModel_1 = model;
          });
          scoreModel = tempModel_1;
        }
        scoreModel && scoreModel.extCtrl && (scoreModel.extCtrl.BindAddScoreTask = function(pos, count) {
          count = count > 5 ? 5 : count;
          var comboName = Constant_1.ComboLevel[M_1.default.runtime.CurCombo];
          if (comboName) {
            var ratio = Constant_1.comboRatio[comboName];
            ratio = ratio > 2 ? 2 : ratio;
            Log_1.Log.i("combo:", ratio, Constant_1.ScoreConfig.Combo[ratio]);
            _this.uiCtrl.updateScore(Constant_1.ScoreConfig.Combo[ratio], pos);
          } else _this.uiCtrl.updateScore(Constant_1.ScoreConfig.Normal[count], pos);
        });
        this.execNormalElimate(task);
      };
      MainCtrl.prototype.execBomb = function(task) {
        var _this = this;
        if (task.type == Constant_1.ElimateType.Girl) {
          var ctrl = task.model1.extCtrl;
          ctrl.elimate(0, task.model1.pos, task.type);
          this.gameModel.task.freeTask(task);
          return;
        }
        if (task.type == Constant_1.ElimateType.Rocket) {
          this.execOctopus(task);
          return;
        }
        task.model1 && task.model1.extCtrl && (task.model1.extCtrl.BindAddScoreTask = function(pos, size) {
          var socre = Constant_1.ScoreConfig.Special[task.model1.getType()];
          task.model1.isBomb && (socre = Constant_1.ScoreConfig.BombElimate[task.model1.getType()]);
          _this.uiCtrl.updateScore(socre, pos);
        });
        switch (task.model1.getType()) {
         case Constant_1.CellType.Bomb1:
          this.execBeikeBomb(task);
          break;

         case Constant_1.CellType.Fish:
          this.execFishBomb(task);
          break;

         case Constant_1.CellType.Bomb4:
          this.execOctopus(task);
          break;

         case Constant_1.CellType.Bomb2:
         case Constant_1.CellType.Bomb3:
          this.execRowAndCol(task);
          break;

         case Constant_1.CellType.Bomb5:
          task.model1.isBomb = false;
          this.execRainbow(task);
          break;

         default:
          this.execNormalElimate(task);
        }
      };
      MainCtrl.prototype.execThreeRowAndCol = function(task) {
        var _this = this;
        var elimateData = task.extData;
        elimateData.forEach(function(item) {
          _this.playRowAndColAni(item.type, item.pos, task.closeAry, task.type);
        });
        this.gameModel.task.freeTask(task);
      };
      MainCtrl.prototype.execDoubleRainbow = function(task) {
        task.size = null;
        task.type = Constant_1.ElimateType.Default;
        0 == task.extData && this.delayExecFun(TimeConfig_1.GapTime.DoubleRainbowResume, function() {
          M_1.default.runtime.resumeGame();
        });
        this.execNormalElimate(task, true);
      };
      MainCtrl.prototype.execOctopus = function(task) {
        return __awaiter(this, void 0, void 0, function() {
          var targetPos, conveType, wpos, tpos;
          var _this = this;
          return __generator(this, function(_a) {
            task.model1.isBomb = false;
            task.type = Constant_1.ElimateType.Bomb4;
            task.model1.extCtrl && task.model1.extCtrl.playBombSingleDestoryEff(0, .5);
            targetPos = task.extData.pos;
            conveType = task.extData.type;
            wpos = Common_1.default.convertCurWorldPos(task.model1.getPosition());
            if (targetPos) {
              tpos = Common_1.default.convertCurWorldPos(Common_1.default.getPos(targetPos.x, targetPos.y));
              M_1.default.runtime.pushZhangyuTimePause();
              this.effCtrl.playZyJump(wpos, tpos, function() {
                if (conveType) {
                  _this.gameModel.execElimateOne(targetPos, Constant_1.ElimateType.Bomb4);
                  GroupAnimatCtrl_1.default.ins.playCreateBomb(conveType, targetPos, true, 0, false);
                } else _this.gameModel.execElimateOne(targetPos, Constant_1.ElimateType.Bomb4);
                _this.delayExecFun(.5, function() {
                  M_1.default.runtime.deleteZhangyuTime();
                });
                GameModel_1.default.ins.CollectModel.removeMark(targetPos);
                GroupAnimatCtrl_1.default.ins.playCellBombShocks(targetPos, 1, 1, true);
              }, conveType);
            }
            this.execNormalElimate(task);
            return [ 2 ];
          });
        });
      };
      MainCtrl.prototype.execBeikeBomb = function(task) {
        if (task.model1.extCtrl) {
          var ctrl = task.model1.extCtrl;
          ctrl.playBombSingleDestoryEff(0, 1);
          var _a = [ task.model1.pos, task.extData ], centerPos_1 = _a[0], bombLv_1 = _a[1];
          var pos = Common_1.default.convertCurWorldPos(task.model1.extData.position);
          task.type != Constant_1.ElimateType.DoubleBomb && this.effCtrl.playBombEff(bombLv_1, pos);
          M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.Bomb);
          this.execNormalElimate(task);
          this.delayExecFun(task.keepTime, function() {
            GroupAnimatCtrl_1.default.ins.playCellBombShocks(centerPos_1, bombLv_1);
          });
        }
      };
      MainCtrl.prototype.execFishBomb = function(task) {
        this.execNormalElimate(task);
        var pos = Common_1.default.convertCurWorldPos(task.model1.getPosition());
        this.effCtrl.playFishBombEff(pos);
        var _a = [ task.model1.pos, task.extData ], centerPos = _a[0], bombLv = _a[1];
        this.delayExecFun(TimeConfig_1.GapTime.FishBombPreShocks, function() {
          GroupAnimatCtrl_1.default.ins.playCellBombShocks(centerPos, bombLv);
        });
        task.model1.extCtrl && task.model1.extCtrl.playBombSingleDestoryEff(0, task.keepTime);
      };
      MainCtrl.prototype.execRowAndCol = function(task) {
        var pos = task.model1.pos;
        if (task.model1.extCtrl) {
          task.model1.isBomb = false;
          task.model1.extCtrl.playBombSingleDestoryEff(0, TimeConfig_1.GapTime.RowAndColSelfElimate, true);
        }
        this.playRowAndColAni(task.extData, pos, task.closeAry);
        this.gameModel.task.freeTask(task);
      };
      MainCtrl.prototype.playRowAndColAni = function(type, pos, closeAry, elimateType) {
        var _this = this;
        this.effCtrl.playRowColEff(type, Common_1.default.convertCurWorldPos(Common_1.default.getPos(pos.x, pos.y)));
        if (closeAry && closeAry.size > 0) {
          var _a = [ 1, closeAry.size, false ], count_1 = _a[0], maxCount_1 = _a[1], isHavaBorn_1 = _a[2];
          var eType = elimateType || type;
          GroupAnimatCtrl_1.default.ins.playRowElimate(pos, closeAry, eType, function(isborn) {
            if (!_this.gameModel) return;
            isborn && (isHavaBorn_1 = true);
            count_1++;
            if (type == Constant_1.CellType.Bomb3 && !isHavaBorn_1 && maxCount_1 == count_1) {
              console.error("\u7ad6\u6d88\u7ed3\u675f!");
              _this.gameModel.notifyFallColumnOver(pos);
            }
          });
        }
      };
      MainCtrl.prototype.collectPower = function(start, end) {
        this.basicCellViewCtrl.playCollectPower(this.uiNode, start, end);
      };
      MainCtrl.prototype.onUpdateComplexView = function(pos) {
        this.groundViewCtrl.updateComlexIteamByPos(pos);
      };
      MainCtrl.prototype.delayExecFun = function(time, fun) {
        this.scheduleOnce(fun.bind(this), time);
      };
      MainCtrl.prototype.execRainbow = function(task) {
        var _this = this;
        task.type = Constant_1.ElimateType.Bomb5;
        var centerModel = task.model1;
        var worldPos = Common_1.default.getWorldPos(centerModel.extData);
        M_1.default.runtime.pauseGame();
        centerModel.extCtrl.playBombSingleDestoryEff(0, TimeConfig_1.GapTime.RainbowCenterDelayElimate);
        this.effCtrl.playRainbowBomb(worldPos, function() {
          GroupAnimatCtrl_1.default.ins.playRainbowBomb(task.closeAry, worldPos, function() {
            M_1.default.runtime.resumeGame();
            if (!_this.gameModel) return;
            _this.delayExecFun(TimeConfig_1.GapTime.StarsElimate, function() {
              _this.effCtrl.removeShootStars();
            });
            _this.execNormalElimate(task);
          });
        });
      };
      MainCtrl.prototype.playPropEff = function(task) {};
      MainCtrl.prototype.onChangeCellType = function(type, count, isDelayCreate) {
        var _this = this;
        void 0 === count && (count = 3);
        void 0 === isDelayCreate && (isDelayCreate = true);
        if (M_1.default.runtime.GameState == Constant_1.GameState.Normal) {
          var getOneCell_1 = function() {
            var y = Util_1.Util.Tool.rangeInt(0, GameModel_1.default.GridSize.H, false);
            var x = Util_1.Util.Tool.rangeInt(0, GameModel_1.default.GridSize.W, false);
            var cell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, cc.v2(x, y));
            return cell && cell.extCtrl && !cell.isDeath && !_this.gameModel.isHavaObs(cell.pos) && cell.getType() < Constant_1.CellType.Banana && cell.getType() != type ? cell : getOneCell_1();
          };
          if (!this.gameModel.checkIsAllDeath()) for (var i = count; i--; ) this.scheduleOnce(function() {
            var cell = getOneCell_1();
            cell.change2Cell(type);
            cell.extCtrl.playChange2Cell();
            var pos = _this.uiNode.convertToNodeSpaceAR(Common_1.default.getWorldPos(cell.extData));
            M_1.default.event.send(Event_1.Event.Effect.CollectOver, pos, "shanxian");
          }, isDelayCreate ? .5 * i : 0);
        }
      };
      MainCtrl.prototype.onTestBtnClick = function() {};
      MainCtrl.prototype.checkUseProp = function() {
        if (M_1.default.runtime.SelectProp) {
          M_1.default.event.send(Event_1.Event.GameCMD.PropClick, M_1.default.runtime.SelectProp);
          M_1.default.runtime.SelectProp = null;
        }
      };
      MainCtrl.prototype.checkTutorial = function() {
        if (this.tutorialData) {
          this.TutorialPanel.active = true;
          this.TutorialPanel.getComponent(Match3TutorialCtrl_1.default).initView(this.tutorialData, this);
          this.startTutorial();
        } else this.TutorialPanel.active = false;
      };
      MainCtrl.prototype.startTutorial = function() {
        this.TutorialPanel.getComponent(Match3TutorialCtrl_1.default).startTutorial();
      };
      MainCtrl.prototype.closeTutorial = function() {
        this.TutorialPanel.getComponent(Match3TutorialCtrl_1.default).closeTutorial();
      };
      MainCtrl.prototype.update = function(dt) {
        this.gameModel && this.gameModel.update(dt);
      };
      __decorate([ property(cc.Sprite) ], MainCtrl.prototype, "bg", void 0);
      __decorate([ property(cc.Node) ], MainCtrl.prototype, "uiNode", void 0);
      __decorate([ property(cc.Node) ], MainCtrl.prototype, "effNode", void 0);
      __decorate([ property(cc.Prefab) ], MainCtrl.prototype, "gridBoard", void 0);
      __decorate([ property(cc.Prefab) ], MainCtrl.prototype, "planePrefab", void 0);
      __decorate([ property(cc.Node) ], MainCtrl.prototype, "maskNode", void 0);
      __decorate([ property(cc.Node) ], MainCtrl.prototype, "TutorialPanel", void 0);
      __decorate([ property(cc.Node) ], MainCtrl.prototype, "overMask", void 0);
      __decorate([ property(cc.Node) ], MainCtrl.prototype, "overHightLightNode", void 0);
      MainCtrl = __decorate([ ccclass ], MainCtrl);
      return MainCtrl;
    }(cc.Component);
    exports.default = MainCtrl;
    cc._RF.pop();
  }, {
    "../../../GodGuide/GuideUtils": "GuideUtils",
    "../../Base/Apps": "Apps",
    "../../Base/Manager/M": "M",
    "../../Base/Manager/UIMgr": "UIMgr",
    "../../Base/Shader/ShaderHelper": "ShaderHelper",
    "../../Base/Shader/ShaderTime": "ShaderTime",
    "../../Base/Utils/Log": "Log",
    "../../Base/Utils/Paths": "Paths",
    "../../Base/Utils/Util": "Util",
    "../Common/ActionCtrl": "ActionCtrl",
    "../Common/AudioCtrl": "AudioCtrl",
    "../Common/Common": "Common",
    "../Common/GroupAnimatCtrl": "GroupAnimatCtrl",
    "../Common/UI/OverHightLightCtrl": "OverHightLightCtrl",
    "../Data/Const/Constant": "Constant",
    "../Data/Const/Event": "Event",
    "../Data/Const/TimeConfig": "TimeConfig",
    "../Data/Interface/Level": "Level",
    "../Data/Interface/Tutorial": "Tutorial",
    "../Data/Interface/UIData": "UIData",
    "./Model/CellBase": "CellBase",
    "./Model/CollectModel": "CollectModel",
    "./Model/GameModel": "GameModel",
    "./View/BasicCellViewCtrl": "BasicCellViewCtrl",
    "./View/EffLayerCtrl": "EffLayerCtrl",
    "./View/GroundViewCtrl": "GroundViewCtrl",
    "./View/Match3TutorialCtrl": "Match3TutorialCtrl",
    "./View/UI/MainUiCtrl": "MainUiCtrl",
    "./View/UpGroundViewCtrl": "UpGroundViewCtrl"
  } ],
  MainUiCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "6c69bLGHLpD0ZesIClYcPLN", "MainUiCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var PropCtrl_1 = require("./PropCtrl");
    var InfoPanelCtrl_1 = require("./InfoPanelCtrl");
    var M_1 = require("../../../../Base/Manager/M");
    var Event_1 = require("../../../Data/Const/Event");
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var Constant_1 = require("../../../Data/Const/Constant");
    var Util_1 = require("../../../../Base/Utils/Util");
    var Common_1 = require("../../../Common/Common");
    var ReportMgr_1 = require("../../../../Base/Manager/ReportMgr");
    var Apps_1 = require("../../../../Base/Apps");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var MainUiCtrl = function(_super) {
      __extends(MainUiCtrl, _super);
      function MainUiCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.topBar = null;
        _this.bottomBar = null;
        _this.propBar = null;
        _this.centerBar = null;
        _this.dotPrefab = null;
        _this.scoreBar = null;
        _this.scoreNode = null;
        _this.tmpTestPropShowLable = null;
        _this.version = null;
        _this._cfg = null;
        _this._mainCtrl = null;
        _this._maxScore = 0;
        _this._nextStarScore = null;
        _this._scoreStarLights = null;
        _this.propCtrl = null;
        _this.infoPanelCtrl = null;
        _this.isSquareBar = false;
        return _this;
      }
      MainUiCtrl.prototype.onLoad = function() {
        this.initEvent();
        this.initSubCtrl();
        this.initView();
      };
      MainUiCtrl.prototype.onDestroy = function() {
        this.destoryEvent();
      };
      MainUiCtrl.prototype.initEvent = function() {
        M_1.default.event.register(Event_1.Event.GameCMD.PropClick, this.onUseProp, this);
        M_1.default.event.register(Event_1.Event.GameCMD.PropUsed, this.onPropOver, this);
        M_1.default.event.register(Event_1.Event.Effect.ShowDot, this.onShowDot, this);
        M_1.default.event.register(Event_1.Event.UI.AddScore, this.updateScore, this);
      };
      MainUiCtrl.prototype.destoryEvent = function() {
        M_1.default.event.unRegister(Event_1.Event.GameCMD.PropClick, this.onUseProp, this);
        M_1.default.event.unRegister(Event_1.Event.GameCMD.PropUsed, this.onPropOver, this);
        M_1.default.event.unRegister(Event_1.Event.Effect.ShowDot, this.onShowDot, this);
        M_1.default.event.unRegister(Event_1.Event.UI.AddScore, this.updateScore, this);
      };
      MainUiCtrl.prototype.init = function(mc, cfg) {
        this._cfg = cfg;
        this._mainCtrl = mc;
        this.initStarProgress(cfg.levelInfo.score);
        this.infoPanelCtrl || (this.infoPanelCtrl = this.topBar.getComponent(InfoPanelCtrl_1.default));
        this.infoPanelCtrl.init();
      };
      MainUiCtrl.prototype.initStarProgress = function(scoreCfg) {
        if (scoreCfg) {
          var starParent = this.scoreBar.node;
          var trajectory = starParent.getChildByName("trajectory");
          this._maxScore = scoreCfg[scoreCfg.length - 1];
          this._maxScore += .15 * this._maxScore;
          this.scoreBar.progress = 0;
          if (trajectory) {
            this.isSquareBar = true;
            this._scoreStarLights = new Map();
            for (var i = 0; i < scoreCfg.length; i++) {
              var star = this.scoreBar.node.getChildByName("star" + i);
              var coefficient = Math.round(scoreCfg[i] / this._maxScore * 10);
              star.setPosition(trajectory.getChildByName("" + coefficient).position);
              this._scoreStarLights.set(coefficient, star);
              Common_1.default.switchGray(true, star);
            }
          } else {
            this.isSquareBar = false;
            this._nextStarScore = scoreCfg[0];
            this._scoreStarLights = new Map();
            for (var i = 0; i < scoreCfg.length; i++) {
              var star = this.scoreBar.node.getChildByName("star" + i);
              var coefficient = scoreCfg[i] / this._maxScore;
              star.x = starParent.width * coefficient - starParent.width / 2;
              Common_1.default.switchGray(true, star);
              this._scoreStarLights.set(i, null);
            }
          }
        }
      };
      MainUiCtrl.prototype.initView = function() {
        var _this = this;
        this.version.string = Apps_1.default.Version;
        this.updateScore(0, null);
        this.centerBar.y -= M_1.default.platform.getTopBangPosition();
        this.scheduleOnce(function() {
          var c = M_1.default.platform.getMenuButtonBoundingClientRect();
          if (c) {
            _this.scoreNode.setPosition(c.x + c.width / 2, c.y - 10);
            if (Util_1.Util.Tool.isIpx()) {
              _this.scoreNode.setScale(.8);
              _this.centerBar.y -= c.height;
              _this.scoreNode.y += c.height + _this.scoreNode.height;
            }
          }
        }, .1);
      };
      MainUiCtrl.prototype.initSubCtrl = function() {
        this.propCtrl = this.propBar.getComponent(PropCtrl_1.default);
        this.propCtrl.init();
      };
      MainUiCtrl.prototype.onUseProp = function(type) {
        switch (type) {
         case Constant_1.PropType.BeikeBomb:
         case Constant_1.PropType.Board:
         case Constant_1.PropType.Hammer:
          this.tmpTestPropShowLable.active = true;
          this.tmpTestPropShowLable.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.2, 1.1), cc.scaleTo(.2, 1))));
        }
      };
      MainUiCtrl.prototype.onShowDot = function(type, startPoint) {};
      MainUiCtrl.prototype.onPropOver = function() {
        this.tmpTestPropShowLable.stopAllActions();
        this.tmpTestPropShowLable.active = false;
      };
      MainUiCtrl.prototype.getLevelLabelPos = function() {
        return this.infoPanelCtrl.getLevelLabPos();
      };
      MainUiCtrl.prototype.getCollectPos = function(type) {
        return this.infoPanelCtrl.getCollectPos(type);
      };
      MainUiCtrl.prototype.getStepPos = function() {
        return this.infoPanelCtrl.getStepPos();
      };
      MainUiCtrl.prototype.onGoMapScene = function() {};
      MainUiCtrl.prototype.onTestShowWin = function() {
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GameOverWin, {
          type: UIData_1.UIHudDef.GameOverWin,
          data: 1
        });
      };
      MainUiCtrl.prototype.onTestShowFail = function() {
        this.showResultDialog(false, 0, 0);
      };
      MainUiCtrl.prototype.showResultDialog = function(result, stepCount, timeCount) {
        ReportMgr_1.default.ins.reportMatchOver(M_1.default.runtime.CurLevel, result, stepCount, timeCount);
        if (result) {
          M_1.default.runtime.SelectLevel = 0;
          var starCount = 3;
          var isNew = M_1.default.runtime.savaLvData(starCount);
          if (isNew) {
            var info = M_1.default.table.LevelUpReward.getByPrimaryKey(M_1.default.runtime.CurLevel);
            info && info.rewards && info.rewards.forEach(function(item) {
              M_1.default.runtime.addCurrency(item.type, item.count);
            });
            var propInfos = M_1.default.table.PropInfo.getData();
            propInfos && propInfos.forEach(function(info) {
              info.unlockLv == M_1.default.runtime.CurLevel && M_1.default.tips.show(Constant_1.WaringTips.UnlockProp);
            });
          }
          cc.log("\u8c03\u7528\u663e\u793a\u6210\u529f\u754c\u9762");
          UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GameOverWin, {
            type: UIData_1.UIHudDef.GameOverWin,
            data: starCount
          });
          M_1.default.runtime.setMatch3Level(M_1.default.runtime.CurLevel + 1);
        } else {
          cc.log("\u8c03\u7528\u663e\u793a\u5931\u8d25\u754c\u9762");
          UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.UIGameFailEncourage, {
            data: this._cfg.collect
          });
        }
      };
      MainUiCtrl.prototype.updateScore = function(as, pos, isOverEff) {
        void 0 === isOverEff && (isOverEff = false);
        if (as) {
          pos && M_1.default.event.send(Event_1.Event.Effect.AddScore, as, pos, isOverEff);
          var score = M_1.default.runtime.addScore(as);
          this.infoPanelCtrl && this.infoPanelCtrl.onUpdateInfo();
          this.updateScoreProgress(score);
        }
      };
      MainUiCtrl.prototype.showTargetDialog = function(dialogOverCallback) {
        var data = {};
        data.collect = this._cfg.collect;
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GameShowTarget, {
          type: UIData_1.UIHudDef.GameShowTarget,
          data: data
        }, null, function() {
          dialogOverCallback();
        });
      };
      MainUiCtrl.prototype.updateScoreProgress = function(curScore) {
        var _this = this;
        if (this._cfg) {
          this.scoreBar.progress = curScore / this._maxScore;
          if (this.isSquareBar && this._scoreStarLights) {
            var coefficient_1 = Math.round(10 * this.scoreBar.progress);
            this._scoreStarLights.forEach(function(v, k) {
              if (coefficient_1 >= k) {
                Common_1.default.switchGray(false, v);
                _this._scoreStarLights.delete(k);
              }
            });
          } else if (this._nextStarScore && curScore >= this._nextStarScore) {
            var currentIndex = this._cfg.levelInfo.score.indexOf(this._nextStarScore);
            var star = this.scoreBar.node.getChildByName("star" + currentIndex);
            this._scoreStarLights.delete(currentIndex);
            Common_1.default.switchGray(false, star);
            this._nextStarScore = this._cfg.levelInfo.score[currentIndex + 1];
            -1 == this._nextStarScore && (this._nextStarScore = null);
          }
        }
      };
      MainUiCtrl.prototype.onOpenGM = function() {
        Apps_1.default.isOpenGM && UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GMView);
      };
      __decorate([ property(cc.Node) ], MainUiCtrl.prototype, "topBar", void 0);
      __decorate([ property(cc.Node) ], MainUiCtrl.prototype, "bottomBar", void 0);
      __decorate([ property(cc.Node) ], MainUiCtrl.prototype, "propBar", void 0);
      __decorate([ property(cc.Node) ], MainUiCtrl.prototype, "centerBar", void 0);
      __decorate([ property(cc.Prefab) ], MainUiCtrl.prototype, "dotPrefab", void 0);
      __decorate([ property(cc.ProgressBar) ], MainUiCtrl.prototype, "scoreBar", void 0);
      __decorate([ property(cc.Node) ], MainUiCtrl.prototype, "scoreNode", void 0);
      __decorate([ property(cc.Node) ], MainUiCtrl.prototype, "tmpTestPropShowLable", void 0);
      __decorate([ property(cc.Label) ], MainUiCtrl.prototype, "version", void 0);
      MainUiCtrl = __decorate([ ccclass ], MainUiCtrl);
      return MainUiCtrl;
    }(cc.Component);
    exports.default = MainUiCtrl;
    cc._RF.pop();
  }, {
    "../../../../Base/Apps": "Apps",
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Manager/ReportMgr": "ReportMgr",
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../../Base/Utils/Util": "Util",
    "../../../Common/Common": "Common",
    "../../../Data/Const/Constant": "Constant",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData",
    "./InfoPanelCtrl": "InfoPanelCtrl",
    "./PropCtrl": "PropCtrl"
  } ],
  MapBgScript: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "de001LKxaVP/YzA2WAL/FWw", "MapBgScript");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var MapBgScript = function(_super) {
      __extends(MapBgScript, _super);
      function MapBgScript() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this._mapScale = 2;
        return _this;
      }
      MapBgScript.prototype.onLoad = function() {
        this.node.scale = this._mapScale;
      };
      MapBgScript = __decorate([ ccclass ], MapBgScript);
      return MapBgScript;
    }(cc.Component);
    exports.default = MapBgScript;
    cc._RF.pop();
  }, {} ],
  MapCamera: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "3ea9b5rViJEM5u1W8eVK6QS", "MapCamera");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Data/Const/Event");
    var MapIslandUtils_1 = require("./MapIslandUtils");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var MapCamera = function(_super) {
      __extends(MapCamera, _super);
      function MapCamera() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.camera = null;
        _this.mapBg = null;
        _this.wall = null;
        _this.oldDistance = null;
        _this.backgroundRect = null;
        _this.backgroundPoint = cc.Vec2.ZERO;
        _this.moveSpeed = 1600;
        _this.zoomRatioMax = 1.8;
        _this.zoomRatioMin = .35;
        _this.cameraRect = null;
        _this.isTouchMoving = false;
        _this.canTouchMove = false;
        _this.lastPos = null;
        _this.lastTime = 0;
        _this.dtime = 0;
        _this.lastCameraPos = null;
        _this._canMoveY = false;
        return _this;
      }
      MapCamera.prototype.onLoad = function() {
        var _this = this;
        this.cameraRect = cc.rect(0, 0, cc.winSize.width, cc.winSize.height);
        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchBegin, this);
        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchControlCamera, this);
        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);
        this.camera.node.on(cc.Node.EventType.POSITION_CHANGED, this.updateMapVisible, this);
        this.initEvent();
        this.mapBg.children.forEach(function(node) {
          _this.loadMapBg(1, node);
        }, this);
        MapIslandUtils_1.default.mapCamera = this.camera;
      };
      MapCamera.prototype.start = function() {
        var mapRect = this.mapBg.getBoundingBoxToWorld();
        var scale = MapIslandUtils_1.default.MapScale;
        var rect = this.backgroundRect = new cc.Rect(mapRect.x, mapRect.y, mapRect.width * scale, mapRect.height * scale);
        this.backgroundPoint = cc.v2(rect.x, rect.y);
      };
      MapCamera.prototype.onEnable = function() {};
      MapCamera.prototype.onDestroy = function() {
        this.node.off(cc.Node.EventType.TOUCH_START, this.onTouchBegin, this);
        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.touchControlCamera, this);
        this.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);
        this.removeEvent();
        this.camera.node && this.camera.node.off(cc.Node.EventType.POSITION_CHANGED, this.updateMapVisible, this);
      };
      MapCamera.prototype.initEvent = function() {
        EventMgr_1.default.ins.register(Event_1.Event.Map.CameraMoveTo, this.moveCameraTo, this);
        EventMgr_1.default.ins.register(Event_1.Event.Map.MapTouchMoveEnable, this.setTouchEnable, this);
      };
      MapCamera.prototype.removeEvent = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.CameraMoveTo, this.moveCameraTo, this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.MapTouchMoveEnable, this.setTouchEnable, this);
      };
      MapCamera.prototype.setTouchEnable = function(enable) {
        this.canTouchMove = enable;
      };
      MapCamera.prototype.moveCameraTo = function(event, movedNext) {
        var _this = this;
        this.canTouchMove = false;
        this.isTouchMoving = false;
        this.camera.node.stopAllActions();
        var position = cc.v2();
        if (event instanceof cc.Vec2) {
          var mapScale = MapIslandUtils_1.default.MapScale;
          event.scale(cc.v2(mapScale, mapScale), position);
          this._canMoveY || (position.y = 0);
        } else event instanceof cc.Node && (position = event.convertToWorldSpaceAR(cc.Vec2.ZERO));
        var delta = this.camera.node.position.sub(position);
        var endPosition = cc.v2();
        endPosition = this.checkCameraCanMove(delta) ? position.clone() : delta.clone();
        var move = cc.moveTo(endPosition.mag() / this.moveSpeed, endPosition);
        var moveEndNext = cc.callFunc(function() {
          _this.canTouchMove = true;
          movedNext && movedNext();
        }, this);
        var seq1 = cc.sequence([ move, moveEndNext ]);
        this.camera.node.runAction(seq1);
      };
      MapCamera.prototype.onTouchBegin = function(event) {
        if (!this.canTouchMove) {
          event.stopPropagationImmediate();
          return;
        }
        this.camera.node.stopAllActions();
      };
      MapCamera.prototype.onTouchEnd = function(event) {
        var _this = this;
        if (!this.canTouchMove) return;
        var touches = event.getTouches();
        if (this.isTouchMoving && 1 == touches.length) {
          var curZoomRatio = this.camera.zoomRatio;
          var distance = event.getStartLocation().sub(event.getPreviousLocation());
          var delta = distance.mul(.3).mul(1 / curZoomRatio);
          this._canMoveY || (delta.y = 0);
          var speed = this.lastPos.sub(this.camera.node.position).mag() / this.dtime;
          speed > 2 && delta.mag() > 100 && this.checkCameraCanMove(delta.mul(-1)) ? this.camera.node.runAction(cc.sequence(cc.moveBy(delta.mag() / (100 * speed), delta).easing(cc.easeQuadraticActionOut()), cc.callFunc(function() {
            _this.isTouchMoving = false;
          }, this))) : this.isTouchMoving = false;
        }
      };
      MapCamera.prototype.touchControlCamera = function(event) {
        if (!this.canTouchMove) return;
        var curZoomRatio = 1;
        var touches = event.getTouches();
        if (1 == touches.length) {
          var delta = event.getDelta().mul(1 / curZoomRatio);
          if (this.checkCameraCanMove(delta, true)) {
            this._canMoveY || (delta.y = 0);
            this.isTouchMoving = true;
            this.lastPos = this.camera.node.position;
            var now = cc.sys.now();
            this.dtime = now - this.lastTime;
            this.lastTime = now;
            this.camera.node.position = this.camera.node.position.subSelf(delta);
          }
        } else if (2 == touches.length) {
          return;
          var touchPoint1;
          var touchPoint2;
          var distance;
          var dis;
        }
      };
      MapCamera.prototype.checkCameraCanMove = function(delta, touch) {
        void 0 === touch && (touch = false);
        var cameraPosition = this.camera.node.position;
        var mapScale = MapIslandUtils_1.default.MapScale;
        if (cameraPosition.x - this.camera.node.width / 2 - delta.x <= -this.mapBg.width * mapScale / 2) {
          delta.x = -this.mapBg.width * mapScale / 2 + this.camera.node.width / 2;
          return false;
        }
        if (cameraPosition.x + this.camera.node.width / 2 - delta.x >= this.mapBg.width * mapScale / 2) {
          delta.x = this.mapBg.width * mapScale / 2 - this.camera.node.width / 2;
          return false;
        }
        return true;
        var _a, left, right, bottom, top;
        var xCanMove;
        var yCanMove;
        var moveX;
        var moveY;
      };
      MapCamera.prototype.getBoundaryDistance = function() {
        var curZoomRatio = MapIslandUtils_1.default.MapScale;
        var width = this.backgroundRect.width * curZoomRatio;
        var height = this.backgroundRect.height * curZoomRatio;
        var point = this.camera.getWorldToScreenPoint(this.backgroundPoint, cc.Vec2.ZERO);
        return [ -point.x, point.x + width - cc.winSize.width, -point.y, point.y + height - cc.winSize.height ];
      };
      MapCamera.prototype.cameraZoom = function(orientation) {
        var step = orientation > 0 ? .04 : -.04;
        var curZoomRatio = this.camera.zoomRatio;
        curZoomRatio += step;
        if (curZoomRatio < this.zoomRatioMin || curZoomRatio > this.zoomRatioMax) return;
        this.camera.zoomRatio = curZoomRatio;
        var _a = this.getBoundaryDistance(), left = _a[0], right = _a[1], bottom = _a[2], top = _a[3];
        left < 0 || right < 0 || bottom < 0 || top < 0 ? this.camera.zoomRatio = curZoomRatio -= step : this.updateMapVisible(true);
      };
      MapCamera.prototype.updateMapVisible = function(force) {
        void 0 === force && (force = false);
        if (force || !this.lastCameraPos || this.lastCameraPos && this.camera.node.position.sub(this.lastCameraPos).mag() > 1) {
          this.updateNodeInCamera(this.mapBg, .35, this.loadMapBg, this);
          if (this.canTouchMove) {
            this.updateNodeInCamera(this.mapBg, this.camera.zoomRatio, this.reduceDrawCall, this);
            this.updateNodeInCamera(this.wall, this.camera.zoomRatio, this.reduceDrawCall, this);
          }
          this.lastCameraPos = this.camera.node.position;
        }
      };
      MapCamera.prototype.updateNodeInCamera = function(parent, zoomRatio, callFunc, target) {
        var children = parent.children;
        for (var idx = 0; idx < children.length; idx++) {
          var node = children[idx];
          var result = this.checkNodeInCamera(node, zoomRatio);
          callFunc.call(target, result, node);
        }
      };
      MapCamera.prototype.checkNodeInCamera = function(node, zoomRatio) {
        var curZoomRatio = zoomRatio || this.camera.zoomRatio;
        var nodeRect = node.getBoundingBoxToWorld();
        var nodeInCameraPos = this.camera.getWorldToScreenPoint(cc.v2(nodeRect.x, nodeRect.y), cc.Vec2.ZERO);
        var nodeInCameraRect = cc.rect(nodeInCameraPos.x, nodeInCameraPos.y, nodeRect.width * curZoomRatio, nodeRect.height * curZoomRatio);
        if (this.cameraRect.intersects(nodeInCameraRect)) {
          if (this.cameraRect.containsRect(nodeInCameraRect)) return 1;
          return 0;
        }
        return -1;
      };
      MapCamera.prototype.reduceDrawCall = function(result, node) {
        if (1 == result) node.opacity = node.opacity || 255; else if (0 == result) {
          node.opacity = node.opacity || 255;
          this.updateNodeInCamera(node, this.camera.zoomRatio, this.reduceDrawCall, this);
        } else node.opacity = 0;
      };
      MapCamera.prototype.loadMapBg = function(result, node) {
        this.loadSpriteFrame(result, node, "texture/map/bg/");
      };
      MapCamera.prototype.loadWall = function(result, node) {
        this.loadSpriteFrame(result, node, "texture/map/wall/");
      };
      MapCamera.prototype.loadSpriteFrame = function(result, node, path) {
        var sprite = node.getComponent(cc.Sprite);
        1 != result && 0 != result || sprite.spriteFrame || cc.loader.loadRes(path + node.name, cc.SpriteFrame, function(error, spriteFrame) {
          error || (sprite.spriteFrame = spriteFrame);
        });
      };
      MapCamera.prototype.onDisable = function() {
        this.camera.node.cleanup();
      };
      __decorate([ property(cc.Camera) ], MapCamera.prototype, "camera", void 0);
      __decorate([ property(cc.Node) ], MapCamera.prototype, "mapBg", void 0);
      __decorate([ property(cc.Node) ], MapCamera.prototype, "wall", void 0);
      MapCamera = __decorate([ ccclass ], MapCamera);
      return MapCamera;
    }(cc.Component);
    exports.default = MapCamera;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Data/Const/Event": "Event",
    "./MapIslandUtils": "MapIslandUtils"
  } ],
  MapIslandManager: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e49dcc/kc1ODq3SjVDT4yWz", "MapIslandManager");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../../Base/Manager/M");
    var MapIslandManager = function() {
      function MapIslandManager() {}
      MapIslandManager.getBuildConfigById = function(id) {
        var config = M_1.default.table.IslandUnlockCfg.getData();
        for (var i = 0; i < config.length; ++i) if (config[i].buildId == id) return config[i];
        console.error("\u83b7\u53d6\u4e0d\u5230\u5efa\u7b51id=" + id + "\u7684\u914d\u7f6e");
        return null;
      };
      return MapIslandManager;
    }();
    exports.MapIslandManager = MapIslandManager;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M"
  } ],
  MapIslandUtils: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "2c02bYBrSFBMqeEiDuBKWZP", "MapIslandUtils");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var MapIslandManager_1 = require("./MapIslandManager");
    var StorageMgr_1 = require("../../../../Base/Manager/StorageMgr");
    var M_1 = require("../../../../Base/Manager/M");
    var EventMgr_1 = require("../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Data/Const/Event");
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var CloudView_1 = require("./CloudView");
    var MapIslandUtils = function() {
      function MapIslandUtils() {}
      Object.defineProperty(MapIslandUtils, "mapCamera", {
        get: function() {
          return this._camera;
        },
        set: function(camera) {
          this._camera = camera;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(MapIslandUtils, "mapLoadFinished", {
        get: function() {
          return this._mapLoadFinished;
        },
        set: function(mapLoadFinished) {
          this._mapLoadFinished = mapLoadFinished;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(MapIslandUtils, "MapScale", {
        get: function() {
          return this._mapScale;
        },
        set: function(scale) {
          this._mapScale = scale;
        },
        enumerable: true,
        configurable: true
      });
      MapIslandUtils.getBuildIcon = function(buildingId, state) {
        void 0 === state && (state = 1);
        return "texture/map/ui/buildIcon/building_B_" + buildingId + "_" + state;
      };
      MapIslandUtils.getBuildShareIcon = function(buildingId, state) {
        void 0 === state && (state = 1);
        return "texture/map/ui/buildShare/buildShare_B_" + buildingId + "_" + state;
      };
      MapIslandUtils.getBuildingState = function(buildingId) {
        var buildingStates = StorageMgr_1.StorageMgr.Storage.getObject(StorageMgr_1.StorageMgr.Storage.BuildingState) || {};
        var singleBuildingState = buildingStates[buildingId];
        return singleBuildingState ? singleBuildingState.state : 0;
      };
      MapIslandUtils.setBuildingState = function(buildingId, state) {
        var buildingStates = StorageMgr_1.StorageMgr.Storage.getObject(StorageMgr_1.StorageMgr.Storage.BuildingState) || {};
        var singleBuildingState = buildingStates[buildingId];
        null == singleBuildingState ? singleBuildingState = {
          buildingId: buildingId,
          fixed: false,
          state: state
        } : singleBuildingState.state = state;
        buildingStates[buildingId] = singleBuildingState;
        StorageMgr_1.StorageMgr.Storage.setObject(StorageMgr_1.StorageMgr.Storage.BuildingState, buildingStates, true);
      };
      MapIslandUtils.getBuildFixed = function(buildingId) {
        var buildingStates = StorageMgr_1.StorageMgr.Storage.getObject(StorageMgr_1.StorageMgr.Storage.BuildingState) || {};
        var singleBuildingState = buildingStates[buildingId];
        return !!singleBuildingState && singleBuildingState.fixed;
      };
      MapIslandUtils.setBuildFixed = function(buildingId) {
        var buildingStates = StorageMgr_1.StorageMgr.Storage.getObject(StorageMgr_1.StorageMgr.Storage.BuildingState) || {};
        var singleBuildingState = buildingStates[buildingId];
        null == singleBuildingState ? singleBuildingState = {
          buildingId: buildingId,
          fixed: true,
          state: 0
        } : singleBuildingState.fixed = true;
        buildingStates[buildingId] = singleBuildingState;
        StorageMgr_1.StorageMgr.Storage.setObject(StorageMgr_1.StorageMgr.Storage.BuildingState, buildingStates, true);
      };
      MapIslandUtils.getBuildConfigById = function(buildingId) {
        return MapIslandManager_1.MapIslandManager.getBuildConfigById(buildingId);
      };
      MapIslandUtils.getNextUnlockBuildingId = function() {
        var star = M_1.default.runtime.getStarCount();
        var config = M_1.default.table.IslandUnlockCfg.getData();
        for (var i = 0; i < config.length; ++i) if (star < config[i].starlv) return config[i].buildId;
        return -1;
      };
      MapIslandUtils.getSmallOpenBuildingId = function() {
        var config = M_1.default.table.IslandUnlockCfg.getData();
        var star = M_1.default.runtime.getStarCount();
        var buildingStates = StorageMgr_1.StorageMgr.Storage.getObject(StorageMgr_1.StorageMgr.Storage.BuildingState);
        if (null == buildingStates) return config[0].buildId;
        var bigBuildingId = 1;
        for (var id in buildingStates) {
          if (buildingStates[id] && buildingStates[id].fixed && 0 == buildingStates[id].state) return buildingStates[id].buildingId;
          bigBuildingId = Number(id);
        }
        for (var i = 0; i < config.length; ++i) {
          var iconfig = config[i];
          if (null == buildingStates[iconfig.buildId] && iconfig.starlv <= star) return iconfig.buildId;
        }
        return bigBuildingId;
      };
      MapIslandUtils.getBuildPosByBuildId = function(buildingId) {
        var _mapBuildPos = {
          1: {
            x: -778.735,
            y: -1283.624,
            z: 0
          },
          2: {
            x: -877.871,
            y: -1022.928,
            z: 0
          },
          3: {
            x: -1698.228,
            y: -340.702,
            z: 0
          },
          4: {
            x: -1474.884,
            y: -398.388,
            z: 0
          },
          5: {
            x: -1276.322,
            y: -162.589,
            z: 0
          },
          6: {
            x: -927.726,
            y: -365.137,
            z: 0
          },
          7: {
            x: -907.5,
            y: 66,
            z: 0
          },
          8: {
            x: -534.028,
            y: 196.112,
            z: 0
          },
          9: {
            x: -412,
            y: -129,
            z: 0
          },
          10: {
            x: 78.136,
            y: -790.895,
            z: 0
          },
          11: {
            x: 0,
            y: -81.065,
            z: 0
          },
          12: {
            x: -404.968,
            y: 636.378,
            z: 0
          },
          13: {
            x: 0,
            y: 387.765,
            z: 0
          },
          14: {
            x: 81.937,
            y: 847.765,
            z: 0
          },
          15: {
            x: 791.125,
            y: -558.105,
            z: 0
          },
          16: {
            x: 900.651,
            y: -81.548,
            z: 0
          },
          17: {
            x: 372.904,
            y: 668.322,
            z: 0
          },
          18: {
            x: 752.595,
            y: 850.622,
            z: 0
          },
          19: {
            x: 1227.135,
            y: 701.697,
            z: 0
          },
          20: {
            x: 1431.102,
            y: 782.251,
            z: 0
          },
          21: {
            x: 1154.27,
            y: 1103.031,
            z: 0
          },
          22: {
            x: 1565.413,
            y: 961.177,
            z: 0
          },
          23: {
            x: 1781.137,
            y: 803.848,
            z: 0
          },
          24: {
            x: 1974.198,
            y: 271.749,
            z: 0
          },
          25: {
            x: 1753.702,
            y: 1299.591,
            z: 0
          },
          26: {
            x: 1728.51,
            y: 597.399,
            z: 0
          },
          27: {
            x: 2102.261,
            y: 1456.261,
            z: 0
          }
        };
        return _mapBuildPos[buildingId];
      };
      MapIslandUtils.mapMoveTo = function(buildingId, moveEndNext) {
        var buildPos = MapIslandUtils.getBuildPosByBuildId(buildingId);
        buildPos && EventMgr_1.default.ins.send(Event_1.Event.Map.CameraMoveTo, cc.v2(buildPos.x, buildPos.y), moveEndNext);
      };
      MapIslandUtils.cameraGetWorldToScreenPoint = function(point, out) {
        this._camera && this._camera.getWorldToScreenPoint(point, out);
      };
      MapIslandUtils.convertMapItemPosition = function(node, stepConfig) {
        if (!this._camera) return null;
        var out = cc.v3();
        var commandType = stepConfig.command.type;
        if ("MapItem" == commandType) node.position.scale(cc.v3(this._mapScale, this._mapScale, 1), out); else {
          if (void 0 == commandType) return null;
          if ("MapUI" == commandType) return null;
        }
        var out1 = cc.v2();
        this.cameraGetWorldToScreenPoint(out, out1);
        return out1;
      };
      MapIslandUtils.setWin = function() {
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.GameOverWin, {
          type: UIData_1.UIHudDef.GameOverWin,
          data: 1
        });
      };
      MapIslandUtils.preloadMapBg = function() {};
      MapIslandUtils.openMapIsland = function() {
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.CloudView, CloudView_1.ICloudData.OpenHotel);
      };
      MapIslandUtils.openMapNeedStar = function() {
        var config = M_1.default.table.IslandUnlockCfg.getData();
        return config[0].starlv;
      };
      MapIslandUtils.leaveMapIsland = function() {
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.CloudView, CloudView_1.ICloudData.LeaveIsland);
      };
      MapIslandUtils.checkBuildFixed = function(buildingId) {
        return this.getBuildFixed(buildingId);
      };
      MapIslandUtils.checkBuildFinished = function(buildingId) {
        return 0 != this.getBuildingState(buildingId);
      };
      MapIslandUtils._mapScale = 0;
      MapIslandUtils._mapLoadFinished = false;
      MapIslandUtils._camera = null;
      MapIslandUtils._loadBgCompleted = false;
      return MapIslandUtils;
    }();
    exports.default = MapIslandUtils;
    window["MapIslandUtils"] = MapIslandUtils;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Manager/StorageMgr": "StorageMgr",
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData",
    "./CloudView": "CloudView",
    "./MapIslandManager": "MapIslandManager"
  } ],
  MapScene: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "c18edLWRGhAKInihPZoc02V", "MapScene");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var EventMgr_1 = require("../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Data/Const/Event");
    var TrafficSystem_1 = require("./TrafficSystem/TrafficSystem");
    var M_1 = require("../../../../Base/Manager/M");
    var MapIslandUtils_1 = require("./MapIslandUtils");
    var Exchange_1 = require("./Exchange");
    var Util_1 = require("../../../../Base/Utils/Util");
    var GuideUtils_1 = require("../../../../../GodGuide/GuideUtils");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var MapScene = function(_super) {
      __extends(MapScene, _super);
      function MapScene() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.mapCamera = null;
        _this.buildingCamera = null;
        _this.trafficSystem = null;
        _this.mapNode = null;
        _this.mapBg = null;
        return _this;
      }
      MapScene.prototype.onLoad = function() {
        M_1.default.changeScene();
      };
      MapScene.prototype.onDestroy = function() {
        this.node.off(cc.Node.EventType.TOUCH_END);
        gsap.TweenLite.killTweensOf(this.mapNode);
        MapIslandUtils_1.default.mapLoadFinished = false;
      };
      MapScene.prototype.start = function() {
        var _this = this;
        var windowSize = cc.view.getVisibleSize();
        var minRatio = windowSize.height / this.mapBg.height;
        gsap.TweenLite.to(this.mapNode, 1.5, {
          scale: minRatio,
          onComplete: function() {
            UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.MenuPanel);
            MapIslandUtils_1.default.mapLoadFinished = true;
            MapIslandUtils_1.default.MapScale = minRatio;
            EventMgr_1.default.ins.send(Event_1.Event.Map.MapTouchMoveEnable, true);
            GuideUtils_1.GuideUtils.stopGuide = true;
            _this.moveToLastBuild(function() {
              GuideUtils_1.GuideUtils.stopGuide = false;
              GuideUtils_1.GuideUtils.pushGuide("_Guide_level3_1", true);
            });
          }
        });
      };
      MapScene.prototype.moveToLastBuild = function(moveEndNext) {
        var buildId = 0;
        buildId = MapIslandUtils_1.default.checkBuildFinished(15) ? MapIslandUtils_1.default.checkBuildFinished(16) ? MapIslandUtils_1.default.getSmallOpenBuildingId() : 16 : 15;
        MapIslandUtils_1.default.mapMoveTo(buildId, moveEndNext);
      };
      MapScene.prototype.onEnable = function() {};
      MapScene.prototype.onDisable = function() {
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.MenuPanel);
      };
      MapScene.prototype.test = function() {
        var exchanges = this.node.getComponentsInChildren(Exchange_1.default);
        var buidlingPosition = {};
        exchanges.forEach(function(exchange) {
          if (exchange.enabled) {
            var key = exchange.buildingId;
            var lock = Util_1.Util.Tool.getChildByName(exchange.node, "Lock");
            if (lock) {
              console.error(key, lock.position);
              buidlingPosition[key] = lock.position;
            }
          }
        });
        console.error(JSON.stringify(buidlingPosition));
      };
      __decorate([ property(cc.Camera) ], MapScene.prototype, "mapCamera", void 0);
      __decorate([ property(cc.Camera) ], MapScene.prototype, "buildingCamera", void 0);
      __decorate([ property(TrafficSystem_1.default) ], MapScene.prototype, "trafficSystem", void 0);
      __decorate([ property(cc.Node) ], MapScene.prototype, "mapNode", void 0);
      __decorate([ property(cc.Node) ], MapScene.prototype, "mapBg", void 0);
      MapScene = __decorate([ ccclass ], MapScene);
      return MapScene;
    }(cc.Component);
    exports.default = MapScene;
    cc._RF.pop();
  }, {
    "../../../../../GodGuide/GuideUtils": "GuideUtils",
    "../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../../Base/Utils/Util": "Util",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData",
    "./Exchange": "Exchange",
    "./MapIslandUtils": "MapIslandUtils",
    "./TrafficSystem/TrafficSystem": "TrafficSystem"
  } ],
  Match3TutorialCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "d6ec32L2A1A2LNRw7y+WORn", "Match3TutorialCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var TutorialBubbleCtrl_1 = require("./TutorialBubbleCtrl");
    var TutorialBorderCtrl_1 = require("./TutorialBorderCtrl");
    var TouchHintCtrl_1 = require("./TouchHintCtrl");
    var M_1 = require("../../../Base/Manager/M");
    var Event_1 = require("../../Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var Match3TutorialCtrl = function(_super) {
      __extends(Match3TutorialCtrl, _super);
      function Match3TutorialCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.bubble = null;
        _this.touchHint = null;
        _this.maskNode = null;
        _this.borderNode = null;
        _this.handNode = null;
        _this.goal = null;
        _this.maskIdxPos = [];
        _this.cells = [];
        _this.mainData = null;
        _this.controller = null;
        _this.isReady = false;
        _this.isShowGoal = false;
        _this.goalClone = null;
        return _this;
      }
      Match3TutorialCtrl.prototype.start = function() {};
      Match3TutorialCtrl.prototype.initView = function(data, controller) {
        var _this = this;
        this.stepIdx = 0;
        this.maskIdxPos = [];
        this.mainData = data;
        this.controller = controller;
        this.isReady = false;
        this.node.zIndex = 101;
        this.node.on(cc.Node.EventType.TOUCH_START, function(event) {
          var stepData = _this.mainData.stages[_this.stepIdx - 1];
          if (stepData && stepData.closeByTouch) {
            _this.closeTutorial();
            return;
          }
          var status = _this.checkPoint(event.touch.getLocation());
          status && _this.isReady && _this.controller.node.emit(cc.Node.EventType.TOUCH_START, event);
        });
        this.node.on(cc.Node.EventType.TOUCH_END, function(event) {
          event.istutorial = true;
          _this.controller.node.emit(cc.Node.EventType.TOUCH_END, event);
        });
        this.node.on(cc.Node.EventType.TOUCH_MOVE, function(event) {
          var status1 = _this.checkPoint(event.touch.getStartLocation());
          var status2 = _this.checkPoint(event.touch.getLocation());
          status1 && status2 && _this.isReady && _this.controller.node.emit(cc.Node.EventType.TOUCH_MOVE, event);
        });
      };
      Match3TutorialCtrl.prototype.buildStage = function() {
        if (!this.mainData) return false;
        var stage = this.mainData.stages[this.stepIdx];
        this.cells = [];
        if (stage && stage.cells) for (var cell in stage.cells) {
          if (!stage.cells[cell].removable) continue;
          this.cells.push(stage.cells[cell]);
        }
        if (!stage) return false;
        this.node.active = true;
        var graphics = this.maskNode.getComponent(cc.Mask)["_graphics"];
        graphics.clear(false);
        this.drawMask(graphics, stage);
        graphics.fill();
        this.borderNode.getComponent(TutorialBorderCtrl_1.default).setData(stage);
        this.bubble.getComponent(TutorialBubbleCtrl_1.default).setData(stage.bubble);
        this.stepIdx++;
        return true;
      };
      Match3TutorialCtrl.prototype.startTutorial = function() {
        this.isReady = false;
        this.touchHint.active = false;
        var status = this.buildStage();
        status && this.showNode();
      };
      Match3TutorialCtrl.prototype.closeTutorial = function() {
        if (this.node && this.node.active && this.isReady) {
          this.isReady = false;
          this.hidenNode();
        }
      };
      Match3TutorialCtrl.prototype.checkPoint = function(pos) {
        var idxPos = this.convertTouchPosToCell(pos);
        if (null == idxPos) return false;
        var status = false;
        var flag = false;
        for (var i = 0; i < this.cells.length; i++) if (idxPos.x == this.cells[i].x && idxPos.y == this.cells[i].y) {
          flag = true;
          break;
        }
        this.maskIdxPos.forEach(function(p) {
          idxPos && p.x == idxPos.x && p.y == idxPos.y && flag && (status = true);
        }, this);
        return status;
      };
      Match3TutorialCtrl.prototype.convertTouchPosToCell = function(pos) {
        this.node.convertToNodeSpaceAR(pos, pos);
        var idxPos = Common_1.default.convetPos(pos);
        if (idxPos.x < 0 || idxPos.x > Common_1.default.GRID_W - 0 || idxPos.y < 0 || idxPos.y > Common_1.default.GRID_H - 0) return null;
        return idxPos;
      };
      Match3TutorialCtrl.prototype.drawHand = function(data) {
        if (!data) {
          this.handNode.active = false;
          return;
        }
        this.handNode.active = true;
        this.handNode.stopAllActions();
        var pos = Common_1.default.getPos(data.x, data.y);
        this.handNode.setPosition(pos);
        if ("click" == data.type) this.handNode.runAction(cc.sequence(cc.moveTo(.4, pos.x, pos.y + 10), cc.moveTo(.1, pos.x, pos.y), cc.moveTo(.4, pos.x, pos.y + 10), cc.moveTo(.1, pos.x, pos.y), cc.moveTo(.3, pos.x, pos.y)).repeatForever()); else {
          var dx = 0, dy = 0, step = Common_1.default.GRID_W;
          "left" == data.type ? dx = -1 : "right" == data.type ? dx = 1 : "up" == data.type ? dy = 1 : "down" == data.type && (dy = -1);
          this.handNode.runAction(cc.sequence(cc.moveTo(1, pos.x + dx * step, pos.y + dy * step), cc.moveTo(.2, pos.x, pos.y)).repeatForever());
        }
      };
      Match3TutorialCtrl.prototype.drawMask = function(graphics, data) {
        this.maskIdxPos = [];
        data.cells && data.cells.forEach(function(cell) {
          var pos = Common_1.default.getPos(cell.x, cell.y);
          var dd = Common_1.default.GRID_H / 2;
          this.maskIdxPos.push(cc.v2(cell.x, cell.y));
          graphics.fillRect(pos.x - dd - 1, pos.y - dd - 2, Common_1.default.GRID_H + 2, Common_1.default.GRID_W + 4);
        }, this);
      };
      Match3TutorialCtrl.prototype.showGoal = function() {
        this.goalClone = cc.instantiate(this.goal);
        this.node.addChild(this.goalClone);
        this.goalClone.setPosition(this.node.convertToNodeSpaceAR(this.goal.parent.convertToWorldSpaceAR(this.goal.position)));
        this.goalClone.setScale(10 / 9);
        this.isShowGoal = true;
        this.scheduleOnce(function() {
          this.hideGoal();
          this.showGoal();
        }, 1);
      };
      Match3TutorialCtrl.prototype.hideGoal = function() {
        if (this.isShowGoal) {
          this.node.removeChild(this.goalClone);
          this.goalClone.destroy();
          this.isShowGoal = false;
        }
      };
      Match3TutorialCtrl.prototype.hidenNode = function() {
        this.handNode.active = false;
        this.bubble.runAction(cc.fadeOut(.7));
        this.borderNode.runAction(cc.fadeOut(.7));
        this.scheduleOnce(function() {
          this.borderNode.destroyAllChildren();
          this.hideGoal();
          this.node.active = false;
          this.nextStage();
        }, .6);
      };
      Match3TutorialCtrl.prototype.nextStage = function() {
        if (!this.mainData) return false;
        var stages = this.mainData.stages[this.stepIdx];
        if (!stages) return false;
        stages && this.startTutorial();
      };
      Match3TutorialCtrl.prototype._showBorderNode = function(callback) {
        this.scheduleOnce(function() {
          this.bubble.runAction(cc.fadeIn(.3));
          this.borderNode.runAction(cc.sequence(cc.fadeIn(.3), cc.callFunc(callback)));
        }, .2);
      };
      Match3TutorialCtrl.prototype.showNode = function() {
        var _this = this;
        this.node.active = true;
        this.bubble.active = true;
        this.bubble.opacity = 0;
        this._showBorderNode(function() {
          _this.isReady = true;
          M_1.default.event.once(Event_1.Event.UI.CloseTutorial, _this.closeTutorial, _this);
        });
        this.scheduleOnce(function() {
          var stepData = _this.mainData.stages[_this.stepIdx - 1];
          _this.drawHand(stepData.hand);
          stepData && stepData.closeByTouch ? _this.touchHint.getComponent(TouchHintCtrl_1.default).show() : _this.touchHint.getComponent(TouchHintCtrl_1.default).hide();
          stepData.highLightGoal && _this.showGoal();
        }, .6);
      };
      __decorate([ property(cc.Node) ], Match3TutorialCtrl.prototype, "bubble", void 0);
      __decorate([ property(cc.Node) ], Match3TutorialCtrl.prototype, "touchHint", void 0);
      __decorate([ property(cc.Node) ], Match3TutorialCtrl.prototype, "maskNode", void 0);
      __decorate([ property(cc.Node) ], Match3TutorialCtrl.prototype, "borderNode", void 0);
      __decorate([ property(cc.Node) ], Match3TutorialCtrl.prototype, "handNode", void 0);
      __decorate([ property(cc.Node) ], Match3TutorialCtrl.prototype, "goal", void 0);
      Match3TutorialCtrl = __decorate([ ccclass ], Match3TutorialCtrl);
      return Match3TutorialCtrl;
    }(cc.Component);
    exports.default = Match3TutorialCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../Common/Common": "Common",
    "../../Data/Const/Event": "Event",
    "./TouchHintCtrl": "TouchHintCtrl",
    "./TutorialBorderCtrl": "TutorialBorderCtrl",
    "./TutorialBubbleCtrl": "TutorialBubbleCtrl"
  } ],
  MemoryDetector: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "6529cs4SbNNW7oablE8pLYz", "MemoryDetector");
    cc._RF.pop();
  }, {} ],
  MenuPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9b5ddsY55pERJTwqfZX67HN", "MenuPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var Event_1 = require("../../Data/Const/Event");
    var UIMgr_1 = require("../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Data/Interface/UIData");
    var M_1 = require("../../../Base/Manager/M");
    var Common_1 = require("../Common");
    var MapIslandUtils_1 = require("../../SimulationOperation/View/Map/MapIslandUtils");
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var DockMenu;
    (function(DockMenu) {
      DockMenu[DockMenu["Top"] = 0] = "Top";
      DockMenu[DockMenu["Bottom"] = 1] = "Bottom";
      DockMenu[DockMenu["Left"] = 2] = "Left";
      DockMenu[DockMenu["Right"] = 3] = "Right";
    })(DockMenu = exports.DockMenu || (exports.DockMenu = {}));
    exports.allMenu = [ DockMenu.Top, DockMenu.Left, DockMenu.Right, DockMenu.Bottom ];
    var dockMoveTime = .5;
    var MenuPanel = function(_super) {
      __extends(MenuPanel, _super);
      function MenuPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.topDock = null;
        _this.bottomDock = null;
        _this.leftDock = null;
        _this.rightDock = null;
        _this.starDock = null;
        _this.coinDock = null;
        _this.labelCoin = null;
        _this.labelStar = null;
        _this.avatarSprite = null;
        _this.tipsNode = null;
        _this.labelTip1 = null;
        _this.labelTip2 = null;
        return _this;
      }
      MenuPanel.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
        EventMgr_1.default.ins.register(Event_1.Event.UI.UpdateCurrency, this.updateInfo, this);
      };
      MenuPanel.prototype.start = function() {
        this.labelTip2.string = "\u53ef\u9a71\u6563\u4e0b\u4e00\u7247\u5bc6\u4e91!!";
        this.starDock.y -= M_1.default.platform.getTopBangPosition();
        this.coinDock.y -= M_1.default.platform.getTopBangPosition();
        this.showDock(exports.allMenu);
        this.initPanelUIInfo();
      };
      MenuPanel.prototype.showDock = function(docks) {
        var _this = this;
        var width = cc.winSize.width;
        var height = cc.winSize.height;
        docks.forEach(function(dock) {
          if (dock == DockMenu.Top) {
            var y = height / 2 - _this.topDock.height / 2;
            gsap.TweenLite.to(_this.topDock, dockMoveTime, {
              y: y
            });
          } else if (dock == DockMenu.Left) {
            var x = -width / 2 + _this.leftDock.width / 2;
            gsap.TweenLite.to(_this.leftDock, dockMoveTime, {
              x: x
            });
          } else if (dock == DockMenu.Right) {
            var x = width / 2 - _this.rightDock.width / 2;
            gsap.TweenLite.to(_this.rightDock, dockMoveTime, {
              x: x
            });
          } else if (dock == DockMenu.Bottom) {
            var y = -height / 2 + _this.bottomDock.height / 2;
            gsap.TweenLite.to(_this.bottomDock, dockMoveTime, {
              y: y
            });
          }
        });
      };
      MenuPanel.prototype.hideDock = function(docks) {
        var _this = this;
        var width = cc.winSize.width;
        var height = cc.winSize.height;
        docks.forEach(function(dock) {
          if (dock == DockMenu.Top) {
            var y = height / 2 + _this.topDock.height / 2;
            gsap.TweenLite.to(_this.topDock, dockMoveTime, {
              y: y
            });
          } else if (dock == DockMenu.Left) {
            var x = -width / 2 - _this.leftDock.width / 2;
            gsap.TweenLite.to(_this.leftDock, dockMoveTime, {
              x: x
            });
          } else if (dock == DockMenu.Right) {
            var x = width / 2 + _this.rightDock.width / 2;
            gsap.TweenLite.to(_this.rightDock, dockMoveTime, {
              x: x
            });
          } else if (dock == DockMenu.Bottom) {
            var y = -height / 2 - _this.bottomDock.height / 2;
            gsap.TweenLite.to(_this.bottomDock, dockMoveTime, {
              y: y
            });
          }
        });
      };
      MenuPanel.prototype.initPanelUIInfo = function() {
        this.labelStar.string = M_1.default.runtime.getStarCount().toString();
        var nextBuildingId = MapIslandUtils_1.default.getNextUnlockBuildingId();
        if (-1 == nextBuildingId) this.tipsNode.active = false; else {
          var buildConfig = MapIslandUtils_1.default.getBuildConfigById(nextBuildingId);
          this.labelTip1.string = "\u5c9b\u4e3b" + buildConfig.starlv;
        }
        this.updateInfo();
        this._updateAvatar();
      };
      MenuPanel.prototype.updateInfo = function() {
        this.labelCoin.string = M_1.default.runtime.getFormateCoin();
      };
      MenuPanel.prototype._updateAvatar = function() {
        var _this = this;
        M_1.default.platform.getUserInfo().then(function(userdata) {
          userdata && userdata.avatarUrl && Common_1.default.getRemotPic(userdata.avatarUrl).then(function(frame) {
            frame && (_this.avatarSprite.spriteFrame = frame);
          });
        });
      };
      MenuPanel.prototype.onSelectLvClick = function() {
        UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.MenuPanel);
        MapIslandUtils_1.default.leaveMapIsland();
      };
      MenuPanel.prototype.onDisable = function() {
        _super.prototype.onDisable.call(this);
      };
      MenuPanel.prototype.onDestroy = function() {
        _super.prototype.onDestroy.call(this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.UI.UpdateCurrency, this.updateInfo, this);
      };
      __decorate([ property(cc.Node) ], MenuPanel.prototype, "topDock", void 0);
      __decorate([ property(cc.Node) ], MenuPanel.prototype, "bottomDock", void 0);
      __decorate([ property(cc.Node) ], MenuPanel.prototype, "leftDock", void 0);
      __decorate([ property(cc.Node) ], MenuPanel.prototype, "rightDock", void 0);
      __decorate([ property(cc.Node) ], MenuPanel.prototype, "starDock", void 0);
      __decorate([ property(cc.Node) ], MenuPanel.prototype, "coinDock", void 0);
      __decorate([ property(cc.Label) ], MenuPanel.prototype, "labelCoin", void 0);
      __decorate([ property(cc.Label) ], MenuPanel.prototype, "labelStar", void 0);
      __decorate([ property(cc.Sprite) ], MenuPanel.prototype, "avatarSprite", void 0);
      __decorate([ property(cc.Node) ], MenuPanel.prototype, "tipsNode", void 0);
      __decorate([ property(cc.Label) ], MenuPanel.prototype, "labelTip1", void 0);
      __decorate([ property(cc.Label) ], MenuPanel.prototype, "labelTip2", void 0);
      MenuPanel = __decorate([ ccclass ], MenuPanel);
      return MenuPanel;
    }(UIBase_1.default);
    exports.default = MenuPanel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/Manager/M": "M",
    "../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../Data/Const/Event": "Event",
    "../../Data/Interface/UIData": "UIData",
    "../../SimulationOperation/View/Map/MapIslandUtils": "MapIslandUtils",
    "../Common": "Common"
  } ],
  MoneyManager: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "239bbN7EhhLHKmRmeKBWpzn", "MoneyManager");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BaseConst_1 = require("../../Base/BaseConst");
    var M_1 = require("../../Base/Manager/M");
    var Constant_1 = require("./Const/Constant");
    var MoneyTipsType;
    (function(MoneyTipsType) {
      MoneyTipsType[MoneyTipsType["None"] = 0] = "None";
      MoneyTipsType[MoneyTipsType["Panel"] = 1] = "Panel";
      MoneyTipsType[MoneyTipsType["Msg"] = 2] = "Msg";
    })(MoneyTipsType = exports.MoneyTipsType || (exports.MoneyTipsType = {}));
    var MoneyManager = function() {
      function MoneyManager() {}
      MoneyManager.CheckMoney = function(moneyType, needNum, takeOff, tipsType) {
        void 0 === takeOff && (takeOff = false);
        void 0 === tipsType && (tipsType = MoneyTipsType.Msg);
        var result = true;
        var haveNum = M_1.default.runtime.getCurrency(moneyType);
        var addNum = 0;
        if (haveNum < needNum) {
          addNum = needNum - haveNum;
          result = false;
        }
        if (result) takeOff && M_1.default.runtime.addCurrency(moneyType, -needNum); else if (tipsType == MoneyTipsType.Msg) switch (moneyType) {
         case BaseConst_1.CurrencyId.Coin:
          M_1.default.tips.show(Constant_1.WaringTips.NoMoreCoin);
          break;

         case BaseConst_1.CurrencyId.Diamond:
          M_1.default.tips.show(Constant_1.WaringTips.NoMoreDiamond);
        }
        return result;
      };
      MoneyManager.CheckMoneyJson = function(comJson, takeOff, tipType) {
        void 0 === takeOff && (takeOff = false);
        void 0 === tipType && (tipType = MoneyTipsType.Msg);
        var itemId = comJson.itemId;
        var result = MoneyManager.CheckMoney(itemId, comJson.num, takeOff, tipType);
        return result;
      };
      return MoneyManager;
    }();
    exports.MoneyManager = MoneyManager;
    cc._RF.pop();
  }, {
    "../../Base/BaseConst": "BaseConst",
    "../../Base/Manager/M": "M",
    "./Const/Constant": "Constant"
  } ],
  MoreCoin: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "7d8f30zJBhEor6VWQiX3GJ4", "MoreCoin");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var UIMgr_1 = require("../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Data/Interface/UIData");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var MoreCoin = function(_super) {
      __extends(MoreCoin, _super);
      function MoreCoin() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.contentLabel = null;
        _this._animation = null;
        return _this;
      }
      MoreCoin.prototype.onInit = function() {
        this._animation || (this._animation = this.getComponent(cc.Animation));
        this._animation.play("moreCoin");
      };
      MoreCoin.prototype.onGo = function() {
        UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.MoreCoin);
        UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.SelectShowTarget, {
          type: UIData_1.UIHudDef.SelectShowTarget,
          data: null
        });
      };
      MoreCoin.prototype.onNotGo = function() {
        UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.MoreCoin);
      };
      __decorate([ property(cc.Label) ], MoreCoin.prototype, "contentLabel", void 0);
      MoreCoin = __decorate([ ccclass ], MoreCoin);
      return MoreCoin;
    }(UIBase_1.default);
    exports.default = MoreCoin;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../Data/Interface/UIData": "UIData"
  } ],
  MultipleGridColBase: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "c6bbfYLRvZP57Iuq/3RjsVc", "MultipleGridColBase");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var MultipleGridColBase = function() {
      function MultipleGridColBase(data, index) {
        this.index = 0;
        this._cfg = null;
        this._count = 0;
        this._pool = {};
        this.index = index;
        this._cfg = [];
        for (var i = data.length; i--; ) void 0 != data[i].index && data[i].index != index || this._cfg.push(data[i]);
        this._cfg.sort(function(a, b) {
          return a.y - b.y;
        });
      }
      Object.defineProperty(MultipleGridColBase.prototype, "config", {
        get: function() {
          return this._cfg;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(MultipleGridColBase.prototype, "count", {
        get: function() {
          return this._count;
        },
        enumerable: true,
        configurable: true
      });
      MultipleGridColBase.prototype.getData = function() {
        return this._pool;
      };
      MultipleGridColBase.prototype.checkItemCompletByIndex = function(idx) {
        var result = this._pool[idx] && this._pool[idx].length <= 0;
        if (result) {
          this._count--;
          delete this._pool[idx];
        }
        return result;
      };
      MultipleGridColBase.prototype.updateItemCountByPos = function(pos) {
        for (var idx in this._pool) {
          var items = this._pool[idx];
          for (var i = items.length; i--; ) {
            var item = items[i];
            if (pos.x == item.x && pos.y == item.y) {
              items.splice(i, 1);
              return idx;
            }
          }
        }
      };
      return MultipleGridColBase;
    }();
    exports.default = MultipleGridColBase;
    cc._RF.pop();
  }, {} ],
  MultipleGridColModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "fd2d4GYSOZAwrVh6W+0qnCV", "MultipleGridColModel");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GnomeModel_1 = require("./multipleGridCol/GnomeModel");
    var TurtlesModel_1 = require("./multipleGridCol/TurtlesModel");
    var CrabModel_1 = require("./multipleGridCol/CrabModel");
    var MultipleGridColModel = function() {
      function MultipleGridColModel(data, index) {
        this._gnome = null;
        this._turtles = null;
        this._crab = null;
        data.gnome && (this._gnome = new GnomeModel_1.default(data.gnome, index));
        data.turtles && (this._turtles = new TurtlesModel_1.default(data.turtles, index));
        data.crab && (this._crab = new CrabModel_1.default(data.crab, index));
      }
      MultipleGridColModel.prototype.sync2View = function(list) {
        this._crab && this._crab.sync2View(list);
        this._gnome && this._gnome.sync2View(list);
        this._turtles && this._turtles.sync2View(list);
      };
      MultipleGridColModel.prototype.getConfig = function(type) {
        var result = null;
        var m = this.getModel(type);
        m && (result = m.config);
        return result;
      };
      MultipleGridColModel.prototype.getData = function(type) {
        var result = null;
        var m = this.getModel(type);
        m && (result = m.getData());
        return result;
      };
      MultipleGridColModel.prototype.checkItemOver = function(type, idx) {
        var result = null;
        var m = this.getModel(type);
        m && (result = m.checkItemCompletByIndex(idx));
        return result;
      };
      MultipleGridColModel.prototype.updateItemCountByPos = function(type, pos) {
        var result = null;
        var m = this.getModel(type);
        m && (result = m.updateItemCountByPos(pos));
        return result;
      };
      MultipleGridColModel.prototype.onComplet = function(type, index, topPoint) {
        var m = this.getModel(type);
        m && m.onComplet(index, topPoint);
      };
      MultipleGridColModel.prototype.getModel = function(type) {
        return {
          gnome: this._gnome,
          turtles: this._turtles,
          crab: this._crab
        }[type];
      };
      return MultipleGridColModel;
    }();
    exports.default = MultipleGridColModel;
    cc._RF.pop();
  }, {
    "./multipleGridCol/CrabModel": "CrabModel",
    "./multipleGridCol/GnomeModel": "GnomeModel",
    "./multipleGridCol/TurtlesModel": "TurtlesModel"
  } ],
  M: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "78cb3i1bW9AErD14YvbVYvX", "M");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var PlatformMgr_1 = require("./PlatformMgr");
    var DeviceMgr_1 = require("./DeviceMgr");
    var NodePoolMgr_1 = require("./NodePoolMgr");
    var EventMgr_1 = require("./EventMgr");
    var GameTableMgr_1 = require("./GameTableMgr");
    var CacheMgr_1 = require("./CacheMgr");
    var UIMgr_1 = require("./UIMgr");
    var RuntimeMgr_1 = require("../../Logic/Data/RuntimeMgr");
    var Tips_1 = require("./View/Tips");
    var AudioCtrl_1 = require("../../Logic/Common/AudioCtrl");
    var NetMgr_1 = require("./NetMgr");
    var M = function() {
      function M() {}
      M.init = function() {
        this.platform = PlatformMgr_1.default.ins;
        this.device = DeviceMgr_1.default.ins;
        this.nodePool = NodePoolMgr_1.default.ins;
        this.event = EventMgr_1.default.ins;
        this.table = GameTableMgr_1.GameTableMgr.ins;
        this.tips = Tips_1.default.ins;
        this.audio = AudioCtrl_1.default.ins;
        this.net = NetMgr_1.default.ins;
        this.cache = CacheMgr_1.default.ins;
        this.ui = UIMgr_1.default.ins;
        this.runtime = RuntimeMgr_1.default.ins;
        this.table.execute();
      };
      M.changeScene = function() {};
      M.destory = function() {};
      M.ui = null;
      M.cache = null;
      M.platform = null;
      M.device = null;
      M.nodePool = null;
      M.event = null;
      M.table = null;
      M.runtime = null;
      M.tips = null;
      M.net = null;
      M.audio = null;
      return M;
    }();
    exports.default = M;
    window["M"] = M;
    cc._RF.pop();
  }, {
    "../../Logic/Common/AudioCtrl": "AudioCtrl",
    "../../Logic/Data/RuntimeMgr": "RuntimeMgr",
    "./CacheMgr": "CacheMgr",
    "./DeviceMgr": "DeviceMgr",
    "./EventMgr": "EventMgr",
    "./GameTableMgr": "GameTableMgr",
    "./NetMgr": "NetMgr",
    "./NodePoolMgr": "NodePoolMgr",
    "./PlatformMgr": "PlatformMgr",
    "./UIMgr": "UIMgr",
    "./View/Tips": "Tips"
  } ],
  Mushroom: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "df4e8RXKo1CiKDiEYuvX6MZ", "Mushroom");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GameModel_1 = require("../GameModel");
    var Mushroom = function() {
      function Mushroom() {
        this._content = null;
        this._map = null;
        this._content = new Set();
        this._map = new Map();
      }
      Mushroom.prototype.init = function() {};
      Mushroom.prototype.add = function(pos, model) {
        this._content.add(model);
        this._map.set(pos, model);
      };
      Mushroom.prototype.del = function(pos) {
        this._map.delete(pos);
        this._map.size <= 0 && requestAnimationFrame(this._destory.bind(this));
      };
      Mushroom.prototype._destory = function() {
        this._content.forEach(function(cell) {
          cell.freeThisPos();
          GameModel_1.default.ins.testFindCanFallCell(cell.pos, GameModel_1.default.ins.seq.next());
          cell.extCtrl && cell.extCtrl.hideMushroom();
          cell.extCtrl && cell.extCtrl.PlayShanhuAnim();
        });
        this._content.clear();
      };
      return Mushroom;
    }();
    exports.default = Mushroom;
    cc._RF.pop();
  }, {
    "../GameModel": "GameModel"
  } ],
  NetBase: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "83e83zoFwdKfr9ZFLjhUL0C", "NetBase");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Sequence_1 = require("./Sequence");
    var Seq = new Sequence_1.default();
    var MaxRetryCount = 3;
    var AutoRetryOpt = true;
    var NetBase = function() {
      function NetBase() {
        this.url = null;
        this._isReady = false;
        this.retryCount = 0;
      }
      NetBase.prototype.getRequestId = function() {
        return Seq.nextString();
      };
      Object.defineProperty(NetBase.prototype, "retryMaxCount", {
        get: function() {
          return MaxRetryCount;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(NetBase.prototype, "isAutoRetry", {
        get: function() {
          return AutoRetryOpt;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(NetBase.prototype, "isReady", {
        get: function() {
          return this._isReady;
        },
        enumerable: true,
        configurable: true
      });
      return NetBase;
    }();
    exports.default = NetBase;
    cc._RF.pop();
  }, {
    "./Sequence": "Sequence"
  } ],
  NetMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "304739Pt39JFIg5Ch23iiH5", "NetMgr");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var PlatformMgr_1 = require("./PlatformMgr");
    var Paths_1 = require("../Utils/Paths");
    var HttpRequest_1 = require("../Network/HttpRequest");
    var StorageMgr_1 = require("./StorageMgr");
    var Apps_1 = require("../Apps");
    var RuntimeMgr_1 = require("../../Logic/Data/RuntimeMgr");
    var Constant_1 = require("../../Logic/Data/Const/Constant");
    var M_1 = require("./M");
    var NetMgr = function() {
      function NetMgr() {
        this.access_token = null;
        this.expires_in = 0;
        this.publicHeaders = null;
        this.reTryAuthMaxCount = 3;
        this.publicHeaders = Apps_1.default.isEncode ? {
          "Content-Type": "application/x-crypt-data"
        } : {
          "Content-Type": "application/x-www-form-urlencoded"
        };
        this.syncAuthInfo();
      }
      Object.defineProperty(NetMgr, "ins", {
        get: function() {
          null == this.instance && (this.instance = new NetMgr());
          return this.instance;
        },
        enumerable: true,
        configurable: true
      });
      NetMgr.prototype._auth = function() {
        var _this = this;
        return new Promise(function(resolve) {
          return __awaiter(_this, void 0, void 0, function() {
            var platformData, url, _a, _b, _c, _d, req;
            var _this = this;
            return __generator(this, function(_e) {
              switch (_e.label) {
               case 0:
                return [ 4, PlatformMgr_1.default.ins.login() ];

               case 1:
                platformData = _e.sent();
                if (!platformData) return [ 3, 3 ];
                url = Paths_1.default.MainHost + "auth/login";
                platformData["platform"] = [ "h5", "wx" ][PlatformMgr_1.default.ins.type - 100];
                platformData["appid"] = Constant_1.APPID;
                platformData["v"] = Apps_1.default.Version;
                _a = platformData;
                _b = "userinfo";
                _d = (_c = JSON).stringify;
                return [ 4, PlatformMgr_1.default.ins.getUserInfo() ];

               case 2:
                _a[_b] = _d.apply(_c, [ _e.sent() ]);
                req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, this.publicHeaders, this._formateData(platformData));
                req.execute().then(function(result) {
                  result = _this._formateResultData(result);
                  if (result && 0 == result.code && result.data) {
                    _this.access_token = "Bearer " + result.data.access_token;
                    _this.expires_in = result.data.expires_in;
                    _this.syncAuthInfo(result.data);
                    resolve({
                      uid: result.data.uid,
                      userdata: result.data.userdata,
                      awards: result.data.awards
                    });
                  } else {
                    console.error("\u6388\u6743\u5931\u8d25:", result);
                    resolve(null);
                  }
                });
                return [ 3, 4 ];

               case 3:
                resolve(null);
                _e.label = 4;

               case 4:
                return [ 2 ];
              }
            });
          });
        });
      };
      NetMgr.prototype.getServerData = function() {
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              var url = Paths_1.default.MainHost + "game/config";
              var head = Object.assign({
                Authorization: _this.access_token
              }, _this.publicHeaders);
              var req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, null);
              req.execute().then(function(result) {
                result = _this._formateResultData(result);
                result && 0 == result.code ? resolve(result.data) : resolve(null);
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.getUserData = function() {
        return __awaiter(this, void 0, Promise, function() {
          var userdata;
          var _this = this;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              userdata = null;
              if (!this._isExpiresed) return [ 3, 2 ];
              return [ 4, this._auth() ];

             case 1:
              userdata = _a.sent();
              return [ 3, 4 ];

             case 2:
              return [ 4, new Promise(function(resolve) {
                var url = Paths_1.default.MainHost + "user/data";
                var head = Object.assign({
                  Authorization: _this.access_token
                }, _this.publicHeaders);
                var req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.GET, head, null);
                req.execute().then(function(result) {
                  result = _this._formateResultData(result);
                  result && 0 == result.code ? resolve(result.data) : resolve(null);
                });
              }) ];

             case 3:
              userdata = _a.sent();
              _a.label = 4;

             case 4:
              return [ 2, userdata ];
            }
          });
        });
      };
      NetMgr.prototype.putUserData = function(data, depth) {
        void 0 === depth && (depth = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var reqData, url, head, req;
                var _this = this;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    reqData = data;
                    if ("string" != typeof data) try {
                      reqData = {
                        content: JSON.stringify(data)
                      };
                    } catch (error) {}
                    if (!this._isExpiresed) return [ 3, 4 ];
                    if (!(depth < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.putUserData(data, depth + 1));
                    return [ 3, 3 ];

                   case 2:
                    resolve(null);
                    _a.label = 3;

                   case 3:
                    return [ 3, 5 ];

                   case 4:
                    url = Paths_1.default.MainHost + "user/save";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData(reqData));
                    req.execute().then(function(result) {
                      result = _this._formateResultData(result);
                      console.warn("user/save:", result, reqData);
                      resolve(result && 0 == result.code);
                    });
                    _a.label = 5;

                   case 5:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.putRankData = function(data, depth) {
        void 0 === depth && (depth = 0);
        return __awaiter(this, void 0, void 0, function() {
          var url, head, req;
          var _this = this;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              if (!this._isExpiresed) return [ 3, 3 ];
              if (!(depth < this.reTryAuthMaxCount)) return [ 3, 2 ];
              return [ 4, this._auth() ];

             case 1:
              _a.sent();
              this.putRankData(data, depth + 1);
              _a.label = 2;

             case 2:
              return [ 3, 4 ];

             case 3:
              url = Paths_1.default.MainHost + "rank/put";
              head = Object.assign({
                Authorization: this.access_token
              }, this.publicHeaders);
              req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData(data));
              req.execute().then(function(result) {
                result = _this._formateResultData(result);
                console.warn(result);
              });
              _a.label = 4;

             case 4:
              return [ 2 ];
            }
          });
        });
      };
      NetMgr.prototype.putDailyTaskProgress = function(id, count, depth) {
        var _this = this;
        void 0 === depth && (depth = 0);
        return new Promise(function(resolve, reject) {
          return __awaiter(_this, void 0, void 0, function() {
            var url, head, reqData, req;
            return __generator(this, function(_a) {
              switch (_a.label) {
               case 0:
                if (!this._isExpiresed) return [ 3, 3 ];
                if (!(depth < this.reTryAuthMaxCount)) return [ 3, 2 ];
                return [ 4, this._auth() ];

               case 1:
                _a.sent();
                resolve(this.putDailyTaskProgress(id, count, depth + 1));
                _a.label = 2;

               case 2:
                return [ 3, 4 ];

               case 3:
                url = Paths_1.default.MainHost + "task/progress";
                head = Object.assign({
                  Authorization: this.access_token
                }, this.publicHeaders);
                reqData = {
                  taskid: id,
                  value: count
                };
                req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData(reqData), true);
                req.execute().then(function(result) {
                  result && 0 == result.code ? resolve(result.data) : resolve(null);
                });
                _a.label = 4;

               case 4:
                return [ 2 ];
              }
            });
          });
        });
      };
      NetMgr.prototype.checkTaskIsOK = function(taskid, retryCount) {
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve, reject) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.checkTaskIsOK(taskid, retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "task/check";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData({
                      taskid: taskid
                    }), true);
                    req.execute().then(function(result) {
                      result && result.data ? resolve(true) : resolve(false);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.getDailyTask = function(retryCount) {
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve, reject) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.getDailyTask(retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "task/list";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, null, true);
                    req.execute().then(function(result) {
                      result && 0 == result.code ? resolve(result.data) : resolve(null);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.getRankData = function(data, retryCount) {
        void 0 === data && (data = null);
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                var _this = this;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.getRankData(data, retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "rank/list";
                    data = data || {
                      name: "BarrierRank",
                      type: "All"
                    };
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData(data));
                    req.execute().then(function(result) {
                      result = _this._formateResultData(result);
                      result && 0 == result.code ? resolve(result.data) : resolve(null);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.exitVisit = function(friendsUid, retryCount) {
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                var _this = this;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!friendsUid) return [ 2, resolve(null) ];
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.visitFriend(retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "user/deleteVisitListId";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData({
                      visitId: friendsUid
                    }));
                    req.execute().then(function(result) {
                      result = _this._formateResultData(result);
                      result && 0 == result.code ? resolve(result.data) : resolve(null);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.visitFriend = function(friendsUid, retryCount) {
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                var _this = this;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!friendsUid) return [ 2, resolve(null) ];
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.visitFriend(retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "user/visit";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData({
                      uid: friendsUid
                    }));
                    req.execute().then(function(result) {
                      result = _this._formateResultData(result);
                      result && 0 == result.code ? resolve(result.data) : resolve(null);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.interactive = function(friendsUid, eventId, retryCount) {
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                var _this = this;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.getFriendList(retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "user/interactive";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData({
                      uid: friendsUid,
                      event: eventId
                    }));
                    req.execute().then(function(result) {
                      result = _this._formateResultData(result);
                      result && 0 == result.code ? resolve(result.msg) : resolve(null);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.getInteractiveList = function(retryCount) {
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                var _this = this;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.getFriendList(retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "user/interactiveList";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.GET, head);
                    req.execute().then(function(result) {
                      result = _this._formateResultData(result);
                      result && 0 == result.code ? resolve(result.data) : resolve(null);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.getOnlineList = function(retryCount) {
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                var _this = this;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!M_1.default.runtime.UserId) return [ 2, resolve(null) ];
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.getFriendList(retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "user/visitList";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData({
                      uid: M_1.default.runtime.UserId
                    }));
                    req.execute().then(function(result) {
                      result = _this._formateResultData(result);
                      result && 0 == result.code ? resolve(result.data) : resolve(null);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.getFriendList = function(retryCount) {
        void 0 === retryCount && (retryCount = 0);
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                var _this = this;
                return __generator(this, function(_a) {
                  switch (_a.label) {
                   case 0:
                    if (!M_1.default.runtime.UserId) return [ 2, resolve(null) ];
                    if (!this._isExpiresed) return [ 3, 3 ];
                    if (!(retryCount < this.reTryAuthMaxCount)) return [ 3, 2 ];
                    return [ 4, this._auth() ];

                   case 1:
                    _a.sent();
                    resolve(this.getFriendList(retryCount + 1));
                    _a.label = 2;

                   case 2:
                    return [ 3, 4 ];

                   case 3:
                    url = Paths_1.default.MainHost + "user/inviteList";
                    head = Object.assign({
                      Authorization: this.access_token
                    }, this.publicHeaders);
                    req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData({
                      uid: M_1.default.runtime.UserId
                    }));
                    req.execute().then(function(result) {
                      result = _this._formateResultData(result);
                      result && 0 == result.code ? resolve(result.data) : resolve(null);
                    });
                    _a.label = 4;

                   case 4:
                    return [ 2 ];
                  }
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.addFriend = function(uid) {
        return __awaiter(this, void 0, void 0, function() {
          var _this = this;
          return __generator(this, function(_a) {
            console.error("addFriend1", M_1.default.runtime.UserId);
            if (M_1.default.runtime.UserId == uid) return [ 2, null ];
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, data, head, req;
                return __generator(this, function(_a) {
                  url = Paths_1.default.MainHost + "user/invite";
                  data = {
                    ref_uid: uid
                  };
                  head = Object.assign({
                    Authorization: this.access_token
                  }, this.publicHeaders);
                  req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData(data), true);
                  req.execute().then(function(result) {
                    console.error("addFriend2:", result);
                    result && 0 == result.code ? resolve(result.data) : resolve(null);
                  });
                  return [ 2 ];
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.clickShareEnterGame = function(uid) {
        return __awaiter(this, void 0, void 0, function() {
          var _this = this;
          return __generator(this, function(_a) {
            if (M_1.default.runtime.UserId == uid) return [ 2, null ];
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, data, head, req;
                return __generator(this, function(_a) {
                  url = Paths_1.default.MainHost + "user/postShareUserId";
                  data = {
                    uid: uid
                  };
                  head = Object.assign({
                    Authorization: this.access_token
                  }, this.publicHeaders);
                  req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData(data), true);
                  req.execute().then(function(result) {
                    console.error(result);
                    result && 0 == result.code, resolve(null);
                  });
                  return [ 2 ];
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.AskQueryWxFriendClickShare = function(uid) {
        return __awaiter(this, void 0, void 0, function() {
          var _this = this;
          return __generator(this, function(_a) {
            cc.log("\u6bcf\u79d2\u67e5\u8be2\u597d\u53cb\u70b9\u51fb");
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, data, head, req;
                return __generator(this, function(_a) {
                  url = Paths_1.default.MainHost + "user/getShareUserMark";
                  data = {
                    uid: uid
                  };
                  head = Object.assign({
                    Authorization: this.access_token
                  }, this.publicHeaders);
                  req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, this._formateData(data), true);
                  req.execute().then(function(result) {
                    console.error(result);
                    result && 0 == result.code ? resolve(result.data) : resolve(null);
                  });
                  return [ 2 ];
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype.login = function(reAuth) {
        void 0 === reAuth && (reAuth = false);
        return __awaiter(this, void 0, Promise, function() {
          var data;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              return [ 4, this._auth() ];

             case 1:
              data = _a.sent();
              data && console.log("\u767b\u5f55\u6210\u529f!");
              return [ 2, data ];
            }
          });
        });
      };
      NetMgr.prototype.cleanPlayer = function() {
        return __awaiter(this, void 0, void 0, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              return __awaiter(_this, void 0, void 0, function() {
                var url, head, req;
                return __generator(this, function(_a) {
                  url = "https://xyx-hy.iky.com/Backend/GM/delUser?app=gmc&sign=0lj8ls.mh92&uid=" + RuntimeMgr_1.default.ins.getUserId();
                  head = Object.assign({
                    Authorization: this.access_token
                  }, this.publicHeaders);
                  req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.POST, head, "");
                  req.execute().then(function(result) {
                    console.warn(result);
                    resolve(true);
                  });
                  return [ 2 ];
                });
              });
            }) ];
          });
        });
      };
      NetMgr.prototype._formateData = function(data) {
        var result = data;
        result = Apps_1.default.isEncode ? this.xorCrypt(JSON.stringify(data)) : this.formatSearchParams(data);
        return result;
      };
      NetMgr.prototype._formateResultData = function(data) {
        var result = data;
        Apps_1.default.isEncode && (result = this.xorCrypt(data));
        try {
          result = JSON.parse(result);
        } catch (error) {
          try {
            result = JSON.parse(result);
          } catch (error) {
            console.error(error);
            result = null;
          }
        }
        return result;
      };
      NetMgr.prototype.formatSearchParams = function(data) {
        var str = null;
        for (var key in data) {
          var v = data[key];
          str = null == str ? "" : str + "&";
          str += key + "=" + ("null" == v ? "" : v);
        }
        return str;
      };
      NetMgr.prototype.xorCrypt = function(str) {
        var output = "";
        var key = 6;
        for (var i = 0; i < str.length; ++i) output += String.fromCharCode(key ^ str.charCodeAt(i));
        return output;
      };
      Object.defineProperty(NetMgr.prototype, "_isExpiresed", {
        get: function() {
          return false;
        },
        enumerable: true,
        configurable: true
      });
      NetMgr.prototype.syncAuthInfo = function(info) {
        if (info) StorageMgr_1.StorageMgr.Storage.setObject("AuthInfo", {
          expires_in: info.expires_in,
          access_token: "Bearer " + info.access_token
        }, false); else {
          var nativeCache = StorageMgr_1.StorageMgr.Storage.getObject("AuthInfo", null);
          if (nativeCache) {
            this.expires_in = nativeCache.expires_in;
            this.access_token = nativeCache.access_token;
          }
        }
      };
      NetMgr.instance = null;
      return NetMgr;
    }();
    exports.default = NetMgr;
    cc._RF.pop();
  }, {
    "../../Logic/Data/Const/Constant": "Constant",
    "../../Logic/Data/RuntimeMgr": "RuntimeMgr",
    "../Apps": "Apps",
    "../Network/HttpRequest": "HttpRequest",
    "../Utils/Paths": "Paths",
    "./M": "M",
    "./PlatformMgr": "PlatformMgr",
    "./StorageMgr": "StorageMgr"
  } ],
  NodePoolMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "72621mL9I9Bcr83XbKkt9t/", "NodePoolMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SingletonFactory_1 = require("../Utils/SingletonFactory");
    var NodePoolMgr = function() {
      function NodePoolMgr() {
        this.mPoolData = null;
        this.mPoolData = new Map();
      }
      NodePoolMgr.prototype.create = function(name, prefab, count) {
        void 0 === count && (count = 5);
        name = name.toString();
        var pool = this.getPool(name);
        pool || (pool = new cc.NodePool());
        if (prefab) {
          var remainCount = count - pool.size() < 0 ? 0 : count - pool.size();
          for (var i = remainCount; i--; ) pool.put(this.createItem(prefab));
        }
        this.mPoolData.set(name, pool);
      };
      NodePoolMgr.prototype.freeItem = function(name, item) {
        if (item) {
          name = String(name);
          var pool = this.getPool(name);
          if (pool) pool.put(item); else {
            this.create(name, item, 1);
            this.freeItem(name, item);
          }
        }
      };
      NodePoolMgr.prototype.getItem = function(name, prefab) {
        void 0 === prefab && (prefab = null);
        name = String(name);
        var pool = this.getPool(name);
        var node = null;
        node = pool && pool.size() > 0 ? pool.get() : this.createItem(prefab);
        if (null == node.children) {
          console.warn("\u5bf9\u8c61\u7834\u635f : ", name);
          return this.getItem(name, prefab);
        }
        return node;
      };
      NodePoolMgr.prototype.getPool = function(name) {
        return this.mPoolData.get(String(name));
      };
      NodePoolMgr.prototype.clearPool = function(name) {
        name = String(name);
        var pool = this.getPool(name);
        pool && pool.clear();
        this.mPoolData.delete(name);
      };
      NodePoolMgr.prototype.destory = function() {
        for (var name in this.mPoolData) this.clearPool(name);
      };
      NodePoolMgr.prototype.createItem = function(prefab) {
        var node = null;
        node = prefab ? cc.instantiate(prefab) : new cc.Node();
        return node;
      };
      NodePoolMgr.ins = SingletonFactory_1.SingletonFactory.getInstance(NodePoolMgr);
      return NodePoolMgr;
    }();
    exports.default = NodePoolMgr;
    cc._RF.pop();
  }, {
    "../Utils/SingletonFactory": "SingletonFactory"
  } ],
  NotifyPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e2b48eWZk5O45zG6Gnjiv/8", "NotifyPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../../Base/UI/UIBase");
    var M_1 = require("../../../../Base/Manager/M");
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var NotifyRewardItemCtrl_1 = require("./NotifyRewardItemCtrl");
    var BoxTipsCtrl_1 = require("../BoxTipsCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var NotifyPanel = function(_super) {
      __extends(NotifyPanel, _super);
      function NotifyPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.titleLab = null;
        _this.textLab = null;
        _this.rewardPrefab = null;
        _this.tipsPrefab = null;
        _this.content = null;
        _this.closeButton = null;
        _this.propFrams = [];
        _this._tips = null;
        _this._isMaintainOn = false;
        return _this;
      }
      NotifyPanel.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
      };
      NotifyPanel.prototype.onDestroy = function() {
        this._tips = null;
      };
      NotifyPanel.prototype.onInit = function(isMaintainOn) {
        void 0 === isMaintainOn && (isMaintainOn = false);
        this._isMaintainOn = isMaintainOn;
        this._initView();
        this._initTips();
      };
      NotifyPanel.prototype._initView = function() {
        var _this = this;
        this.content.removeAllChildren();
        M_1.default.runtime.getServerConfig().then(function(config) {
          if (_this._isMaintainOn) {
            _this.titleLab.string = "\u516c\u544a";
            _this.content.active = false;
            _this.textLab.node.active = true;
            _this.textLab.string = config.maintain_content;
            _this.closeButton.active = false;
          } else {
            _this.closeButton.active = true;
            if (config && config.announcement) {
              _this.titleLab.string = "\u6d3b\u52a8\u89c4\u5219";
              _this.textLab.node.active = !!config.announcement.text;
              _this.content.active = !!config.announcement.grid;
              config.announcement.text && (_this.textLab.string = config.announcement.text);
              config.announcement.grid && config.announcement.grid.forEach(function(itemData, index) {
                var item = M_1.default.nodePool.createItem(_this.rewardPrefab);
                item.parent = _this.content;
                item.getComponent(NotifyRewardItemCtrl_1.default).init(itemData, index == config.announcement.grid.length - 1, _this._onShowTips.bind(_this));
              });
            }
          }
        });
      };
      NotifyPanel.prototype.onCloseClick = function() {
        this._isMaintainOn || UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.NoticePanel);
      };
      NotifyPanel.prototype._initTips = function() {
        if (!this._tips) {
          var node = M_1.default.nodePool.createItem(this.tipsPrefab);
          node.parent = this.node;
          this._tips = node.getComponent(BoxTipsCtrl_1.default);
          this._tips.updateData("\u5f00\u542f\u5b9d\u7bb1\u83b7\u5f97\u4ee5\u4e0b\u5956\u52b1:", cc.size(330, 366));
          this._tips.hide();
        }
      };
      NotifyPanel.prototype.onHideTips = function() {
        this._tips && this._tips.isReady && this._tips.hide();
      };
      NotifyPanel.prototype._onShowTips = function(data, wolrdPos) {
        this._tips && this._tips.show(data, this.node.convertToNodeSpaceAR(wolrdPos).add(cc.v2(0, 35)));
      };
      __decorate([ property(cc.Label) ], NotifyPanel.prototype, "titleLab", void 0);
      __decorate([ property(cc.Label) ], NotifyPanel.prototype, "textLab", void 0);
      __decorate([ property(cc.Prefab) ], NotifyPanel.prototype, "rewardPrefab", void 0);
      __decorate([ property(cc.Prefab) ], NotifyPanel.prototype, "tipsPrefab", void 0);
      __decorate([ property(cc.Node) ], NotifyPanel.prototype, "content", void 0);
      __decorate([ property(cc.Node) ], NotifyPanel.prototype, "closeButton", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], NotifyPanel.prototype, "propFrams", void 0);
      NotifyPanel = __decorate([ ccclass ], NotifyPanel);
      return NotifyPanel;
    }(UIBase_1.default);
    exports.default = NotifyPanel;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../../Base/UI/UIBase": "UIBase",
    "../../../Data/Interface/UIData": "UIData",
    "../BoxTipsCtrl": "BoxTipsCtrl",
    "./NotifyRewardItemCtrl": "NotifyRewardItemCtrl"
  } ],
  NotifyRewardItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "603f3HyPvtBSYbePw8Nn3Ij", "NotifyRewardItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common");
    var Constant_1 = require("../../../Data/Const/Constant");
    var BaseConst_1 = require("../../../../Base/BaseConst");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var NotifyRewardItemCtrl = function(_super) {
      __extends(NotifyRewardItemCtrl, _super);
      function NotifyRewardItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.text = null;
        _this.content = null;
        _this.line = null;
        _this.boxFrame = null;
        _this.CurrencyFrames = [];
        _this._showTipsCB = null;
        _this._reward = null;
        _this._box = null;
        return _this;
      }
      NotifyRewardItemCtrl.prototype.init = function(data, isLast, showTips) {
        void 0 === isLast && (isLast = false);
        this.line.active = false;
        this._showTipsCB = showTips;
        if (data) {
          var index = 0;
          this._reward = data.reward;
          this.text.string = data.text;
          isLast || (this.line.active = true);
          for (var key in data.reward) {
            0 != index && this._createLable("+");
            if ("box" == key) {
              var sprite = this._createSprite(this.boxFrame);
              this._box = sprite.node;
              sprite.node.setContentSize(.65 * sprite.node.width, .65 * sprite.node.height);
              sprite.node.on(cc.Node.EventType.TOUCH_END, this._showTips, this);
            } else if (Number(key) < Constant_1.PropType.BeikeBomb) {
              var sprite = this._createSprite(this.CurrencyFrames[key]);
              sprite.node.setContentSize(.5 * sprite.node.width, .5 * sprite.node.height);
              sprite.node.y -= 4;
              var count = data.reward[key];
              Number(key) == BaseConst_1.CurrencyId.Coin && (count = Common_1.default.bytesToSize(count));
              this._createLable(count);
            }
            index++;
          }
        }
      };
      NotifyRewardItemCtrl.prototype._showTips = function() {
        this._showTipsCB && this._showTipsCB(Common_1.default.getRewardArray(this._reward), Common_1.default.getWorldPos(this._box));
      };
      NotifyRewardItemCtrl.prototype._createSprite = function(frame) {
        var sprite = Common_1.default.createSprite(null, frame);
        sprite.trim = false;
        sprite.node.parent = this.content;
        return sprite;
      };
      NotifyRewardItemCtrl.prototype._createLable = function(count) {
        var node = cc.instantiate(this.text.node);
        var label = node.getComponent(cc.Label);
        label.overflow = cc.Label.Overflow.NONE;
        label.string = "" + count;
        node.anchorX = 0;
        node.parent = this.content;
        return label;
      };
      __decorate([ property(cc.Label) ], NotifyRewardItemCtrl.prototype, "text", void 0);
      __decorate([ property(cc.Node) ], NotifyRewardItemCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Node) ], NotifyRewardItemCtrl.prototype, "line", void 0);
      __decorate([ property(cc.SpriteFrame) ], NotifyRewardItemCtrl.prototype, "boxFrame", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], NotifyRewardItemCtrl.prototype, "CurrencyFrames", void 0);
      NotifyRewardItemCtrl = __decorate([ ccclass ], NotifyRewardItemCtrl);
      return NotifyRewardItemCtrl;
    }(cc.Component);
    exports.default = NotifyRewardItemCtrl;
    cc._RF.pop();
  }, {
    "../../../../Base/BaseConst": "BaseConst",
    "../../../Data/Const/Constant": "Constant",
    "../../Common": "Common"
  } ],
  NumberUtils: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "218f2uuShVPnqfXZUB+P3dN", "NumberUtils");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var NumberUtil = function() {
      function NumberUtil() {}
      NumberUtil.numAdd = function(num1, num2) {
        var baseNum, baseNum1, baseNum2;
        try {
          baseNum1 = num1.toString().split(".")[1].length;
        } catch (e) {
          baseNum1 = 0;
        }
        try {
          baseNum2 = num2.toString().split(".")[1].length;
        } catch (e) {
          baseNum2 = 0;
        }
        baseNum = Math.pow(10, Math.max(baseNum1, baseNum2));
        return Number((num1 * baseNum + num2 * baseNum) / baseNum);
      };
      NumberUtil.numSub = function(num1, num2) {
        var baseNum, baseNum1, baseNum2;
        var precision;
        try {
          baseNum1 = num1.toString().split(".")[1].length;
        } catch (e) {
          baseNum1 = 0;
        }
        try {
          baseNum2 = num2.toString().split(".")[1].length;
        } catch (e) {
          baseNum2 = 0;
        }
        baseNum = Math.pow(10, Math.max(baseNum1, baseNum2));
        precision = baseNum1 >= baseNum2 ? baseNum1 : baseNum2;
        return Number(((num1 * baseNum - num2 * baseNum) / baseNum).toFixed(precision));
      };
      NumberUtil.numMulti = function(num1, num2) {
        var baseNum = 0;
        try {
          baseNum += num1.toString().split(".")[1].length;
        } catch (e) {}
        try {
          baseNum += num2.toString().split(".")[1].length;
        } catch (e) {}
        return Number(num1.toString().replace(".", "")) * Number(num2.toString().replace(".", "")) / Math.pow(10, baseNum);
      };
      NumberUtil.numDiv = function(num1, num2) {
        var baseNum1 = 0, baseNum2 = 0;
        var baseNum3, baseNum4;
        try {
          baseNum1 = num1.toString().split(".")[1].length;
        } catch (e) {
          baseNum1 = 0;
        }
        try {
          baseNum2 = num2.toString().split(".")[1].length;
        } catch (e) {
          baseNum2 = 0;
        }
        baseNum3 = Number(num1.toString().replace(".", ""));
        baseNum4 = Number(num2.toString().replace(".", ""));
        return baseNum3 / baseNum4 * Math.pow(10, baseNum2 - baseNum1);
      };
      return NumberUtil;
    }();
    exports.NumberUtil = NumberUtil;
    cc._RF.pop();
  }, {} ],
  OnLineGuestCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "db156it5SxBq7PkGZgcJsTl", "OnLineGuestCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var OnLineGuestCtrl = function(_super) {
      __extends(OnLineGuestCtrl, _super);
      function OnLineGuestCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.guestIconItem = null;
        return _this;
      }
      OnLineGuestCtrl.prototype.init = function(data) {
        if (data) {
          this.node.removeAllChildren();
          for (var i = 0; i < 9; i++) {
            var itemData = data[i];
            if (itemData) {
              var item = cc.instantiate(this.guestIconItem);
              item.parent = this.node;
              this._syncIconFrame(cc.find("mask/icon", item).getComponent(cc.Sprite), itemData.avatar_url);
            }
          }
        }
      };
      OnLineGuestCtrl.prototype._syncIconFrame = function(sprite, url) {
        sprite && url && Common_1.default.getRemotPic(url).then(function(frame) {
          frame && (sprite.spriteFrame = frame);
        });
      };
      __decorate([ property(cc.Prefab) ], OnLineGuestCtrl.prototype, "guestIconItem", void 0);
      OnLineGuestCtrl = __decorate([ ccclass ], OnLineGuestCtrl);
      return OnLineGuestCtrl;
    }(cc.Component);
    exports.default = OnLineGuestCtrl;
    cc._RF.pop();
  }, {
    "../../Common/Common": "Common"
  } ],
  OverHightLightCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "fce55gWXklC94HtJAPn/viu", "OverHightLightCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GameModel_1 = require("../../Match3/Model/GameModel");
    var M_1 = require("../../../Base/Manager/M");
    var Event_1 = require("../../Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var OverHightLightCtrl = function(_super) {
      __extends(OverHightLightCtrl, _super);
      function OverHightLightCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.countDownNode = null;
        _this.stepNode = null;
        _this.stepLabel = null;
        _this.countDownLabel = null;
        _this._animation = null;
        return _this;
      }
      OverHightLightCtrl.prototype.onLoad = function() {
        this._animation = this.getComponent(cc.Animation);
      };
      OverHightLightCtrl.prototype.onDestroy = function() {
        this.unscheduleAllCallbacks();
      };
      OverHightLightCtrl.prototype.showStepNode = function() {
        this.stepNode.scale = 1;
        this.countDownNode.active = false;
      };
      OverHightLightCtrl.prototype.showCountDown = function() {
        var _this = this;
        var currentCount = this.stepLabel.string;
        this.schedule(function() {
          _this.stepLabel.string = (Number(_this.stepLabel.string) - 1).toString();
          if ("0" == _this.stepLabel.string) {
            _this.countDownNode.active = true;
            _this._animation.play("gameOverCountdown");
            _this._startCountDown();
          }
        }, .03, Number(currentCount));
      };
      OverHightLightCtrl.prototype._startCountDown = function() {
        var _this = this;
        var count = GameModel_1.default.ins.stepLimit + 5;
        this.countDownLabel.string = count.toString();
        M_1.default.event.send(Event_1.Event.GameCMD.GameOverFall);
        this.schedule(function() {
          _this.countDownLabel.string = (Number(_this.countDownLabel.string) - 1).toString();
          if ("0" == _this.countDownLabel.string) {
            console.error("\u5012\u8ba1\u65f6\u7ed3\u675f,\u8fdb\u53bb\u7ed3\u7b97\u754c\u9762!");
            M_1.default.event.send(Event_1.Event.GameCMD.ShowGameResult, true);
          }
        }, 1, count - 1);
      };
      __decorate([ property(cc.Node) ], OverHightLightCtrl.prototype, "countDownNode", void 0);
      __decorate([ property(cc.Node) ], OverHightLightCtrl.prototype, "stepNode", void 0);
      __decorate([ property(cc.Label) ], OverHightLightCtrl.prototype, "stepLabel", void 0);
      __decorate([ property(cc.Label) ], OverHightLightCtrl.prototype, "countDownLabel", void 0);
      OverHightLightCtrl = __decorate([ ccclass ], OverHightLightCtrl);
      return OverHightLightCtrl;
    }(cc.Component);
    exports.default = OverHightLightCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../Data/Const/Event": "Event",
    "../../Match3/Model/GameModel": "GameModel"
  } ],
  Paths: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f74b0OgDfxKlJRRaowt0zUw", "Paths");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Apps_1 = require("../Apps");
    var Paths = function() {
      function Paths() {}
      Paths.getItemPath = function(itemId) {
        return "texture/ui/item/item_" + itemId + ".png";
      };
      Paths.ReportHost = "https://dlog.uu.cc";
      Paths.MainHost = Apps_1.default.isDebug ? "http://10.1.0.5:9501/api/v1/" : "https://xyhy.ifusky.com/api/v1/";
      Paths.MainCDNHost = "https://mini-er.dl.gxpan.cn/soe/";
      Paths.ShareImgPath = Paths.MainCDNHost + "share/";
      Paths.CDNTablePath = Paths.MainCDNHost + "table/";
      Paths.NativeTablePath = "csv/";
      Paths.SoundPath = "sound/";
      Paths.LevelCfgPath = "config/level/new/";
      Paths.RoomPrefabPath = "prefab/hotel/room/";
      Paths.RoomPicPath = "texture/hotel/";
      Paths.LevelMapPath = "prefab/LevelMap/";
      Paths.LevelRemotPath = Paths.MainCDNHost + "level/";
      Paths.TurorialCfgPath = "config/level/turorial/";
      Paths.TurorialRemotPath = Paths.MainCDNHost + "turorial/";
      Paths.Match3Bg = "texture/match3/bg/";
      Paths.SoMap = "texture/map/";
      Paths.Match3BgEff = "prefab/eff/";
      Paths.DailyTaskConfig = "https://mini-center.dl.gan.cn/configcenter/soe-wx/tasklist.json";
      return Paths;
    }();
    exports.default = Paths;
    cc._RF.pop();
  }, {
    "../Apps": "Apps"
  } ],
  PlaneCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "17282rM5v1LiqqghFSUThov", "PlaneCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../../Common/Common");
    var TimeConfig_1 = require("../../../Data/Const/TimeConfig");
    var Constant_1 = require("../../../Data/Const/Constant");
    var M_1 = require("../../../../Base/Manager/M");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var PlaneCtrl = function(_super) {
      __extends(PlaneCtrl, _super);
      function PlaneCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.icon = null;
        _this.particle = null;
        _this._arg = null;
        return _this;
      }
      PlaneCtrl.prototype.onLoad = function() {};
      PlaneCtrl.prototype.shootPlane = function(from, to, delay, isCounterClockWise) {
        var _this = this;
        void 0 === delay && (delay = 0);
        void 0 === isCounterClockWise && (isCounterClockWise = false);
        this.particle.active = false;
        return new Promise(function(resolve, reject) {
          from = Common_1.default.getPos(from.x, from.y);
          to = Common_1.default.getPos(to.x, to.y);
          var arg = new FlyPlaneArgs();
          _this.node.setPosition(from);
          _this.node.angle = 0;
          arg.node = _this.node;
          var startPoint = _this.node.position;
          var endPoint = to;
          var s = TimeConfig_1.GapTime.BeikeSuctionSpeed();
          arg.move_speed = isCounterClockWise ? -s : s;
          var centerPoint = cc.v2(.5 * (startPoint.x + endPoint.x), .5 * (startPoint.y + endPoint.y));
          var r = Math.sqrt(Math.pow(startPoint.x - centerPoint.x, 2) + Math.pow(startPoint.y - centerPoint.y, 2));
          arg.r = r;
          arg.xc = centerPoint.x;
          arg.yc = centerPoint.y;
          arg.angle = _this.getPlaneAngle(startPoint, cc.v2(centerPoint.x, centerPoint.y + r), r);
          arg.move_angle = 180;
          arg.delay = delay;
          arg.resolve = resolve;
          _this._arg = arg;
        });
      };
      PlaneCtrl.prototype.getPlaneAngle = function(pa, pc, r) {
        var angle = 0;
        var x = 0;
        var y = 0;
        if (pa.x < pc.x) {
          x = pa.x - pc.x;
          y = pc.y - pa.y;
          angle = 360 - 2 * Math.asin(Math.sqrt(x * x + y * y) / r * .5) * 180 / Math.PI;
        } else {
          x = pc.x - pa.x;
          y = pc.y - pa.y;
          angle = 2 * Math.asin(Math.sqrt(x * x + y * y) / r * .5) * 180 / Math.PI;
        }
        return angle;
      };
      PlaneCtrl.prototype.updateFlyPlane = function(dt) {
        if (!this._arg) return;
        if (this._arg.delay > 0) this._arg.delay -= dt; else if (this._arg.move_angle <= 0) this.planeArrive(this._arg); else {
          this.particle.active = true;
          var xc = this._arg.xc;
          var yc = this._arg.yc;
          var r = this._arg.r;
          var moveDis = dt * this._arg.move_speed;
          this._arg.angle += moveDis;
          this._arg.move_angle -= Math.abs(moveDis);
          var curX = xc + r * Math.sin(this._arg.angle / 180 * Math.PI);
          var curY = yc + r * Math.cos(this._arg.angle / 180 * Math.PI);
          if (false == this._arg.node.active) {
            this._arg.node.active = true;
            this._arg.node.opacity = 255;
          }
          this._arg.node.position = cc.v3(curX, curY);
          this._arg.node.angle = -(this._arg.angle - (this._arg.move_speed > 0 ? 120 : -60));
        }
      };
      PlaneCtrl.prototype.planeArrive = function(arg) {
        console.log("planeArrive!");
        this.particle.getComponent(cc.ParticleSystem).resetSystem();
        M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.Plane, this.node);
        if (arg.resolve) {
          arg.resolve();
          arg.resolve = null;
        }
      };
      PlaneCtrl.prototype.onDestroy = function() {};
      PlaneCtrl.prototype.update = function(dt) {
        this.updateFlyPlane(dt);
      };
      __decorate([ property(cc.Sprite) ], PlaneCtrl.prototype, "icon", void 0);
      __decorate([ property(cc.Node) ], PlaneCtrl.prototype, "particle", void 0);
      PlaneCtrl = __decorate([ ccclass ], PlaneCtrl);
      return PlaneCtrl;
    }(cc.Component);
    exports.default = PlaneCtrl;
    var FlyPlaneArgs = function() {
      function FlyPlaneArgs() {
        this.node = null;
        this.delay = 0;
        this.xc = 0;
        this.yc = 0;
        this.r = 0;
        this.angle = 0;
        this.move_speed = 0;
        this.move_angle = 0;
        this.resolve = null;
      }
      return FlyPlaneArgs;
    }();
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../Common/Common": "Common",
    "../../../Data/Const/Constant": "Constant",
    "../../../Data/Const/TimeConfig": "TimeConfig"
  } ],
  PlatformAdApi: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "8f9ffgWrMlOTZ6c2uFOcsT4", "PlatformAdApi");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    cc._RF.pop();
  }, {} ],
  PlatformMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e20102YpnJP56fteVvIKIeT", "PlatformMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Webapp_1 = require("./Plaform/Webapp");
    var Wechat_1 = require("./Plaform/Wechat");
    var Util_1 = require("../Utils/Util");
    var BaseConst_1 = require("../BaseConst");
    var PlatformMgr = function() {
      function PlatformMgr() {}
      Object.defineProperty(PlatformMgr, "ins", {
        get: function() {
          if (PlatformMgr._instance) return PlatformMgr._instance;
          switch (this.getCurrentPlatformType()) {
           case BaseConst_1.PlatformType.Web:
            PlatformMgr._instance = new Webapp_1.default();
            break;

           case BaseConst_1.PlatformType.WxGame:
            PlatformMgr._instance = new Wechat_1.default();
          }
          return PlatformMgr._instance;
        },
        enumerable: true,
        configurable: true
      });
      PlatformMgr.getCurrentPlatformType = function() {
        var type = BaseConst_1.PlatformType.Web;
        Util_1.Util.Tool.isWechatGame() && (type = BaseConst_1.PlatformType.WxGame);
        return type;
      };
      return PlatformMgr;
    }();
    exports.default = PlatformMgr;
    cc._RF.pop();
  }, {
    "../BaseConst": "BaseConst",
    "../Utils/Util": "Util",
    "./Plaform/Webapp": "Webapp",
    "./Plaform/Wechat": "Wechat"
  } ],
  PlayerInfo: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "2be4bQOm5xAN7D7eSJAob5o", "PlayerInfo");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Constant_1 = require("../Const/Constant");
    var StorageMgr_1 = require("../../../Base/Manager/StorageMgr");
    var PlayerInfo = function() {
      function PlayerInfo() {
        this.userId = -1;
        this.nickName = "tt";
        this.avatarUrl = "";
        this.gender = 0;
        this.country = "cn";
        this.city = "sz";
        this.serverTime = 0;
        this.offlineTime = 0;
        this.scene = "";
        this.switchSet = {};
        this.power = 0;
        this.coin = 0;
        this.diamond = 0;
        this.level = 1;
        this.mathc3Level = 1;
        this.chapter = 1;
        this.propData = {};
        this.timeCounter = 0;
        this.lvMap = new Map();
      }
      PlayerInfo.prototype.initRemotData = function(data) {
        this.lvMap.clear();
        if (data) {
          "string" == typeof data && (data = JSON.parse(data));
          data[Constant_1.NativeKey.PlayerInfo] || this.setNormalPower();
          for (var key in data) key == Constant_1.NativeKey.PlayerInfo ? this.syncPlayerData(data[key]) : -1 != key.indexOf(Constant_1.NativeKey.LvDataKey.toString() + "_") && this.lvMap.set(key, JSON.parse(data[key]));
        } else this.setNormalPower();
      };
      PlayerInfo.prototype.syncPlayerData = function(data) {
        "string" == typeof data && (data = JSON.parse(data));
        for (var playerKey in data) void 0 != this[playerKey] && (this[playerKey] = data[playerKey]);
      };
      PlayerInfo.prototype.setNormalPower = function() {
        var data = StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.PlayerInfo, null);
        data && StorageMgr_1.StorageMgr.Storage.removeAll();
        this.power = 30;
        this.saveData("power");
      };
      PlayerInfo.prototype.saveLastTime = function() {
        StorageMgr_1.StorageMgr.Storage.setInt(Constant_1.NativeKey.LastTime, this.serverTime);
      };
      PlayerInfo.prototype.getLastTime = function() {
        return StorageMgr_1.StorageMgr.Storage.getInt(Constant_1.NativeKey.LastTime, 0);
      };
      PlayerInfo.prototype.saveData = function(key) {
        var _this = this;
        return new Promise(function(resolve) {
          var data = StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.PlayerInfo, {});
          data[key] = _this[key];
          StorageMgr_1.StorageMgr.Storage.setObject(Constant_1.NativeKey.PlayerInfo, data, true);
          resolve(true);
        });
      };
      PlayerInfo.prototype._saveAll = function() {};
      return PlayerInfo;
    }();
    exports.default = PlayerInfo;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/StorageMgr": "StorageMgr",
    "../Const/Constant": "Constant"
  } ],
  PropCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "ec6de7rJXhK7pLWTMebmnWo", "PropCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../../Base/Manager/M");
    var PropItemCtrl_1 = require("./PropItemCtrl");
    var Constant_1 = require("../../../Data/Const/Constant");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var PropCtrl = function(_super) {
      __extends(PropCtrl, _super);
      function PropCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.propItemPrefab = null;
        _this.propIcons = [];
        return _this;
      }
      PropCtrl.prototype.onLoad = function() {};
      PropCtrl.prototype.init = function() {
        for (var type = Constant_1.PropType.BeikeBomb; type <= Constant_1.PropType.Board; type++) {
          var data = M_1.default.runtime.getPropData(type) || {
            count: 0
          };
          this._createItem(type, data.count);
        }
      };
      PropCtrl.prototype._createItem = function(type, count) {
        var item = M_1.default.nodePool.createItem(this.propItemPrefab);
        var itemCtrl = item.getComponent(PropItemCtrl_1.default);
        itemCtrl && itemCtrl.init(type, this.propIcons[type - 100], count);
        item.name = "item_" + type;
        item.parent = this.node;
      };
      __decorate([ property(cc.Prefab) ], PropCtrl.prototype, "propItemPrefab", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], PropCtrl.prototype, "propIcons", void 0);
      PropCtrl = __decorate([ ccclass ], PropCtrl);
      return PropCtrl;
    }(cc.Component);
    exports.default = PropCtrl;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../Data/Const/Constant": "Constant",
    "./PropItemCtrl": "PropItemCtrl"
  } ],
  PropDropView: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "c280cedyGVDG7v+8Xo5Ts+t", "PropDropView");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../Base/UI/UIBase");
    var M_1 = require("../Base/Manager/M");
    var PropItemCtrl_1 = require("../Logic/Match3/View/UI/PropItemCtrl");
    var UIMgr_1 = require("../Base/Manager/UIMgr");
    var UIData_1 = require("../Logic/Data/Interface/UIData");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var PropDropView = function(_super) {
      __extends(PropDropView, _super);
      function PropDropView() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.itemPrefab = null;
        _this._curItem = null;
        _this._curData = null;
        return _this;
      }
      PropDropView.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
      };
      PropDropView.prototype.onInit = function(itemData) {
        var item = M_1.default.nodePool.createItem(this.itemPrefab);
        var itemCtrl = item.getComponent(PropItemCtrl_1.default);
        itemCtrl && itemCtrl.initOnlyType(itemData.itemId, itemData.num);
        item.parent = this.node;
        item.setScale(.2);
        this._curItem = item;
        this._curData = itemData;
        this.flyToPropsBar();
      };
      PropDropView.prototype.flyToPropsBar = function() {
        var _this = this;
        var node = this._curItem;
        var destinationPos = this.getDestination(this._curData.itemId);
        var timeline = new gsap.TimelineMax();
        timeline.to(node, .6, {
          scale: 1.1,
          x: 0,
          y: 100
        }).to(node, .6, {
          x: destinationPos.x,
          y: destinationPos.y,
          scale: .5,
          ease: gsap.Back.easeIn
        }).add(function() {
          M_1.default.runtime.updatePropCount(_this._curData.itemId, _this._curData.num);
          timeline.remove(timeline);
          UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.PropDropView);
        });
      };
      PropDropView.prototype.getDestination = function(itemId) {
        var propBar = cc.find("Canvas/ui/bottom/propsBar");
        if (propBar) {
          var itemNode = propBar.getChildByName("item_" + itemId);
          if (itemNode) {
            var itemNodeWorldPos = propBar.convertToWorldSpaceAR(itemNode.position);
            return itemNodeWorldPos.sub(cc.v3(cc.winSize.width / 2, cc.winSize.height / 2));
          }
        }
        return cc.v2(0, -600);
      };
      __decorate([ property(cc.Prefab) ], PropDropView.prototype, "itemPrefab", void 0);
      PropDropView = __decorate([ ccclass ], PropDropView);
      return PropDropView;
    }(UIBase_1.default);
    exports.default = PropDropView;
    cc._RF.pop();
  }, {
    "../Base/Manager/M": "M",
    "../Base/Manager/UIMgr": "UIMgr",
    "../Base/UI/UIBase": "UIBase",
    "../Logic/Data/Interface/UIData": "UIData",
    "../Logic/Match3/View/UI/PropItemCtrl": "PropItemCtrl"
  } ],
  PropInfo: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "42417Qg2H1PMrAR6fj9uTj/", "PropInfo");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BaseConst_1 = require("../BaseConst");
    var PropInfo = function() {
      function PropInfo(data) {
        this.id = null;
        this.currencyType = BaseConst_1.CurrencyId.Coin;
        this.price = null;
        this.name = null;
        this.detail = null;
        this.res = null;
        this.value = null;
        this.isBagUse = false;
        this.unlockLv = 0;
        this.id = data.id;
        this.name = data.name;
        this.detail = data.detail || "";
        this.res = data.res;
        this.value = data.v;
        this.isBagUse = data.baguse;
        this.unlockLv = data.unlock || 0;
        this._parsePrice(data.price);
      }
      PropInfo.prototype._parsePrice = function(price) {
        if (price) {
          var cfg = price.split("|");
          this.currencyType = Number(cfg[0]);
          this.price = Number(cfg[1]);
        }
      };
      return PropInfo;
    }();
    exports.default = PropInfo;
    cc._RF.pop();
  }, {
    "../BaseConst": "BaseConst"
  } ],
  PropItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "351b4fMa2ZMYajQIUvDZ90J", "PropItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../../Base/Manager/M");
    var Event_1 = require("../../../Data/Const/Event");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var Util_1 = require("../../../../Base/Utils/Util");
    var Paths_1 = require("../../../../Base/Utils/Paths");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var PropItemCtrl = function(_super) {
      __extends(PropItemCtrl, _super);
      function PropItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.countLab = null;
        _this.icon = null;
        _this.addBtn = null;
        _this._type = null;
        return _this;
      }
      PropItemCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.PropCount, this.onPropCountChanged, this);
      };
      PropItemCtrl.prototype.init = function(type, icon, count) {
        this._type = type;
        this.icon.spriteFrame = icon;
        this._showCount(count);
        M_1.default.event.register(Event_1.Event.UI.PropCount, this.onPropCountChanged, this);
      };
      PropItemCtrl.prototype.initOnlyType = function(type, count) {
        var _this = this;
        this._type = type;
        this._showCount(count);
        M_1.default.event.register(Event_1.Event.UI.PropCount, this.onPropCountChanged, this);
        Util_1.Util.Loader.loadSpriteFrame(Paths_1.default.getItemPath(type), function(err, texture) {
          texture && _this.icon && (_this.icon.spriteFrame = texture);
        });
      };
      PropItemCtrl.prototype.onClick = function() {
        var propInfo = M_1.default.runtime.getPropData(this._type);
        propInfo && propInfo.count > 0 ? M_1.default.event.send(Event_1.Event.GameCMD.PropClick, this._type) : M_1.default.ui.showUI(UIData_1.UIHudDef.BuyProp, this._type);
      };
      PropItemCtrl.prototype._showCount = function(count) {
        if (count <= 0) {
          this.addBtn.active = true;
          this.countLab.node.parent.active = false;
        } else {
          this.addBtn.active = false;
          this.countLab.string = count.toString();
          this.countLab.node.parent.active = true;
        }
      };
      PropItemCtrl.prototype.onPropCountChanged = function(type) {
        if (this._type == type) {
          var cd = M_1.default.runtime.getPropData(type);
          if (cd) {
            this.countLab.string = cd.count;
            this._showCount(cd.count);
          }
        }
      };
      __decorate([ property(cc.Label) ], PropItemCtrl.prototype, "countLab", void 0);
      __decorate([ property(cc.Sprite) ], PropItemCtrl.prototype, "icon", void 0);
      __decorate([ property(cc.Node) ], PropItemCtrl.prototype, "addBtn", void 0);
      PropItemCtrl = __decorate([ ccclass ], PropItemCtrl);
      return PropItemCtrl;
    }(cc.Component);
    exports.default = PropItemCtrl;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Utils/Paths": "Paths",
    "../../../../Base/Utils/Util": "Util",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData"
  } ],
  PropModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "8815488dtlJgaSAiNjulOpR", "PropModel");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var Event_1 = require("../../Data/Const/Event");
    var Constant_1 = require("../../Data/Const/Constant");
    var Common_1 = require("../../Common/Common");
    var RuntimeMgr_1 = require("../../Data/RuntimeMgr");
    var M_1 = require("../../../Base/Manager/M");
    var CellBase_1 = require("./CellBase");
    var Util_1 = require("../../../Base/Utils/Util");
    var BaseConst_1 = require("../../../Base/BaseConst");
    var AudioCtrl_1 = require("../../Common/AudioCtrl");
    var EffLayerCtrl_1 = require("../View/EffLayerCtrl");
    var PropModel = function() {
      function PropModel(gameModel) {
        this.execType = null;
        this.gameModel = null;
        this._maxDepth = 10;
        this._curDepth = 0;
        this.gameModel = gameModel;
        EventMgr_1.default.ins.register(Event_1.Event.GameCMD.PropClick, this.onTriggerProp, this);
      }
      PropModel.prototype.destory = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.GameCMD.PropClick, this.onTriggerProp, this);
      };
      PropModel.prototype.execute = function(pos, isChuizi) {
        if (this.execType) {
          pos = Common_1.default.convetPos(pos);
          M_1.default.runtime.addUsePropCount(this.execType);
          switch (this.execType) {
           case Constant_1.PropType.BeikeBomb:
            this._execBeikeBomb(pos);
            break;

           case Constant_1.PropType.Board:
            this._execBoard(pos);
            break;

           case Constant_1.PropType.Hammer:
            this._execHammer(pos, isChuizi);
          }
        }
      };
      PropModel.prototype.onTriggerProp = function(type) {
        this.execType = type;
        M_1.default.runtime.addUsePropCount(type);
        switch (type) {
         case Constant_1.PropType.ResetGrid:
          this._execResetGrid();
          break;

         case Constant_1.PropType.Add3Step:
          this._execAddThreeStep();
          break;

         case Constant_1.PropType.StartBomb:
          this._execStartBomb();
          break;

         case Constant_1.PropType.StartStar:
          this._execStartStar();
          break;

         case Constant_1.PropType.PowerBottle1:
         case Constant_1.PropType.PowerBottle2:
          this._execAddPower(type);
        }
      };
      PropModel.prototype._execAddPower = function(type) {
        var info = M_1.default.table.PropInfo.getByPrimaryKey(type);
        if (M_1.default.runtime.getCurrency(BaseConst_1.CurrencyId.Power) >= Constant_1.MaxPowerCount) M_1.default.tips.show(Constant_1.WaringTips.PowerMax); else {
          M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Power, info.value);
          this.propUserOver();
        }
      };
      PropModel.prototype._execStartBomb = function() {
        var _this = this;
        var types = [ Constant_1.CellType.Bomb1, Constant_1.CellType.Bomb2 ];
        types.forEach(function(type) {
          var cell = _this.findOneRandomCell();
          cell && cell.extCtrl && cell.extCtrl.change2Bomb(type);
        });
        this.propUserOver();
      };
      PropModel.prototype._execStartStar = function() {
        var cell = this.findOneRandomCell();
        cell && cell.extCtrl && cell.extCtrl.change2Bomb(Constant_1.CellType.Bomb5);
        this.propUserOver();
      };
      PropModel.prototype._execAddThreeStep = function() {
        this.gameModel.stepLimit += M_1.default.table.PropInfo.getByPrimaryKey(Constant_1.PropType.Add3Step).value;
        M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel);
        M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.AddThree);
        this.propUserOver();
        M_1.default.tips.show(Constant_1.WaringTips.PropAdd3StepTips);
      };
      PropModel.prototype._execHammer = function(pos, isChuizi) {
        return __awaiter(this, void 0, void 0, function() {
          var data, cell, count;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              if (!(true == isChuizi)) return [ 3, 2 ];
              cc.log("\u6267\u884c\u9524\u5b50" + Common_1.default.getPos(pos.x, pos.y).x + "   y: " + Common_1.default.getPos(pos.x, pos.y).y);
              return [ 4, EffLayerCtrl_1.default.ins.playChuizi(Common_1.default.convertCurWorldPos(Common_1.default.getPos(pos.x, pos.y))) ];

             case 1:
              _a.sent();
              return [ 3, 3 ];

             case 2:
              cc.log("\u6267\u884c\u9524\u5b50 false");
              _a.label = 3;

             case 3:
              data = M_1.default.runtime.getPropData(this.execType);
              if (data && data.count > 0) {
                cell = Common_1.default.safeGet2ArrayValue(this.gameModel.CellList, pos);
                if (this.gameModel.isHold(pos) || cell && cell.isInvincible) M_1.default.tips.show(Constant_1.WaringTips.CantUseForThat); else {
                  count = this.gameModel.execElimateOneAtAll(pos, Constant_1.ElimateType.Hammer);
                  M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.Hammer);
                  console.error(count);
                  this.propUserOver();
                }
              }
              return [ 2 ];
            }
          });
        });
      };
      PropModel.prototype._execBoard = function(pos) {
        var data = M_1.default.runtime.getPropData(this.execType);
        if (data && data.count > 0) {
          var cell = Common_1.default.safeGet2ArrayValue(this.gameModel.CellList, pos);
          if (cell && cell.extCtrl) if (this.checkCanUse(cell)) {
            cell.extCtrl.change2Bomb(Constant_1.CellType.Bomb2);
            cell.onMsg(CellBase_1.MsgType.ComplexBomb, {
              type1: Constant_1.CellType.Bomb2,
              type2: Constant_1.CellType.Bomb3,
              isBoard: true
            });
            this.propUserOver();
          } else M_1.default.tips.show(Constant_1.WaringTips.CantUseForThat); else this.propUserOver(false);
        }
      };
      PropModel.prototype._execResetGrid = function() {
        var data = M_1.default.runtime.getPropData(this.execType);
        if (data && data.count > 0) {
          M_1.default.tips.show(Constant_1.WaringTips.PropResetGrid);
          this.gameModel.resetGrid(true);
          M_1.default.event.send(Event_1.Event.Sound.PlaySoundEff, AudioCtrl_1.AudioID.Reset);
          this.propUserOver();
        }
      };
      PropModel.prototype._execBeikeBomb = function(pos) {
        var data = M_1.default.runtime.getPropData(this.execType);
        if (data && data.count > 0) {
          var cell = Common_1.default.safeGet2ArrayValue(this.gameModel.CellList, pos);
          if (cell && cell.extCtrl) if (this.checkCanUse(cell)) {
            cell.isExecBomb = true;
            cell.extCtrl.change2Bomb(Constant_1.CellType.Bomb1);
            this.propUserOver();
          } else M_1.default.tips.show(Constant_1.WaringTips.CantUseForThat); else this.propUserOver(false);
        }
      };
      PropModel.prototype.findOneRandomCell = function() {
        this._curDepth++;
        var list = this.gameModel.CellList;
        var y = Util_1.Util.Tool.rangeInt(0, list.length, false);
        var x = Util_1.Util.Tool.rangeInt(0, list[y].length, false);
        var cell = Common_1.default.safeGet2ArrayValue(list, cc.v2(x, y));
        if (!this.checkCanUse(cell)) return this._curDepth > this._maxDepth ? null : this.findOneRandomCell();
        this._curDepth = 0;
        return cell;
      };
      PropModel.prototype.checkCanUse = function(cell) {
        if (!cell) return false;
        var type = cell.getType();
        return !(type == Constant_1.CellType.Ground || type == Constant_1.CellType.Banana || type == Constant_1.CellType.IceCream || this.gameModel.isHavaSpe(cell.pos) || this.gameModel.isHold(cell.pos));
      };
      PropModel.prototype.propUserOver = function(isUpdateCount) {
        void 0 === isUpdateCount && (isUpdateCount = true);
        EventMgr_1.default.ins.send(Event_1.Event.GameCMD.PropUsed);
        isUpdateCount && RuntimeMgr_1.default.ins.updatePropCount(this.execType, -1);
        this.execType = null;
      };
      return PropModel;
    }();
    exports.PropModel = PropModel;
    cc._RF.pop();
  }, {
    "../../../Base/BaseConst": "BaseConst",
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/Manager/M": "M",
    "../../../Base/Utils/Util": "Util",
    "../../Common/AudioCtrl": "AudioCtrl",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/RuntimeMgr": "RuntimeMgr",
    "../View/EffLayerCtrl": "EffLayerCtrl",
    "./CellBase": "CellBase"
  } ],
  RankItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "5d8e7XMDmpOyKqop1Z0Xp1O", "RankItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Logic/Common/Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RankItemCtrl = function(_super) {
      __extends(RankItemCtrl, _super);
      function RankItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.nickName = null;
        _this.score = null;
        _this.rank = null;
        _this.icon = null;
        _this.rankIcon = null;
        _this.rankIconFrame = [];
        _this.level = null;
        return _this;
      }
      RankItemCtrl.prototype.init = function(data) {
        if (data) {
          this.nickName.string = data.nickname;
          Common_1.default.parseRankData(data.value);
          var rd = Common_1.default.parseRankData(data.value);
          this.rank.string = data.rank.toString();
          this.score.string = rd.score.toString();
          this.level.string = rd.level + "\u5173";
          this._fillIcon(data.avatar_url);
          if (data.rank <= 3) {
            this.rank.node.active = false;
            this.rankIcon.node.active = true;
            this.rankIcon.spriteFrame = this.rankIconFrame[data.rank - 1];
          } else {
            this.rank.node.active = true;
            this.rankIcon.node.active = false;
          }
        }
      };
      RankItemCtrl.prototype._fillIcon = function(url) {
        var _this = this;
        url && Common_1.default.getRemotPic(url, this.icon.node.getContentSize()).then(function(frame) {
          frame ? _this.icon.spriteFrame = frame : console.error("get avatar error!");
        });
      };
      RankItemCtrl.prototype.update = function() {};
      __decorate([ property(cc.Label) ], RankItemCtrl.prototype, "nickName", void 0);
      __decorate([ property(cc.Label) ], RankItemCtrl.prototype, "score", void 0);
      __decorate([ property(cc.Label) ], RankItemCtrl.prototype, "rank", void 0);
      __decorate([ property(cc.Sprite) ], RankItemCtrl.prototype, "icon", void 0);
      __decorate([ property(cc.Sprite) ], RankItemCtrl.prototype, "rankIcon", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], RankItemCtrl.prototype, "rankIconFrame", void 0);
      __decorate([ property(cc.Label) ], RankItemCtrl.prototype, "level", void 0);
      RankItemCtrl = __decorate([ ccclass ], RankItemCtrl);
      return RankItemCtrl;
    }(cc.Component);
    exports.default = RankItemCtrl;
    cc._RF.pop();
  }, {
    "../../Logic/Common/Common": "Common"
  } ],
  RankPanelCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e6116Ek6phKq4ba3e2Q6X82", "RankPanelCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../Base/UI/UIBase");
    var M_1 = require("../../Base/Manager/M");
    var RankItemCtrl_1 = require("./RankItemCtrl");
    var Common_1 = require("../../Logic/Common/Common");
    var UIData_1 = require("../../Logic/Data/Interface/UIData");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RankPanelCtrl = function(_super) {
      __extends(RankPanelCtrl, _super);
      function RankPanelCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.content = null;
        _this.itemPrefab = null;
        _this.selfLv = null;
        _this.selfScore = null;
        _this.selfRank = null;
        _this.selfIcon = null;
        _this.operatingHead = null;
        _this.rankScrollView = null;
        _this._rankData = null;
        _this._itemPool = null;
        _this._animation = null;
        _this._rankSize = 6;
        _this._endNode = null;
        _this._startNode = null;
        return _this;
      }
      RankPanelCtrl.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
        this._animation = this.node.getComponent(cc.Animation);
      };
      RankPanelCtrl.prototype.onInit = function() {
        this._initData();
        this._itemPool || (this._itemPool = []);
        this._animation || (this._animation = this.node.getComponent(cc.Animation));
      };
      RankPanelCtrl.prototype._initData = function() {
        return __awaiter(this, void 0, void 0, function() {
          var _a;
          return __generator(this, function(_b) {
            switch (_b.label) {
             case 0:
              _a = this;
              return [ 4, M_1.default.net.getRankData() ];

             case 1:
              _a._rankData = _b.sent();
              if (this._rankData) {
                this._cleanView();
                this._initView();
              }
              this.show();
              return [ 2 ];
            }
          });
        });
      };
      RankPanelCtrl.prototype.show = function() {
        this.node.active = true;
        this._animation.play("ShowSelectLevel");
      };
      RankPanelCtrl.prototype._initView = function() {
        this._initSelfDisplay(this._rankData.my);
        this._initOperatingHead();
        this._initRankContent();
      };
      RankPanelCtrl.prototype._initRankContent = function() {
        for (var i = 0; i < this._rankSize; i++) {
          var itemData = this._rankData.list[i];
          var itemNode = M_1.default.nodePool.createItem(this.itemPrefab);
          itemNode.y = -(i * itemNode.height + (10 + itemNode.height / 2) + 5 * i);
          itemNode.parent = this.content;
          itemNode["index"] = i;
          itemNode.getComponent(RankItemCtrl_1.default).init(itemData);
        }
        var size = this._rankData.list.length;
        this._endNode = this.content.children[this._rankSize - 1];
        this._startNode = this.content.children[0];
        this.content.height = size * this.itemPrefab.data.height + 5 * size + 10;
      };
      RankPanelCtrl.prototype._cleanView = function() {
        this.content.removeAllChildren();
      };
      RankPanelCtrl.prototype._initSelfDisplay = function(myData) {
        var _this = this;
        if (myData) {
          var rd = Common_1.default.parseRankData(myData.value);
          this.selfScore.string = rd.score.toString();
          this.selfLv.string = rd.level + "\u5173";
          this.selfRank.string = myData.rank <= 0 ? "\u672a\u4e0a\u699c" : myData.rank.toString();
        }
        M_1.default.platform.getUserInfo().then(function(userdata) {
          userdata && userdata.avatarUrl && Common_1.default.getRemotPic(userdata.avatarUrl).then(function(frame) {
            frame && (_this.selfIcon.spriteFrame = frame);
          });
        });
      };
      RankPanelCtrl.prototype._initOperatingHead = function() {
        var _this = this;
        M_1.default.runtime.getServerConfig().then(function(config) {
          config && config.rank_banner && Common_1.default.getRemotPic(config.rank_banner, null, "png").then(function(frame) {
            frame && (_this.operatingHead.spriteFrame = frame);
          });
        });
      };
      RankPanelCtrl.prototype.onCloseBtnClick = function() {
        var _this = this;
        this._animation.play("HideSelectLevel");
        this.scheduleOnce(function() {
          _this.node.active = false;
        }, .3);
      };
      RankPanelCtrl.prototype.onOperatingHeadClick = function() {
        M_1.default.ui.showUI(UIData_1.UIHudDef.NoticePanel);
      };
      RankPanelCtrl.prototype.onScrollCallBack = function(a, b, c) {
        for (var i = this.content.children.length; i--; ) {
          var node = this.content.children[i];
          if (node.active) {
            var pos = this.content.parent.convertToNodeSpaceAR(Common_1.default.getWorldPos(node));
            if (pos.y >= node.height / 2 + 10) {
              var nextIndex = this._endNode["index"] + 1;
              var data = this._rankData.list[nextIndex];
              if (data) {
                node.active = false;
                this._startNode = this._getNodeByIndex(node["index"] + 1);
                node["index"] = nextIndex;
                node.getComponent(RankItemCtrl_1.default).init(data);
                node.y = this._endNode.y - (node.height + 5);
                this._endNode = node;
                node.active = true;
              }
            }
          }
        }
        if (this._startNode) {
          var startPos = this.content.parent.convertToNodeSpaceAR(Common_1.default.getWorldPos(this._startNode));
          if (startPos.y + this._startNode.height / 2 + 10 < 0) {
            var data = this._rankData.list[this._startNode["index"] - 1];
            if (data) {
              var tempNode = this._endNode;
              this._endNode = this._getNodeByIndex(this._endNode["index"] - 1);
              tempNode.y = this._startNode.y + (this._startNode.height + 5);
              tempNode.getComponent(RankItemCtrl_1.default).init(data);
              tempNode["index"] = this._startNode["index"] - 1;
              this._startNode = tempNode;
            }
          }
        }
      };
      RankPanelCtrl.prototype._getNodeByIndex = function(index) {
        var result = null;
        for (var i = this.content.children.length; i--; ) {
          var node = this.content.children[i];
          if (node["index"] == index) {
            result = node;
            break;
          }
        }
        return result;
      };
      RankPanelCtrl.prototype.start = function() {};
      RankPanelCtrl.prototype.update = function(dt) {};
      __decorate([ property(cc.Node) ], RankPanelCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Prefab) ], RankPanelCtrl.prototype, "itemPrefab", void 0);
      __decorate([ property(cc.Label) ], RankPanelCtrl.prototype, "selfLv", void 0);
      __decorate([ property(cc.Label) ], RankPanelCtrl.prototype, "selfScore", void 0);
      __decorate([ property(cc.Label) ], RankPanelCtrl.prototype, "selfRank", void 0);
      __decorate([ property(cc.Sprite) ], RankPanelCtrl.prototype, "selfIcon", void 0);
      __decorate([ property(cc.Sprite) ], RankPanelCtrl.prototype, "operatingHead", void 0);
      __decorate([ property(cc.ScrollView) ], RankPanelCtrl.prototype, "rankScrollView", void 0);
      RankPanelCtrl = __decorate([ ccclass ], RankPanelCtrl);
      return RankPanelCtrl;
    }(UIBase_1.default);
    exports.default = RankPanelCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "../../Base/UI/UIBase": "UIBase",
    "../../Logic/Common/Common": "Common",
    "../../Logic/Data/Interface/UIData": "UIData",
    "./RankItemCtrl": "RankItemCtrl"
  } ],
  ReportMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "3c3bbM36pBKobxS/m0dDP75", "ReportMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Paths_1 = require("../Utils/Paths");
    var Util_1 = require("../Utils/Util");
    var M_1 = require("./M");
    var HttpRequest_1 = require("../Network/HttpRequest");
    var Apps_1 = require("../Apps");
    var BaseConst_1 = require("../BaseConst");
    var ReportMgr = function() {
      function ReportMgr() {
        this.AppKey = "58c0179c656d13089697";
        this.GameId = 550088;
        this.Secret = "a838d248cceb0fd45c61";
        this.channelIds = [ "", "WE0S0N10001", "SQ0S0N30101", "TX0S0N00003", "OP0S0N02002", "BG0S0N00002", "YQ0S0N00003", "ZC0S0N00000" ];
        this.publicHeader = {
          "Content-Type": "application/x-www-form-urlencoded"
        };
      }
      Object.defineProperty(ReportMgr, "ins", {
        get: function() {
          null == this.instance && (this.instance = new ReportMgr());
          return this.instance;
        },
        enumerable: true,
        configurable: true
      });
      ReportMgr.prototype.login = function() {
        var userid = M_1.default.runtime.getUserId();
        var userinfo = M_1.default.platform.getUserInfo();
        var data = "sgame_login|" + Util_1.Util.Timer.dateFtt("yyyy-MM-dd hh:mm:ss", new Date()) + "|" + this.AppKey + "|" + M_1.default.device.isAndroid + "|" + userid + "|" + Apps_1.default.Version + "|" + this.channelIds[M_1.default.platform.type - 100] + "|" + JSON.stringify(userinfo);
        if (M_1.default.platform.type == BaseConst_1.PlatformType.Web) console.warn(data); else {
          var req = new HttpRequest_1.HttpRequest(Paths_1.default.ReportHost, HttpRequest_1.HttpRequest.METHOD.POST, this.publicHeader, data);
          req.execute().then(function(result) {
            console.log("report login :", data, "\n", "result:", result);
          });
        }
      };
      ReportMgr.prototype.reportPoint = function(eventId, reportData) {
        var userid = M_1.default.runtime.getUserId();
        var data = "sgame_event|" + Util_1.Util.Timer.dateFtt("yyyy-MM-dd hh:mm:ss", new Date()) + "|" + this.AppKey + "|" + M_1.default.device.isAndroid + "|" + userid + "|" + Apps_1.default.Version + "|" + this.channelIds[M_1.default.platform.type - 100] + "|" + eventId + "|" + reportData;
        if (M_1.default.platform.type == BaseConst_1.PlatformType.Web) console.warn(data); else {
          var req = new HttpRequest_1.HttpRequest(Paths_1.default.ReportHost, HttpRequest_1.HttpRequest.METHOD.POST, this.publicHeader, data);
          req.execute().then(function(result) {
            console.log("report point :", data, "\n", "result:", result);
          });
        }
      };
      ReportMgr.prototype.reportMatchOver = function(lv, result, stepCount, tiemCount) {
        var str = stepCount + "," + tiemCount;
        this.reportPoint("stage", lv + "|" + (result ? 1 : 0) + "|" + str);
      };
      ReportMgr.prototype.reportBuyProp = function(type, count, lv) {
        this.reportPoint("prop", type + "|" + count + "|" + lv);
      };
      ReportMgr.prototype.reportTutorial = function(eventParam) {
        this.reportPoint("tutorial", eventParam);
      };
      ReportMgr.prototype.reportDecorate = function(eventParam) {
        this.reportPoint("decorate", eventParam);
      };
      ReportMgr.instance = null;
      return ReportMgr;
    }();
    exports.default = ReportMgr;
    cc._RF.pop();
  }, {
    "../Apps": "Apps",
    "../BaseConst": "BaseConst",
    "../Network/HttpRequest": "HttpRequest",
    "../Utils/Paths": "Paths",
    "../Utils/Util": "Util",
    "./M": "M"
  } ],
  ResCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "b7437pZvS9EEJ35BYoXCOAy", "ResCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Constant_1 = require("../Data/Const/Constant");
    var RuntimeMgr_1 = require("../Data/RuntimeMgr");
    var Common_1 = require("../Common/Common");
    var GameModel_1 = require("./Model/GameModel");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ResCtrl = function(_super) {
      __extends(ResCtrl, _super);
      function ResCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.BombFlashingBg = [];
        _this.BombStaticFrame = [];
        _this.NormalCellFrame = [];
        _this.pearlFrame = null;
        _this.Map2NormalCellFrame = [];
        _this.CellPrefab = [];
        _this.lockFrames = [];
        _this.boxFrames = [];
        _this.iceFrames = [];
        _this.stoneFrames = [];
        _this.LeaveFrames = [];
        _this.GroundFrames = [];
        _this.GemFrames = [];
        _this.FlowerFrames = [];
        _this.FireflyFrames = [];
        _this.CollectIcon = [];
        _this.groundPrefabs = [];
        _this.groundCenter = null;
        _this.tuituji = null;
        _this.rocketPrefab = null;
        _this.mushroomFrames = [];
        return _this;
      }
      ResCtrl_1 = ResCtrl;
      ResCtrl.prototype.onLoad = function() {
        ResCtrl_1.ins = this;
      };
      ResCtrl.prototype.onDestroy = function() {
        ResCtrl_1.ins = null;
      };
      ResCtrl.prototype.getCellPrefab = function(index) {
        return this.CellPrefab[index];
      };
      ResCtrl.prototype.getBombBg = function(index) {
        return this.BombFlashingBg[index];
      };
      ResCtrl.prototype.getCellFrame = function(type, index) {
        var frames = this.NormalCellFrame;
        Common_1.default.isBombType(type) && (frames = this.BombStaticFrame);
        var frame = frames[index];
        type == Constant_1.CellType.Flower && GameModel_1.default.ins.HaveFlowers && (frame = this.pearlFrame);
        if (type < Constant_1.CellType.Bomb1 && 2 == RuntimeMgr_1.default.ins.CurBgIndex) {
          var bg2frame = this.Map2NormalCellFrame[index];
          bg2frame && (frame = bg2frame);
        }
        return frame;
      };
      ResCtrl.prototype.getLockFrame = function(index) {
        return this.lockFrames[index];
      };
      ResCtrl.prototype.getBoxFrame = function(index, type) {
        void 0 === type && (type = null);
        var area = 0;
        null != type && (area = 3 * (type + 1));
        return this.boxFrames[area + index];
      };
      ResCtrl.prototype.getIceFrame = function(index) {
        return this.iceFrames[index];
      };
      ResCtrl.prototype.getStoneFrame = function(index) {
        return this.stoneFrames[index];
      };
      ResCtrl.prototype.getLeavesFrame = function(index) {
        return this.LeaveFrames[index];
      };
      ResCtrl.prototype.getGroundFrame = function(index) {
        return this.GroundFrames[index];
      };
      ResCtrl.prototype.getFlowerFrame = function(index) {
        return this.FlowerFrames[index];
      };
      ResCtrl.prototype.getFirefly = function(index) {
        return this.FireflyFrames[index];
      };
      ResCtrl.prototype.getGemFrame = function(index) {
        return this.GemFrames[index];
      };
      ResCtrl.prototype.getCollectFrame = function(index) {
        return this.CollectIcon[index];
      };
      ResCtrl.prototype.getGroundBorderPrefab = function(index) {
        return this.groundPrefabs[index];
      };
      ResCtrl.prototype.getRoketPrefab = function() {
        return this.rocketPrefab;
      };
      ResCtrl.prototype.getMushroomFrame = function(index) {
        return this.mushroomFrames[index];
      };
      var ResCtrl_1;
      ResCtrl.ins = null;
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "BombFlashingBg", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "BombStaticFrame", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "NormalCellFrame", void 0);
      __decorate([ property(cc.SpriteFrame) ], ResCtrl.prototype, "pearlFrame", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "Map2NormalCellFrame", void 0);
      __decorate([ property([ cc.Prefab ]) ], ResCtrl.prototype, "CellPrefab", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "lockFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "boxFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "iceFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "stoneFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "LeaveFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "GroundFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "GemFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "FlowerFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "FireflyFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "CollectIcon", void 0);
      __decorate([ property([ cc.Prefab ]) ], ResCtrl.prototype, "groundPrefabs", void 0);
      __decorate([ property(cc.SpriteFrame) ], ResCtrl.prototype, "groundCenter", void 0);
      __decorate([ property(cc.SpriteFrame) ], ResCtrl.prototype, "tuituji", void 0);
      __decorate([ property(cc.Prefab) ], ResCtrl.prototype, "rocketPrefab", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ResCtrl.prototype, "mushroomFrames", void 0);
      ResCtrl = ResCtrl_1 = __decorate([ ccclass ], ResCtrl);
      return ResCtrl;
    }(cc.Component);
    exports.default = ResCtrl;
    cc._RF.pop();
  }, {
    "../Common/Common": "Common",
    "../Data/Const/Constant": "Constant",
    "../Data/RuntimeMgr": "RuntimeMgr",
    "./Model/GameModel": "GameModel"
  } ],
  RoadUtil: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "22558BDLdpPF4YbZgzSHzJm", "RoadUtil");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, requireComponent = _a.requireComponent;
    var RoadUtils = function(_super) {
      __extends(RoadUtils, _super);
      function RoadUtils() {
        return null !== _super && _super.apply(this, arguments) || this;
      }
      RoadUtils_1 = RoadUtils;
      RoadUtils.prototype.onEnable = function() {
        var anim = this.node.getComponent(cc.Animation);
        var clips = anim.getClips();
        var clip = clips[0];
        var paths = clip.curveData.paths;
        for (var k in paths) {
          var data = paths[k].props.position;
          this.drawRoad(RoadUtils_1.getRoadData(data));
        }
      };
      RoadUtils.prototype.drawRoad = function(roadDatas) {
        var graphics = this.node.getComponent(cc.Graphics) || this.node.addComponent(cc.Graphics);
        graphics.lineWidth = 10;
        for (var j = 0; j < roadDatas.length; j++) {
          var path = roadDatas[j];
          var len = path.length;
          for (var i = 0; i < len; i++) 0 == i ? graphics.moveTo(path[i].x, path[i].y) : graphics.lineTo(path[i].x, path[i].y);
        }
        graphics.stroke();
        graphics.fill();
      };
      RoadUtils.getRoadData = function(road_data) {
        var ctrl1 = null;
        var start_point = null;
        var end_point = null;
        var ctrl2 = null;
        var road_curve_path = [];
        for (var i = 0; i < road_data.length; i++) {
          var key_frame = road_data[i];
          if (!key_frame.motionPath) break;
          null !== ctrl1 && road_curve_path.push([ start_point, ctrl1, ctrl1, cc.v2(key_frame.value[0], key_frame.value[1]) ]);
          start_point = cc.v2(key_frame.value[0], key_frame.value[1]);
          for (var j = 0; j < key_frame.motionPath.length; j++) {
            end_point = cc.v2(key_frame.motionPath[j][0], key_frame.motionPath[j][1]);
            ctrl2 = cc.v2(key_frame.motionPath[j][2], key_frame.motionPath[j][3]);
            null === ctrl1 && (ctrl1 = ctrl2);
            road_curve_path.push([ start_point, ctrl1, ctrl2, end_point ]);
            ctrl1 = cc.v2(key_frame.motionPath[j][4], key_frame.motionPath[j][5]);
            start_point = end_point;
          }
        }
        var one_road = [];
        for (var index = 0; index < road_curve_path.length; index++) {
          start_point = road_curve_path[index][0];
          ctrl1 = road_curve_path[index][1];
          ctrl2 = road_curve_path[index][2];
          end_point = road_curve_path[index][3];
          var len = this.bezierLength(start_point, ctrl1, ctrl2, end_point);
          var OFFSET = 16;
          var count = len / OFFSET;
          count = Math.floor(count);
          var t_delta = 1 / count;
          var t = t_delta;
          for (var i = 0; i < count; i++) {
            var x = start_point.x * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.x * t * (1 - t) * (1 - t) + 3 * ctrl2.x * t * t * (1 - t) + end_point.x * t * t * t;
            var y = start_point.y * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.y * t * (1 - t) * (1 - t) + 3 * ctrl2.y * t * t * (1 - t) + end_point.y * t * t * t;
            one_road.push(cc.v2(Math.ceil(x), Math.ceil(y)));
            t += t_delta;
          }
        }
        return one_road;
      };
      RoadUtils.bezierLength = function(start_point, ctrl1, ctrl2, end_point) {
        var prev_point = start_point;
        var length = 0;
        var t = .05;
        for (var i = 0; i < 20; i++) {
          var x = start_point.x * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.x * t * (1 - t) * (1 - t) + 3 * ctrl2.x * t * t * (1 - t) + end_point.x * t * t * t;
          var y = start_point.y * (1 - t) * (1 - t) * (1 - t) + 3 * ctrl1.y * t * (1 - t) * (1 - t) + 3 * ctrl2.y * t * t * (1 - t) + end_point.y * t * t * t;
          var now_point = cc.v2(x, y);
          var dir = now_point.sub(prev_point);
          prev_point = now_point;
          length += dir.mag();
          t += .05;
        }
        return length;
      };
      var RoadUtils_1;
      RoadUtils = RoadUtils_1 = __decorate([ ccclass, requireComponent(cc.Animation) ], RoadUtils);
      return RoadUtils;
    }(cc.Component);
    exports.default = RoadUtils;
    cc._RF.pop();
  }, {} ],
  RoomBuyCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "32ca8wnFDtA9bWHjRC04K3m", "RoomBuyCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../Base/Manager/EventMgr");
    var Event_1 = require("../Data/Const/Event");
    var HotelData_1 = require("./HotelData");
    var MoneyManager_1 = require("../Data/MoneyManager");
    var UIMgr_1 = require("../../Base/Manager/UIMgr");
    var UIData_1 = require("../Data/Interface/UIData");
    var Common_1 = require("../Common/Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RoomBuyCtrl = function(_super) {
      __extends(RoomBuyCtrl, _super);
      function RoomBuyCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.nameLabel = null;
        _this.priceLabel = null;
        _this.iconSp = null;
        _this.moneyIcon = null;
        _this.moneyIconFrames = [];
        _this._slotData = null;
        return _this;
      }
      RoomBuyCtrl.prototype.onLoad = function() {
        EventMgr_1.default.ins.register(Event_1.Event.Hotel.UIRoomUnlock, this.showUnlock, this);
        EventMgr_1.default.ins.register(Event_1.Event.Hotel.MapScrollBegin, this.hideUnlock, this);
        this.node.zIndex = 100;
      };
      RoomBuyCtrl.prototype.onDestroy = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Hotel.UIRoomUnlock, this.showUnlock, this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.Hotel.MapScrollBegin, this.hideUnlock, this);
        this._slotData = null;
      };
      RoomBuyCtrl.prototype.onClickBuy = function() {
        this.node.active = false;
        this._slotData.state = 1;
        this._slotData.subId = 1;
        var slotConfig = HotelData_1.HotelData.getSlotConfig(this._slotData.roomId, this._slotData.slotId);
        if (slotConfig) {
          var moneyCheck = MoneyManager_1.MoneyManager.CheckMoneyJson(slotConfig.prices[0], true);
          if (moneyCheck) {
            HotelData_1.HotelData.setSubSlotStateData(this._slotData);
            EventMgr_1.default.ins.send(Event_1.Event.Hotel.SlotUnlock, this._slotData);
            EventMgr_1.default.ins.send(Event_1.Event.Hotel.TouchSlotIcon, this._slotData.slotId);
          } else UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.MoreCoin);
        }
      };
      RoomBuyCtrl.prototype.showUnlock = function(data, position) {
        this._slotData = data;
        position || (position = Common_1.default.getWorldPos(HotelData_1.HotelData.getLockItem(this._slotData.roomId, this._slotData.slotId)));
        this.node.active = true;
        var slotPosition = this.node.parent.convertToNodeSpaceAR(position);
        this.node.setPosition(cc.v2(slotPosition.x, slotPosition.y + this.node.height / 2 + 80));
        var slotConfig = HotelData_1.HotelData.getSlotConfig(this._slotData.roomId, this._slotData.slotId);
        if (slotConfig) {
          var p = slotConfig.prices[0];
          this.nameLabel.string = slotConfig.slotName;
          if (p) {
            this.moneyIcon.spriteFrame = this.moneyIconFrames[p.itemId];
            this.priceLabel.string = "x" + Common_1.default.bytesToSize(p.num);
          }
        }
        this.show();
      };
      RoomBuyCtrl.prototype.hideUnlock = function() {
        this.node.active = false;
      };
      RoomBuyCtrl.prototype.show = function() {
        var animation = this.node.getComponent(cc.Animation);
        animation.play();
      };
      __decorate([ property(cc.Label) ], RoomBuyCtrl.prototype, "nameLabel", void 0);
      __decorate([ property(cc.Label) ], RoomBuyCtrl.prototype, "priceLabel", void 0);
      __decorate([ property(cc.Sprite) ], RoomBuyCtrl.prototype, "iconSp", void 0);
      __decorate([ property(cc.Sprite) ], RoomBuyCtrl.prototype, "moneyIcon", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], RoomBuyCtrl.prototype, "moneyIconFrames", void 0);
      RoomBuyCtrl = __decorate([ ccclass ], RoomBuyCtrl);
      return RoomBuyCtrl;
    }(cc.Component);
    exports.RoomBuyCtrl = RoomBuyCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/EventMgr": "EventMgr",
    "../../Base/Manager/UIMgr": "UIMgr",
    "../Common/Common": "Common",
    "../Data/Const/Event": "Event",
    "../Data/Interface/UIData": "UIData",
    "../Data/MoneyManager": "MoneyManager",
    "./HotelData": "HotelData"
  } ],
  RoomDetailCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "37f67a0azhH+a0tpXfXdi4Q", "RoomDetailCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../Common/Common");
    var Paths_1 = require("../../Base/Utils/Paths");
    var HotelRoomCtrl_1 = require("./HotelRoomCtrl");
    var M_1 = require("../../Base/Manager/M");
    var HotelData_1 = require("./HotelData");
    var Event_1 = require("../Data/Const/Event");
    var RoomSlotDetailItemCtrl_1 = require("./RoomSlotDetailItemCtrl");
    var BaseConst_1 = require("../../Base/BaseConst");
    var OnLineGuestCtrl_1 = require("./Access/OnLineGuestCtrl");
    var UIData_1 = require("../Data/Interface/UIData");
    var GuestPanelCtrl_1 = require("./Access/GuestPanelCtrl");
    var CloudView_1 = require("../SimulationOperation/View/Map/CloudView");
    var Constant_1 = require("../Data/Const/Constant");
    var MoneyManager_1 = require("../Data/MoneyManager");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RoomDetailCtrl = function(_super) {
      __extends(RoomDetailCtrl, _super);
      function RoomDetailCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.bottomSlotContent = null;
        _this.bottomNode = null;
        _this.guestInfoPanel = null;
        _this.selfInfoPanel = null;
        _this.roomContent = null;
        _this.partsPrefab = null;
        _this.slotDetailView = null;
        _this.slotDetailContent = null;
        _this.slotDetailItemPrefab = null;
        _this.diamondLabel = null;
        _this.coinLabel = null;
        _this.scoreLabel = null;
        _this.visitCountLabel = null;
        _this.guestListView = null;
        _this.onlineEye = null;
        _this.onlineCount = null;
        _this.moneyBox = null;
        _this.socreBox = null;
        _this.slotScrollView = null;
        _this.confirmBtnLab = null;
        _this._roomCtrl = null;
        _this._roomId = null;
        _this._myView = null;
        _this._guestView = null;
        _this._visitList = null;
        return _this;
      }
      RoomDetailCtrl.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.Hotel.ShowSubSlot, this._onShowSubSlot, this);
        M_1.default.event.register(Event_1.Event.Hotel.HideSubSlot, this._onHideSubSlot, this);
        M_1.default.event.register(Event_1.Event.Hotel.ShowGuestRoom, this.showGuestRoom, this);
        M_1.default.event.register(Event_1.Event.Hotel.TouchSlotIcon, this._onSlotIconClick, this);
      };
      RoomDetailCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.Hotel.ShowSubSlot, this._onShowSubSlot, this);
        M_1.default.event.unRegister(Event_1.Event.Hotel.HideSubSlot, this._onHideSubSlot, this);
        M_1.default.event.unRegister(Event_1.Event.Hotel.ShowGuestRoom, this.showGuestRoom, this);
        M_1.default.event.unRegister(Event_1.Event.Hotel.TouchSlotIcon, this._onSlotIconClick, this);
      };
      RoomDetailCtrl.prototype._onSlotIconClick = function(slotid) {
        this._onShowSubSlot(HotelData_1.HotelData.getSlotConfig(this._roomId, slotid));
      };
      RoomDetailCtrl.prototype.showGuestRoom = function(data) {
        var _this = this;
        if (data && data._hotelDatas) {
          this._showGuestPanel(true);
          this._myView.active = false;
          this.onlineEye.active = false;
          var roomData_1 = data._hotelDatas[1];
          this.guestInfoPanel.getComponent(GuestPanelCtrl_1.default).init(data);
          roomData_1 && Common_1.default.getRes(Paths_1.default.RoomPrefabPath + "RoomItem_" + roomData_1.roomId, cc.Prefab).then(function(roomPrefab) {
            if (roomPrefab) {
              var roomItem = _this._guestView = cc.instantiate(roomPrefab);
              roomItem.parent = _this.roomContent;
              roomItem.scale = Constant_1.ROOM_DETAIL_SCALE;
              roomItem.setPosition(cc.v2(0, 0));
              _this.roomContent.setContentSize(roomItem.width * Constant_1.ROOM_DETAIL_SCALE, roomItem.height * Constant_1.ROOM_DETAIL_SCALE);
              _this.roomContent.y = 0;
              _this.roomContent.parent.y = 0;
              _this._roomCtrl = roomItem.getComponent(HotelRoomCtrl_1.HotelRoomCtrl);
              _this._roomCtrl.init(roomData_1.roomId, roomData_1);
            }
          });
        }
      };
      RoomDetailCtrl.prototype.show = function(roomId) {
        var _this = this;
        this.onlineEye.active = false;
        this.slotDetailView.active = false;
        this.bottomNode.active = true;
        this._showGuestPanel(false);
        this._showMoneyBox(false);
        this.diamondLabel.string = M_1.default.runtime.getCurrencyStr(BaseConst_1.CurrencyId.Diamond);
        this.coinLabel.string = M_1.default.runtime.getFormateCoin();
        this.guestListView.active = false;
        this.guestListView.parent.getChildByName("jt").active = false;
        if (this._roomCtrl || this._roomId == roomId) this._roomCtrl.init(roomId, null, this); else {
          this.roomContent.destroyAllChildren();
          Common_1.default.getRes(Paths_1.default.RoomPrefabPath + "RoomItem_" + roomId, cc.Prefab).then(function(roomPrefab) {
            if (roomPrefab) {
              var roomItem = _this._myView = cc.instantiate(roomPrefab);
              roomItem.parent = _this.roomContent;
              roomItem.scale = Constant_1.ROOM_DETAIL_SCALE;
              roomItem.setPosition(cc.v2(0, 0));
              _this.roomContent.parent.setContentSize(roomItem.width * Constant_1.ROOM_DETAIL_SCALE, roomItem.height * Constant_1.ROOM_DETAIL_SCALE);
              _this.roomContent.parent.y = 0;
              _this._roomCtrl = roomItem.getComponent(HotelRoomCtrl_1.HotelRoomCtrl);
              _this._roomCtrl.init(roomId, null, _this);
              _this.updateSlotData({
                roomId: roomId,
                slots: null,
                score: 0
              });
            }
          });
        }
        this._roomId = roomId;
        this.bottomSlotContent.removeAllChildren();
        this._initSlot();
        this._showOnlineList();
      };
      RoomDetailCtrl.prototype._showOnlineList = function() {
        var _this = this;
        M_1.default.net.getOnlineList().then(function(list) {
          console.error("online list", list);
          _this._visitList = list;
          if (list && list.length > 0) {
            _this.onlineEye.active = true;
            _this.onlineCount.string = list.length;
          }
        });
      };
      RoomDetailCtrl.prototype._showMoneyBox = function(opt) {
        void 0 === opt && (opt = false);
        if (opt) {
          this.moneyBox.active = true;
          this.socreBox.active = false;
          this.moneyBox.opacity = 0;
          this.moneyBox.runAction(cc.fadeIn(.3));
        } else {
          this.moneyBox.active = false;
          this.socreBox.active = true;
          this.socreBox.opacity = 0;
          this.socreBox.runAction(cc.fadeIn(.3));
        }
      };
      RoomDetailCtrl.prototype._showGuestPanel = function(opt) {
        void 0 === opt && (opt = true);
        this.guestInfoPanel.active = opt;
        this.bottomNode.active = !opt;
        this.selfInfoPanel.active = !opt;
      };
      RoomDetailCtrl.prototype._initSlot = function() {};
      RoomDetailCtrl.prototype._onHideSubSlot = function() {
        this._showMoneyBox(false);
        this.slotDetailView.active = false;
      };
      RoomDetailCtrl.prototype.onCloseSelectSubSlostView = function() {
        M_1.default.event.send(Event_1.Event.Hotel.HideSubSlot);
      };
      RoomDetailCtrl.prototype.onConfirmSelectSubSlostView = function() {
        M_1.default.runtime.RoomCurrentSelectSubSlotCfg && (MoneyManager_1.MoneyManager.CheckMoneyJson(M_1.default.runtime.RoomCurrentSelectSubSlotCfg, true) ? M_1.default.event.send(Event_1.Event.Hotel.SelectSubSlot) : M_1.default.ui.showUI(UIData_1.UIHudDef.SelectShowTarget, {
          type: UIData_1.UIHudDef.SelectShowTarget,
          data: null
        }));
      };
      RoomDetailCtrl.prototype.onGuestCloseBtnClick = function() {
        var _this = this;
        M_1.default.ui.showUI(UIData_1.UIHudDef.CloudView, CloudView_1.ICloudData.VisitFriendHotel, function() {
          M_1.default.ui.hideUI(UIData_1.UIHudDef.FriendRank);
          _this._guestView && _this._guestView.destroy();
          _this._myView && (_this._myView.active = true);
          _this._showGuestPanel(false);
          M_1.default.net.exitVisit(M_1.default.runtime.CurrentGuestUserid);
          M_1.default.runtime.CurrentGuestUserid = null;
        });
      };
      RoomDetailCtrl.prototype.onFriendListBtnClick = function() {
        M_1.default.ui.showUI(UIData_1.UIHudDef.FriendRank);
      };
      RoomDetailCtrl.prototype.onGuestBtnClick = function() {
        if (this._visitList) {
          this.guestListView.active = true;
          this.guestListView.parent.getChildByName("jt").active = true;
          this.guestListView.getComponent(OnLineGuestCtrl_1.default).init(this._visitList);
        }
      };
      RoomDetailCtrl.prototype.updateSlotData = function(roomData) {
        var socre = 0;
        if (this._roomCtrl && 1 != this._roomCtrl.node.scale) {
          if (roomData.slots) {
            var suit = {};
            for (var key in roomData.slots) {
              var data = roomData.slots[key];
              var cfg = HotelData_1.HotelData.getSlotConfig(data.roomId, data.slotId);
              cfg && cfg.prices[data.subId] && (socre += cfg.prices[data.subId].extData);
              suit[data.roomId] || (suit[data.roomId] = 0);
              suit[data.roomId]++;
            }
            for (var roomid in suit) {
              var count = suit[roomid];
              var bonus = HotelData_1.HotelData.getSlotBonusByCount(Number(roomid), count);
              if (bonus) {
                socre += Math.round(socre * (bonus / 100));
                if (roomData.roomId == Number(roomid)) {
                  console.error(roomid);
                  M_1.default.tips.show("\u6fc0\u6d3b\u4e86\u5957\u88c5\u52a0\u6210!");
                }
              }
            }
            HotelData_1.HotelData.updateRoomScore(roomData.roomId, socre);
          } else socre = HotelData_1.HotelData.getScoreByRoomId(roomData.roomId);
          this.scoreLabel.string = "" + socre;
        }
      };
      RoomDetailCtrl.prototype._onShowSubSlot = function(slotCfg) {
        var _this = this;
        if (slotCfg) {
          this._showMoneyBox(true);
          this.slotDetailContent.removeAllChildren();
          this.slotDetailView.active = true;
          M_1.default.runtime.RoomCurrentSelectSubSlotCfg = null;
          var frames_1 = this._roomCtrl.getSoltFrames(slotCfg.slotId);
          slotCfg.prices.forEach(function(item) {
            var slotSubNode = cc.instantiate(_this.slotDetailItemPrefab);
            slotSubNode.parent = _this.slotDetailContent;
            slotSubNode.getComponent(RoomSlotDetailItemCtrl_1.default).init(slotCfg.roomId, slotCfg.slotId, item, frames_1[item.id - 1]);
          });
        }
      };
      RoomDetailCtrl.prototype.onOtherClick = function(a) {
        M_1.default.event.send(Event_1.Event.Hotel.MapScrollBegin);
        this.guestListView.active = false;
        this.guestListView.parent.getChildByName("jt").active = false;
      };
      RoomDetailCtrl.prototype.onExitBtnClick = function() {
        M_1.default.event.send(Event_1.Event.Hotel.HideSubSlot);
        this.node.active = false;
      };
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "bottomSlotContent", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "bottomNode", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "guestInfoPanel", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "selfInfoPanel", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "roomContent", void 0);
      __decorate([ property(cc.Prefab) ], RoomDetailCtrl.prototype, "partsPrefab", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "slotDetailView", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "slotDetailContent", void 0);
      __decorate([ property(cc.Prefab) ], RoomDetailCtrl.prototype, "slotDetailItemPrefab", void 0);
      __decorate([ property(cc.Label) ], RoomDetailCtrl.prototype, "diamondLabel", void 0);
      __decorate([ property(cc.Label) ], RoomDetailCtrl.prototype, "coinLabel", void 0);
      __decorate([ property(cc.Label) ], RoomDetailCtrl.prototype, "scoreLabel", void 0);
      __decorate([ property(cc.Label) ], RoomDetailCtrl.prototype, "visitCountLabel", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "guestListView", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "onlineEye", void 0);
      __decorate([ property(cc.Label) ], RoomDetailCtrl.prototype, "onlineCount", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "moneyBox", void 0);
      __decorate([ property(cc.Node) ], RoomDetailCtrl.prototype, "socreBox", void 0);
      __decorate([ property(cc.ScrollView) ], RoomDetailCtrl.prototype, "slotScrollView", void 0);
      __decorate([ property(cc.Label) ], RoomDetailCtrl.prototype, "confirmBtnLab", void 0);
      RoomDetailCtrl = __decorate([ ccclass ], RoomDetailCtrl);
      return RoomDetailCtrl;
    }(cc.Component);
    exports.default = RoomDetailCtrl;
    cc._RF.pop();
  }, {
    "../../Base/BaseConst": "BaseConst",
    "../../Base/Manager/M": "M",
    "../../Base/Utils/Paths": "Paths",
    "../Common/Common": "Common",
    "../Data/Const/Constant": "Constant",
    "../Data/Const/Event": "Event",
    "../Data/Interface/UIData": "UIData",
    "../Data/MoneyManager": "MoneyManager",
    "../SimulationOperation/View/Map/CloudView": "CloudView",
    "./Access/GuestPanelCtrl": "GuestPanelCtrl",
    "./Access/OnLineGuestCtrl": "OnLineGuestCtrl",
    "./HotelData": "HotelData",
    "./HotelRoomCtrl": "HotelRoomCtrl",
    "./RoomSlotDetailItemCtrl": "RoomSlotDetailItemCtrl"
  } ],
  RoomDetailItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9295frIkkZKSpNbKWKcmWXh", "RoomDetailItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var HotelData_1 = require("./HotelData");
    var Common_1 = require("../Common/Common");
    var Paths_1 = require("../../Base/Utils/Paths");
    var M_1 = require("../../Base/Manager/M");
    var Event_1 = require("../Data/Const/Event");
    var HotelManager_1 = require("./HotelManager");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RoomDetailItemCtrl = function(_super) {
      __extends(RoomDetailItemCtrl, _super);
      function RoomDetailItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.nameLabel = null;
        _this.bgSp = null;
        _this.iconSp = null;
        _this.bgFrame = [];
        _this.lockNode = null;
        _this._cfg = null;
        _this._curSubId = 1;
        _this._isSelected = false;
        _this._isLocked = false;
        _this.index = null;
        return _this;
      }
      RoomDetailItemCtrl.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.Hotel.ShowSubSlot, this._stateChanged, this);
        M_1.default.event.register(Event_1.Event.Hotel.HideSubSlot, this._hideSelect, this);
        M_1.default.event.register(Event_1.Event.Hotel.SlotUnlock, this._onSubSlotUpdate, this);
        M_1.default.event.register(Event_1.Event.Hotel.TouchSlotIcon, this._onSlotIconClick, this);
      };
      RoomDetailItemCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.Hotel.ShowSubSlot, this._stateChanged, this);
        M_1.default.event.unRegister(Event_1.Event.Hotel.HideSubSlot, this._hideSelect, this);
        M_1.default.event.unRegister(Event_1.Event.Hotel.SlotUnlock, this._onSubSlotUpdate, this);
        M_1.default.event.unRegister(Event_1.Event.Hotel.TouchSlotIcon, this._onSlotIconClick, this);
      };
      RoomDetailItemCtrl.prototype.init = function(index, cfg) {
        this.index = index;
        this.iconSp.spriteFrame = null;
        this._cfg = cfg;
        this.nameLabel.string = this._cfg.slotName;
        this._initIcon();
        this._updateLock();
      };
      RoomDetailItemCtrl.prototype._updateLock = function() {
        this._isLocked = !HotelData_1.HotelData.getSlotData(this._cfg.roomId, this._cfg.slotId);
        this.lockNode.active = this._isLocked;
      };
      RoomDetailItemCtrl.prototype._initIcon = function() {
        var slotData = HotelData_1.HotelData.getSlotData(this._cfg.roomId, this._cfg.slotId);
        slotData && slotData.state > 0 && (this._curSubId = slotData.subId);
        this._updateIcon(this._curSubId);
      };
      RoomDetailItemCtrl.prototype._onSubSlotUpdate = function(data) {
        if (this._isLocked) {
          this._updateLock();
          this._isLocked || this.onClick();
        }
        this._cfg.slotId == data.slotId && this._curSubId != data.subId && this._updateIcon(data.subId);
      };
      RoomDetailItemCtrl.prototype._updateIcon = function(subId) {
        var _this = this;
        this._curSubId = subId;
        Common_1.default.getRes(Paths_1.default.RoomPicPath + "room" + this._cfg.roomId + "/" + subId + "/slot_" + this._cfg.slotId, cc.SpriteFrame).then(function(res) {
          if (res) {
            _this.iconSp.spriteFrame = res;
            _this._resetIconContentSize();
          }
        });
      };
      RoomDetailItemCtrl.prototype._resetIconContentSize = function() {
        var size = this.iconSp.node.getContentSize();
        size.width > size.height ? this.iconSp.node.scale = 110 / size.width : this.iconSp.node.scale = 110 / size.height;
      };
      RoomDetailItemCtrl.prototype._stateChanged = function() {
        if (this._isSelected) {
          M_1.default.event.send(Event_1.Event.Hotel.ChangeSlot, this._cfg.slotId);
          this.bgSp.spriteFrame = this.bgFrame[0];
          this._isSelected = false;
        }
      };
      RoomDetailItemCtrl.prototype._hideSelect = function() {
        this._isSelected && this._stateChanged();
      };
      RoomDetailItemCtrl.prototype._onSlotIconClick = function(slotId) {
        this._cfg.slotId == slotId && this.onClick();
      };
      RoomDetailItemCtrl.prototype.onClick = function() {
        var _this = this;
        if (this._isLocked) {
          if (HotelManager_1.HotelManager.checkSlotUnlockShow(this._cfg.roomId, this.index)) {
            var slotData = {
              roomId: this._cfg.roomId,
              slotId: this._cfg.slotId,
              subId: 1,
              state: 0
            };
            M_1.default.event.send(Event_1.Event.Hotel.UIRoomUnlock, slotData);
          } else M_1.default.tips.show("\u7ee7\u7eed\u88c5\u4fee\u623f\u95f4,\u5c31\u53ef\u4ee5\u89e3\u9501 " + this._cfg.slotName + "!");
          return;
        }
        if (this._isSelected) M_1.default.event.send(Event_1.Event.Hotel.HideSubSlot, this._cfg.slotId); else {
          M_1.default.event.send(Event_1.Event.Hotel.ShowSubSlot, this._cfg);
          this.scheduleOnce(function() {
            _this.bgSp.spriteFrame = _this.bgFrame[1];
            _this._isSelected = true;
          }, 0);
        }
      };
      __decorate([ property(cc.Label) ], RoomDetailItemCtrl.prototype, "nameLabel", void 0);
      __decorate([ property(cc.Sprite) ], RoomDetailItemCtrl.prototype, "bgSp", void 0);
      __decorate([ property(cc.Sprite) ], RoomDetailItemCtrl.prototype, "iconSp", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], RoomDetailItemCtrl.prototype, "bgFrame", void 0);
      __decorate([ property(cc.Node) ], RoomDetailItemCtrl.prototype, "lockNode", void 0);
      RoomDetailItemCtrl = __decorate([ ccclass ], RoomDetailItemCtrl);
      return RoomDetailItemCtrl;
    }(cc.Component);
    exports.default = RoomDetailItemCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "../../Base/Utils/Paths": "Paths",
    "../Common/Common": "Common",
    "../Data/Const/Event": "Event",
    "./HotelData": "HotelData",
    "./HotelManager": "HotelManager"
  } ],
  RoomFinishView: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "cef84Bny+ZJw7bsKh9D3BPr", "RoomFinishView");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var HotelData_1 = require("../HotelData");
    var Common_1 = require("../../Common/Common");
    var UIMgr_1 = require("../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Data/Interface/UIData");
    var M_1 = require("../../../Base/Manager/M");
    var BaseConst_1 = require("../../../Base/BaseConst");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RoomFinishView = function(_super) {
      __extends(RoomFinishView, _super);
      function RoomFinishView() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.labelCoin = null;
        _this._buildingId = null;
        return _this;
      }
      RoomFinishView.prototype.onInit = function(buildingId) {
        this._buildingId = buildingId;
      };
      RoomFinishView.prototype.onStart = function() {
        this.initRoomData();
      };
      RoomFinishView.prototype.initRoomData = function() {
        var roomConfig = HotelData_1.HotelData.getHotelRoomConfig(this._buildingId);
        roomConfig && (this.labelCoin.string = "x" + Common_1.default.bytesToSize(roomConfig.finishReward[0].num));
      };
      RoomFinishView.prototype.onClickBtn = function() {
        var roomConfig = HotelData_1.HotelData.getHotelRoomConfig(this._buildingId);
        roomConfig && M_1.default.runtime.addCurrency(BaseConst_1.CurrencyId.Coin, roomConfig.finishReward[0].num);
        this.close();
      };
      RoomFinishView.prototype.close = function() {
        UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.RoomFinishView);
      };
      __decorate([ property(cc.Label) ], RoomFinishView.prototype, "labelCoin", void 0);
      RoomFinishView = __decorate([ ccclass ], RoomFinishView);
      return RoomFinishView;
    }(UIBase_1.default);
    exports.RoomFinishView = RoomFinishView;
    cc._RF.pop();
  }, {
    "../../../Base/BaseConst": "BaseConst",
    "../../../Base/Manager/M": "M",
    "../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../Common/Common": "Common",
    "../../Data/Interface/UIData": "UIData",
    "../HotelData": "HotelData"
  } ],
  RoomSlotCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "73e78ENxG1NzrA7yztPPqVR", "RoomSlotCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BuildingLock_1 = require("../SimulationOperation/View/Map/Component/BuildingLock");
    var HotelData_1 = require("./HotelData");
    var HotelManager_1 = require("./HotelManager");
    var Constant_1 = require("../Data/Const/Constant");
    var M_1 = require("../../Base/Manager/M");
    var Event_1 = require("../Data/Const/Event");
    var Common_1 = require("../Common/Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property, executeInEditMode = _a.executeInEditMode;
    var RoomSlotCtrl = function(_super) {
      __extends(RoomSlotCtrl, _super);
      function RoomSlotCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.slotSp = null;
        _this.iconPos = null;
        _this.iconFrames = [];
        _this.offsets = [];
        _this.animationPrefab = null;
        _this.isSpine = true;
        _this.animationName = "";
        _this._roomId = -1;
        _this._slotId = -1;
        _this._subId = -1;
        _this._soltData = null;
        _this._unlockIconItem = null;
        _this._isDetail = false;
        _this._touchPointNode = null;
        _this._isSelect = false;
        _this.index = null;
        _this._cfg = null;
        _this._spineItem = null;
        _this._animationItem = null;
        _this._animationNames = null;
        _this._animationIndex = 0;
        _this._originPos = null;
        _this._tempFrame = null;
        _this._tempPosition = null;
        _this._hightLight = null;
        return _this;
      }
      RoomSlotCtrl.prototype.onLoad = function() {
        this.node.on(cc.Node.EventType.TOUCH_END, this.onClick, this);
        if (M_1.default.event) {
          M_1.default.event.register(Event_1.Event.Hotel.ShowSubSlot, this._showSubSlot, this);
          M_1.default.event.register(Event_1.Event.Hotel.HideSubSlot, this._hideSelect, this);
          M_1.default.event.register(Event_1.Event.Hotel.ChangeSlot, this._stateChanged, this);
          M_1.default.event.register(Event_1.Event.Hotel.UpateSubSlotState, this.updateIconDisplay, this);
        }
      };
      RoomSlotCtrl.prototype.onDestroy = function() {
        this.clearUnlockIconItem();
        if (M_1.default.event) {
          M_1.default.event.unRegister(Event_1.Event.Hotel.ShowSubSlot, this._showSubSlot, this);
          M_1.default.event.unRegister(Event_1.Event.Hotel.HideSubSlot, this._hideSelect, this);
          M_1.default.event.unRegister(Event_1.Event.Hotel.ChangeSlot, this._stateChanged, this);
          M_1.default.event.unRegister(Event_1.Event.Hotel.UpateSubSlotState, this.updateIconDisplay, this);
        }
      };
      RoomSlotCtrl.prototype.init = function(index, roomId, slotId, slotData, unlockItem, isDetail) {
        void 0 === isDetail && (isDetail = false);
        this.index = index;
        this._soltData = slotData;
        this._subId = slotData ? slotData.subId : 1;
        this._roomId = roomId;
        this._isDetail = isDetail;
        this._slotId = Number(slotId);
        this.slotSp.spriteFrame = null;
        this._originPos || (this._originPos = this.node.position);
        this._cfg = HotelData_1.HotelData.getSlotConfig(this._roomId, this._slotId);
        this._touchPointNode = this.node.parent.getChildByName("touchPoint");
        if (this._soltData && this._soltData.state > 0) {
          this.showSlot(this._soltData.subId);
          this.name = "room_" + this._roomId + "_" + this._slotId + "_" + this._soltData.subId;
        } else {
          this.addUnlockItem(index, unlockItem);
          this.name = "room_" + roomId + "_" + slotId;
        }
      };
      RoomSlotCtrl.prototype.addUnlockItem = function(index, unlockItem) {
        if (!HotelManager_1.HotelManager.checkSlotUnlockShow(this._roomId, index)) return;
        if (this._unlockIconItem) return;
        if (!this._isDetail) return;
        var lockItem = cc.instantiate(unlockItem);
        lockItem.getComponent(BuildingLock_1.default).setHotelData(this._roomId, this._slotId);
        var ox = this.node.width * this.node.scaleX / 2 - this.node.anchorX * (this.node.width * this.node.scaleX);
        var oy = this.node.height * this.node.scaleY / 2 - this.node.anchorY * (this.node.height * this.node.scaleY);
        lockItem.setPosition(this.node.position.add(cc.v3(ox, oy)).add(this.iconPos));
        lockItem.setScale(Constant_1.ROOM_DETAIL_SCALE - 1);
        HotelData_1.HotelData.addLockItem(this._roomId, this._slotId, lockItem);
        lockItem.parent = this._touchPointNode;
        this._unlockIconItem = lockItem;
      };
      RoomSlotCtrl.prototype.showSlot = function(subId, next) {
        if (this.iconFrames[subId - 1]) {
          this.slotSp.enabled = true;
          this.slotSp.spriteFrame = this.iconFrames[subId - 1];
          var offsetPos = this.offsets[subId - 1];
          offsetPos && this.node.setPosition(this._originPos.add(offsetPos));
          this.updateSelctHightLight();
          this._havaAnimationNeedPlay(subId) && !this.isSpine && this._playAnimation();
          next && next();
        }
      };
      RoomSlotCtrl.prototype.doUnlock = function(subId, next) {
        var _this = this;
        this.clearUnlockIconItem();
        this._tempFrame = null;
        this._tempPosition = null;
        this.showSlot(subId, function() {
          _this.show(next, subId);
        });
      };
      RoomSlotCtrl.prototype.updateIconDisplay = function(ctrl) {
        if (this._slotId == ctrl.slotId) {
          if (!this._tempFrame) {
            this._tempFrame = this.slotSp.spriteFrame;
            this._tempPosition = this.node.position;
          }
          this.showSlot(ctrl.subId);
          if (this._havaAnimationNeedPlay(ctrl.subId)) {
            this._playAnimation();
            this.updateSelctHightLight();
          } else this._hideAnimation();
        }
      };
      RoomSlotCtrl.prototype.updateSelctHightLight = function() {
        if (this._hightLight) {
          this._hightLight.getComponent(cc.Sprite).spriteFrame = this.slotSp.spriteFrame;
          this._setHightLightPosition();
        }
      };
      RoomSlotCtrl.prototype._havaAnimationNeedPlay = function(subId) {
        return this.animationPrefab && this._cfg && this._cfg.animationOpts && this._cfg.animationOpts.get(subId);
      };
      RoomSlotCtrl.prototype.show = function(next, subId) {
        var _this = this;
        if (!this.node) return;
        if (this._havaAnimationNeedPlay(subId)) {
          this.slotSp.enabled = false;
          if (this.isSpine) {
            this._spineItem || (this._spineItem = Common_1.default.createSpineNode(this.node, this.animationPrefab, null));
            this._spineItem.node.opacity = 255;
            this._spineItem.node.active = true;
            this._spineItem && this._spineItem.ctrl && this._spineItem.ctrl.play(this.animationName, 1, false, function() {
              next && next();
              _this.slotSp.enabled = true;
              _this._spineItem.node.runAction(cc.sequence(cc.fadeOut(.1), cc.callFunc(function() {
                _this._spineItem.node.active = false;
              })));
            });
          } else this._playAnimation();
        } else {
          this._hideAnimation();
          this.node.opacity = 0;
          var op = this.node.position;
          this.node.y = this.node.y - 140;
          var a0 = cc.fadeIn(.25);
          var a1 = cc.moveTo(.25, cc.v2(this.node.x, this.node.y + 236)).easing(cc.easeCubicActionOut());
          var a2 = cc.moveTo(.085, op);
          var a3 = cc.scaleTo(.05, this.node.scaleX, this.node.scaleY - .05);
          var a4 = cc.scaleTo(.05, this.node.scaleX, this.node.scaleY);
          var a5 = cc.callFunc(function() {
            next && next();
          });
          this.node.runAction(cc.sequence(cc.spawn(a0, a1), a2, a3, a4, a5));
        }
      };
      RoomSlotCtrl.prototype._initAniamtion = function() {
        if (!this._animationItem) {
          this._animationItem = Common_1.default.createEffPrefab(this.node, null, this.animationPrefab);
          this._animationItem.ctrl.on("stop", this._onAnimationStop, this);
        }
        this.animationName && (this._animationNames = this.animationName.split("|"));
      };
      RoomSlotCtrl.prototype._onAnimationStop = function() {
        this._playAnimation();
      };
      RoomSlotCtrl.prototype._hideAnimation = function() {
        this._animationItem && (this._animationItem.node.active = false);
        this.slotSp.enabled = true;
      };
      RoomSlotCtrl.prototype._playAnimation = function() {
        this._animationItem || this._initAniamtion();
        this.slotSp.enabled = false;
        this._animationItem.node.active = true;
        this._animationItem.ctrl.play(this._animationNames[this._animationIndex]);
        this._animationIndex++;
        this._animationIndex >= this._animationNames.length && (this._animationIndex = 0);
      };
      RoomSlotCtrl.prototype._showSubSlot = function(cfg) {
        this._isDetail && cfg.roomId == this._roomId && cfg.slotId == this._slotId && this._showSelect();
      };
      RoomSlotCtrl.prototype.onClick = function() {
        if (this.slotSp.spriteFrame && this._isDetail) {
          this._playTouchAction();
          if (this._isSelect) M_1.default.event.send(Event_1.Event.Hotel.HideSubSlot, this._slotId); else {
            M_1.default.event.send(Event_1.Event.Hotel.TouchSlotIcon, this._slotId);
            this._showSelect();
            M_1.default.event.send(Event_1.Event.Hotel.ChangeSlot, this._slotId);
          }
        }
      };
      RoomSlotCtrl.prototype._playTouchAction = function() {
        if (1 == this._slotId || 2 == this._slotId || 3 == this._slotId) return;
        this.node.stopAllActions();
        var a0 = cc.scaleTo(.12, this.node.scaleX, this.node.scaleY - .05);
        var a1 = cc.scaleTo(.12, this.node.scaleX, this.node.scaleY + .05);
        var a2 = cc.scaleTo(.12, this.node.scaleX, this.node.scaleY);
        this.node.runAction(cc.sequence(a0, a1, a2));
      };
      RoomSlotCtrl.prototype._showSelect = function() {
        if (this._isSelect) return;
        this._isSelect = true;
        var lightMask = Common_1.default.createSprite(null, this.slotSp.spriteFrame, this.node);
        this._hightLight = lightMask.node;
        this._hightLight.zIndex = 100;
        this._setHightLightPosition();
        lightMask.srcBlendFactor = cc.macro.BlendFactor.SRC_ALPHA;
        lightMask.dstBlendFactor = cc.macro.BlendFactor.DST_ALPHA;
        this._hightLight.opacity = 0;
        var a0 = cc.fadeTo(.5, 80);
        var a1 = cc.fadeTo(.5, 0);
        this._hightLight.runAction(cc.repeatForever(cc.sequence(a0, a1)));
      };
      RoomSlotCtrl.prototype._setHightLightPosition = function() {
        if (this._hightLight) {
          .5 != this.node.anchorX && (this._hightLight.x = this.node.scaleX * this.node.width * (1 - this.node.anchorX));
          .5 != this.node.anchorY && (this._hightLight.y = this.node.scaleY * this.node.height * (1 - this.node.anchorY));
        }
      };
      RoomSlotCtrl.prototype._stateChanged = function(slotId) {
        void 0 === slotId && (slotId = null);
        slotId != this._slotId && this._isSelect && this._hideSelect();
      };
      RoomSlotCtrl.prototype._hideSelect = function(slotId) {
        void 0 === slotId && (slotId = null);
        slotId = slotId || this._slotId;
        if ((!slotId || slotId && this._slotId == slotId) && this._hightLight) {
          this._hightLight.stopAllActions();
          this._hightLight.destroy();
          this._hightLight = null;
          this._isSelect = false;
          if (this._tempFrame) {
            this.slotSp.spriteFrame = this._tempFrame;
            this.node.setPosition(this._tempPosition);
          }
        }
      };
      RoomSlotCtrl.prototype.clearUnlockIconItem = function() {
        if (this._unlockIconItem) {
          this._unlockIconItem.destroy();
          this._unlockIconItem = null;
        }
      };
      __decorate([ property(cc.Sprite) ], RoomSlotCtrl.prototype, "slotSp", void 0);
      __decorate([ property(cc.Vec2) ], RoomSlotCtrl.prototype, "iconPos", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], RoomSlotCtrl.prototype, "iconFrames", void 0);
      __decorate([ property([ cc.Vec2 ]) ], RoomSlotCtrl.prototype, "offsets", void 0);
      __decorate([ property(cc.Prefab) ], RoomSlotCtrl.prototype, "animationPrefab", void 0);
      __decorate([ property ], RoomSlotCtrl.prototype, "isSpine", void 0);
      __decorate([ property ], RoomSlotCtrl.prototype, "animationName", void 0);
      RoomSlotCtrl = __decorate([ ccclass, executeInEditMode ], RoomSlotCtrl);
      return RoomSlotCtrl;
    }(cc.Component);
    exports.RoomSlotCtrl = RoomSlotCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "../Common/Common": "Common",
    "../Data/Const/Constant": "Constant",
    "../Data/Const/Event": "Event",
    "../SimulationOperation/View/Map/Component/BuildingLock": "BuildingLock",
    "./HotelData": "HotelData",
    "./HotelManager": "HotelManager"
  } ],
  RoomSlotDetailItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e52fcW8xJ1DVa7fjDLfmLXH", "RoomSlotDetailItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var HotelData_1 = require("./HotelData");
    var M_1 = require("../../Base/Manager/M");
    var Event_1 = require("../Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RoomSlotDetailItemCtrl = function(_super) {
      __extends(RoomSlotDetailItemCtrl, _super);
      function RoomSlotDetailItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.money = null;
        _this.bgSp = null;
        _this.iconSp = null;
        _this.unitSp = null;
        _this.selectNode = null;
        _this.priceNode = null;
        _this.bgFrame = [];
        _this.currencyFrames = [];
        _this._cfg = null;
        _this._isUnlock = true;
        _this._isSelect = false;
        _this.roomId = null;
        _this.slotId = null;
        _this.subId = null;
        _this._state = 1;
        _this._confirmLabel = null;
        return _this;
      }
      RoomSlotDetailItemCtrl.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.Hotel.UpateSubSlotState, this._updateState, this);
        M_1.default.event.register(Event_1.Event.Hotel.SelectSubSlot, this._onSelectConfirm, this);
      };
      RoomSlotDetailItemCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.Hotel.UpateSubSlotState, this._updateState, this);
        M_1.default.event.unRegister(Event_1.Event.Hotel.SelectSubSlot, this._onSelectConfirm, this);
      };
      RoomSlotDetailItemCtrl.prototype.init = function(roomId, slotId, data, frame) {
        this.roomId = roomId;
        this.subId = data.id;
        this.slotId = slotId;
        this._cfg = data;
        this._initIcon(frame);
        this._initPrice();
      };
      RoomSlotDetailItemCtrl.prototype._initPrice = function() {
        var slotData = HotelData_1.HotelData.getSlotData(this.roomId, this.slotId);
        if (slotData && slotData.subId == this.subId) this._showSelect(true); else if (HotelData_1.HotelData.getSubSlotStateData({
          roomId: this.roomId,
          slotId: this.slotId,
          subId: this.subId,
          state: this._state
        })) this._showSelect(false); else {
          this._isUnlock = false;
          this._state = 0;
          this.money.string = this._cfg.num.toString();
          this.unitSp.spriteFrame = this.currencyFrames[this._cfg.itemId];
          this._showSelect(false);
        }
      };
      RoomSlotDetailItemCtrl.prototype._initIcon = function(frame) {
        this.iconSp.spriteFrame = frame;
        this._resetIconSize();
      };
      RoomSlotDetailItemCtrl.prototype._resetIconSize = function() {
        var size = this.iconSp.node.getContentSize();
        size.width > size.height ? this.iconSp.node.scale = 120 / size.width : this.iconSp.node.scale = 120 / size.height;
      };
      RoomSlotDetailItemCtrl.prototype._showSelect = function(opt) {
        this.selectNode.active = opt;
        this._isSelect = opt;
        this._isUnlock && (this.priceNode.active = false);
        if (opt) {
          var data = HotelData_1.HotelData.getSlotData(this.roomId, this.slotId);
          (!data || data && data.subId != this.subId) && (M_1.default.runtime.RoomCurrentSelectSubSlotCfg = this._cfg);
        }
        this.bgSp.spriteFrame = this.bgFrame[opt ? 1 : 0];
      };
      RoomSlotDetailItemCtrl.prototype._updateState = function(from) {
        this != from && this._showSelect(false);
      };
      RoomSlotDetailItemCtrl.prototype._onSelectConfirm = function() {
        if (this._isSelect) {
          var data = HotelData_1.HotelData.getSlotData(this.roomId, this.slotId);
          if (data && data.subId == this.subId) return;
          var slotData = {
            roomId: this.roomId,
            slotId: this.slotId,
            subId: this.subId,
            state: this._state
          };
          slotData.state = this._state = 1;
          this._isUnlock = true;
          this._showSelect(true);
          HotelData_1.HotelData.setSubSlotStateData(slotData);
          M_1.default.event.send(Event_1.Event.Hotel.UpateSubSlotState, this);
          M_1.default.event.send(Event_1.Event.Hotel.SlotUnlock, slotData);
        }
      };
      RoomSlotDetailItemCtrl.prototype.onClick = function() {
        if (!this._isSelect) {
          this._isUnlock && (this._isUnlock = true);
          this._showSelect(true);
          M_1.default.event.send(Event_1.Event.Hotel.UpateSubSlotState, this);
        }
      };
      __decorate([ property(cc.Label) ], RoomSlotDetailItemCtrl.prototype, "money", void 0);
      __decorate([ property(cc.Sprite) ], RoomSlotDetailItemCtrl.prototype, "bgSp", void 0);
      __decorate([ property(cc.Sprite) ], RoomSlotDetailItemCtrl.prototype, "iconSp", void 0);
      __decorate([ property(cc.Sprite) ], RoomSlotDetailItemCtrl.prototype, "unitSp", void 0);
      __decorate([ property(cc.Node) ], RoomSlotDetailItemCtrl.prototype, "selectNode", void 0);
      __decorate([ property(cc.Node) ], RoomSlotDetailItemCtrl.prototype, "priceNode", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], RoomSlotDetailItemCtrl.prototype, "bgFrame", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], RoomSlotDetailItemCtrl.prototype, "currencyFrames", void 0);
      RoomSlotDetailItemCtrl = __decorate([ ccclass ], RoomSlotDetailItemCtrl);
      return RoomSlotDetailItemCtrl;
    }(cc.Component);
    exports.default = RoomSlotDetailItemCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "../Data/Const/Event": "Event",
    "./HotelData": "HotelData"
  } ],
  RotatingCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "5fe62GcHRlFs65lmrk3zBO1", "RotatingCtrl");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var RotatingCtrl = function() {
      function RotatingCtrl(target, targetPosition) {
        this._arg = null;
        this._target = null;
        this._targetPosition = null;
        this._target = target;
        this._targetPosition = targetPosition;
      }
      RotatingCtrl.prototype.start = function(delay) {
        var _this = this;
        void 0 === delay && (delay = 0);
        return new Promise(function(resolve) {
          var arg = new FlyPlaneArgs();
          _this._target.angle = 0;
          arg.node = _this._target;
          var startPoint = _this._target.position;
          var endPoint = _this._targetPosition;
          var speed = TimeConfig_1.GapTime.BeikeSuctionSpeed();
          arg.move_speed = TimeConfig_1.GapTime.IsCounterClockWise ? -speed : speed;
          var centerPoint = cc.v2(.5 * (startPoint.x + endPoint.x), .5 * (startPoint.y + endPoint.y));
          var r = Math.sqrt(Math.pow(startPoint.x - centerPoint.x, 2) + Math.pow(startPoint.y - centerPoint.y, 2));
          arg.r = r;
          arg.xc = centerPoint.x;
          arg.yc = centerPoint.y;
          arg.angle = _this.getPlaneAngle(startPoint, cc.v2(centerPoint.x, centerPoint.y + r), r);
          arg.move_angle = 180;
          arg.delay = delay;
          arg.resolve = resolve;
          _this._arg = arg;
        });
      };
      RotatingCtrl.prototype.getPlaneAngle = function(pa, pc, r) {
        var angle = 0;
        var x = 0;
        var y = 0;
        if (pa.x < pc.x) {
          x = pa.x - pc.x;
          y = pc.y - pa.y;
          angle = 360 - 2 * Math.asin(Math.sqrt(x * x + y * y) / r * .5) * 180 / Math.PI;
        } else {
          x = pc.x - pa.x;
          y = pc.y - pa.y;
          angle = 2 * Math.asin(Math.sqrt(x * x + y * y) / r * .5) * 180 / Math.PI;
        }
        return angle;
      };
      RotatingCtrl.prototype.updateFlyPlane = function(dt) {
        if (!this._arg) return;
        if (this._arg.delay > 0) this._arg.delay -= dt; else if (this._arg.move_angle <= 0) {
          this._arg.node.scale = 0;
          this.planeArrive(this._arg);
        } else {
          var xc = this._arg.xc;
          var yc = this._arg.yc;
          var r = this._arg.r;
          var moveDis = dt * this._arg.move_speed;
          this._arg.angle += moveDis;
          this._arg.move_angle -= Math.abs(moveDis);
          var a = this._arg.angle / 180 * Math.PI;
          var curX = xc + r * Math.sin(a);
          var curY = yc + r * Math.cos(a);
          if (false == this._arg.node.active) {
            this._arg.node.active = true;
            this._arg.node.opacity = 255;
          }
          this._arg.node.scale -= .01;
          this._arg.node.position = cc.v3(curX, curY);
          this._arg.node.angle = -(this._arg.angle - (this._arg.move_speed > 0 ? 120 : -60));
        }
      };
      RotatingCtrl.prototype.planeArrive = function(arg) {
        console.log("planeArrive!");
        if (arg.resolve) {
          arg.resolve();
          arg.resolve = null;
        }
      };
      RotatingCtrl.prototype.update = function(dt) {
        this.updateFlyPlane(dt);
      };
      return RotatingCtrl;
    }();
    exports.default = RotatingCtrl;
    var FlyPlaneArgs = function() {
      function FlyPlaneArgs() {
        this.node = null;
        this.delay = 0;
        this.xc = 0;
        this.yc = 0;
        this.r = 0;
        this.angle = 0;
        this.move_speed = 0;
        this.move_angle = 0;
        this.resolve = null;
      }
      return FlyPlaneArgs;
    }();
    cc._RF.pop();
  }, {
    "../../Data/Const/TimeConfig": "TimeConfig"
  } ],
  RuntimeMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f6cc0HzBSxGm5ePVq2g3XAJ", "RuntimeMgr");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var PlayerInfo_1 = require("./Player/PlayerInfo");
    var SingletonFactory_1 = require("../../Base/Utils/SingletonFactory");
    var BaseConst_1 = require("../../Base/BaseConst");
    var EventMgr_1 = require("../../Base/Manager/EventMgr");
    var Event_1 = require("./Const/Event");
    var Constant_1 = require("./Const/Constant");
    var M_1 = require("../../Base/Manager/M");
    var StorageMgr_1 = require("../../Base/Manager/StorageMgr");
    var ReportMgr_1 = require("../../Base/Manager/ReportMgr");
    var Common_1 = require("../Common/Common");
    var DailyTaskMgr_1 = require("../../Base/Manager/DailyTaskMgr");
    var RuntimeMgr = function() {
      function RuntimeMgr() {
        this.info = null;
        this._dataSaveTaskPool = [];
        this._execSaveTasking = false;
        this.IsLogin = false;
        this.BombCount = 0;
        this.OverStepCount = 0;
        this.SelectLevel = 0;
        this.CurLevel = 0;
        this.SceneTask = null;
        this.SelectProp = null;
        this.CurBgIndex = 0;
        this.CurCombo = 0;
        this.MatchGameTime = 0;
        this.RewardTask = {};
        this.DailyTaskProgress = null;
        this.RoomCurrentSelectSubSlotCfg = null;
        this._dailyTime = 0;
        this._serverConfig = null;
        this._score = 0;
        this._timeHandle = null;
        this._gameStata = Constant_1.GameState.preReady;
        this._onShowTask = null;
        this.CurrentGuestUserid = null;
        this._preGameState = null;
        this._zyTimeTaskPool = 0;
        this.SceneTask = [];
        this.info = new PlayerInfo_1.default();
        this._onShowTask = [];
        this._openTimer();
      }
      RuntimeMgr.prototype.initRemotData = function(data) {
        var userdata = data ? data.userdata : null;
        this.RewardTask = data ? data.awards : null;
        this.info.initRemotData(userdata);
        if (data) {
          this.info.userId = data.uid;
          this.IsLogin = true;
          this._checkOnShowTask();
        }
        console.error("\u5f53\u524d\u7528\u6237ID:", this.info.userId);
        StorageMgr_1.StorageMgr.Storage.init(userdata);
        this.setDailyTime(StorageMgr_1.StorageMgr.RingStorage.day().getValue(Constant_1.NativeKey.DailyTime, 0));
        this.getServerConfig();
        ReportMgr_1.default.ins.login();
      };
      Object.defineProperty(RuntimeMgr.prototype, "UserId", {
        get: function() {
          return this.info.userId;
        },
        enumerable: true,
        configurable: true
      });
      RuntimeMgr.prototype.initTaskNativeData = function() {
        this.DailyTaskProgress && DailyTaskMgr_1.default.ins.syncPro2Native(this.DailyTaskProgress.progress);
      };
      RuntimeMgr.prototype.getPropData = function(type) {
        void 0 === type && (type = null);
        var ddd;
        try {
          ddd = JSON.parse(cc.sys.localStorage.getItem("daoju"));
        } catch (e) {
          console.error("JSON \u89e3\u6790\u5931\u8d25:", e);
          ddd = {};
          cc.sys.localStorage.setItem("daoju", JSON.stringify(ddd));
        }
        if (null == ddd) {
          ddd = {};
          cc.sys.localStorage.setItem("daoju", JSON.stringify(ddd));
        }
        this.info.propData = ddd;
        var rst = null;
        rst = null == type ? this.info.propData : this.info.propData[type];
        return rst;
      };
      RuntimeMgr.prototype.getUserId = function() {
        return this.info.userId;
      };
      RuntimeMgr.prototype.isPropUnLocked = function(type) {
        var info = M_1.default.table.PropInfo.getByPrimaryKey(type);
        var result = false;
        info && this.getMatch3Level() >= info.unlockLv && (result = true);
        return result;
      };
      RuntimeMgr.prototype.getCurrency = function(type) {
        cc.sys.localStorage.getItem(this.getCurrencyKey(type)) && 0 == this.info[this.getCurrencyKey(type)] && (this.info[this.getCurrencyKey(type)] = cc.sys.localStorage.getItem(this.getCurrencyKey(type)));
        return this.info[this.getCurrencyKey(type)];
      };
      RuntimeMgr.prototype.getCurrencyStr = function(type) {
        return this.getCurrency(type).toString();
      };
      RuntimeMgr.prototype.getFormateCoin = function() {
        return Common_1.default.bytesToSize(this.getCurrency(BaseConst_1.CurrencyId.Coin));
      };
      RuntimeMgr.prototype.getCurChapter = function() {
        return this.info.chapter;
      };
      RuntimeMgr.prototype.getServerTime = function() {
        return this.info.serverTime;
      };
      RuntimeMgr.prototype.getLastTime = function() {
        return this.info.getLastTime();
      };
      Object.defineProperty(RuntimeMgr.prototype, "GameState", {
        get: function() {
          return this._gameStata;
        },
        set: function(state) {
          this._gameStata = state;
        },
        enumerable: true,
        configurable: true
      });
      RuntimeMgr.prototype.getMatch3Level = function() {
        this.info.mathc3Level = Number(cc.sys.localStorage.getItem("gamelevel"));
        return this.info.mathc3Level || 1;
      };
      Object.defineProperty(RuntimeMgr.prototype, "maxMatch3Level", {
        get: function() {
          return 500;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(RuntimeMgr.prototype, "currentScore", {
        get: function() {
          return this._score || 0;
        },
        enumerable: true,
        configurable: true
      });
      RuntimeMgr.prototype.getStarCount = function() {
        var count = 0;
        this.info.lvMap.forEach(function(value, key) {
          count += value.star;
        });
        return count;
      };
      RuntimeMgr.prototype.gameStar = function() {
        this._preGameState = null;
        this._score = 0;
      };
      RuntimeMgr.prototype.setScore = function(score) {
        this._score = score;
      };
      RuntimeMgr.prototype.setServerTime = function(time) {
        this.info.serverTime = time;
      };
      RuntimeMgr.prototype.addScore = function(score) {
        this.setScore(this.currentScore + (score || 0));
        return this.currentScore;
      };
      RuntimeMgr.prototype._addCountByType = function(key, type, count) {
        void 0 === count && (count = 1);
        var dd = StorageMgr_1.StorageMgr.RingStorage.day().getValue(key, {});
        dd[type] = dd[type] ? dd[type] + count : count;
        StorageMgr_1.StorageMgr.RingStorage.day().setValue(key, dd);
        var md = StorageMgr_1.StorageMgr.RingStorage.month().getValue(key + 1, {});
        md[type] = md[type] ? md[type] + count : count;
        StorageMgr_1.StorageMgr.RingStorage.month().setValue(key + 1, md);
        var ad = StorageMgr_1.StorageMgr.Storage.getObject(key + 2, {});
        ad[type] = ad[type] ? ad[type] + count : count;
        StorageMgr_1.StorageMgr.Storage.setObject(key + 2, ad);
        DailyTaskMgr_1.default.ins.syncPro2Ser(key, type, dd[type], md[type]);
      };
      RuntimeMgr.prototype._addCount = function(key) {
        var dc = StorageMgr_1.StorageMgr.RingStorage.day().getValue(key, 0);
        StorageMgr_1.StorageMgr.RingStorage.day().setValue(key, dc + 1);
        var mc = StorageMgr_1.StorageMgr.RingStorage.month().getValue(key + 1, 0);
        StorageMgr_1.StorageMgr.RingStorage.month().setValue(key + 1, mc + 1);
        var ac = StorageMgr_1.StorageMgr.Storage.getInt(key + 2, 0);
        StorageMgr_1.StorageMgr.Storage.setInt(key + 2, ac + 1);
        DailyTaskMgr_1.default.ins.syncPro2Ser(key, null, dc + 1, mc + 1);
      };
      RuntimeMgr.prototype.addCollectCount = function(type, count) {
        void 0 === count && (count = 1);
        this._addCountByType(Constant_1.NativeKey.DailyCollect, type, count);
      };
      RuntimeMgr.prototype.addMergeCount = function(type) {
        this._addCountByType(Constant_1.NativeKey.DailyMerge, type);
      };
      RuntimeMgr.prototype.addGameCount = function() {
        this._addCount(Constant_1.NativeKey.DailyGameCount);
      };
      RuntimeMgr.prototype.addUsePropCount = function(type) {
        this._addCount(Constant_1.NativeKey.DailyUsePropCount);
      };
      RuntimeMgr.prototype.updatePropCount = function(type, num) {
        var p = this.info.propData[type] || {
          count: 0
        };
        p.count += num;
        p.count = p.count < 0 ? 0 : p.count;
        this.info.propData[type] = p;
        cc.sys.localStorage.setItem("daoju", JSON.stringify(this.info.propData));
        EventMgr_1.default.ins.send(Event_1.Event.UI.PropCount, type);
        this._pushSaveTask("propData");
      };
      RuntimeMgr.prototype.setMatch3Level = function(lv, qj) {
        void 0 === qj && (qj = false);
        if (lv > this.info.mathc3Level || qj) {
          var lvData = this.getNativeLvData(this.info.mathc3Level);
          M_1.default.net.putRankData({
            name: "BarrierRank",
            value: Common_1.default.stringifyRankData(this.info.mathc3Level, lvData.score)
          });
          this.info.mathc3Level = lv;
          cc.sys.localStorage.setItem("gamelevel", lv);
          M_1.default.event.send(Event_1.Event.UI.UpdateLv, lv);
          this._pushSaveTask("mathc3Level");
        } else this.SelectLevel = lv;
      };
      RuntimeMgr.prototype.addCurrency = function(type, num) {
        if (type == BaseConst_1.CurrencyId.TaskKey) DailyTaskMgr_1.default.ins.addDailyTaskKey(num); else {
          var key = this.getCurrencyKey(type);
          var currentValue = this.info[key];
          if (type == BaseConst_1.CurrencyId.Power && num > 0 && currentValue >= Constant_1.MaxPowerCount) return;
          this.info[key] += num;
          this.info[key] < 0 && (this.info[key] = 0);
          cc.sys.localStorage.setItem(key, this.info[key]);
          EventMgr_1.default.ins.send(Event_1.Event.UI.UpdateCurrency, type, this.getCurrency(type));
          this._pushSaveTask(key);
        }
      };
      RuntimeMgr.prototype.isPowerEnough = function() {
        return this.info.power >= Constant_1.PowerConfig.LvConsumption;
      };
      RuntimeMgr.prototype.getNativeLvData = function(lv) {
        void 0 === lv && (lv = null);
        lv = lv || this.CurLevel;
        var key = Constant_1.NativeKey.LvDataKey + "_" + lv;
        var result = this.info.lvMap.get(key);
        if (!result) {
          result = StorageMgr_1.StorageMgr.Storage.getObject(key, {
            score: 0,
            star: 0
          });
          result && 0 != result.score && 0 != result.star && this.info.lvMap.set(key, result);
        }
        return result;
      };
      RuntimeMgr.prototype.getBoxGiftDataByLv = function(lv) {
        var data = StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.BoxGifts, {});
        return data[lv];
      };
      RuntimeMgr.prototype.setBoxGiftData = function(lv, received) {
        var data = StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.BoxGifts, {});
        if (data[lv] && data[lv]["received"]) return;
        data[lv] = {
          received: received
        };
        StorageMgr_1.StorageMgr.Storage.setObject(Constant_1.NativeKey.BoxGifts, data, true);
      };
      RuntimeMgr.prototype.savaLvData = function(star, score) {
        var lvData = this.getNativeLvData(this.CurLevel);
        var isNew = false;
        if (0 == lvData.score && 0 == lvData.star) {
          isNew = true;
          M_1.default.runtime.addCollectCount("star", star);
        } else star - lvData.star > 0 && M_1.default.runtime.addCollectCount("star", star - lvData.star);
        score = score || this._score;
        score > lvData.score && (lvData.score = score);
        star > lvData.star && (lvData.star = star);
        var key = Constant_1.NativeKey.LvDataKey + "_" + this.CurLevel;
        this.info.lvMap.set(key, lvData);
        StorageMgr_1.StorageMgr.Storage.setObject(key, lvData, true);
        if (this.CurLevel % 10 == 0) {
          var info = M_1.default.table.BoxRewardInfo.getByPrimaryKey(this.CurLevel);
          info && this.setBoxGiftData(this.CurLevel, false);
        }
        return isNew;
      };
      RuntimeMgr.prototype.pushZhangyuTimePause = function() {
        this._zyTimeTaskPool++;
        this.pauseGame();
      };
      RuntimeMgr.prototype.deleteZhangyuTime = function() {
        this._zyTimeTaskPool--;
        this._zyTimeTaskPool <= 0 && this.resumeGame();
      };
      RuntimeMgr.prototype.pauseGame = function() {
        this._gameStata >= Constant_1.GameState.Win && (this._preGameState = this._gameStata);
        this._gameStata = Constant_1.GameState.Pause;
      };
      RuntimeMgr.prototype.resumeGame = function() {
        if (this._gameStata == Constant_1.GameState.Pause) {
          this._gameStata = null == this._preGameState ? Constant_1.GameState.Normal : this._preGameState;
          EventMgr_1.default.ins.send(Event_1.Event.GameCMD.GameResume);
        }
      };
      RuntimeMgr.prototype.getCurrencyKey = function(id) {
        return [ "coin", "diamond", "power" ][id];
      };
      RuntimeMgr.prototype._openTimer = function() {
        true;
        this._timeHandle = setInterval(this.update.bind(this), 1e3);
      };
      RuntimeMgr.prototype._pushSaveTask = function(key) {
        this._dataSaveTaskPool.push(key);
      };
      RuntimeMgr.prototype.getServerConfig = function() {
        return __awaiter(this, void 0, Promise, function() {
          var _this = this;
          return __generator(this, function(_a) {
            return [ 2, new Promise(function(resolve) {
              _this._serverConfig ? resolve(_this._serverConfig) : M_1.default.net.getServerData().then(function(serverConfig) {
                _this._serverConfig = serverConfig;
                resolve(serverConfig);
              });
            }) ];
          });
        });
      };
      RuntimeMgr.prototype._execSaveTask = function() {
        return __awaiter(this, void 0, void 0, function() {
          var task;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              if (!!this._execSaveTasking) return [ 3, 3 ];
              this._execSaveTasking = true;
              task = this._dataSaveTaskPool.shift();
              if (!task) return [ 3, 2 ];
              return [ 4, this.info.saveData(task) ];

             case 1:
              _a.sent();
              this._execSaveTasking = false;
              this._execSaveTask();
              return [ 3, 3 ];

             case 2:
              this._execSaveTasking = false;
              _a.label = 3;

             case 3:
              return [ 2 ];
            }
          });
        });
      };
      RuntimeMgr.prototype._updatePowerTime = function() {
        if (this.getCurrency(BaseConst_1.CurrencyId.Power) < Constant_1.MaxPowerCount) {
          this.info.timeCounter++;
          this.info.timeCounter >= Number.MAX_SAFE_INTEGER && (this.info.timeCounter = 0);
          this.info.timeCounter % 30 == 0 && this._pushSaveTask("timeCounter");
          this.info.timeCounter % Constant_1.PowerConfig.NormalTime == 0 && this.addCurrency(BaseConst_1.CurrencyId.Power, Constant_1.PowerConfig.NormalCount);
          EventMgr_1.default.ins.send(Event_1.Event.UI.UpdateRemainAddPowerTime, this.info.timeCounter);
        }
      };
      RuntimeMgr.prototype._updateDailyTime = function() {
        this.setDailyTime(this._dailyTime + 1);
      };
      Object.defineProperty(RuntimeMgr.prototype, "DailyTime", {
        get: function() {
          return this._dailyTime;
        },
        enumerable: true,
        configurable: true
      });
      RuntimeMgr.prototype.setDailyTime = function(value) {
        this._dailyTime = value;
        StorageMgr_1.StorageMgr.RingStorage.day().setValue(Constant_1.NativeKey.DailyTime, this._dailyTime);
      };
      RuntimeMgr.prototype.update = function() {
        this._dataSaveTaskPool.length > 0 && this._execSaveTask();
        if (0 != this.info.serverTime) {
          this.info.serverTime++;
          this.info.serverTime % 30 == 0 && this.info.saveLastTime();
        }
        this._updatePowerTime();
        this._updateDailyTime();
      };
      RuntimeMgr.prototype.pushOnShowTask = function(task) {
        this._onShowTask || (this._onShowTask = []);
        this._onShowTask.push(task);
      };
      RuntimeMgr.prototype._checkOnShowTask = function() {
        if (this._onShowTask && this._onShowTask.length > 0) {
          var userid = this._onShowTask.shift();
          M_1.default.net.addFriend(userid);
        }
      };
      RuntimeMgr.ins = SingletonFactory_1.SingletonFactory.getInstance(RuntimeMgr);
      return RuntimeMgr;
    }();
    exports.default = RuntimeMgr;
    cc._RF.pop();
  }, {
    "../../Base/BaseConst": "BaseConst",
    "../../Base/Manager/DailyTaskMgr": "DailyTaskMgr",
    "../../Base/Manager/EventMgr": "EventMgr",
    "../../Base/Manager/M": "M",
    "../../Base/Manager/ReportMgr": "ReportMgr",
    "../../Base/Manager/StorageMgr": "StorageMgr",
    "../../Base/Utils/SingletonFactory": "SingletonFactory",
    "../Common/Common": "Common",
    "./Const/Constant": "Constant",
    "./Const/Event": "Event",
    "./Player/PlayerInfo": "PlayerInfo"
  } ],
  SelectChapterCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "89787NCWnFLzr25fv4owYu2", "SelectChapterCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../Base/Manager/M");
    var ChapterItemCtrl_1 = require("./ChapterItemCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var SelectChapterCtrl = function(_super) {
      __extends(SelectChapterCtrl, _super);
      function SelectChapterCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.content = null;
        _this.itemPrefab = null;
        return _this;
      }
      SelectChapterCtrl.prototype.onLoad = function() {};
      SelectChapterCtrl.prototype.init = function(callback) {
        var _this = this;
        var datas = M_1.default.table.ChapterInfo.getData();
        datas.forEach(function(info) {
          var item = M_1.default.nodePool.createItem(_this.itemPrefab);
          item.parent = _this.content;
          item.getComponent(ChapterItemCtrl_1.default).init(info, .7, callback);
        });
      };
      __decorate([ property(cc.Node) ], SelectChapterCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Prefab) ], SelectChapterCtrl.prototype, "itemPrefab", void 0);
      SelectChapterCtrl = __decorate([ ccclass ], SelectChapterCtrl);
      return SelectChapterCtrl;
    }(cc.Component);
    exports.default = SelectChapterCtrl;
    cc._RF.pop();
  }, {
    "../../Base/Manager/M": "M",
    "./ChapterItemCtrl": "ChapterItemCtrl"
  } ],
  SelectLevelCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "d9332z2r8VFuYuiE7zsSFKC", "SelectLevelCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var LevelMarkItem_1 = require("../../../Views/LevelMap/LevelMarkItem");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var SelectLevelCtrl = function(_super) {
      __extends(SelectLevelCtrl, _super);
      function SelectLevelCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.content = null;
        _this.lvItem = null;
        _this.nameLab = null;
        return _this;
      }
      SelectLevelCtrl.prototype.init = function(data) {
        if (data) {
          this.content.removeAllChildren();
          for (var i = data.minLv; i <= data.maxLv; i++) {
            var item = M_1.default.nodePool.createItem(this.lvItem);
            item.parent = this.content;
            item.getComponent(LevelMarkItem_1.default).updateData(i);
          }
          this.nameLab.string = data.name;
          this.nameLab.node.getChildByName("shadow").getComponent(cc.Label).string = data.name;
        }
      };
      __decorate([ property(cc.Node) ], SelectLevelCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Prefab) ], SelectLevelCtrl.prototype, "lvItem", void 0);
      __decorate([ property(cc.Label) ], SelectLevelCtrl.prototype, "nameLab", void 0);
      SelectLevelCtrl = __decorate([ ccclass ], SelectLevelCtrl);
      return SelectLevelCtrl;
    }(cc.Component);
    exports.default = SelectLevelCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../../Views/LevelMap/LevelMarkItem": "LevelMarkItem"
  } ],
  SelectPropCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "284fcdVga5K8qWYoC2UQCUB", "SelectPropCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Constant_1 = require("../../../Data/Const/Constant");
    var M_1 = require("../../../../Base/Manager/M");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var Event_1 = require("../../../Data/Const/Event");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var SelectPropCtrl = function(_super) {
      __extends(SelectPropCtrl, _super);
      function SelectPropCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.prop1 = null;
        _this.prop2 = null;
        _this.prop3 = null;
        _this.tipsNode = null;
        _this.tipsContent = null;
        _this.propFrames = [];
        return _this;
      }
      SelectPropCtrl.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.UI.PropCount, this.onPropCountChanged, this);
      };
      SelectPropCtrl.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.UI.PropCount, this.onPropCountChanged, this);
      };
      SelectPropCtrl.prototype.init = function() {
        this._hideTips();
        this._initPropLockState();
        this._initSelect();
      };
      SelectPropCtrl.prototype._initPropLockState = function() {
        var _this = this;
        var types = [ Constant_1.PropType.Add3Step, Constant_1.PropType.StartBomb, Constant_1.PropType.StartStar ];
        types.forEach(function(type) {
          var index = type - Constant_1.PropType.Add3Step;
          if (M_1.default.runtime.isPropUnLocked(type)) {
            var sprite_1 = _this["prop" + (index + 1)];
            var node_1 = sprite_1.node;
            node_1.getChildByName("add").active = true;
            var lbNum = node_1.getChildByName("titleNoOpen").getComponent(cc.Label);
            lbNum.string = "\u6682\u672a\u5f00\u542f";
          } else if (!_this.tipsNode.active) {
            var sprite_2 = _this["prop" + (index + 1)];
            var node_2 = sprite_2.node;
            _this._showTips(sprite_2.node.position, type);
            node_2.getChildByName("add").active = false;
            var lbNum = node_2.getChildByName("titleNoOpen").getComponent(cc.Label);
            lbNum.string = "\u6682\u672a\u5f00\u542f";
          }
          var sprite = _this["prop" + (index + 1)];
          var node = sprite.node;
          _this._updateIconState(type, node);
        });
      };
      SelectPropCtrl.prototype._updateIconState = function(type, node) {
        var data = M_1.default.runtime.getPropData(type);
        if (!data || data.count <= 0) ; else {
          node.getChildByName("add").active = false;
          var lbNum = node.getChildByName("titleNoOpen").getComponent(cc.Label);
          lbNum.string = data.count.toString();
          cc.log("\u6570\u91cf\uff1a " + data.count);
        }
      };
      SelectPropCtrl.prototype._hideTips = function() {
        this.tipsNode.active = false;
      };
      SelectPropCtrl.prototype._showTips = function(pos, type) {
        this.tipsNode.x = pos.x;
        this.tipsNode.active = true;
        var info = M_1.default.table.PropInfo.getByPrimaryKey(type);
        this.tipsContent.string = info.unlockLv + "\u5173\u5f00\u542f!";
      };
      SelectPropCtrl.prototype._initSelect = function() {
        for (var i = 1; i <= 3; i++) {
          var node = this["prop" + i].node.getChildByName("selected");
          M_1.default.runtime.SelectProp && M_1.default.runtime.SelectProp == Constant_1.PropType.Add3Step + (i - 1) ? node.active = true : node.active = false;
        }
      };
      SelectPropCtrl.prototype.onPropCountChanged = function(type) {
        if (this.node.active && this.node.activeInHierarchy) {
          var index = type - Constant_1.PropType.Add3Step;
          var sprite = this["prop" + (index + 1)];
          this._updateIconState(type, sprite.node);
        }
      };
      SelectPropCtrl.prototype.onClick = function(event, cv) {
        var type = Number(cv);
        var data = M_1.default.runtime.getPropData(type);
        if (M_1.default.runtime.isPropUnLocked(type)) if (!data || data.count <= 0) {
          M_1.default.ui.showUI(UIData_1.UIHudDef.BuyProp, type);
          cc.log("\u9009\u4e2d: " + type);
        } else {
          this._updateSelectPropDisplay(type);
          M_1.default.runtime.SelectProp = type;
          cc.log("\u9009\u4e2ddata.count: " + data.count);
        } else cc.log("\u9009\u4e2d isPropUnLocked: false");
      };
      SelectPropCtrl.prototype._updateSelectPropDisplay = function(type) {
        var index = type - Constant_1.PropType.Add3Step + 1;
        if (M_1.default.runtime.SelectProp == type) {
          var node = this["prop" + (type - Constant_1.PropType.Add3Step + 1)].node.getChildByName("selected");
          true == node.active ? node.active = false : node.active = true;
          true == node.active && (M_1.default.runtime.SelectProp = null);
          var node1 = this["prop" + (type - Constant_1.PropType.Add3Step + 1)].node;
        } else for (var i = 1; i <= 3; i++) {
          var node = this["prop" + i].node.getChildByName("selected");
          node.active = index == i;
          var node1 = this["prop" + i].node;
        }
      };
      __decorate([ property(cc.Sprite) ], SelectPropCtrl.prototype, "prop1", void 0);
      __decorate([ property(cc.Sprite) ], SelectPropCtrl.prototype, "prop2", void 0);
      __decorate([ property(cc.Sprite) ], SelectPropCtrl.prototype, "prop3", void 0);
      __decorate([ property(cc.Node) ], SelectPropCtrl.prototype, "tipsNode", void 0);
      __decorate([ property(cc.Label) ], SelectPropCtrl.prototype, "tipsContent", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], SelectPropCtrl.prototype, "propFrames", void 0);
      SelectPropCtrl = __decorate([ ccclass ], SelectPropCtrl);
      return SelectPropCtrl;
    }(cc.Component);
    exports.default = SelectPropCtrl;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../Data/Const/Constant": "Constant",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData"
  } ],
  Sequence: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "23081ERW3xF8qqQAbIbrc4Y", "Sequence");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Sequence = function() {
      function Sequence() {
        this.counter = 100;
      }
      Sequence.prototype.next = function() {
        return this.counter++;
      };
      Sequence.prototype.nextString = function() {
        return this.next().toString();
      };
      Sequence.prototype.reset = function() {
        this.counter = 1;
      };
      return Sequence;
    }();
    exports.default = Sequence;
    cc._RF.pop();
  }, {} ],
  SettingViewCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "506db6IhrpF84rzEkWUPbLC", "SettingViewCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Constant_1 = require("../../Data/Const/Constant");
    var M_1 = require("../../../Base/Manager/M");
    var Event_1 = require("../../Data/Const/Event");
    var Common_1 = require("../Common");
    var UIData_1 = require("../../Data/Interface/UIData");
    var StorageMgr_1 = require("../../../Base/Manager/StorageMgr");
    var ReportMgr_1 = require("../../../Base/Manager/ReportMgr");
    var GameModel_1 = require("../../Match3/Model/GameModel");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var SettingViewCtrl = function(_super) {
      __extends(SettingViewCtrl, _super);
      function SettingViewCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.soundEffFrames = [];
        _this.musicFrames = [];
        _this.musicSprite = null;
        _this.soundEffSprite = null;
        _this._isOpenPause = false;
        _this._animation = null;
        _this._animationState = null;
        _this._opt = null;
        return _this;
      }
      SettingViewCtrl.prototype.onLoad = function() {
        this._animation = this.node.getComponent(cc.Animation);
        this._animationState = this.node.getComponent(cc.Animation).getAnimationState(this._animation.defaultClip.name);
      };
      SettingViewCtrl.prototype.start = function() {};
      SettingViewCtrl.prototype.onRestartGame = function() {
        var _this = this;
        M_1.default.runtime.GameState <= Constant_1.GameState.Pause && M_1.default.ui.showUI(UIData_1.UIHudDef.SelectShowTarget, {
          type: UIData_1.UIHudDef.SelectShowTarget,
          data: M_1.default.runtime.SelectLevel || null
        }, null, function() {
          _this.onShowPause();
        });
      };
      SettingViewCtrl.prototype.onExitGame = function() {
        M_1.default.ui.closeAllUI();
        var useStep = GameModel_1.default.ins.stepCount - GameModel_1.default.ins.stepLimit;
        ReportMgr_1.default.ins.reportMatchOver(M_1.default.runtime.CurLevel, false, useStep, M_1.default.runtime.MatchGameTime);
        M_1.default.runtime.SelectLevel = 0;
        Common_1.default.jumpScene(Constant_1.Scene.Hotel);
      };
      SettingViewCtrl.prototype.onMusicOpt = function() {
        this._opt.bgm = !this._opt.bgm;
        this._changeMusicBtnState(this._opt.bgm);
      };
      SettingViewCtrl.prototype.onSoundEffOpt = function() {
        this._opt.eff = !this._opt.eff;
        this._changeEffBtnState(this._opt.eff);
      };
      SettingViewCtrl.prototype.onShowPause = function() {
        if (Common_1.default.curScene == Constant_1.Scene.Match && M_1.default.runtime.GameState == Constant_1.GameState.preReady) return;
        this._initSoundOpt();
        this._isOpenPause = !this._isOpenPause;
        this._isOpenPause ? this._animationState.wrapMode = cc.WrapMode.Normal : this._animationState.wrapMode = cc.WrapMode.Reverse;
        this._animationState.play();
      };
      SettingViewCtrl.prototype.onShowBag = function() {
        M_1.default.ui.showUI(UIData_1.UIHudDef.Bag);
      };
      SettingViewCtrl.prototype._initSoundOpt = function() {
        this._opt = StorageMgr_1.StorageMgr.Storage.getObject(Constant_1.NativeKey.Sound, {
          eff: false,
          bgm: true
        });
        this._changeMusicBtnState(this._opt.bgm);
        this._changeEffBtnState(this._opt.eff);
      };
      SettingViewCtrl.prototype._changeMusicBtnState = function(opt) {
        this.musicSprite.spriteFrame = this.musicFrames[opt ? 0 : 1];
        M_1.default.event.send(Event_1.Event.Sound.UpdateOpt, "bgm", opt);
      };
      SettingViewCtrl.prototype._changeEffBtnState = function(opt) {
        this.soundEffSprite.spriteFrame = this.soundEffFrames[opt ? 0 : 1];
        M_1.default.event.send(Event_1.Event.Sound.UpdateOpt, "eff", opt);
      };
      __decorate([ property([ cc.SpriteFrame ]) ], SettingViewCtrl.prototype, "soundEffFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], SettingViewCtrl.prototype, "musicFrames", void 0);
      __decorate([ property(cc.Sprite) ], SettingViewCtrl.prototype, "musicSprite", void 0);
      __decorate([ property(cc.Sprite) ], SettingViewCtrl.prototype, "soundEffSprite", void 0);
      SettingViewCtrl = __decorate([ ccclass ], SettingViewCtrl);
      return SettingViewCtrl;
    }(cc.Component);
    exports.default = SettingViewCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../../Base/Manager/ReportMgr": "ReportMgr",
    "../../../Base/Manager/StorageMgr": "StorageMgr",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../../Data/Interface/UIData": "UIData",
    "../../Match3/Model/GameModel": "GameModel",
    "../Common": "Common"
  } ],
  ShaderHelper: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9d7f37H18xI4qQZLe2GtX08", "ShaderHelper");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property, executeInEditMode = _a.executeInEditMode;
    var ShaderProperty = function() {
      function ShaderProperty() {
        this.key = "";
        this.value = 0;
      }
      __decorate([ property({
        readonly: true
      }) ], ShaderProperty.prototype, "key", void 0);
      __decorate([ property(cc.Float) ], ShaderProperty.prototype, "value", void 0);
      ShaderProperty = __decorate([ ccclass("ShaderProperty") ], ShaderProperty);
      return ShaderProperty;
    }();
    exports.ShaderProperty = ShaderProperty;
    var ShaderEnum = cc.Enum({});
    var ShaderHelper = function(_super) {
      __extends(ShaderHelper, _super);
      function ShaderHelper() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this._program = 0;
        _this._props = [];
        _this.material = null;
        return _this;
      }
      ShaderHelper_1 = ShaderHelper;
      Object.defineProperty(ShaderHelper.prototype, "program", {
        get: function() {
          return this._program;
        },
        set: function(value) {
          if (this._program === value) return;
          this._program = value;
          this.applyEffect();
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(ShaderHelper.prototype, "props", {
        get: function() {
          return this._props;
        },
        set: function(value) {
          this._props = value;
          this.applyEffect();
        },
        enumerable: true,
        configurable: true
      });
      ShaderHelper.prototype.start = function() {
        var _this = this;
        false;
        this.applyEffect();
      };
      ShaderHelper.prototype.applyEffect = function() {
        var sprite = this.node.getComponent(cc.Sprite);
        if (!sprite) return;
        var effectAsset = ShaderHelper_1.effectAssets[this.program];
        var material = cc.Material.create(effectAsset);
        var defineUserTexture = !!effectAsset.shaders.find(function(shader) {
          return shader.defines.find(function(def) {
            return "USE_TEXTURE" === def.name;
          });
        });
        defineUserTexture && material.define("USE_TEXTURE", true);
        material.name = effectAsset.name;
        sprite.setMaterial(0, material);
        this.material = sprite.getMaterial(0);
        this.setProperty(effectAsset);
        this.node.emit("effect-changed", this, this.material);
      };
      ShaderHelper.prototype.setProperty = function(effectAsset) {
        var _this = this;
        var oldProps;
        var keys;
        var values;
        var _loop_1;
        var this_1;
        var i;
        var shaderTimer;
        false;
        this._props.length && this._props.forEach(function(item) {
          return item.key && _this.material.setProperty(item.key, item.value || 0);
        });
        cc.Class.Attr.setClassAttr(ShaderHelper_1, "props", "visible", !!this._props.length);
      };
      ShaderHelper.prototype.next = function() {
        this.program = (this.program + 1) % ShaderHelper_1.effectAssets.length;
      };
      ShaderHelper.prototype.prev = function() {
        if (0 === this.program) {
          this.program = ShaderHelper_1.effectAssets.length - 1;
          return;
        }
        this.program = (this.program - 1) % ShaderHelper_1.effectAssets.length;
      };
      var ShaderHelper_1;
      ShaderHelper.effectAssets = null;
      __decorate([ property ], ShaderHelper.prototype, "_program", void 0);
      __decorate([ property({
        type: ShaderEnum
      }) ], ShaderHelper.prototype, "program", null);
      __decorate([ property({
        type: [ ShaderProperty ]
      }) ], ShaderHelper.prototype, "_props", void 0);
      __decorate([ property({
        type: [ ShaderProperty ]
      }) ], ShaderHelper.prototype, "props", null);
      ShaderHelper = ShaderHelper_1 = __decorate([ ccclass, executeInEditMode ], ShaderHelper);
      return ShaderHelper;
    }(cc.Component);
    exports.default = ShaderHelper;
    cc.game.on(cc.game.EVENT_ENGINE_INITED, function() {
      cc.dynamicAtlasManager.enabled = false;
      cc.loader.loadResDir("effect", cc.EffectAsset, function(error, res) {
        ShaderHelper.effectAssets = res;
        var array = ShaderHelper.effectAssets.map(function(item, i) {
          return {
            name: item._name,
            value: i
          };
        });
        cc.Class.Attr.setClassAttr(ShaderHelper, "program", "enumList", array);
      });
    });
    cc._RF.pop();
  }, {} ],
  ShaderTime: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "4b0c9b6HtpMo4aDeBTmlvUP", "ShaderTime");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ShaderTime = function(_super) {
      __extends(ShaderTime, _super);
      function ShaderTime() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this._max = 65535;
        _this.step = .01;
        _this._start = 0;
        return _this;
      }
      Object.defineProperty(ShaderTime.prototype, "max", {
        get: function() {
          return this._max;
        },
        set: function(value) {
          this._max = value;
          true;
          return;
          var sprite;
          var material;
        },
        enumerable: true,
        configurable: true
      });
      ShaderTime.prototype.update = function(dt) {
        this._material = this.node.getComponent(cc.Sprite).getMaterials()[0];
        this.node.active && this._material && this._material.effect.getProperty("time") && this._setShaderTime(dt);
      };
      ShaderTime.prototype._setShaderTime = function(dt) {
        var start = this._start;
        start > this.max && (start = 0);
        start += this.step;
        this._material.effect.setProperty("time", start);
        this._start = start;
      };
      __decorate([ property ], ShaderTime.prototype, "_max", void 0);
      __decorate([ property ], ShaderTime.prototype, "step", void 0);
      __decorate([ property ], ShaderTime.prototype, "max", null);
      ShaderTime = __decorate([ ccclass ], ShaderTime);
      return ShaderTime;
    }(cc.Component);
    exports.default = ShaderTime;
    cc._RF.pop();
  }, {} ],
  ShareCfg: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "69ffccIvjNJoZqU5tPcbotE", "ShareCfg");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var ShareCfg = function() {
      function ShareCfg(data) {
        this.id = data.id;
        this.shareType = data.shareType;
        this.buildId = data.buildId;
        this.shareImg = data.shareImg;
        this.shareText = data.shareText;
        this.reward = data.reward;
        this.level = data.level;
        this.buildId = data.buildId;
      }
      return ShareCfg;
    }();
    exports.default = ShareCfg;
    cc._RF.pop();
  }, {} ],
  ShareMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "8c89aw6Pl1C9pcG1LKJVQfS", "ShareMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("./M");
    var BaseConst_1 = require("../BaseConst");
    var Paths_1 = require("../Utils/Paths");
    var ShareMgr = function() {
      function ShareMgr() {
        this._shareCdnPath = "";
      }
      Object.defineProperty(ShareMgr, "ins", {
        get: function() {
          null == this.instance && (this.instance = new ShareMgr());
          return this.instance;
        },
        enumerable: true,
        configurable: true
      });
      ShareMgr.prototype.doShareLevel = function(level, next) {
        var config = this.getConfig(level, "level");
        if (config) this.doShare(config.shareText, config.shareImg, next); else {
          console.error("\u62ff\u4e0d\u5230\u5206\u4eab\u914d\u7f6elevel =", level);
          next(false);
        }
      };
      ShareMgr.prototype.doShareBuild = function(buildId, next) {
        var config = this.getConfig(buildId, "buildId");
        if (config) this.doShare(config.shareText, config.shareImg, next); else {
          console.error("\u62ff\u4e0d\u5230\u5206\u4eab\u914d\u7f6ebuildId =", buildId);
          next(false);
        }
      };
      ShareMgr.prototype.LevelFailAddStepShare = function() {
        M_1.default.platform.share("\u5feb\u6765\u4e00\u8d77\u73a9\u6e38\u620f", Paths_1.default.ShareImgPath + "level_share_45.png", 1);
      };
      ShareMgr.prototype.doShare = function(text, img, next) {
        M_1.default.platform.type == BaseConst_1.PlatformType.Web ? next && next(true) : M_1.default.platform.share(text, Paths_1.default.ShareImgPath + img + ".png").then(function(result) {
          next && next(result);
        });
      };
      ShareMgr.prototype.getConfig = function(value, key) {
        var config = M_1.default.table.ShareCfg.getData();
        for (var i = 0; i < config.length; ++i) if (config[i][key] == value) return config[i];
        return null;
      };
      ShareMgr.instance = null;
      return ShareMgr;
    }();
    exports.default = ShareMgr;
    cc._RF.pop();
  }, {
    "../BaseConst": "BaseConst",
    "../Utils/Paths": "Paths",
    "./M": "M"
  } ],
  ShopInfo: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "52d38jpEUtKwJr3Bv9gnOk6", "ShopInfo");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var ShopInfo = function() {
      function ShopInfo(data) {
        this.id = null;
        this.name = null;
        this.flag = null;
        this.res = null;
        this.currencyType = null;
        this.price = null;
        this.content = null;
        this.id = data.id;
        this.name = data.name;
        this.flag = data.flag;
        this.res = data.res;
        this._parsePrice(data.price);
        this._parseContent(data.content);
      }
      ShopInfo.prototype._parsePrice = function(priceCfg) {
        var sc = priceCfg.split("|");
        this.currencyType = Number(sc[0]);
        this.price = Number(sc[1]);
      };
      ShopInfo.prototype._parseContent = function(reward) {
        var _this = this;
        if (reward) {
          this.content = [];
          reward.forEach(function(item) {
            if (item) {
              var sc = item.split("|");
              var type = Number(sc[0]);
              null != type && void 0 != type && _this.content.push({
                type: type,
                count: Number(sc[1])
              });
            }
          });
        }
      };
      return ShopInfo;
    }();
    exports.default = ShopInfo;
    cc._RF.pop();
  }, {} ],
  ShopPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f9accg3Ss1KN7hvavMudbJt", "ShopPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../../Base/UI/UIBase");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var M_1 = require("../../../../Base/Manager/M");
    var ShopToolsItemCtrl_1 = require("./ShopToolsItemCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ShopPanel = function(_super) {
      __extends(ShopPanel, _super);
      function ShopPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.toolsNode = null;
        _this.decNode = null;
        _this.toolsPrefab = null;
        _this.onlyCoinPrefab = null;
        _this.frames = [];
        return _this;
      }
      ShopPanel.prototype.onLoad = function() {};
      ShopPanel.prototype.onInit = function() {
        this.toolsNode.active = false;
        this.onMainBtnChanged({
          node: {
            name: "tools"
          }
        });
      };
      ShopPanel.prototype.onCloseClick = function() {
        M_1.default.ui.hideUI(UIData_1.UIHudDef.ShopPanel);
      };
      ShopPanel.prototype.onShowVideoClick = function() {};
      ShopPanel.prototype.onMainBtnChanged = function(event) {
        switch (event.node.name) {
         case "tools":
          if (!this.toolsNode.active) {
            this.toolsNode.active = true;
            this.decNode.active = false;
            this.initToolsContent();
          }
        }
      };
      ShopPanel.prototype.initToolsContent = function() {
        var _this = this;
        var content = cc.find("view/content", this.toolsNode);
        content.removeAllChildren();
        var singleIndex = null;
        M_1.default.table.ShopInfo.getData().forEach(function(info, index) {
          var node = null;
          if (1 == info.content.length) {
            index = null == singleIndex ? singleIndex = 0 : singleIndex++;
            node = M_1.default.nodePool.createItem(_this.onlyCoinPrefab);
          } else node = M_1.default.nodePool.createItem(_this.toolsPrefab);
          node.parent = content;
          node.getComponent(ShopToolsItemCtrl_1.default).init(info, _this.frames, index);
        });
      };
      __decorate([ property(cc.Node) ], ShopPanel.prototype, "toolsNode", void 0);
      __decorate([ property(cc.Node) ], ShopPanel.prototype, "decNode", void 0);
      __decorate([ property(cc.Prefab) ], ShopPanel.prototype, "toolsPrefab", void 0);
      __decorate([ property(cc.Prefab) ], ShopPanel.prototype, "onlyCoinPrefab", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ShopPanel.prototype, "frames", void 0);
      ShopPanel = __decorate([ ccclass ], ShopPanel);
      return ShopPanel;
    }(UIBase_1.default);
    exports.default = ShopPanel;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../../Base/UI/UIBase": "UIBase",
    "../../../Data/Interface/UIData": "UIData",
    "./ShopToolsItemCtrl": "ShopToolsItemCtrl"
  } ],
  ShopToolsItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "915cbh4SmhLi7MCenfKLAl4", "ShopToolsItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common");
    var MoneyManager_1 = require("../../../Data/MoneyManager");
    var M_1 = require("../../../../Base/Manager/M");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ShopToolsItemCtrl = function(_super) {
      __extends(ShopToolsItemCtrl, _super);
      function ShopToolsItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.title = null;
        _this.bg = null;
        _this.flag = null;
        _this.icon = null;
        _this.unit = null;
        _this.singleCount = null;
        _this.price = null;
        _this.propItemPrefab = null;
        _this.content = null;
        _this.nameFrames = [];
        _this.flagFrames = [];
        _this.bgFrames = [];
        _this._data = null;
        _this._frames = null;
        return _this;
      }
      ShopToolsItemCtrl.prototype.onLoad = function() {};
      ShopToolsItemCtrl.prototype.init = function(info, frames, index) {
        var _this = this;
        this._frames = frames;
        this._data = info;
        if (info) {
          this.unit.spriteFrame = this._getRewardIcon(info.currencyType);
          this.title && (this.title.spriteFrame = this.nameFrames[index]);
          this.price.string = "x " + info.price.toString();
          this.flag && (info.flag ? this.flag.spriteFrame = this.flagFrames[info.flag] : this.flag.node.active = false);
          this.bg && (this.bg.spriteFrame = this.bgFrames[index] || this.bgFrames[this.bgFrames.length - 1]);
          if (this.content) {
            info.res && this.icon && Common_1.default.getRemotPic(info.res, this.icon.node.getContentSize()).then(function(frame) {
              frame && (_this.icon.spriteFrame = frame);
            });
            if (info.content && info.content.length > 0) {
              this.content.removeAllChildren();
              info.content.forEach(function(itemData) {
                _this._createContentItem(itemData);
              });
            }
          } else {
            this.icon.spriteFrame = this.nameFrames[index];
            this.singleCount.string = info.content[0].count.toString();
          }
        }
      };
      ShopToolsItemCtrl.prototype.onBuyClick = function() {
        var _this = this;
        var result = MoneyManager_1.MoneyManager.CheckMoney(this._data.currencyType, this._data.price, true);
        result && this._data.content.forEach(function(item) {
          _this._setItem(item);
        });
      };
      ShopToolsItemCtrl.prototype._createContentItem = function(data) {
        var item = cc.instantiate(this.propItemPrefab);
        item.parent = this.content;
        var iconNode = item.getChildByName("icon");
        iconNode.getComponent(cc.Sprite).spriteFrame = this._getRewardIcon(data.type);
        var value = data.count.toString();
        if (data.type < 100) {
          value = Common_1.default.bytesToSize(data.count);
          iconNode.scale = .5;
        }
        item.getChildByName("count").getComponent(cc.Label).string = "x" + value;
      };
      ShopToolsItemCtrl.prototype._setItem = function(item) {
        var type = Number(item.type);
        type >= 100 ? M_1.default.runtime.updatePropCount(type, item.count) : M_1.default.runtime.addCurrency(type, item.count);
      };
      ShopToolsItemCtrl.prototype._getRewardIcon = function(type) {
        var result = null;
        result = type >= 100 ? this._frames[type - 100] : this._frames[type + 20];
        return result;
      };
      __decorate([ property(cc.Sprite) ], ShopToolsItemCtrl.prototype, "title", void 0);
      __decorate([ property(cc.Sprite) ], ShopToolsItemCtrl.prototype, "bg", void 0);
      __decorate([ property(cc.Sprite) ], ShopToolsItemCtrl.prototype, "flag", void 0);
      __decorate([ property(cc.Sprite) ], ShopToolsItemCtrl.prototype, "icon", void 0);
      __decorate([ property(cc.Sprite) ], ShopToolsItemCtrl.prototype, "unit", void 0);
      __decorate([ property(cc.Label) ], ShopToolsItemCtrl.prototype, "singleCount", void 0);
      __decorate([ property(cc.Label) ], ShopToolsItemCtrl.prototype, "price", void 0);
      __decorate([ property(cc.Prefab) ], ShopToolsItemCtrl.prototype, "propItemPrefab", void 0);
      __decorate([ property(cc.Node) ], ShopToolsItemCtrl.prototype, "content", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ShopToolsItemCtrl.prototype, "nameFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ShopToolsItemCtrl.prototype, "flagFrames", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], ShopToolsItemCtrl.prototype, "bgFrames", void 0);
      ShopToolsItemCtrl = __decorate([ ccclass ], ShopToolsItemCtrl);
      return ShopToolsItemCtrl;
    }(cc.Component);
    exports.default = ShopToolsItemCtrl;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../Data/MoneyManager": "MoneyManager",
    "../../Common": "Common"
  } ],
  ShowBuildTool: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "93a8eCmwwhEL6A0bQ/SszKC", "ShowBuildTool");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../../../../Base/Manager/EventMgr");
    var Event_1 = require("../../../Data/Const/Event");
    var Exchange_1 = require("./Exchange");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var ShowBuildTool = function(_super) {
      __extends(ShowBuildTool, _super);
      function ShowBuildTool() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.lockNode = null;
        return _this;
      }
      ShowBuildTool.prototype.onLoad = function() {
        this.mapCamera = cc.Camera.findCamera(this.node);
        var collider = this.node.getComponent(cc.PolygonCollider);
        collider && (this.points = collider.points);
        this.rect = this.node.getBoundingBoxToWorld();
        this.node.on(cc.Node.EventType.TOUCH_END, this.checkClick, this);
        EventMgr_1.default.ins.register(Event_1.Event.Map.UnLock, this.hideLock, this);
        EventMgr_1.default.ins.register(Event_1.Event.Map.ShowLock, this.showLock, this);
      };
      ShowBuildTool.prototype.start = function() {
        this.exchange = this.node.parent.parent.getComponent(Exchange_1.default);
        this.showLock();
      };
      ShowBuildTool.prototype.onDestroy = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.UnLock, this.hideLock, this);
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.ShowLock, this.showLock, this);
        this.node.off(cc.Node.EventType.TOUCH_END, this.checkClick, this);
      };
      ShowBuildTool.prototype.showLock = function() {
        if (0 == this.exchange.lockState && this.lockNode) {
          this.lockNode.active = true;
          this.lockNode.on(cc.Node.EventType.TOUCH_END, this.unlockClick, this);
          this.lockPos = this.lockNode.convertToWorldSpaceAR(cc.v2(0, 60));
          EventMgr_1.default.ins.unRegister(Event_1.Event.Map.ShowLock, this.showLock, this);
        }
      };
      ShowBuildTool.prototype.hideLock = function() {
        if (1 == this.exchange.lockState && this.lockNode) {
          this.lockNode.off(cc.Node.EventType.TOUCH_END, this.unlockClick, this);
          this.lockNode.removeFromParent();
          this.lockNode.destroy();
        }
      };
      ShowBuildTool.prototype.getRectInMapCamera = function() {
        var rect = this.rect;
        var mapCamera = this.mapCamera;
        var curZoomRatio = mapCamera.zoomRatio;
        var nodeInCameraPos = mapCamera.getWorldToScreenPoint(rect.origin, cc.Vec2.ZERO);
        return cc.rect(nodeInCameraPos.x, nodeInCameraPos.y, rect.width * curZoomRatio, rect.height * curZoomRatio);
      };
      ShowBuildTool.prototype.checkClick = function(event) {
        var rect = this.getRectInMapCamera();
        var location = event.getLocation();
        if (event.getStartLocation().sub(location).mag() < 1 && rect.contains(location)) {
          var touchPointInNode = location.sub(rect.center).mul(1 / this.mapCamera.zoomRatio);
          if (cc.Intersection.pointInPolygon(touchPointInNode, this.points)) {
            this.node._touchListener.setSwallowTouches(true);
            EventMgr_1.default.ins.send(Event_1.Event.Map.ShowTool, location, this.node.parent);
          } else this.node._touchListener.setSwallowTouches(false);
        }
      };
      ShowBuildTool.prototype.unlockClick = function(event) {
        if (event.getStartLocation().sub(event.getLocation()).mag() < 1) {
          var position = this.mapCamera.getWorldToScreenPoint(this.lockPos);
          EventMgr_1.default.ins.send(Event_1.Event.Map.ShowTool, position, this.node.parent);
        }
      };
      __decorate([ property(cc.Node) ], ShowBuildTool.prototype, "lockNode", void 0);
      ShowBuildTool = __decorate([ ccclass ], ShowBuildTool);
      return ShowBuildTool;
    }(cc.Component);
    exports.default = ShowBuildTool;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Data/Const/Event": "Event",
    "./Exchange": "Exchange"
  } ],
  SingletonFactory: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f2ab1LSQVlPKZsVS0JD8Bn6", "SingletonFactory");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SingletonFactory = function() {
      function SingletonFactory() {}
      SingletonFactory.getInstance = function(c) {
        if (!SingletonFactory.instances.has(c)) {
          var obj = new c();
          SingletonFactory.instances.set(c, obj);
          return obj;
        }
        return SingletonFactory.instances.get(c);
      };
      SingletonFactory.instances = new Map();
      return SingletonFactory;
    }();
    exports.SingletonFactory = SingletonFactory;
    cc._RF.pop();
  }, {} ],
  SlideButton: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "fb316Sfe3dKOYmAJ3fiEojP", "SlideButton");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var SlideButton = function(_super) {
      __extends(SlideButton, _super);
      function SlideButton() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.openSprite = null;
        _this.closeSprite = null;
        _this.bar = null;
        _this.eventHandler = null;
        _this._isOpen = true;
        _this._isPlaying = false;
        return _this;
      }
      SlideButton.prototype.onLoad = function() {
        this._isOpen = true;
        this._isPlaying = false;
      };
      SlideButton.prototype._change = function(isNeedPlayAction) {
        void 0 === isNeedPlayAction && (isNeedPlayAction = true);
        if (this._isOpen) {
          this.openSprite.node.active = true;
          this.closeSprite.node.active = false;
        } else {
          this.openSprite.node.active = false;
          this.closeSprite.node.active = true;
        }
        if (isNeedPlayAction) this._playMoveBarAction(); else {
          this.eventHandler.emit([ this._isOpen ]);
          (!this._isOpen || this._isOpen && false == this.bar.node["open"]) && this._playMoveBarAction();
        }
      };
      SlideButton.prototype._playMoveBarAction = function() {
        var _this = this;
        var distance = this.openSprite.node.width / 2;
        if (this.bar.node["open"] != this._isOpen) {
          this._isOpen || (distance = -distance);
          this._isPlaying = true;
          this.bar.node["open"] = this._isOpen;
          this.bar.node.runAction(cc.sequence(cc.moveBy(.1, cc.v2(distance, 0)), cc.callFunc(function() {
            _this._isPlaying = false;
            _this.eventHandler.emit([ _this._isOpen ]);
          }, this)));
        }
      };
      SlideButton.prototype.onChange = function(event, opt) {
        void 0 === opt && (opt = null);
        if (this._isPlaying) return;
        var isMove = true;
        if (null != opt) {
          this._isOpen = opt;
          isMove = false;
        } else this._isOpen = !this._isOpen;
        this._change(isMove);
      };
      __decorate([ property(cc.Sprite) ], SlideButton.prototype, "openSprite", void 0);
      __decorate([ property(cc.Sprite) ], SlideButton.prototype, "closeSprite", void 0);
      __decorate([ property(cc.Sprite) ], SlideButton.prototype, "bar", void 0);
      __decorate([ property(cc.Component.EventHandler) ], SlideButton.prototype, "eventHandler", void 0);
      SlideButton = __decorate([ ccclass ], SlideButton);
      return SlideButton;
    }(cc.Component);
    exports.default = SlideButton;
    cc._RF.pop();
  }, {} ],
  SlotBonusCfg: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "0988391KWZALLsNi4mWLmok", "SlotBonusCfg");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SlotBonusCfg = function() {
      function SlotBonusCfg(data) {
        this.id = null;
        this.roomId = null;
        this.count = null;
        this.bonus = null;
        this.id = data.id;
        this.roomId = data.roomId;
        this.count = data.count;
        this.bonus = data.bonus;
      }
      return SlotBonusCfg;
    }();
    exports.default = SlotBonusCfg;
    cc._RF.pop();
  }, {} ],
  Socket: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "005admXZVhMQretsIbDKX6n", "Socket");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var NetBase_1 = require("./NetBase");
    var Log_1 = require("../Utils/Log");
    var AutoHearBeat = true;
    var HeartBeatGapTime = 3e4;
    var ReConnectGapTime = 1e3;
    var Scoket = function(_super) {
      __extends(Scoket, _super);
      function Scoket(url, data) {
        void 0 === data && (data = null);
        var _this = _super.call(this) || this;
        _this.ws = null;
        _this.data = null;
        _this.connectCallBack = null;
        _this.heartBeatTimer = null;
        _this.reConnectTimer = null;
        _this.url = url;
        _this.data = data;
        return _this;
      }
      Scoket.prototype.connect = function() {
        var _this = this;
        return new Promise(function(resolve) {
          _this.connectCallBack = resolve;
          _this.createWebSocket();
        });
      };
      Scoket.prototype.disconnect = function() {
        this.destoryWs();
      };
      Scoket.prototype.send = function(pack) {
        this.isReady && this.ws.readyState == WebSocket.OPEN ? this.ws.send(pack) : Log_1.Log.e("Error websocket \u72b6\u6001\u5f02\u5e38!", this.isReady, this.ws.readyState);
      };
      Scoket.prototype.createWebSocket = function() {
        this.ws = new WebSocket(this.url);
        this.ws.binaryType = "arraybuffer";
        this.ws.onopen = this.onOpen.bind(this);
        this.ws.onmessage = this.onMessage.bind(this);
        this.ws.onclose = this.onClose.bind(this);
        this.ws.onerror = this.onError.bind(this);
      };
      Scoket.prototype.onOpen = function(evt) {
        Log_1.Log.d("ws " + this.url + " opened");
        this.ws === evt.target && this.onConnected();
      };
      Scoket.prototype.onClose = function(evt) {
        Log_1.Log.d("ws " + this.url + " close");
        this.destoryWs();
        this.checkIsNeedReConnect();
      };
      Scoket.prototype.onError = function(evt) {
        Log_1.Log.d("ws " + this.url + " error", evt);
        this.destoryWs();
        this.checkIsNeedReConnect();
      };
      Scoket.prototype.onMessage = function(msg) {
        console.info("onMessage:", msg.data);
      };
      Scoket.prototype.onSendHeartBeat = function() {
        this.send("HeartBeat");
      };
      Scoket.prototype.onConnected = function() {
        this._isReady = true;
        this.retryCount = 0;
        AutoHearBeat && this.scheduleHeartBeat();
        if (this.connectCallBack) {
          this.connectCallBack();
          this.connectCallBack = null;
        }
      };
      Scoket.prototype.onReConnect = function() {
        if (this.ws || this._isReady) this.unScheduleReConnect(); else {
          this.retryCount++;
          this.connect();
        }
      };
      Scoket.prototype.destoryWs = function() {
        this._isReady = false;
        this.unScheduleHeartBeat();
        this.unScheduleReConnect();
        if (this.ws) {
          this.ws.onopen = null;
          this.ws.onmessage = null;
          this.ws.onclose = null;
          this.ws.onerror = null;
          this.ws.readyState !== WebSocket.CLOSING && this.ws.readyState !== WebSocket.CLOSED && this.ws.close(3e3, "client close .");
        }
        this.ws = null;
      };
      Scoket.prototype.checkIsNeedReConnect = function() {
        this.isAutoRetry && this.scheduleReConnect();
      };
      Scoket.prototype.scheduleReConnect = function() {
        this.unScheduleReConnect();
        this.reConnectTimer = setInterval(this.onReConnect.bind(this), ReConnectGapTime);
      };
      Scoket.prototype.unScheduleReConnect = function() {
        clearInterval(this.reConnectTimer);
      };
      Scoket.prototype.scheduleHeartBeat = function() {
        this.unScheduleHeartBeat();
        this.heartBeatTimer = setInterval(this.onSendHeartBeat.bind(this), HeartBeatGapTime);
      };
      Scoket.prototype.unScheduleHeartBeat = function() {
        clearInterval(this.heartBeatTimer);
      };
      return Scoket;
    }(NetBase_1.default);
    exports.default = Scoket;
    cc._RF.pop();
  }, {
    "../Utils/Log": "Log",
    "./NetBase": "NetBase"
  } ],
  SpecialCell: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "40461ekjJhLq4IseYa6K4J5", "SpecialCell");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Constant_1 = require("../../Data/Const/Constant");
    var SpecialCell = function() {
      function SpecialCell(type, lv) {
        this._type = Constant_1.UpGroundType.None;
        this._lv = 0;
        this.plug = null;
        this._type = type;
        this._lv = lv;
        this.initPlug();
      }
      SpecialCell.prototype.initPlug = function() {
        switch (this.type) {
         case Constant_1.UpGroundType.Box:
         case Constant_1.UpGroundType.Ice:
         case Constant_1.UpGroundType.Lock:
          this.plug = null;
        }
      };
      Object.defineProperty(SpecialCell.prototype, "lv", {
        get: function() {
          return this._lv;
        },
        enumerable: true,
        configurable: true
      });
      SpecialCell.prototype.setLv = function(num) {
        this._lv += num;
        this._lv = this._lv < 0 ? 0 : this._lv;
        return this._lv;
      };
      Object.defineProperty(SpecialCell.prototype, "type", {
        get: function() {
          return this._type;
        },
        enumerable: true,
        configurable: true
      });
      SpecialCell.prototype.getFeaturePlug = function() {
        return this.plug;
      };
      return SpecialCell;
    }();
    exports.default = SpecialCell;
    cc._RF.pop();
  }, {
    "../../Data/Const/Constant": "Constant"
  } ],
  SpinePlayerCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "6a7017uvUJEoKGgXET9l4Ei", "SpinePlayerCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var SpinePlayerCtrl = function(_super) {
      __extends(SpinePlayerCtrl, _super);
      function SpinePlayerCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.callback = null;
        _this.frameCallback = null;
        _this._curPlayName = null;
        _this._timeout = null;
        return _this;
      }
      SpinePlayerCtrl.prototype.onLoad = function() {
        this.setCompleteListener(this._handleAniCompleteEvent.bind(this));
        this.setEventListener(this._handleFrameEvent.bind(this));
      };
      SpinePlayerCtrl.prototype.play = function(name, trackIndex, isloop, callback, frameEventCallback, nextData) {
        void 0 === isloop && (isloop = false);
        this.callback = callback;
        this.frameCallback = frameEventCallback;
        this.node.active = true;
        this._curPlayName = name;
        this.setAnimation(trackIndex, name, isloop);
        nextData && this.addAnimation(0, nextData.name, nextData.loop, 0);
      };
      SpinePlayerCtrl.prototype.isStopSpine = function(isPaused) {
        this.paused = isPaused;
      };
      SpinePlayerCtrl.prototype._handleAniCompleteEvent = function(trackEntry, loopCount) {
        clearTimeout(this._timeout);
        this._curPlayName = null;
        this.callback && this.callback();
      };
      SpinePlayerCtrl.prototype._handleFrameEvent = function(event) {
        this.frameCallback && this.frameCallback(event);
      };
      SpinePlayerCtrl.prototype.onDestroy = function() {
        this.callback = null;
        this.frameCallback = null;
      };
      SpinePlayerCtrl.prototype._setMix = function(anim1, anim2) {
        this.setMix(anim1, anim2, .5);
        this.setMix(anim2, anim1, .5);
      };
      Object.defineProperty(SpinePlayerCtrl.prototype, "curPlay", {
        get: function() {
          return this._curPlayName;
        },
        enumerable: true,
        configurable: true
      });
      SpinePlayerCtrl = __decorate([ ccclass ], SpinePlayerCtrl);
      return SpinePlayerCtrl;
    }(sp.Skeleton);
    exports.default = SpinePlayerCtrl;
    cc._RF.pop();
  }, {} ],
  StorageMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "5b1afnYUzFKvqBU0fpIMh4E", "StorageMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var NetMgr_1 = require("./NetMgr");
    var PlatformMgr_1 = require("./PlatformMgr");
    var BaseConst_1 = require("../BaseConst");
    var FLUSH_2_NET_TIME = 3e3;
    var StorageMgr;
    (function(StorageMgr) {
      var Storage = function() {
        function Storage() {}
        Storage.init = function(res) {
          if (res) for (var key in res) Storage.setStorage(key, res[key]);
          if (Storage._flushTimer) {
            clearInterval(Storage._flushTimer);
            Storage._flushTimer = null;
          }
          Storage._flushTimer = setInterval(Storage.flush, FLUSH_2_NET_TIME);
        };
        Storage.setStorage = function(key, data, syncRemote) {
          void 0 === syncRemote && (syncRemote = false);
          null == data && (data = "");
          "object" == typeof data && (data = JSON.stringify(data));
          syncRemote && Storage._awaitServerStorages.set(key + "", data);
          Storage._setLocalStorageData(key, data);
        };
        Storage.setObject = function(key, data, syncRemote) {
          void 0 === syncRemote && (syncRemote = false);
          null == data && (data = {});
          try {
            data = JSON.stringify(data);
          } catch (e) {
            data = {};
          }
          Storage.setStorage(key, data, syncRemote);
        };
        Storage.setInt = function(key, data, syncRemote) {
          void 0 === syncRemote && (syncRemote = false);
          Storage.setStorage(key, data || 0, syncRemote);
        };
        Storage.setFloat = function(key, data, syncRemote) {
          void 0 === syncRemote && (syncRemote = false);
          data || (data = 0);
          Storage.setStorage(key, data, syncRemote);
        };
        Storage.setBoolean = function(key, data, syncRemote) {
          void 0 === syncRemote && (syncRemote = false);
          var value = data ? "1" : "0";
          Storage.setStorage(key, value, syncRemote);
        };
        Storage.setString = function(key, data, syncRemote) {
          void 0 === syncRemote && (syncRemote = false);
          Storage.setStorage(key, data || "", syncRemote);
        };
        Storage.getStorage = function(key, defData) {
          return Storage._getLocalStorageData(key, defData);
        };
        Storage.getObject = function(key, defData) {
          var value = Storage._getLocalStorageData(key, defData);
          if (!value) return defData;
          var type = typeof value;
          if ("object" == type) return value;
          "string" != type && (value = String(value));
          try {
            value = JSON.parse(value);
          } catch (e) {}
          return value || defData;
        };
        Storage.getString = function(key, defData) {
          var value = Storage._getLocalStorageData(key, defData);
          if (!value) return defData;
          return String(value);
        };
        Storage.getInt = function(key, defData) {
          var value = Storage._getLocalStorageData(key, defData);
          if (!value) return defData;
          var type = typeof value;
          try {
            value = "string" == type ? parseInt(value) : Number(value);
          } catch (e) {}
          return null != value && "undefined" != typeof value ? value : defData;
        };
        Storage.getStorageFloat = function(key, defData) {
          var value = Storage._getLocalStorageData(key, defData);
          if (!value) return defData;
          var type = typeof value;
          try {
            value = "string" == type ? parseFloat(value) : Number(value);
          } catch (e) {}
          return null != value && "undefined" != typeof value ? value : defData;
        };
        Storage.removeAll = function() {
          if (PlatformMgr_1.default.ins.type == BaseConst_1.PlatformType.Web) {
            var data = cc.sys.localStorage;
            for (var i = 0; i < data.length; ++i) {
              if ("__userId" == data.key(i)) continue;
              data.removeItem(data.key(i));
              i -= 1;
            }
          } else cc.sys.localStorage.clear();
        };
        Storage.getBoolean = function(key, defData) {
          var value = Storage._getLocalStorageData(key, defData);
          if (!value) return defData;
          var type = typeof value;
          try {
            value = "string" == type ? "true" == value || "1" == value : Boolean(value);
          } catch (e) {}
          return null != value && "undefined" != typeof value ? value : defData;
        };
        Storage.removeStorage = function(key, syncRemote) {
          void 0 === syncRemote && (syncRemote = false);
          syncRemote && Storage._awaitServerStorages.set(key + "", "");
          Storage._removeStorageData(key);
        };
        Storage.flush = function() {
          if (0 == Storage._awaitServerStorages.size) return;
          var data = {};
          Storage._awaitServerStorages.forEach(function(v, k) {
            data[k] = v;
          });
          NetMgr_1.default.ins.putUserData(data).then(function(result) {});
          Storage._awaitServerStorages.clear();
        };
        Storage._getLocalStorageData = function(key, defData) {
          var data = Storage._localStorages.get(key + "");
          if (data) return data;
          data = cc.sys.localStorage.getItem(key + "");
          return data || defData;
        };
        Storage._setLocalStorageData = function(key, data) {
          Storage._localStorages.set(key + "", data);
          cc.sys.localStorage.setItem(key + "", data);
        };
        Storage._removeStorageData = function(key) {
          Storage._localStorages.delete(key + "");
          cc.sys.localStorage.removeItem(key + "");
        };
        Storage.BuildingState = "_island";
        Storage.GuideIds = "_guideMap";
        Storage.HotelData = "_hotelDatas";
        Storage._localStorages = new Map();
        Storage._awaitServerStorages = new Map();
        Storage._flushTimer = null;
        return Storage;
      }();
      StorageMgr.Storage = Storage;
      var RingStorage = function() {
        function RingStorage(key) {
          this.__RING_KEY__ = "";
          this.__RING_KEY__ = key;
        }
        RingStorage.prototype.getNowTime = function() {
          return Date.now();
        };
        RingStorage._g = function(k) {
          null == RingStorage._rs && (RingStorage._rs = new Map());
          var s = RingStorage._rs.get(k);
          if (!s) {
            s = new RingStorage(k);
            RingStorage._rs.set(k, s);
          }
          return s;
        };
        RingStorage.day = function() {
          return RingStorage._g(RingStorage.DAY_KEY);
        };
        RingStorage.week = function() {
          return RingStorage._g(RingStorage.WEEK_KEY);
        };
        RingStorage.month = function() {
          return RingStorage._g(RingStorage.MONTH_KEY);
        };
        RingStorage.prototype.createTimestamp = function() {
          var d = new Date(this.getNowTime());
          if (this.__RING_KEY__ == RingStorage.MONTH_KEY) return d.getFullYear() << 16 | d.getMonth() << 8;
          if (this.__RING_KEY__ == RingStorage.WEEK_KEY) {
            d.setHours(0);
            d.setMinutes(0);
            d.setSeconds(0);
            return d.getTime();
          }
          return d.getFullYear() << 16 | d.getMonth() << 8 | d.getDate();
        };
        RingStorage.prototype.diffDay = function(t) {
          var d = new Date(this.getNowTime());
          d.setHours(0);
          d.setMinutes(0);
          d.setSeconds(0);
          return (d.getTime() - t) / 864e5;
        };
        RingStorage.prototype.getStorageData = function() {
          var changed = false;
          var t = this.createTimestamp();
          var data = Storage.getObject(this.__RING_KEY__, {
            t: 0,
            d: {}
          });
          changed = this.__RING_KEY__ == RingStorage.WEEK_KEY ? this.diffDay(data.t) > 7 : data.t != t;
          if (changed) {
            data.t = t;
            data.d = {};
            Storage.setObject(this.__RING_KEY__, data);
          }
          return data;
        };
        RingStorage.prototype.deleteValue = function(key) {
          key = key.toString();
          var data = this.getStorageData();
          delete data[key];
          Storage.setObject(this.__RING_KEY__, data);
        };
        RingStorage.prototype.setValue = function(key, value) {
          key = key.toString();
          var data = this.getStorageData();
          data.d[key] = value;
          Storage.setObject(this.__RING_KEY__, data);
        };
        RingStorage.prototype.getValue = function(key, defVal) {
          key = key.toString();
          var data = this.getStorageData();
          var value = data.d[key];
          if (null == value) return defVal;
          return value;
        };
        RingStorage.DAY_KEY = "__RING_DAY_KEY__";
        RingStorage.WEEK_KEY = "__RING_WEEK_KEY__";
        RingStorage.MONTH_KEY = "__RING_MONTH_KEY__";
        return RingStorage;
      }();
      StorageMgr.RingStorage = RingStorage;
    })(StorageMgr = exports.StorageMgr || (exports.StorageMgr = {}));
    cc._RF.pop();
  }, {
    "../BaseConst": "BaseConst",
    "./NetMgr": "NetMgr",
    "./PlatformMgr": "PlatformMgr"
  } ],
  StoryTalkPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "58d92lSMeNGDqIKCG56jWt0", "StoryTalkPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var UIMgr_1 = require("../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../Data/Interface/UIData");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var StoryTalkPanel = function(_super) {
      __extends(StoryTalkPanel, _super);
      function StoryTalkPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.panel = null;
        _this.leftName = null;
        _this.rightName = null;
        _this.contentLab = null;
        _this.leftIcon = null;
        _this.rightIcon = null;
        _this.roleIcons = [];
        _this._currentIndex = 0;
        _this._storyData = null;
        return _this;
      }
      StoryTalkPanel.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
      };
      StoryTalkPanel.prototype.start = function() {};
      StoryTalkPanel.prototype.onShow = function(closeCallBack) {
        _super.prototype.onShow.call(this, closeCallBack);
      };
      StoryTalkPanel.prototype.onInit = function(storyData) {
        this._currentIndex = 0;
        this._storyData = storyData;
        this.showNext();
      };
      StoryTalkPanel.prototype.showNext = function() {
        if (this._storyData) {
          var sd = this._storyData.storys[this._currentIndex];
          if (sd) {
            this.contentLab.string = sd.content;
            sd.isLeft ? this.showLeft(sd.rid, sd.name) : this.showRight(sd.rid, sd.name);
            this._currentIndex++;
          } else UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.StoryTalkPanel);
        }
      };
      StoryTalkPanel.prototype.showLeft = function(roleId, name) {
        this.leftIcon.node.active = true;
        this.leftName.node.parent.active = true;
        this.rightIcon.node.active = false;
        this.rightName.node.parent.active = false;
        this.leftName.string = name;
        this.leftIcon.spriteFrame = this.roleIcons[roleId];
      };
      StoryTalkPanel.prototype.showRight = function(roleId, name) {
        this.leftIcon.node.active = false;
        this.leftName.node.parent.active = false;
        this.rightIcon.node.active = true;
        this.rightName.node.parent.active = true;
        this.rightName.string = name;
        this.rightIcon.spriteFrame = this.roleIcons[roleId];
      };
      StoryTalkPanel.prototype.onContinueClick = function() {
        this.showNext();
      };
      __decorate([ property(cc.Node) ], StoryTalkPanel.prototype, "panel", void 0);
      __decorate([ property(cc.Label) ], StoryTalkPanel.prototype, "leftName", void 0);
      __decorate([ property(cc.Label) ], StoryTalkPanel.prototype, "rightName", void 0);
      __decorate([ property(cc.Label) ], StoryTalkPanel.prototype, "contentLab", void 0);
      __decorate([ property(cc.Sprite) ], StoryTalkPanel.prototype, "leftIcon", void 0);
      __decorate([ property(cc.Sprite) ], StoryTalkPanel.prototype, "rightIcon", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], StoryTalkPanel.prototype, "roleIcons", void 0);
      StoryTalkPanel = __decorate([ ccclass ], StoryTalkPanel);
      return StoryTalkPanel;
    }(UIBase_1.default);
    exports.default = StoryTalkPanel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/UIMgr": "UIMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../Data/Interface/UIData": "UIData"
  } ],
  TTMask: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "7f0b7zqwTFPLbUCU91kQsEV", "TTMask");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, inspector = _a.inspector;
    var TTMask = function(_super) {
      __extends(TTMask, _super);
      function TTMask() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this._curPoints = [];
        _this._polygonCom = null;
        return _this;
      }
      TTMask.prototype.updateMask = function() {
        var graphics = this["_graphics"];
        graphics.clear(false);
        for (var i = 0; i < this._curPoints.length; ++i) {
          var point = this._curPoints[i];
          0 === i ? graphics.moveTo(point.x, point.y) : graphics.lineTo(point.x, point.y);
        }
        graphics.close();
        graphics.fill();
      };
      TTMask.prototype._compareArray = function(arr1, arr2) {
        var result = true;
        if (arr1 !== arr2 || arr1.length != arr2.length) result = false; else for (var i = 0; i < arr1.length; i++) {
          var p1 = arr1[i];
          var p2 = arr2[i];
          if (p1.x !== p2.x || p1.y !== p2.y) {
            result = false;
            break;
          }
        }
        return result;
      };
      TTMask.prototype.onEnable = function() {
        var _this = this;
        _super.prototype.onEnable.call(this);
        this._polygonCom = this.node.getComponent(cc.PolygonCollider);
        this.scheduleOnce(function() {
          _this.updateMask();
        }, 0);
      };
      TTMask.prototype.update = function() {
        if (this._polygonCom && !this._compareArray(this._polygonCom.points, this._curPoints)) {
          this._curPoints = this._polygonCom.points;
          this.updateMask();
        }
      };
      TTMask = __decorate([ ccclass, inspector("packages://CustomComponent/mask.js") ], TTMask);
      return TTMask;
    }(cc.Mask);
    exports.default = TTMask;
    cc._RF.pop();
  }, {} ],
  TalkPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "ae3ff8/VF9IIqh4U9Hc8x6p", "TalkPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Log_1 = require("../../../../Base/Utils/Log");
    var UIBase_1 = require("../../../../Base/UI/UIBase");
    var UIMgr_1 = require("../../../../Base/Manager/UIMgr");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var JumpUtils_1 = require("../JumpUtils");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var REG = /[\u4E00-\u9FFF\u3400-\u4DFF]|[a-z]+[\-\']?[a-z]*|(^\s+)|(\s+$)|\s+|[!,.:;'}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01\uff1a\uff1b]|....../gi;
    var TalkPanel = function(_super) {
      __extends(TalkPanel, _super);
      function TalkPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.text = null;
        _this.bg = null;
        _this.role = null;
        _this.roleName = null;
        _this.other = null;
        _this.otherName = null;
        _this.talkFrame = null;
        _this.chatto = null;
        _this.curStoryId = null;
        _this.curIdx = 0;
        _this.autoNext = true;
        _this.configPath = "config/story/";
        _this.backgroundPath = "texture/story/bg/";
        _this.roleMap = new Map();
        _this.bgMap = new Map();
        _this.storyMap = new Map();
        return _this;
      }
      TalkPanel.prototype.onUILoad = function() {
        var _this = this;
        cc.loader.loadRes(this.configPath + "role", cc.JsonAsset, function(err, resource) {
          if (err) {
            Log_1.Log.error(_this.configPath + "role\u52a0\u8f7d\u4e0d\u6210\u529f");
            return;
          }
          var roleData = resource.json;
          for (var rid in roleData) _this.roleMap.set(rid, roleData[rid]);
          cc.loader.loadRes(_this.configPath + "background", cc.JsonAsset, function(err, resource) {
            if (err) {
              Log_1.Log.error(_this.configPath + "background\u52a0\u8f7d\u4e0d\u6210\u529f");
              return;
            }
            var bgData = resource.json;
            for (var bgId in bgData) _this.bgMap.set(bgId, bgData[bgId]);
            cc.loader.loadRes(_this.configPath + "story", cc.JsonAsset, function(err, resource) {
              if (err) {
                Log_1.Log.error(_this.configPath + "story\u52a0\u8f7d\u4e0d\u6210\u529f");
                return;
              }
              var storyData = resource.json;
              for (var id in storyData) _this.storyMap.set(id, storyData[id]);
              null != _this.curStoryId && _this.showNext();
            });
          });
        });
      };
      TalkPanel.prototype.onInit = function(storyId) {
        this.curStoryId = storyId;
        this.curIdx = 0;
      };
      TalkPanel.prototype.onShow = function() {
        this.node.on(cc.Node.EventType.TOUCH_END, this.showNext, this);
        this.showNext();
      };
      TalkPanel.prototype.showNext = function() {
        var story = this.storyMap.get(this.curStoryId);
        if (!story) return;
        var content = story.content;
        if (!content || this.curIdx > content.length) {
          this.node.off(cc.Node.EventType.TOUCH_END, this.showNext, this);
          this.role.node.active = false;
          this.other.node.active = false;
          this.text.string = "";
          this.bg.spriteFrame = null;
          this.talkFrame.active = false;
          UIMgr_1.default.ins.hideUI(UIData_1.UIHudDef.TalkPanel, function() {
            1 == story.jump.length && JumpUtils_1.default.jump(story.jump[0]);
          });
          return;
        }
        this.talkFrame.active = true;
        this.curIdx == content.length && story.jump.length > 1;
        if (0 != this.curIdx) {
          var words = content[this.curIdx - 1].words;
          this.text.string = words;
        }
        this.unscheduleAllCallbacks();
        this.scheduleOnce(this.setNext, .5);
      };
      TalkPanel.prototype.setNext = function() {
        var _this = this;
        var content = this.storyMap.get(this.curStoryId).content;
        var nextData = content[this.curIdx];
        this.curIdx++;
        if (!nextData) {
          this.showNext();
          return;
        }
        var bgID = nextData.bgID;
        if (void 0 != bgID) {
          this.bg.node.active = true;
          cc.loader.loadRes(this.backgroundPath + this.bgMap.get(bgID + "").url, cc.SpriteFrame, function(err, resource) {
            if (err) {
              Log_1.Log.error(_this.backgroundPath + _this.bgMap.get(bgID + "").url + "\u52a0\u8f7d\u4e0d\u6210\u529f");
              return;
            }
            _this.bg.spriteFrame = resource;
          });
        } else this.bg.node.active = false;
        var roleID = nextData.roleID;
        if (roleID) if (1 == roleID) {
          this.role.node.active = true;
          this.other.node.active = false;
          this.chatto.x = 490;
          this.roleName.string = "kkk";
        } else {
          this.role.node.active = false;
          this.other.node.active = true;
          this.chatto.x = -490;
          this.otherName.string = this.roleMap.get(roleID + "").name;
        } else {
          this.role.node.active = false;
          this.other.node.active = false;
          this.chatto.x = 490;
        }
        var imgIdx = nextData.figureID;
        void 0 != imgIdx;
        var words = nextData.words;
        this.showWords(words);
      };
      TalkPanel.prototype.showWords = function(text) {
        var _this = this;
        var textArr = text.match(REG);
        var index = 0;
        this.text.string = "";
        this.schedule(function() {
          _this.text.string += textArr[index];
          index++;
          index >= textArr.length && _this.autoNext && _this.scheduleOnce(_this.showNext, .2);
        }, .05, textArr.length - 1);
      };
      __decorate([ property(cc.RichText) ], TalkPanel.prototype, "text", void 0);
      __decorate([ property(cc.Sprite) ], TalkPanel.prototype, "bg", void 0);
      __decorate([ property(cc.Sprite) ], TalkPanel.prototype, "role", void 0);
      __decorate([ property(cc.Label) ], TalkPanel.prototype, "roleName", void 0);
      __decorate([ property(cc.Sprite) ], TalkPanel.prototype, "other", void 0);
      __decorate([ property(cc.Label) ], TalkPanel.prototype, "otherName", void 0);
      __decorate([ property(cc.Node) ], TalkPanel.prototype, "talkFrame", void 0);
      __decorate([ property(cc.Node) ], TalkPanel.prototype, "chatto", void 0);
      TalkPanel = __decorate([ ccclass ], TalkPanel);
      return TalkPanel;
    }(UIBase_1.default);
    exports.TalkPanel = TalkPanel;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/UIMgr": "UIMgr",
    "../../../../Base/UI/UIBase": "UIBase",
    "../../../../Base/Utils/Log": "Log",
    "../../../Data/Interface/UIData": "UIData",
    "../JumpUtils": "JumpUtils"
  } ],
  TaskCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "60bfdzf/1ZHf4oj5fg6k40v", "TaskCtrl");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var M_1 = require("../../../Base/Manager/M");
    var Event_1 = require("../../Data/Const/Event");
    var TimeConfig_1 = require("../../Data/Const/TimeConfig");
    var GameTaskModel_1 = require("../Model/GameTaskModel");
    var DataPool_1 = require("../../../Base/DataPool");
    var TaskCtrl = function() {
      function TaskCtrl() {
        this.gameTaskPool = null;
        this.taskNodePool = null;
        this.gameTaskPool = new Array();
        this.taskNodePool = new DataPool_1.DataPool(30, GameTaskModel_1.GameTaskModel, true);
      }
      TaskCtrl.prototype.pushAddNewTask = function(cell, createType) {
        var task = this._getTaskNode();
        task.model1 = cell;
        task.extData = createType;
        task.action = Event_1.Event.GameCMD.AddNewCell;
        M_1.default.event.send(Event_1.Event.GameCMD.MainCMD, task);
      };
      TaskCtrl.prototype.pushElimateTask = function(tm, closeAry, size, type, extInfo, keepTime) {
        var task = this._getTaskNode();
        task.action = Event_1.Event.GameCMD.Elimate;
        task.model1 = tm;
        task.closeAry = closeAry;
        task.size = size;
        task.keepTime = keepTime || .2;
        task.type = type;
        task.extData = extInfo;
        this.gameTaskPool.push(task);
      };
      TaskCtrl.prototype.pushExchangeTask = function(model1, targetPos1, model2, targetPos2) {
        var task = this._getTaskNode();
        task.action = Event_1.Event.GameCMD.Exchange;
        task.cp1 = targetPos1;
        task.model1 = model1;
        task.cp2 = targetPos2;
        task.model2 = model2;
        task.keepTime = TimeConfig_1.GapTime.ExchangeTime;
        this.gameTaskPool.push(task);
      };
      TaskCtrl.prototype.pushTisTask = function(model1, closeAry, mulPos) {
        var task = this._getTaskNode();
        task.action = Event_1.Event.GameCMD.PromptCanElimate;
        task.model1 = model1;
        task.cp1 = mulPos;
        task.closeAry = closeAry;
        task.keepTime = .15;
        this.gameTaskPool.push(task);
        return task;
      };
      TaskCtrl.prototype.freeTask = function(task) {
        this.taskNodePool.freeData(task);
      };
      TaskCtrl.prototype.execGameTask = function() {
        if (this.gameTaskPool && this.gameTaskPool.length > 0) {
          var task = this.gameTaskPool.shift();
          M_1.default.event.send(Event_1.Event.GameCMD.MainCMD, task);
        }
      };
      TaskCtrl.prototype._getTaskNode = function() {
        var node = this.taskNodePool.getData();
        node.init();
        return node;
      };
      TaskCtrl.prototype.execViewTask = function() {};
      TaskCtrl.prototype.update = function(dt) {
        this.execGameTask();
        this.execViewTask();
      };
      return TaskCtrl;
    }();
    exports.default = TaskCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/DataPool": "DataPool",
    "../../../Base/Manager/M": "M",
    "../../Data/Const/Event": "Event",
    "../../Data/Const/TimeConfig": "TimeConfig",
    "../Model/GameTaskModel": "GameTaskModel"
  } ],
  TempLoadingPanel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "749f8IuUVFP/aSiPV8gUGIh", "TempLoadingPanel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Constant_1 = require("../../Data/Const/Constant");
    var Util_1 = require("../../../Base/Utils/Util");
    var EventMgr_1 = require("../../../Base/Manager/EventMgr");
    var Event_1 = require("../../Data/Const/Event");
    var UIBase_1 = require("../../../Base/UI/UIBase");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var TempLoadingPanel = function(_super) {
      __extends(TempLoadingPanel, _super);
      function TempLoadingPanel() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.tipsLabel = null;
        _this.sprite = null;
        _this.progrss = null;
        _this.frames = [];
        return _this;
      }
      TempLoadingPanel.prototype.onLoad = function() {
        _super.prototype.onLoad.call(this);
        this._initView();
        this._initEvent();
      };
      TempLoadingPanel.prototype.onDestroy = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.UI.UpdateTmpLoadingProgress, this._onUpdateProgress, this);
      };
      TempLoadingPanel.prototype._initEvent = function() {
        EventMgr_1.default.ins.register(Event_1.Event.UI.UpdateTmpLoadingProgress, this._onUpdateProgress, this);
      };
      TempLoadingPanel.prototype._initView = function() {
        var keys = Object.keys(Constant_1.TempLoadingTip);
        var index = Util_1.Util.Tool.rangeInt(0, keys.length, false);
        this.sprite.spriteFrame = this.frames[index];
        this.tipsLabel.string = Constant_1.TempLoadingTip[index + 1];
      };
      TempLoadingPanel.prototype._onUpdateProgress = function(jd) {
        this.progrss.string = Math.ceil(jd) + "%";
      };
      TempLoadingPanel.prototype.start = function() {};
      __decorate([ property(cc.Label) ], TempLoadingPanel.prototype, "tipsLabel", void 0);
      __decorate([ property(cc.Sprite) ], TempLoadingPanel.prototype, "sprite", void 0);
      __decorate([ property(cc.Label) ], TempLoadingPanel.prototype, "progrss", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], TempLoadingPanel.prototype, "frames", void 0);
      TempLoadingPanel = __decorate([ ccclass ], TempLoadingPanel);
      return TempLoadingPanel;
    }(UIBase_1.default);
    exports.default = TempLoadingPanel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/EventMgr": "EventMgr",
    "../../../Base/UI/UIBase": "UIBase",
    "../../../Base/Utils/Util": "Util",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event"
  } ],
  TimeConfig: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "46e7arqHZZE64UF7dBNOyXy", "TimeConfig");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Util_1 = require("../../../Base/Utils/Util");
    var Constant_1 = require("./Constant");
    exports.GapTime = {
      DoubleRainbowResume: 1,
      DoubleRainbowWaves: .15,
      ThreePlaneCreate: .2,
      CreatePlaneDelayTime: .1,
      BombShocks: .15,
      DelayDestoryColAndRow: .2,
      NormalBombDelayElimate: 1.32,
      DelayDestoryBomb: .5,
      DelayDestoryOctopus: 0,
      DelayDestoryFishBomb: .3,
      ExchangeTime: .15,
      PromptElimate: 4,
      FallingSpeed: 18 / (Constant_1.RunTimeGate / 60) * Constant_1.RunTimeGate,
      EndFallingSpeed: 2 / (Constant_1.RunTimeGate / 60) * Constant_1.RunTimeGate,
      RowAndColSelfElimate: .5,
      RowAndColElimate: .1,
      MergeBombSpeed: .2,
      OctopusDelayElimate: .3,
      BombPreShocks: 1.85,
      FishBombPreShocks: .58,
      FishBombDelayElimate: .8,
      RainbowCenterDelayElimate: 1.6,
      RainbowShootStarCount: 1,
      RainbowShootOverElimate: .2,
      StarsShootSpeed: .2,
      StarsElimate: .5,
      CollectMoveSpeed: 1500,
      OctopusJumpSpeed: .7,
      BeikeDelayShaking: .3,
      BeikeDelaySuction: 1,
      BeikeSuctionSpeed: function() {
        return Util_1.Util.Tool.rangeInt(400, 700);
      },
      IsCounterClockWise: true,
      BombMergeBombChangeTime: 2.6,
      DelayChangeBroken: .3,
      DelayLightPoint: .3,
      TurtlesOver: 3.6,
      CrabStartElimate: 3,
      CrabStartedFallGap: .8,
      CrabElimateGap: .2
    };
    cc._RF.pop();
  }, {
    "../../../Base/Utils/Util": "Util",
    "./Constant": "Constant"
  } ],
  TimerTaskItem: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "53d71XNb5BDi7lbuQx2+kkb", "TimerTaskItem");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var StorageMgr_1 = require("../../../../Base/Manager/StorageMgr");
    var M_1 = require("../../../../Base/Manager/M");
    var Event_1 = require("../../../Data/Const/Event");
    var Util_1 = require("../../../../Base/Utils/Util");
    var UIData_1 = require("../../../Data/Interface/UIData");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var DAILY_TASK_DATA_KEY = "DAILY_TASK_DATA";
    var TimerTaskItem = function(_super) {
      __extends(TimerTaskItem, _super);
      function TimerTaskItem() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.count = null;
        _this.icon = null;
        _this.countDown = null;
        _this._info = null;
        _this._conditionType = null;
        _this._active = false;
        _this._isReceivd = false;
        _this._isComplet = false;
        return _this;
      }
      TimerTaskItem.prototype.onLoad = function() {
        M_1.default.event.register(Event_1.Event.DailyTask.UpdateProgress, this.updateProgress, this);
        M_1.default.event.register(Event_1.Event.DailyTask.UpdateTimerTaskActive, this.updateActive, this);
      };
      TimerTaskItem.prototype.onDestroy = function() {
        M_1.default.event.unRegister(Event_1.Event.DailyTask.UpdateProgress, this.updateProgress, this);
        M_1.default.event.unRegister(Event_1.Event.DailyTask.UpdateTimerTaskActive, this.updateActive, this);
      };
      TimerTaskItem.prototype.init = function(info, iconFrame) {
        this._info = info;
        this._conditionType = info.conditionType;
        this.icon.spriteFrame = iconFrame;
        this.icon.node.scale = 70 / this.icon.node.height;
        this.count.string = "x" + info.rewards[0].count;
        this.updateActive();
      };
      TimerTaskItem.prototype.updateActive = function() {
        this._active = false;
        var data = StorageMgr_1.StorageMgr.RingStorage.day().getValue(DAILY_TASK_DATA_KEY, {})[this._info.id];
        if (data) {
          this._isReceivd = data.isReceivd;
          this._isReceivd && (this.countDown.string = "\u9886\u5b8c");
        }
        var preIndex = this._info.id - 1;
        var preData = StorageMgr_1.StorageMgr.RingStorage.day().getValue(DAILY_TASK_DATA_KEY, {})[preIndex];
        if (preIndex < 1 || preData && preData.isReceivd) {
          if (!this._isReceivd) {
            this._active = true;
            this.countDown.node.active = true;
          }
        } else this.countDown.node.active = false;
      };
      TimerTaskItem.prototype.onClick = function() {
        if (this._isComplet && !this._isReceivd) {
          M_1.default.ui.showUI(UIData_1.UIHudDef.OpenBox, {
            config: {
              rewards: this._info.rewards
            },
            text: "\u6302\u673a\u5956\u52b1!",
            isHideBox: true
          });
          M_1.default.runtime.setDailyTime(0);
          var datas = StorageMgr_1.StorageMgr.RingStorage.day().getValue(DAILY_TASK_DATA_KEY, {});
          this._isReceivd = true;
          datas[this._info.id] = {
            isReceivd: true
          };
          StorageMgr_1.StorageMgr.RingStorage.day().setValue(DAILY_TASK_DATA_KEY, datas);
          M_1.default.event.send(Event_1.Event.DailyTask.UpdateTimerTaskActive);
        }
      };
      TimerTaskItem.prototype.updateProgress = function(type) {
        if (type == this._conditionType && this._active) {
          var num = this._info.condition - M_1.default.runtime.DailyTime;
          if (num < 0) {
            this._isComplet = true;
            this.countDown.string = "\u5f85\u9886\u53d6";
          } else this.countDown.string = Util_1.Util.Timer.conversionTime(num);
        }
      };
      __decorate([ property(cc.Label) ], TimerTaskItem.prototype, "count", void 0);
      __decorate([ property(cc.Sprite) ], TimerTaskItem.prototype, "icon", void 0);
      __decorate([ property(cc.Label) ], TimerTaskItem.prototype, "countDown", void 0);
      TimerTaskItem = __decorate([ ccclass ], TimerTaskItem);
      return TimerTaskItem;
    }(cc.Component);
    exports.default = TimerTaskItem;
    cc._RF.pop();
  }, {
    "../../../../Base/Manager/M": "M",
    "../../../../Base/Manager/StorageMgr": "StorageMgr",
    "../../../../Base/Utils/Util": "Util",
    "../../../Data/Const/Event": "Event",
    "../../../Data/Interface/UIData": "UIData"
  } ],
  Tips: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "38444alxRVB0YEnkfY8rebN", "Tips");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var View_1 = require("./View");
    var Tips = function(_super) {
      __extends(Tips, _super);
      function Tips() {
        var _this = _super.call(this, "Tips") || this;
        _this.mTipsPool = [];
        _this.mPlayState = 0;
        _this.mTimer = null;
        return _this;
      }
      Object.defineProperty(Tips, "ins", {
        get: function() {
          null == this.instance && (this.instance = new Tips());
          return this.instance;
        },
        enumerable: true,
        configurable: true
      });
      Tips.prototype.show = function(content, type, time) {
        void 0 === type && (type = 0);
        void 0 === time && (time = 2);
        this.init();
        this.mTimer = time;
        if (1 != this.mPlayState || this.isInvalidNode) {
          this.isInvalidNode && (this.mNode = null);
          this.mPlayState = 1;
          if (this.mNode) {
            this._setContent(content, type);
            this.onShow();
          } else this._initTipsView(content, type);
        }
      };
      Object.defineProperty(Tips.prototype, "isInvalidNode", {
        get: function() {
          return this.mNode && !this.mNode.parent;
        },
        enumerable: true,
        configurable: true
      });
      Tips.prototype._initTipsView = function(content, type) {
        var _this = this;
        void 0 === content && (content = "");
        if (!this.mRootNode) return;
        cc.loader.loadRes("prefab/ui/tips", cc.Prefab, function(err, prefab) {
          if (err) return console.error(err, prefab);
          _this.mNode = cc.instantiate(prefab);
          _this.mRootNode.addChild(_this.mNode);
          _this._setContent(content, type);
          _this.onShow();
        });
      };
      Tips.prototype._setContent = function(content, type) {
        if (!this.mNode) return console.error("Error: tips is not init ! ");
        if (0 == type) {
          this.mNode.getChildByName("normal").active = true;
          this.mNode.getChildByName("gril").active = false;
          if ("string" == typeof content) {
            cc.find("normal/picContent", this.mNode).active = false;
            var c = cc.find("normal/content", this.mNode);
            c.active = true;
            c.getComponent(cc.Label).string = content;
          } else {
            cc.find("normal/content", this.mNode).active = false;
            var pic = cc.find("normal/picContent", this.mNode);
            pic.getComponent(cc.Sprite).spriteFrame = content;
          }
        } else {
          this.mNode.getChildByName("normal").active = false;
          this.mNode.getChildByName("gril").active = true;
          var c = cc.find("gril/content", this.mNode);
          c.getComponent(cc.Label).string = content;
        }
      };
      Tips.prototype.playHideAnimate = function() {
        this.mNode.opacity = 255;
        this.mNode.setPosition(0, 0);
        this.mNode.active = false;
        this.mPlayState = 0;
      };
      Tips.prototype.playShowAnimate = function() {
        var _this = this;
        this.mNode.active = true;
        var a1 = cc.moveBy(.1, cc.v2(0, 40));
        var a2 = cc.moveBy(.1, cc.v2(0, -20));
        var a3 = cc.delayTime(this.mTimer);
        var a4 = cc.callFunc(function() {
          _this.mNode.runAction(cc.sequence(cc.fadeOut(.2), cc.callFunc(function() {
            return _this.onHide();
          }, _this)));
        });
        this.mNode.runAction(cc.sequence(a1, a2, a3, a4));
      };
      Tips.instance = null;
      return Tips;
    }(View_1.default);
    exports.default = Tips;
    cc._RF.pop();
  }, {
    "./View": "View"
  } ],
  Titles: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "927ffRr7ZROl7Y6I+3f4UNU", "Titles");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Titles = function() {
      function Titles(data) {
        this.showTargetContent = null;
        this.novContent = null;
        this.lv = data.lv;
        this.setTC(data.showTargetContent);
        this.setNC(data.novContent);
      }
      Titles.prototype.setTC = function(c) {
        c && "" != c && (this.showTargetContent = c);
      };
      Titles.prototype.setNC = function(c) {
        c && "" != c && (this.novContent = c);
      };
      return Titles;
    }();
    exports.default = Titles;
    cc._RF.pop();
  }, {} ],
  TouchHintCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "26067v9PqdCQ60ZHL1aXfCA", "TouchHintCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var TouchHintCtrl = function(_super) {
      __extends(TouchHintCtrl, _super);
      function TouchHintCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.interval = 2e3;
        _this.time = 0;
        return _this;
      }
      TouchHintCtrl.prototype.start = function() {
        this.time = 0;
      };
      TouchHintCtrl.prototype.show = function() {
        this.time = 0;
        this.node.opacity = 50;
        this.node.active = true;
      };
      TouchHintCtrl.prototype.hide = function() {
        this.node.active = false;
      };
      TouchHintCtrl.prototype.update = function(dt) {
        this.time = this.time + 10;
        this.node.opacity = 50 + this.time % this.interval / this.interval * 255;
      };
      __decorate([ property(cc.Integer) ], TouchHintCtrl.prototype, "interval", void 0);
      TouchHintCtrl = __decorate([ ccclass ], TouchHintCtrl);
      return TouchHintCtrl;
    }(cc.Component);
    exports.default = TouchHintCtrl;
    cc._RF.pop();
  }, {} ],
  TrafficSystem: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "93810zRYHtM9ZwHjg4YtmCP", "TrafficSystem");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var RoadUtil_1 = require("../../../../../Base/Utils/RoadUtil");
    var Walk_1 = require("./Walk");
    var Util_1 = require("../../../../../Base/Utils/Util");
    var Event_1 = require("../../../../Data/Const/Event");
    var EventMgr_1 = require("../../../../../Base/Manager/EventMgr");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var TrafficSystem = function(_super) {
      __extends(TrafficSystem, _super);
      function TrafficSystem() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.walkMap = new Map();
        _this.walkNode = new Map();
        _this.walkPrefab = [];
        _this.area = [];
        _this.walkList = [];
        return _this;
      }
      TrafficSystem.prototype.onLoad = function() {};
      TrafficSystem.prototype.onDestroy = function() {
        EventMgr_1.default.ins.unRegister(Event_1.Event.Map.WalkEnd, this.doNextWalk, this);
      };
      TrafficSystem.prototype.start = function() {
        EventMgr_1.default.ins.register(Event_1.Event.Map.WalkEnd, this.doNextWalk, this);
        this.initWalkRoad();
        this.executeWalk();
      };
      TrafficSystem.prototype.initWalkRoad = function() {
        var anim_com = this.node.getComponent(cc.Animation);
        var clips = anim_com.getClips();
        var clip = clips[0];
        var paths = clip.curveData.paths;
        for (var key in paths) {
          var data = paths[key].props.position;
          this.walkMap.set(key, RoadUtil_1.default.getRoadData(data));
          var node = key.split("-");
          var arr1 = this.walkNode.get(node[0]) || [];
          arr1.push(key);
          this.walkNode.set(node[0], arr1);
          var arr2 = this.walkNode.get(node[1]) || [];
          arr2.push(key.split("").reverse().join(""));
          this.walkNode.set(node[1], arr2);
        }
      };
      TrafficSystem.prototype.executeWalk = function() {
        var walkPrefab = [].concat(this.walkPrefab);
        var startKeys = Array.from(this.walkNode.keys());
        for (var i = 0; i < 3; i++) {
          var start = startKeys.splice(Util_1.Util.Tool.rangeInt(0, startKeys.length, false), 1)[0];
          var _a = this.getRandomPath(start), end = _a[0], path = _a[1];
          var idx = Util_1.Util.Tool.rangeInt(0, walkPrefab.length, false);
          var walk = cc.instantiate(walkPrefab.splice(idx, 1)[0]);
          walk.getComponent(Walk_1.default).startWalk({
            start: start,
            end: end,
            path: path
          });
          this.area[0].addChild(walk);
        }
      };
      TrafficSystem.prototype.getRandomPath = function(start) {
        var pathArr = this.walkNode.get(start);
        var pathName = pathArr[Util_1.Util.Tool.rangeInt(0, pathArr.length, false)];
        var end = pathName.replace(start + "-", "");
        var pathdata = this.walkMap.get(this.walkMap.has(pathName) ? pathName : end + "-" + start);
        var path = this.walkMap.has(start + "-" + end) ? [].concat(pathdata) : [].concat(pathdata).reverse();
        return [ end, path ];
      };
      TrafficSystem.prototype.doNextWalk = function(walk) {
        var start = walk.road.end;
        var _a = this.getRandomPath(start), end = _a[0], path = _a[1];
        walk.startWalk({
          start: start,
          end: end,
          path: path
        }, true);
      };
      __decorate([ property([ cc.Prefab ]) ], TrafficSystem.prototype, "walkPrefab", void 0);
      __decorate([ property([ cc.Node ]) ], TrafficSystem.prototype, "area", void 0);
      TrafficSystem = __decorate([ ccclass ], TrafficSystem);
      return TrafficSystem;
    }(cc.Component);
    exports.default = TrafficSystem;
    cc._RF.pop();
  }, {
    "../../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../../../Base/Utils/RoadUtil": "RoadUtil",
    "../../../../../Base/Utils/Util": "Util",
    "../../../../Data/Const/Event": "Event",
    "./Walk": "Walk"
  } ],
  Tuituji: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "fe2d6aFTExKyKsPIJkJvLWp", "Tuituji");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GameModel_1 = require("../../Model/GameModel");
    var GroupAnimatCtrl_1 = require("../../../Common/GroupAnimatCtrl");
    var Constant_1 = require("../../../Data/Const/Constant");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var Dirs = {
      0: cc.v2(1, 0),
      90: cc.v2(0, 1),
      180: cc.v2(-1, 0),
      270: cc.v2(0, -1)
    };
    var Speed = 2.5;
    var Tuituji = function(_super) {
      __extends(Tuituji, _super);
      function Tuituji() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.prog = null;
        _this.body = null;
        _this.bodyFrames = [];
        _this._cfg = null;
        _this._dir = null;
        _this._count = 0;
        _this._uiNode = null;
        return _this;
      }
      Tuituji.prototype.onLoad = function() {};
      Tuituji.prototype.init = function(cfg) {
        this._cfg = cfg;
        this._count = 0;
        this._dir = Dirs[this._cfg.degree];
        this.node.angle = cfg.degree - 90;
        this.prog.node.angle = -this.node.angle;
        this.body.spriteFrame = this.bodyFrames[this._cfg.type];
        this._updateProgress();
      };
      Tuituji.prototype._updateProgress = function() {
        this.prog.progress = this._count / this._cfg.count;
        this._count >= this._cfg.count && this._exec();
      };
      Tuituji.prototype._exec = function() {
        console.error("\u6536\u96c6\u5b8c\u6210,\u5f00\u59cb\u6267\u884c->");
        var groundCell = GameModel_1.default.ins.CollectModel.collectPowerCells["" + this._cfg.type];
        groundCell.freeThisPos();
        delete GameModel_1.default.ins.CollectModel.collectPowerCells["" + this._cfg.type];
        this._runMove();
      };
      Tuituji.prototype._runMove = function() {
        var _this = this;
        if (this._dir) {
          var a0 = cc.delayTime(.3);
          var a1 = cc.callFunc(function() {
            _this._elimate();
          });
          var a2 = cc.moveTo(Speed, cc.v2(2e3 * this._dir.x, 2e3 * this._dir.y));
          var a3 = cc.callFunc(function() {
            _this.node.destroy();
          });
          this.node.runAction(cc.sequence(a0, a1, a2, a3));
        }
      };
      Tuituji.prototype._elimate = function() {
        var _this = this;
        var pos = cc.v2(this._cfg.x, this._cfg.y);
        var timeLine = GroupAnimatCtrl_1.default.ins.createTimeLine();
        if (0 != this._dir.x) for (var i = 0; i < GameModel_1.default.GridSize.W; i++) timeLine.add(gsap.TweenLite.delayedCall(.1, function(p) {
          GameModel_1.default.ins.execElimateOneAtAll(p, Constant_1.ElimateType.Tuituji, _this._cfg.type);
        }, [ pos.add(this._dir.scale(cc.v2(i, 0))) ])); else if (0 != this._dir.y) for (var i = 0; i < GameModel_1.default.GridSize.H; i++) timeLine.add(gsap.TweenLite.delayedCall(.1, function(p) {
          GameModel_1.default.ins.execElimateOneAtAll(p, Constant_1.ElimateType.Tuituji, _this._cfg.type);
        }, [ pos.add(this._dir.scale(cc.v2(0, -i))) ]));
      };
      Tuituji.prototype.collectItem = function() {
        this._count++;
        this._updateProgress();
      };
      __decorate([ property(cc.ProgressBar) ], Tuituji.prototype, "prog", void 0);
      __decorate([ property(cc.Sprite) ], Tuituji.prototype, "body", void 0);
      __decorate([ property([ cc.SpriteFrame ]) ], Tuituji.prototype, "bodyFrames", void 0);
      Tuituji = __decorate([ ccclass ], Tuituji);
      return Tuituji;
    }(cc.Component);
    exports.default = Tuituji;
    cc._RF.pop();
  }, {
    "../../../Common/GroupAnimatCtrl": "GroupAnimatCtrl",
    "../../../Data/Const/Constant": "Constant",
    "../../Model/GameModel": "GameModel"
  } ],
  TurtlesModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "aa2fbyDEP1FqqTrkhIQEun4", "TurtlesModel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var MultipleGridColBase_1 = require("./MultipleGridColBase");
    var GameModel_1 = require("../GameModel");
    var Common_1 = require("../../../Common/Common");
    var CellBase_1 = require("../CellBase");
    var TurtlesModel = function(_super) {
      __extends(TurtlesModel, _super);
      function TurtlesModel() {
        return null !== _super && _super.apply(this, arguments) || this;
      }
      TurtlesModel.prototype.onComplet = function(index, topPoint) {
        var stateDirs = [ cc.v2(0, 0), cc.v2(1, 0), cc.v2(1, 1), cc.v2(0, 1) ];
        stateDirs.forEach(function(dir) {
          var gcell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, topPoint.add(dir));
          gcell && gcell.freeThisPos();
        });
        var notifyDirs = [ cc.v2(0, -1), cc.v2(1, -1) ];
        notifyDirs.forEach(function(dir) {
          var cell = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.CellList, topPoint.add(dir));
          cell && cell.onMsg(CellBase_1.MsgType.Fall);
        });
      };
      TurtlesModel.prototype.sync2View = function(groundList) {
        var _this = this;
        if (!this._cfg) return;
        this._count = this._cfg.length;
        var _loop_1 = function(i) {
          var cfg = this_1._cfg[i];
          this_1._pool[i] || (this_1._pool[i] = []);
          var pos = cc.v2(cfg.x, cfg.y);
          var topPointModel = Common_1.default.safeGet2ArrayValue(groundList, pos);
          topPointModel.initTurtles(pos);
          this_1._pool[i].push(pos);
          var tmpDirs = [ cc.v2(1, 0), cc.v2(0, 1), cc.v2(1, 1) ];
          tmpDirs.forEach(function(dir) {
            var groundItem = Common_1.default.safeGet2ArrayValue(groundList, pos.add(dir));
            if (groundItem) {
              groundItem.initTurtles(pos);
              _this._pool[i].push(groundItem.pos);
            }
          });
        };
        var this_1 = this;
        for (var i = 0; i < this._count; i++) _loop_1(i);
      };
      return TurtlesModel;
    }(MultipleGridColBase_1.default);
    exports.default = TurtlesModel;
    cc._RF.pop();
  }, {
    "../../../Common/Common": "Common",
    "../CellBase": "CellBase",
    "../GameModel": "GameModel",
    "./MultipleGridColBase": "MultipleGridColBase"
  } ],
  TutorialBorderCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "d28ecZG6OBHAJC5J6xJKXz6", "TutorialBorderCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Common_1 = require("../../Common/Common");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var TutorialBorderCtrl = function(_super) {
      __extends(TutorialBorderCtrl, _super);
      function TutorialBorderCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.borderFrames = [];
        _this.stage = null;
        return _this;
      }
      TutorialBorderCtrl.prototype.setData = function(stage) {
        this.stage = stage;
        if (this.stage && this.stage.cells) {
          var xMin_1 = Number.MAX_VALUE, xMax_1 = 0, yMin_1 = Number.MAX_VALUE, yMax_1 = 0;
          this.stage.cells.forEach(function(element) {
            xMin_1 = xMin_1 < element.x ? xMin_1 : element.x;
            xMax_1 = xMax_1 > element.x ? xMax_1 : element.x;
            yMin_1 = yMin_1 < element.y ? yMin_1 : element.y;
            yMax_1 = yMax_1 > element.y ? yMax_1 : element.y;
          });
          for (var y = yMin_1 - 1; y <= yMax_1 + 1; y++) for (var x = xMin_1 - 1; x <= xMax_1 + 1; x++) {
            var borderName = this.getBorderSpriteName(x, y);
            Common_1.default.getGroundBorderInfo(borderName) && this.initBorderView(borderName, x, y);
          }
        }
      };
      TutorialBorderCtrl.prototype.initBorderView = function(name, x, y) {
        var cfg = Common_1.default.getGroundBorderInfo(name);
        var pos = Common_1.default.getPos(x, y);
        pos.x -= Common_1.default.GRID_W / 2;
        pos.y += Common_1.default.GRID_H / 2;
        this.createBorder(pos, cfg, name);
      };
      TutorialBorderCtrl.prototype.createBorder = function(pos, cfg, name) {
        var borderNode = new cc.Node();
        var sprite = borderNode.addComponent(cc.Sprite);
        borderNode.parent = this.node;
        borderNode.zIndex = 2;
        sprite.trim = false;
        sprite.spriteFrame = this.getBorderFrame(cfg[0]);
        borderNode.setPosition(pos);
        borderNode.setScale(cfg[1]);
        borderNode.setContentSize(cc.size(Common_1.default.GRID_W, Common_1.default.GRID_H));
      };
      TutorialBorderCtrl.prototype.getBorderFrame = function(name) {
        var result = null;
        for (var i = this.borderFrames.length; i--; ) {
          var frame = this.borderFrames[i];
          frame.name.includes(name) && (result = frame);
        }
        result || console.error("\u6ca1\u627e\u5230\u8d44\u6e90:-----\x3e", name);
        return result;
      };
      TutorialBorderCtrl.prototype.getBorderSpriteName = function(x, y) {
        var name = "";
        name += this.getCellEmptyStatus(x - 1, y - 1);
        name += this.getCellEmptyStatus(x, y - 1);
        name += this.getCellEmptyStatus(x - 1, y);
        name += this.getCellEmptyStatus(x, y);
        return name;
      };
      TutorialBorderCtrl.prototype.getCellEmptyStatus = function(x, y) {
        var result = 0;
        this.stage.cells.forEach(function(element) {
          element.x == x && element.y == y && (result = 1);
        });
        return result;
      };
      __decorate([ property([ cc.SpriteFrame ]) ], TutorialBorderCtrl.prototype, "borderFrames", void 0);
      TutorialBorderCtrl = __decorate([ ccclass ], TutorialBorderCtrl);
      return TutorialBorderCtrl;
    }(cc.Component);
    exports.default = TutorialBorderCtrl;
    cc._RF.pop();
  }, {
    "../../Common/Common": "Common"
  } ],
  TutorialBubbleCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "84ef0l2CcpDDYFfIhrgo5Gb", "TutorialBubbleCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var TutroialBubbleCtrl = function(_super) {
      __extends(TutroialBubbleCtrl, _super);
      function TutroialBubbleCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.content = null;
        _this.bg = null;
        _this.touchHint = null;
        _this.role = null;
        return _this;
      }
      TutroialBubbleCtrl.prototype.setData = function(bubble) {
        if (bubble) {
          this.node.active = true;
          this.content.string = bubble.text["zh"];
          this.bg.height = this.content.node.height + 60;
          this.node.x = bubble.x;
          this.node.y = bubble.y;
        } else this.node.active = false;
      };
      TutroialBubbleCtrl.prototype.update = function(dt) {};
      __decorate([ property(cc.RichText) ], TutroialBubbleCtrl.prototype, "content", void 0);
      __decorate([ property(cc.Node) ], TutroialBubbleCtrl.prototype, "bg", void 0);
      __decorate([ property(cc.Node) ], TutroialBubbleCtrl.prototype, "touchHint", void 0);
      __decorate([ property(cc.Node) ], TutroialBubbleCtrl.prototype, "role", void 0);
      TutroialBubbleCtrl = __decorate([ ccclass ], TutroialBubbleCtrl);
      return TutroialBubbleCtrl;
    }(cc.Component);
    exports.default = TutroialBubbleCtrl;
    cc._RF.pop();
  }, {} ],
  Tutorial: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "adc64WvGb1MZL9wy3FwRmEi", "Tutorial");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SingletonFactory_1 = require("../../../Base/Utils/SingletonFactory");
    var RuntimeMgr_1 = require("../RuntimeMgr");
    var Paths_1 = require("../../../Base/Utils/Paths");
    var Turorial = function() {
      function Turorial() {
        this.retryCount = 0;
      }
      Turorial.prototype.getTurCfgData = function(lv, callback) {
        void 0 === lv && (lv = null);
        return __awaiter(this, void 0, Promise, function() {
          var isRemotReqeust, path, cfg;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              lv = lv || RuntimeMgr_1.default.ins.getMatch3Level();
              lv > RuntimeMgr_1.default.ins.maxMatch3Level && (lv = RuntimeMgr_1.default.ins.maxMatch3Level);
              isRemotReqeust = this.retryCount < 2;
              path = isRemotReqeust ? Paths_1.default.TurorialRemotPath : Paths_1.default.TurorialCfgPath;
              return [ 4, this._requestTurorial(lv, path, isRemotReqeust) ];

             case 1:
              cfg = _a.sent();
              if (cfg) {
                this.retryCount = 0;
                callback && callback(cfg);
                return [ 2, cfg ];
              }
              this.retryCount++;
              if (this.retryCount > 5) return [ 2, null ];
              return [ 2, this.getTurCfgData(lv, callback) ];
            }
          });
        });
      };
      Turorial.prototype._requestTurorial = function(lv, p, isRemotReqeust) {
        var lvStr = "0000" + lv;
        var path = p + "levels-0" + (Math.floor((lv - 1) / 100) + 1) + "/" + lvStr.slice(-4) + ".json";
        var loadStr = isRemotReqeust ? "load" : "loadRes";
        console.error(loadStr, path);
        return new Promise(function(resolve) {
          cc.loader[loadStr](path, function(err, res) {
            if (err || !res) return resolve(null);
            resolve(isRemotReqeust ? res : res.json);
          });
        });
      };
      Turorial.ins = SingletonFactory_1.SingletonFactory.getInstance(Turorial);
      return Turorial;
    }();
    exports.default = Turorial;
    cc._RF.pop();
  }, {
    "../../../Base/Utils/Paths": "Paths",
    "../../../Base/Utils/SingletonFactory": "SingletonFactory",
    "../RuntimeMgr": "RuntimeMgr"
  } ],
  UIBase: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9e6d0jNcFNMwLJcsFI9ptOg", "UIBase");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("../Manager/EventMgr");
    var UIData_1 = require("../../Logic/Data/Interface/UIData");
    var GuideUtils_1 = require("../../../GodGuide/GuideUtils");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var UIBase = function(_super) {
      __extends(UIBase, _super);
      function UIBase() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.uiEventList = null;
        _this._closeCallBack = null;
        _this.isShow = false;
        return _this;
      }
      UIBase.prototype.init = function(params) {
        this.onInit(params);
      };
      UIBase.prototype.onLoad = function() {
        var _this = this;
        this.uiEventList = new Map(this.initUIEvent());
        this.uiEventList.forEach(function(cb, key) {
          EventMgr_1.default.ins.register(key, cb, _this);
        }, this);
        this.onUILoad();
      };
      UIBase.prototype.onDestroy = function() {
        var _this = this;
        if (this.uiEventList) {
          this.uiEventList.forEach(function(cb, key) {
            EventMgr_1.default.ins.unRegister(key, cb, _this);
          }, this);
          this.uiEventList.clear();
        }
        this.onUIDestroy();
      };
      UIBase.prototype.onEnable = function() {};
      UIBase.prototype.onDisable = function() {
        this.onHide();
      };
      UIBase.prototype.start = function() {
        this.onStart();
      };
      UIBase.prototype.update = function(dt) {
        this.onUpdate(dt);
      };
      UIBase.prototype.addUIEventListener = function(eventName, cb) {
        EventMgr_1.default.ins.register(eventName, cb, this);
        this.uiEventList.set(eventName, cb);
      };
      UIBase.prototype.initUIEvent = function() {
        return [];
      };
      UIBase.prototype.onInit = function(params) {};
      UIBase.prototype.onUILoad = function() {};
      UIBase.prototype.onUIDestroy = function() {};
      UIBase.prototype.onShow = function(closeCallBack) {
        this._closeCallBack = closeCallBack;
        this.uiHudDef == UIData_1.UIHudDef.GameOverWin && GuideUtils_1.GuideUtils.checkGuide();
      };
      UIBase.prototype.onHide = function() {
        this._closeCallBack && this._closeCallBack();
        this._closeCallBack = null;
      };
      UIBase.prototype.onStart = function() {};
      UIBase.prototype.onUpdate = function(dt) {};
      UIBase.prototype.onClose = function() {
        this._closeCallBack && this._closeCallBack();
        this._closeCallBack = null;
      };
      UIBase = __decorate([ ccclass ], UIBase);
      return UIBase;
    }(cc.Component);
    exports.default = UIBase;
    cc._RF.pop();
  }, {
    "../../../GodGuide/GuideUtils": "GuideUtils",
    "../../Logic/Data/Interface/UIData": "UIData",
    "../Manager/EventMgr": "EventMgr"
  } ],
  UIData: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "1d2128QD3VMf5xFmwhX3Gze", "UIData");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var ViewZorder;
    (function(ViewZorder) {
      ViewZorder[ViewZorder["Scene"] = 20] = "Scene";
      ViewZorder[ViewZorder["MenuPanel"] = 80] = "MenuPanel";
      ViewZorder[ViewZorder["UI"] = 100] = "UI";
      ViewZorder[ViewZorder["Dialog"] = 200] = "Dialog";
      ViewZorder[ViewZorder["Tips"] = 300] = "Tips";
      ViewZorder[ViewZorder["Guide"] = 400] = "Guide";
      ViewZorder[ViewZorder["Notice"] = 500] = "Notice";
      ViewZorder[ViewZorder["Loading"] = 600] = "Loading";
    })(ViewZorder = exports.ViewZorder || (exports.ViewZorder = {}));
    var UIHudDef;
    (function(UIHudDef) {
      UIHudDef[UIHudDef["MenuPanel"] = 0] = "MenuPanel";
      UIHudDef[UIHudDef["GuideLayer"] = 1] = "GuideLayer";
      UIHudDef[UIHudDef["TalkPanel"] = 2] = "TalkPanel";
      UIHudDef[UIHudDef["GameOverFail"] = 3] = "GameOverFail";
      UIHudDef[UIHudDef["GameOverWin"] = 4] = "GameOverWin";
      UIHudDef[UIHudDef["GameShowTarget"] = 5] = "GameShowTarget";
      UIHudDef[UIHudDef["StoryTalkPanel"] = 6] = "StoryTalkPanel";
      UIHudDef[UIHudDef["GameLoading"] = 7] = "GameLoading";
      UIHudDef[UIHudDef["SelectShowTarget"] = 8] = "SelectShowTarget";
      UIHudDef[UIHudDef["OverShow"] = 9] = "OverShow";
      UIHudDef[UIHudDef["GamePause"] = 10] = "GamePause";
      UIHudDef[UIHudDef["BuildSuccess"] = 11] = "BuildSuccess";
      UIHudDef[UIHudDef["Bag"] = 12] = "Bag";
      UIHudDef[UIHudDef["OpenBox"] = 13] = "OpenBox";
      UIHudDef[UIHudDef["ShopPanel"] = 14] = "ShopPanel";
      UIHudDef[UIHudDef["BuyProp"] = 15] = "BuyProp";
      UIHudDef[UIHudDef["CloudView"] = 16] = "CloudView";
      UIHudDef[UIHudDef["NoticePanel"] = 17] = "NoticePanel";
      UIHudDef[UIHudDef["GMView"] = 18] = "GMView";
      UIHudDef[UIHudDef["PropDropView"] = 19] = "PropDropView";
      UIHudDef[UIHudDef["RoomFinishView"] = 20] = "RoomFinishView";
      UIHudDef[UIHudDef["CommonReward"] = 21] = "CommonReward";
      UIHudDef[UIHudDef["DailyTaskPanel"] = 22] = "DailyTaskPanel";
      UIHudDef[UIHudDef["FriendRank"] = 23] = "FriendRank";
      UIHudDef[UIHudDef["UIGameFailEncourage"] = 24] = "UIGameFailEncourage";
      UIHudDef[UIHudDef["MoreCoin"] = 25] = "MoreCoin";
    })(UIHudDef = exports.UIHudDef || (exports.UIHudDef = {}));
    exports.default = new Map([ [ UIHudDef.MenuPanel, {
      prefabPath: "MenuPanel",
      viewZOrder: ViewZorder.MenuPanel,
      hold: true,
      tween: false,
      blackBg: false
    } ], [ UIHudDef.TalkPanel, {
      prefabPath: "TalkPanel",
      viewZOrder: ViewZorder.Dialog,
      hold: true,
      tween: false,
      blackBg: false
    } ], [ UIHudDef.GuideLayer, {
      prefabPath: "GuideLayer",
      viewZOrder: ViewZorder.Guide,
      tween: false,
      blackBg: false
    } ], [ UIHudDef.GameOverFail, {
      prefabPath: "GameFail",
      viewZOrder: ViewZorder.UI,
      tween: false
    } ], [ UIHudDef.GameOverWin, {
      prefabPath: "GameWin",
      viewZOrder: ViewZorder.UI,
      tween: false
    } ], [ UIHudDef.GameShowTarget, {
      prefabPath: "GameShowTarget",
      tween: false,
      viewZOrder: ViewZorder.UI,
      blackBg: false
    } ], [ UIHudDef.SelectShowTarget, {
      prefabPath: "SelectShowTarget",
      viewZOrder: ViewZorder.UI,
      tween: false
    } ], [ UIHudDef.OverShow, {
      prefabPath: "OverShow",
      viewZOrder: ViewZorder.UI,
      blackBg: false
    } ], [ UIHudDef.GamePause, {
      prefabPath: "GamePause",
      viewZOrder: ViewZorder.UI,
      tween: false
    } ], [ UIHudDef.BuildSuccess, {
      prefabPath: "BuildSuccess",
      viewZOrder: ViewZorder.UI
    } ], [ UIHudDef.StoryTalkPanel, {
      prefabPath: "StoryTalkPanel",
      viewZOrder: ViewZorder.UI
    } ], [ UIHudDef.GameLoading, {
      prefabPath: "GameLoading",
      viewZOrder: ViewZorder.UI,
      tween: false
    } ], [ UIHudDef.Bag, {
      prefabPath: "Bag",
      viewZOrder: ViewZorder.UI
    } ], [ UIHudDef.OpenBox, {
      prefabPath: "OpenBox",
      viewZOrder: ViewZorder.UI,
      blackBg: false
    } ], [ UIHudDef.BuyProp, {
      prefabPath: "BuyPropPanel",
      viewZOrder: ViewZorder.UI,
      tween: false,
      blackBg: false
    } ], [ UIHudDef.CloudView, {
      prefabPath: "CloudView",
      viewZOrder: ViewZorder.UI,
      tween: false,
      blackBg: false
    } ], [ UIHudDef.NoticePanel, {
      prefabPath: "NoticePanel",
      viewZOrder: ViewZorder.UI
    } ], [ UIHudDef.GMView, {
      prefabPath: "GMView",
      viewZOrder: ViewZorder.UI
    } ], [ UIHudDef.PropDropView, {
      prefabPath: "PropDropView",
      viewZOrder: ViewZorder.UI,
      tween: false,
      blackBg: false
    } ], [ UIHudDef.RoomFinishView, {
      prefabPath: "RoomFinishView",
      viewZOrder: ViewZorder.UI,
      tween: true,
      blackBg: true
    } ], [ UIHudDef.CommonReward, {
      prefabPath: "CommonReward",
      viewZOrder: ViewZorder.UI,
      tween: true,
      blackBg: true
    } ], [ UIHudDef.ShopPanel, {
      prefabPath: "ShopPanel",
      viewZOrder: ViewZorder.UI,
      tween: true,
      blackBg: true
    } ], [ UIHudDef.DailyTaskPanel, {
      prefabPath: "DailyTaskPanel",
      viewZOrder: ViewZorder.UI,
      tween: true,
      blackBg: true
    } ], [ UIHudDef.FriendRank, {
      prefabPath: "FriendRank",
      viewZOrder: ViewZorder.UI,
      tween: true,
      blackBg: true
    } ], [ UIHudDef.UIGameFailEncourage, {
      prefabPath: "GameFailEncourage",
      viewZOrder: ViewZorder.UI,
      tween: true,
      blackBg: true
    } ], [ UIHudDef.MoreCoin, {
      prefabPath: "MoreCoin",
      viewZOrder: ViewZorder.UI,
      tween: false,
      blackBg: true
    } ] ]);
    cc._RF.pop();
  }, {} ],
  UIMgr: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "dda066VFIdLt518AC6oE6rq", "UIMgr");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UIBase_1 = require("../UI/UIBase");
    var UIData_1 = require("../../Logic/Data/Interface/UIData");
    var Log_1 = require("../Utils/Log");
    var LRUCache_1 = require("../Utils/LRUCache");
    var EventMgr_1 = require("./EventMgr");
    var BaseConst_1 = require("../BaseConst");
    var Event_1 = require("../../Logic/Data/Const/Event");
    var UIMgr = function() {
      function UIMgr() {
        var _this = this;
        this.uiMap = new Map();
        this.uiData = UIData_1.default;
        this.prefabRoot = "prefab/ui/";
        this.isOpening = false;
        this.lru = new LRUCache_1.LRUCache(5);
        this.uiRoot = new cc.Node("UIRoot");
        this.uiRoot.x = cc.winSize.width / 2;
        this.uiRoot.y = cc.winSize.height / 2;
        this.uiRoot.width = cc.winSize.width;
        this.uiRoot.height = cc.winSize.height;
        cc.game.addPersistRootNode(this.uiRoot);
        var widget = this.uiRoot.addComponent(cc.Widget);
        widget.alignMode = cc.Widget.AlignMode.ALWAYS;
        widget.bottom = widget.top = widget.left = widget.right = 0;
        this.blackBg = new cc.Node("BlackBg");
        this.blackBg.active = false;
        this.blackBg.setContentSize(cc.winSize);
        var graphics = this.blackBg.addComponent(cc.Graphics);
        graphics.rect(-cc.winSize.width / 2, -cc.winSize.height / 2, 2 * cc.winSize.width, 2 * cc.winSize.height);
        graphics.fillColor = cc.color(0, 0, 0, 180);
        graphics.fill();
        this.uiRoot.addChild(this.blackBg);
        this.blackBg.addComponent(cc.BlockInputEvents);
        this.blackBg.on(cc.Node.EventType.TOUCH_END, function(event) {
          _this.uiMap.forEach(function(ui, uiHudDef) {
            _this.isShowing(uiHudDef) && (_this.isOpening || ui.node.getBoundingBoxToWorld().contains(event.getLocationInView()) || _this.blackBgOnClick(uiHudDef));
          });
        });
        EventMgr_1.default.ins.register(Event_1.Event.System.CacheWarning, this.closeOld, this);
        EventMgr_1.default.ins.register(BaseConst_1.PlatformEvenType.OnMemoryWarning, this.closeOld, this);
      }
      Object.defineProperty(UIMgr, "ins", {
        get: function() {
          null == this.instance && (this.instance = new UIMgr());
          return this.instance;
        },
        enumerable: true,
        configurable: true
      });
      UIMgr.prototype.closeOld = function() {
        if (this.lru.oldNode && !this.isShowing(this.lru.oldNode.key)) {
          var uiData = this.uiData.get(this.lru.oldNode.key);
          uiData && !uiData.hold;
        }
      };
      UIMgr.prototype.blackBgOnClick = function(type) {
        var def = this.uiData.get(type);
        def && def.autoClose && this.hideUI(type);
      };
      UIMgr.prototype.openUI = function(uiHudDef, args, callback, closeCallback) {
        var _this = this;
        this.isOpening = true;
        var uiData = this.uiData.get(uiHudDef);
        if (this.hasUI(uiHudDef)) {
          Log_1.Log.error("OpenUI 1: ui " + UIData_1.UIHudDef[uiHudDef] + " is already exist, please check");
          this.isOpening = false;
          return;
        }
        var path = this.prefabRoot + uiData.prefabPath;
        cc.loader.loadRes(path, function(error, prefab) {
          if (error) {
            Log_1.Log.error("OpenUI: load ui error: " + error);
            _this.isOpening = false;
            return;
          }
          if (_this.hasUI(uiHudDef)) {
            Log_1.Log.error("OpenUI 2: ui " + UIData_1.UIHudDef[uiHudDef] + " is already exist, please check");
            _this.isOpening = false;
            return;
          }
          var uiNode = cc.instantiate(prefab);
          var ui = uiNode.getComponent(UIBase_1.default);
          if (!ui) {
            Log_1.Log.error(path + "\u6ca1\u6709\u7ed1\u5b9aUI\u811a\u672c!!!");
            _this.isOpening = false;
            return;
          }
          ui.init(args);
          ui.uiHudDef = uiHudDef;
          uiNode.opacity = 0;
          uiNode.parent = _this.uiRoot;
          uiNode.zIndex = uiData.viewZOrder;
          uiNode.active = true;
          _this.show(ui, uiHudDef, closeCallback);
          _this.uiMap.set(uiHudDef, ui);
          callback && callback(ui);
          var remove = _this.lru.pack(uiHudDef, ui);
          remove && !_this.isShowing(remove.key) && _this.closeUI(remove.key, true);
        });
      };
      UIMgr.prototype.clearDependsRes = function(prefabUrl) {
        var deps = cc.loader.getDependsRecursively(prefabUrl);
        deps.forEach(function(item) {});
      };
      UIMgr.prototype.closeUI = function(uiHudDef, release, callback) {
        var _this = this;
        void 0 === release && (release = false);
        void 0 === callback && (callback = null);
        if (this.hasUI(uiHudDef)) {
          var ui_1 = this.uiMap.get(uiHudDef);
          if (cc.isValid(ui_1.node)) {
            this.uiMap.delete(uiHudDef);
            this.lru.remove(uiHudDef);
            this.hide(ui_1, uiHudDef, function() {
              ui_1.node.destroy();
              if (release) {
                var uiData = _this.uiData.get(uiHudDef);
                _this.clearDependsRes(_this.prefabRoot + uiData.prefabPath);
              }
              callback && callback();
            });
          }
          return;
        }
      };
      UIMgr.prototype.closeAllUI = function() {
        var _this = this;
        this.uiMap.forEach(function(ui, uiHudDef) {
          _this.closeUI(uiHudDef);
        });
      };
      UIMgr.prototype.showUI = function(uiHudDef, args, callback, closeCB) {
        var ui = this.getUI(uiHudDef);
        if (!ui) {
          Log_1.Log.warn("showUI: ui " + UIData_1.UIHudDef[uiHudDef] + " not exist");
          this.openUI(uiHudDef, args, callback, closeCB);
          return;
        }
        ui.init(args);
        ui.isShow = true;
        ui.node.active = true;
        this.isOpening = true;
        this.show(ui, uiHudDef, closeCB);
        this.lru.get(uiHudDef);
        callback && callback(ui);
      };
      UIMgr.prototype.hideUI = function(uiHudDef, callback) {
        var ui = this.getUI(uiHudDef);
        if (ui) {
          ui.isShow = false;
          this.hide(ui, uiHudDef, function() {
            if (!ui.isShow) {
              ui.node.active = false;
              callback && callback();
            }
          });
        }
      };
      UIMgr.prototype.getUI = function(uiHudDef) {
        if (this.hasUI(uiHudDef)) return this.uiMap.get(uiHudDef);
        return null;
      };
      UIMgr.prototype.hasUI = function(uiHudDef) {
        return this.uiMap.has(uiHudDef);
      };
      UIMgr.prototype.isShowing = function(uiHudDef) {
        var ui = this.getUI(uiHudDef);
        if (!ui) return false;
        return ui.node.active;
      };
      UIMgr.prototype.show = function(ui, uiHudDef, closeCallBack) {
        var _this = this;
        var uiData = this.uiData.get(uiHudDef);
        if (void 0 == uiData.blackBg || true == uiData.blackBg) {
          this.blackBg.stopAllActions();
          this.blackBg.active = true;
          this.blackBg.opacity = 0;
          this.blackBg.zIndex = uiData.viewZOrder - 1;
          this.blackBg.runAction(cc.fadeIn(.3));
        }
        if (void 0 == uiData.tween || true == uiData.tween) {
          var tween = new gsap.TimelineLite();
          tween.set(ui.node, {
            scale: .5,
            opacity: 0
          }).to(ui.node, .5, {
            scale: 1,
            opacity: 255,
            ease: gsap.Back.easeInOut,
            onComplete: function() {
              _this.isOpening = false;
              ui.onShow(closeCallBack);
            }
          });
        } else {
          ui.node.opacity = 255;
          this.isOpening = false;
          ui.onShow(closeCallBack);
        }
      };
      UIMgr.prototype.hide = function(ui, uiHudDef, callback) {
        var _this = this;
        var uiData = this.uiData.get(uiHudDef);
        if (void 0 == uiData.blackBg || true == uiData.blackBg) {
          var a0 = cc.fadeOut(.1);
          var a1 = cc.callFunc(function() {
            _this.blackBg.active = false;
          }, this);
          this.blackBg.runAction(cc.sequence(a0, a1));
        } else this.blackBg.active = false;
        if (void 0 == uiData.tween || true == uiData.tween) gsap.TweenLite.to(ui.node, .3, {
          scale: .5,
          opacity: 0,
          ease: gsap.Expo.easeOut,
          onComplete: callback
        }); else {
          ui.node.active = false;
          callback();
        }
      };
      return UIMgr;
    }();
    exports.default = UIMgr;
    cc._RF.pop();
  }, {
    "../../Logic/Data/Const/Event": "Event",
    "../../Logic/Data/Interface/UIData": "UIData",
    "../BaseConst": "BaseConst",
    "../UI/UIBase": "UIBase",
    "../Utils/LRUCache": "LRUCache",
    "../Utils/Log": "Log",
    "./EventMgr": "EventMgr"
  } ],
  UpGroundCellModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "9e9ba+ISJJFbIgvN1tYOq5u", "UpGroundCellModel");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var CellBase_1 = require("./CellBase");
    var SpecialCell_1 = require("./SpecialCell");
    var Common_1 = require("../../Common/Common");
    var GameModel_1 = require("./GameModel");
    var CollectModel_1 = require("./CollectModel");
    var M_1 = require("../../../Base/Manager/M");
    var Constant_1 = require("../../Data/Const/Constant");
    var UpGroundCellModel = function(_super) {
      __extends(UpGroundCellModel, _super);
      function UpGroundCellModel() {
        var _this = _super.call(this) || this;
        _this.specials = null;
        _this.isObstacles = false;
        _this._isBox = false;
        _this._boxType = null;
        _this.isFollowBindNode = false;
        _this.portalIdx = 0;
        _this.BindCell = null;
        _this.isNov = false;
        _this.isIntact = true;
        _this.isElimateing = false;
        _this._groupId = null;
        _this._elimateCount = 0;
        _this.isObstacles = false;
        _this.type = Constant_1.UpGroundType.None;
        _this.ctrlName = "ItemUpgroundCtrl";
        return _this;
      }
      UpGroundCellModel.prototype.init = function(data, x, y, index) {
        this._pos = cc.v2(x, y);
        if (!data) {
          this.type = Constant_1.UpGroundType.None;
          return;
        }
        this.mapIndex = index;
        this.data = data;
        this.specials = [];
        this.BindCell = null;
        this._boxType = null;
        this._groupId = null;
        if (data.nov_grass) {
          this.isNov = true;
          this.specials.push(new SpecialCell_1.default(Constant_1.UpGroundType.Nov_grass, data.nov_grass));
        }
        if (data.nov_conch) {
          this.isNov = true;
          this.isObstacles = true;
          this.specials.push(new SpecialCell_1.default(Constant_1.UpGroundType.Nov_conch, data.nov_conch));
        }
        data.ice && this.specials.push(new SpecialCell_1.default(Constant_1.UpGroundType.Ice, data.ice));
        data.locks && this.specials.push(new SpecialCell_1.default(Constant_1.UpGroundType.Lock, data.locks));
        if (data.box_level) {
          this.specials.push(new SpecialCell_1.default(Constant_1.UpGroundType.Box, data.box_level));
          this.isObstacles = true;
          this._isBox = true;
          this._boxType = null != data.box_type && void 0 != data.box_type ? data.box_type : null;
        }
        if (data.stone) {
          this.specials.push(new SpecialCell_1.default(Constant_1.UpGroundType.Stone, 2));
          this.isObstacles = true;
        }
        data.ivy;
        data.portal_idx && (this.portalIdx = data.portal_idx);
        var curSp = this.getCurrentSpecial();
        if (curSp) {
          this.type = curSp.type;
          this.lv = curSp.lv;
        }
        this.isNov && (GameModel_1.default.ins.isNovLv = true);
      };
      UpGroundCellModel.prototype.forcedElimateNov = function() {
        this.isNov = false;
        this.isObstacles = false;
        this.isFollowBindNode = false;
        this.specials.length = 0;
        this.type = Constant_1.UpGroundType.None;
        this.BindCell.onMsg(CellBase_1.MsgType.Bomb);
      };
      UpGroundCellModel.prototype.getNovWaringTitle = function() {
        var result = "";
        var cfg = M_1.default.table.Titles.getByPrimaryKey(M_1.default.runtime.getMatch3Level());
        cfg && cfg.novContent && (result = cfg.novContent);
        return result;
      };
      UpGroundCellModel.prototype.isCanFall = function() {
        var result = true;
        switch (this.type) {
         case Constant_1.UpGroundType.Lock:
         case Constant_1.UpGroundType.Box:
         case Constant_1.UpGroundType.Stone:
         case Constant_1.UpGroundType.Nov_grass:
          result = false;
          break;

         case Constant_1.UpGroundType.Ice:
        }
        return result;
      };
      UpGroundCellModel.prototype.onMsg = function(type, data) {
        this._groupId = data ? data.groupId : null;
        switch (type) {
         case CellBase_1.MsgType.Elimate:
          Constant_1.UpGroundType.Stone == this.type && Common_1.default.isBombType(data.type) && (this.isIntact = false);
          this.execElimate();
          break;

         case CellBase_1.MsgType.BesideElimate:
          this.besideElimate(data.cell);
          break;

         case CellBase_1.MsgType.ElimateAll:
          this.execElimateAll();
        }
      };
      UpGroundCellModel.prototype.onChangePos = function(pos) {
        Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.UpGroundList, this._pos, null);
        Common_1.default.safeSet2ArrayValue(GameModel_1.default.ins.UpGroundList, pos, this);
      };
      UpGroundCellModel.prototype.onUnBind = function(pos) {};
      UpGroundCellModel.prototype.onBind = function(model) {
        this.BindCell = model;
        this.changeSpecialPlug();
      };
      UpGroundCellModel.prototype.besideElimate = function(cell) {
        switch (this.type) {
         case Constant_1.UpGroundType.Box:
          !this.isBox || null != this.boxType && cell && cell.getType() != this.boxType || this.execElimate();
          break;

         case Constant_1.UpGroundType.Stone:
          this.isIntact || this.execElimate();
        }
      };
      UpGroundCellModel.prototype.execElimateAll = function() {
        var _this = this;
        this._elimateCount = 0;
        if (this.specials && this.specials.length > 0 && this.lv > 0) {
          this.lv = 0;
          this.type = Constant_1.UpGroundType.None;
          this.specials.forEach(function(spe) {
            _this._elimateCount += spe.lv;
            spe.type == Constant_1.UpGroundType.Box && _this.updateCollect(Constant_1.UpGroundType.Box);
          });
          this._isBox = false;
          this.specials.length = 0;
          this.isObstacles = false;
          this.isFollowBindNode = false;
          this.notifyOver(Constant_1.UpGroundType.Box);
        }
        this.extCtrl.playAnimation(this.type);
        return this._elimateCount;
      };
      UpGroundCellModel.prototype.updateCollect = function(type) {
        GameModel_1.default.ins.updateCollectCount(this.getCollectName(type, this._boxType), this.pos);
      };
      UpGroundCellModel.prototype.execElimate = function() {
        return __awaiter(this, void 0, void 0, function() {
          var isNeedCheckElimate, preType, currentSp;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              if (!(this.type != Constant_1.UpGroundType.None && !this.isElimateing && !this.isNov)) return [ 3, 2 ];
              this.isElimateing = true;
              return [ 4, this.extCtrl.playAnimation(this.type) ];

             case 1:
              _a.sent();
              if (!this.isHavaSpe) return [ 2 ];
              this.lv = this.getCurrentSpecial().setLv(-1);
              if (this.lv <= 0) {
                isNeedCheckElimate = this._checkNeedOverCheck();
                if (this.type == Constant_1.UpGroundType.Box) {
                  this._isBox = false;
                  this.updateCollect(null);
                }
                this.specials.splice(this.specials.length - 1, 1);
                preType = this.type;
                currentSp = this.getCurrentSpecial();
                if (currentSp) {
                  this.type = currentSp.type;
                  this.lv = currentSp.lv;
                  this.changeSpecialPlug();
                } else this.type = Constant_1.UpGroundType.None;
                this.checkChangeObs(preType);
                isNeedCheckElimate && GameModel_1.default.ins.checkHavaElimate(this.pos);
              }
              this.isElimateing = false;
              _a.label = 2;

             case 2:
              return [ 2 ];
            }
          });
        });
      };
      UpGroundCellModel.prototype._checkNeedOverCheck = function() {
        return this.type == Constant_1.UpGroundType.Box || this.type == Constant_1.UpGroundType.Stone || this.type == Constant_1.UpGroundType.Ice;
      };
      UpGroundCellModel.prototype.getCollectName = function(type, boxType) {
        void 0 === type && (type = null);
        void 0 === boxType && (boxType = null);
        var result = null;
        type = type || this.type;
        switch (type) {
         case Constant_1.UpGroundType.Box:
          result = null != boxType ? CollectModel_1.CollectType.colorbox : CollectModel_1.CollectType.box;
          break;

         case Constant_1.UpGroundType.Stone:
          result = CollectModel_1.CollectType.stone;
        }
        return result;
      };
      UpGroundCellModel.prototype.changeSpecialPlug = function() {
        this.type == Constant_1.UpGroundType.Ice && (this.isFollowBindNode = true);
      };
      UpGroundCellModel.prototype.checkChangeObs = function(preType) {
        return __awaiter(this, void 0, void 0, function() {
          var obs, i, type;
          return __generator(this, function(_a) {
            if (this.isHavaSpe) {
              obs = false;
              for (i = this.specials.length; i--; ) {
                type = this.specials[i].type;
                if (type == Constant_1.UpGroundType.Box || type == Constant_1.UpGroundType.Stone) {
                  obs = true;
                  break;
                }
              }
              this.isObstacles = obs;
            } else {
              this.isObstacles = false;
              this.isFollowBindNode = false;
              this.notifyOver(preType);
            }
            return [ 2 ];
          });
        });
      };
      UpGroundCellModel.prototype.notifyOver = function(preType) {
        var ground = Common_1.default.safeGet2ArrayValue(GameModel_1.default.ins.GroundList, this.pos);
        ground && ground.onMsg(CellBase_1.MsgType.UpGroundDone, preType);
        this.BindCell && this.BindCell.onMsg(CellBase_1.MsgType.UpGroundDone, this._groupId);
      };
      UpGroundCellModel.prototype.clear = function() {
        this.specials = [];
      };
      Object.defineProperty(UpGroundCellModel.prototype, "isFollowNode", {
        get: function() {
          return this.isFollowBindNode;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(UpGroundCellModel.prototype, "boxType", {
        get: function() {
          return this._boxType;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(UpGroundCellModel.prototype, "isBox", {
        get: function() {
          return this._isBox;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(UpGroundCellModel.prototype, "isObs", {
        get: function() {
          return this.isObstacles;
        },
        enumerable: true,
        configurable: true
      });
      Object.defineProperty(UpGroundCellModel.prototype, "isHavaSpe", {
        get: function() {
          return this.specials && this.specials.length > 0;
        },
        enumerable: true,
        configurable: true
      });
      UpGroundCellModel.prototype.getSpecials = function() {
        return this.specials;
      };
      UpGroundCellModel.prototype.getCurrentSpecial = function() {
        return this.specials[this.specials.length - 1];
      };
      return UpGroundCellModel;
    }(CellBase_1.CellBase);
    exports.default = UpGroundCellModel;
    cc._RF.pop();
  }, {
    "../../../Base/Manager/M": "M",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "./CellBase": "CellBase",
    "./CollectModel": "CollectModel",
    "./GameModel": "GameModel",
    "./SpecialCell": "SpecialCell"
  } ],
  UpGroundModel: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "2543djlU/JE87VTZ3cYRvHC", "UpGroundModel");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UpGroundCellModel_1 = require("./UpGroundCellModel");
    var UpGroundModel = function() {
      function UpGroundModel() {
        this.ugCellList = null;
        this.boxMap = null;
        this.portalMap = null;
        this.ugCellList = [];
        this.boxMap = new Map();
        this.portalMap = new Map();
      }
      UpGroundModel.prototype.initUpGroupCell = function(data, x, y, index) {
        var item = new UpGroundCellModel_1.default();
        item.init(data, x, y, index);
        var warr = this.ugCellList[y] || [];
        warr.push(item);
        this.ugCellList[y] = warr;
        item.isBox && this.boxMap.set(this.getPosKey(item.pos), item.pos);
        item.portalIdx && this.syncPortal(item);
        return item;
      };
      UpGroundModel.prototype.getUGroupCellList = function() {
        return this.ugCellList;
      };
      UpGroundModel.prototype.getUGCellByPos = function(pos) {
        return this.ugCellList[pos.y][pos.x];
      };
      UpGroundModel.prototype.updateCollectCount = function(type, pos) {
        if ("box" == type) {
          var key = this.getPosKey(pos);
          this.boxMap.has(key) && this.boxMap.delete(key);
        }
      };
      UpGroundModel.prototype.syncPortal = function(model) {
        var key = Math.abs(model.portalIdx);
        var data = this.portalMap.get(key) || {};
        model.portalIdx < 0 ? data.in = model.pos : data.out = model.pos;
        this.portalMap.set(key, data);
      };
      UpGroundModel.prototype.getPosKey = function(pos) {
        return pos.x + "-" + pos.y;
      };
      UpGroundModel.prototype.getPortalPos = function(index) {
        return this.portalMap.get(Math.abs(index));
      };
      UpGroundModel.prototype.getAllPortal = function() {
        return this.portalMap;
      };
      Object.defineProperty(UpGroundModel.prototype, "BoxMap", {
        get: function() {
          return this.boxMap;
        },
        enumerable: true,
        configurable: true
      });
      return UpGroundModel;
    }();
    exports.UpGroundModel = UpGroundModel;
    cc._RF.pop();
  }, {
    "./UpGroundCellModel": "UpGroundCellModel"
  } ],
  UpGroundViewCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "49bedhsMQFN5bN0vZhab2EM", "UpGroundViewCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var UpGroundCellModel_1 = require("../Model/UpGroundCellModel");
    var M_1 = require("../../../Base/Manager/M");
    var Constant_1 = require("../../Data/Const/Constant");
    var ItemUpgroundCtrl_1 = require("./ItemUpgroundCtrl");
    var BaseView_1 = require("./BaseView");
    var GameModel_1 = require("../Model/GameModel");
    var ActionCtrl_1 = require("../../Common/ActionCtrl");
    var Event_1 = require("../../Data/Const/Event");
    var Common_1 = require("../../Common/Common");
    var SpinePlayerCtrl_1 = require("../../../Base/CustomComponent/SpinePlayerCtrl");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var UpGroundViewCtrl = function(_super) {
      __extends(UpGroundViewCtrl, _super);
      function UpGroundViewCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.defaultNode = null;
        _this.portal = null;
        _this.portalPrefab = null;
        return _this;
      }
      UpGroundViewCtrl.prototype.initView = function(models) {
        _super.prototype.initView.call(this, models);
        M_1.default.nodePool.create(Constant_1.NodePoolKey.UpGroundCell, this.ItemPrefab, 150);
        for (var y = models.length; y--; ) {
          var yItems = models[y];
          for (var x = yItems.length; x--; ) {
            var item = yItems[x];
            var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.UpGroundCell, this.ItemPrefab);
            node.getComponent(ItemUpgroundCtrl_1.default).init(item);
            item.extData = node;
            node.parent = this.defaultNode;
            this.syncPortal(item);
          }
        }
      };
      UpGroundViewCtrl.prototype.syncPortal = function(model) {
        this.portal.y = 0;
        if (0 != model.portalIdx) {
          var node = M_1.default.nodePool.createItem(this.portalPrefab);
          var ctrl_1 = node.getComponent(SpinePlayerCtrl_1.default);
          node.parent = this.portal;
          node.setPosition(model.getPosition());
          var playName_1 = null;
          if (model.portalIdx > 0) {
            node.y += Common_1.default.GRID_H / 2;
            playName_1 = "chuansongmen_blue";
          } else if (model.portalIdx < 0) {
            node.y -= Common_1.default.GRID_H / 2;
            playName_1 = "chuansongmen_orage";
          }
          this.scheduleOnce(function() {
            ctrl_1.play(playName_1, 0, true);
          }, 0);
        }
      };
      UpGroundViewCtrl.prototype.playCollectAniByType = function(parent, pos, targetPos, type) {
        var boxNode = this.createTempBoxNode(pos);
        boxNode.parent = parent;
        targetPos = parent.convertToNodeSpaceAR(targetPos);
        ActionCtrl_1.default.ins.runCollectNormalCell(boxNode, targetPos).then(function() {
          M_1.default.nodePool.freeItem(Constant_1.NodePoolKey.UpGroundCell, boxNode);
          M_1.default.event.send(Event_1.Event.Effect.CollectOver, targetPos);
          M_1.default.event.send(Event_1.Event.UI.UpdateInfoPanel, type);
        });
      };
      UpGroundViewCtrl.prototype.createTempBoxNode = function(pos) {
        var item = new UpGroundCellModel_1.default();
        item.init({
          box_level: 1
        }, pos.x, pos.y, GameModel_1.default.ins.mapIndex);
        var node = M_1.default.nodePool.getItem(Constant_1.NodePoolKey.UpGroundCell, this.ItemPrefab);
        item.extData = node;
        node.getComponent(ItemUpgroundCtrl_1.default).init(item);
        return node;
      };
      __decorate([ property(cc.Node) ], UpGroundViewCtrl.prototype, "defaultNode", void 0);
      __decorate([ property(cc.Node) ], UpGroundViewCtrl.prototype, "portal", void 0);
      __decorate([ property(cc.Prefab) ], UpGroundViewCtrl.prototype, "portalPrefab", void 0);
      UpGroundViewCtrl = __decorate([ ccclass ], UpGroundViewCtrl);
      return UpGroundViewCtrl;
    }(BaseView_1.default);
    exports.default = UpGroundViewCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/CustomComponent/SpinePlayerCtrl": "SpinePlayerCtrl",
    "../../../Base/Manager/M": "M",
    "../../Common/ActionCtrl": "ActionCtrl",
    "../../Common/Common": "Common",
    "../../Data/Const/Constant": "Constant",
    "../../Data/Const/Event": "Event",
    "../Model/GameModel": "GameModel",
    "../Model/UpGroundCellModel": "UpGroundCellModel",
    "./BaseView": "BaseView",
    "./ItemUpgroundCtrl": "ItemUpgroundCtrl"
  } ],
  Util: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "2df7fpPq8dFIZ0GFbnvFJGf", "Util");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Util;
    (function(Util) {
      var Enum = function() {
        function Enum() {}
        Enum.next = function() {
          return this.counter++;
        };
        Enum.nextString = function() {
          return this.next().toString();
        };
        Enum.convert2EventEnum = function(e) {
          for (var key in e) e[key] = this.next();
        };
        Enum.counter = 1e4;
        return Enum;
      }();
      Util.Enum = Enum;
      var Tool = function() {
        function Tool() {}
        Tool.isNull = function(p) {
          var result = true;
          if (p) for (var key in p) {
            result = false;
            break;
          }
          return result;
        };
        Tool.isIpx = function() {
          if (cc.winSize.height > 1500) return true;
          return false;
        };
        Tool.isNumber = function(value) {
          return "number" == typeof value;
        };
        Tool.showDebugView = function(opt) {};
        Tool.isWechatGame = function() {
          return "wechatgame" == cc.sys.browserType;
        };
        Tool.rangeInt = function(min, max, isHaveMax) {
          void 0 === isHaveMax && (isHaveMax = true);
          var value = isHaveMax ? 1 : 0;
          return Math.floor(Math.random() * (max - min + value) + min);
        };
        Tool.range = function(min, max) {
          return Math.random() * (max - min) + min;
        };
        Tool.compareV2 = function(p1, p2) {
          return p1.equals(p2);
        };
        Tool.getChildByName = function(ele, name) {
          if (ele.name === name) return ele;
          for (var i = 0; i < ele.children.length; i++) if (this.getChildByName(ele.children[i], name)) return this.getChildByName(ele.children[i], name);
          return null;
        };
        Tool.stringFormat = function(str) {
          var args = [];
          for (var _i = 1; _i < arguments.length; _i++) args[_i - 1] = arguments[_i];
          str = str.replace(/%%/g, "%");
          return Tool.stringFormatArr(str, args);
        };
        Tool.stringFormatArr = function(str, args) {
          var new_str = str;
          for (var i in args) {
            var arg = args[i];
            new RegExp("(%s|%d)").test(new_str) && (new_str = new_str.replace(RegExp.$1, arg));
          }
          return new_str;
        };
        Tool.copyDict = function(dict, isDeepCopy) {
          if (!dict) return dict;
          var newDict = dict instanceof Array ? [] : {};
          for (var i in dict) {
            if ("function" == typeof dict[i]) continue;
            isDeepCopy && "object" == typeof dict[i] ? newDict[i] = Tool.copyDict(dict[i], isDeepCopy) : newDict[i] = dict[i];
          }
          return newDict;
        };
        Tool.OpenUITween = function(node, callback) {
          cc.log("\u6253\u5f00\u754c\u9762\u52a8\u753b");
          var tween = new gsap.TimelineLite();
          tween.set(node, {
            scale: .5,
            opacity: 0
          }).to(node, .5, {
            scale: 1,
            opacity: 255,
            ease: gsap.Back.easeInOut,
            onComplete: function() {}
          });
        };
        Tool.CloseUITween = function(node, callback) {
          gsap.TweenLite.to(node, .3, {
            scale: .5,
            opacity: 0,
            ease: gsap.Expo.easeOut,
            onComplete: callback
          });
        };
        Tool.moveTo = function(targetPos, node, callback) {};
        return Tool;
      }();
      Util.Tool = Tool;
      var Timer = function() {
        function Timer() {}
        Timer.dateFtt = function(fmt, date) {
          var o = {
            "M+": date.getMonth() + 1,
            "d+": date.getDate(),
            "h+": date.getHours(),
            "m+": date.getMinutes(),
            "s+": date.getSeconds(),
            "q+": Math.floor((date.getMonth() + 3) / 3),
            S: date.getMilliseconds()
          };
          /(y+)/.test(fmt) && (fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length)));
          for (var k in o) new RegExp("(" + k + ")").test(fmt) && (fmt = fmt.replace(RegExp.$1, 1 == RegExp.$1.length ? o[k] : ("00" + o[k]).substr(("" + o[k]).length)));
          return fmt;
        };
        Timer.conversionTime = function(times, isDot, fillZero) {
          void 0 === isDot && (isDot = false);
          void 0 === fillZero && (fillZero = {});
          if (times < 0) return;
          var d = Math.floor(times / 60 / 60 / 24);
          var h = Math.floor(times % 86400 / 60 / 60);
          var m = Math.floor(times % 3600 / 60);
          var s = Math.floor(times % 60);
          h = h < 10 ? "0" + h : h;
          m = m < 10 ? "0" + m : m;
          s = s < 10 ? "0" + s : s;
          var resutle = "";
          var unit = isDot ? [ ":", ":", ":", "" ] : [ "\u5929", "\u65f6", "\u5206", "\u79d2" ];
          resutle = d > 0 ? d + unit[0] + h + unit[1] + m + unit[2] + s + unit[3] : h > 0 || fillZero["h"] ? h + unit[1] + m + unit[2] + s + unit[3] : m > 0 || fillZero["m"] ? m + unit[2] + s + unit[3] : s + unit[3];
          return resutle;
        };
        Timer.getNowTime = function() {
          return Date.now();
        };
        return Timer;
      }();
      Util.Timer = Timer;
      var Loader = function() {
        function Loader() {}
        Loader.loadSpriteFrame = function(path, next) {
          cc.loader.loadRes(path, cc.SpriteFrame, function(err, resource) {
            err && console.warn("\u52a0\u8f7dSpriteFrame\u51fa\u9519", err);
            next(err, resource);
          });
        };
        return Loader;
      }();
      Util.Loader = Loader;
    })(Util = exports.Util || (exports.Util = {}));
    window["Util"] = Util;
    cc._RF.pop();
  }, {} ],
  View: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "6efe3wputNIJJPqqx3Q0G8J", "View");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var SHOW_ACT_TYPE;
    (function(SHOW_ACT_TYPE) {
      SHOW_ACT_TYPE[SHOW_ACT_TYPE["DEFAULT"] = 1] = "DEFAULT";
      SHOW_ACT_TYPE[SHOW_ACT_TYPE["SCALE"] = 2] = "SCALE";
    })(SHOW_ACT_TYPE = exports.SHOW_ACT_TYPE || (exports.SHOW_ACT_TYPE = {}));
    var View = function() {
      function View(type) {
        this.mRootNode = null;
        this.mNode = null;
        this.mType = null;
        this.showActType = SHOW_ACT_TYPE.DEFAULT;
        this.mType = type;
        this.init();
      }
      View.prototype.init = function() {
        this.mRootNode = new cc.Node();
        this.mRootNode.x = cc.winSize.width / 2;
        this.mRootNode.y = cc.winSize.height / 2;
        this.mRootNode.width = cc.winSize.width;
        this.mRootNode.height = cc.winSize.height;
        cc.game.addPersistRootNode(this.mRootNode);
      };
      View.prototype.onHide = function() {
        this.mNode && this.playHideAnimate();
      };
      View.prototype.onShow = function() {
        if (!this.mNode) throw new Error("Error: View must be init ! ");
        this.playShowAnimate();
      };
      View.prototype.setShowActType = function(showActType) {
        this.showActType = showActType;
      };
      View.prototype.destroy = function() {
        this.mNode = null;
        this.mRootNode = null;
      };
      return View;
    }();
    exports.default = View;
    cc._RF.pop();
  }, {} ],
  VistItemCtrl: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "7a70f8pf4VNH41ZWLCDyBLw", "VistItemCtrl");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuestPanelCtrl_1 = require("./GuestPanelCtrl");
    var Util_1 = require("../../../Base/Utils/Util");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var VistItemCtrl = function(_super) {
      __extends(VistItemCtrl, _super);
      function VistItemCtrl() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.timeLabel = null;
        _this.eventLabel = null;
        return _this;
      }
      VistItemCtrl.prototype.onLoad = function() {};
      VistItemCtrl.prototype.init = function(data) {
        if (data) {
          this.eventLabel.string = "<color=#00AB00>" + data.nickname + "</c> <color=#0076A4>" + this._getEventMsg(data.event) + "</color>";
          this.timeLabel.string = Util_1.Util.Timer.dateFtt("yyyy MM dd hh:mm:ss", new Date(1e3 * data.created_at));
        }
      };
      VistItemCtrl.prototype._getEventMsg = function(id) {
        var result = "";
        switch (id) {
         case GuestPanelCtrl_1.FriendsEventIds.Zan:
          result = "\u7ed9\u4f60\u7684\u9152\u5e97\u70b9\u4e86\u8d5e!";
          break;

         case GuestPanelCtrl_1.FriendsEventIds.Share:
          result = "\u5206\u4eab\u4e86\u4f60\u7684\u9152\u5e97\u5594!";
        }
        return result;
      };
      __decorate([ property(cc.Label) ], VistItemCtrl.prototype, "timeLabel", void 0);
      __decorate([ property(cc.RichText) ], VistItemCtrl.prototype, "eventLabel", void 0);
      VistItemCtrl = __decorate([ ccclass ], VistItemCtrl);
      return VistItemCtrl;
    }(cc.Component);
    exports.default = VistItemCtrl;
    cc._RF.pop();
  }, {
    "../../../Base/Utils/Util": "Util",
    "./GuestPanelCtrl": "GuestPanelCtrl"
  } ],
  Walk: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "2e4e8UM9NdIOYwzBHVCpnDs", "Walk");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var Event_1 = require("../../../../Data/Const/Event");
    var EventMgr_1 = require("../../../../../Base/Manager/EventMgr");
    var Util_1 = require("../../../../../Base/Utils/Util");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var Walk = function(_super) {
      __extends(Walk, _super);
      function Walk() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.speed = 20;
        _this.isWalking = false;
        _this.passedTime = 0;
        _this.nextStep = 0;
        return _this;
      }
      Walk.prototype.startWalk = function(road, isNext) {
        void 0 === isNext && (isNext = false);
        this.isWalking = false;
        this.passedTime = 0;
        this.road = road;
        this.nextStep = isNext ? 1 : Util_1.Util.Tool.rangeInt(1, road.path.length, false);
        this.walkOnRoad(isNext);
      };
      Walk.prototype.walkOnRoad = function(isNext) {
        var _this = this;
        if (this.road.path.length < 2) return;
        this.node.setPosition(this.road.path[this.nextStep - 1]);
        isNext ? this.node.runAction(cc.sequence(cc.fadeIn(.5), cc.callFunc(function() {
          _this.walkToNext();
        }, this))) : this.walkToNext();
      };
      Walk.prototype.walkToNext = function() {
        if (this.nextStep >= this.road.path.length) {
          this.isWalking = false;
          this.walkEnd();
          return;
        }
        var src = this.node.getPosition();
        var dst = this.road.path[this.nextStep];
        var dir = dst.sub(src);
        var len = dir.mag();
        this.slope = dir.x / dir.y;
        this.vx = this.speed * dir.x / len;
        this.vy = this.speed * dir.y / len;
        this.walkTime = len / this.speed;
        this.passedTime = 0;
        this.isWalking = true;
      };
      Walk.prototype.walkEnd = function() {
        var _this = this;
        "0" == this.road.end || "1" == this.road.end ? this.node.runAction(cc.sequence(cc.fadeTo(.5, .001), cc.delayTime(Util_1.Util.Tool.range(2, 5)), cc.callFunc(function() {
          EventMgr_1.default.ins.send(Event_1.Event.Map.WalkEnd, _this);
        }, this))) : this.node.runAction(cc.sequence(cc.delayTime(1), cc.callFunc(function() {
          EventMgr_1.default.ins.send(Event_1.Event.Map.WalkEnd, _this);
        }, this)));
      };
      Walk.prototype.update = function(dt) {
        if (false === this.isWalking) return;
        this.passedTime += dt;
        this.passedTime > this.walkTime && (dt -= this.passedTime - this.walkTime);
        this.node.x += this.vx * dt;
        this.node.y += this.vy * dt;
        this.updateZIndex();
        if (this.passedTime >= this.walkTime) {
          this.nextStep++;
          this.walkToNext();
        }
      };
      Walk.prototype.updateZIndex = function() {
        var parent = this.node.parent;
        for (var _i = 0, _a = parent.children; _i < _a.length; _i++) {
          var child = _a[_i];
          var box1 = child.getBoundingBox();
          var box2 = this.node.getBoundingBox();
          this.slope > 0 ? box1.center.y > box2.center.y && (this.node.zIndex = child.zIndex - 1) : box1.center.x > box2.center.x && (this.node.zIndex = child.zIndex + 1);
        }
      };
      Walk = __decorate([ ccclass ], Walk);
      return Walk;
    }(cc.Component);
    exports.default = Walk;
    cc._RF.pop();
  }, {
    "../../../../../Base/Manager/EventMgr": "EventMgr",
    "../../../../../Base/Utils/Util": "Util",
    "../../../../Data/Const/Event": "Event"
  } ],
  Webapp: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "d9c84Zm8N1KZYoOuT2eQFKY", "Webapp");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BaseConst_1 = require("../../BaseConst");
    var Log_1 = require("../../Utils/Log");
    var StorageMgr_1 = require("../StorageMgr");
    var Webapp = function() {
      function Webapp() {
        this.type = BaseConst_1.PlatformType.Web;
        this.options = null;
      }
      Webapp.prototype.share = function(text, imgUrl) {
        return new Promise(function(rsolve) {
          rsolve(true);
        });
      };
      Webapp.prototype.showBanner = function() {};
      Webapp.prototype.hideBanner = function() {};
      Webapp.prototype.showInterstitialAd = function() {};
      Webapp.prototype.showVideoAd = function() {};
      Webapp.prototype.init = function(o) {
        this.options = o;
      };
      Webapp.prototype.exit = function() {};
      Webapp.prototype.authorize = function() {
        return new Promise(function(resolve) {
          resolve(true);
        });
      };
      Webapp.prototype.login = function() {
        var _this = this;
        return new Promise(function(resolve) {
          var userId = "test19";
          if (!userId) {
            userId = "" + Date.now();
            StorageMgr_1.StorageMgr.Storage.setString("__userId", userId, true);
          }
          resolve({
            code: (_this.options ? _this.options.appId : "tt.tang") + "_" + userId
          });
        });
      };
      Webapp.prototype.getTopBangPosition = function() {
        return 0;
      };
      Webapp.prototype.getSystemInfoSync = function() {
        return {};
      };
      Webapp.prototype.onShow = function() {};
      Webapp.prototype.offShow = function() {};
      Webapp.prototype.onHide = function() {};
      Webapp.prototype.onNetworkStatusChange = function() {};
      Webapp.prototype.createAuthButton = function(box) {
        return new Promise(function(resolve) {
          resolve(null);
        });
      };
      Webapp.prototype.getUserInfo = function() {
        return new Promise(function(resolve) {
          resolve(null);
        });
      };
      Webapp.prototype.getPlatfromVersion = function() {
        return null;
      };
      Webapp.prototype.getFileSystemMgr = function() {
        return null;
      };
      Webapp.prototype.downLoadFile = function(data) {
        return new Promise(function(resolve) {
          resolve(null);
        });
      };
      Webapp.prototype.loadRemotPicture = function(url, type) {
        void 0 === type && (type = "jpg");
        return new Promise(function(resolve, reject) {
          -1 != url.indexOf("http") ? cc.loader.load({
            url: url,
            type: type
          }, function(err, tex) {
            if (err) {
              Log_1.Log.e(err);
              return resolve(null);
            }
            resolve(new cc.SpriteFrame(tex));
          }) : cc.loader.loadRes(url, function(err, tex) {
            if (err) {
              Log_1.Log.e(err);
              return resolve(null);
            }
            resolve(new cc.SpriteFrame(tex));
          });
        });
      };
      Webapp.prototype.checkUpdate = function() {};
      Webapp.prototype.unzip = function(path) {
        return false;
      };
      Webapp.prototype.vibrateShort = function() {};
      Webapp.prototype.getMenuButtonBoundingClientRect = function() {
        return null;
      };
      Webapp.prototype.vibrateLong = function() {};
      return Webapp;
    }();
    exports.default = Webapp;
    cc._RF.pop();
  }, {
    "../../BaseConst": "BaseConst",
    "../../Utils/Log": "Log",
    "../StorageMgr": "StorageMgr"
  } ],
  Wechat: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "eea1doqNGhKAaXgztbwxzCS", "Wechat");
    "use strict";
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var BaseConst_1 = require("../../BaseConst");
    var EventMgr_1 = require("../EventMgr");
    var Log_1 = require("../../Utils/Log");
    var Util_1 = require("../../Utils/Util");
    var Paths_1 = require("../../Utils/Paths");
    var M_1 = require("../M");
    var RuntimeMgr_1 = require("../../../Logic/Data/RuntimeMgr");
    var NetMgr_1 = require("../NetMgr");
    var Wechat = function() {
      function Wechat() {
        this.type = BaseConst_1.PlatformType.WxGame;
        this.systemInfo = null;
        this.userInfo = null;
        this.options = null;
        this._shareResolve = null;
        this._bannerAD = null;
        this._interstitialAD = null;
        this._onShow = null;
        this._onHide = null;
        this._onBannerError = null;
        this._onBannerResize = null;
        this._isIntrstitialReady = false;
        this._videoResolve = null;
        this._videoMap = null;
        this.wxOpenDataKey = {
          Score: "Score"
        };
        wx.showShareMenu({
          withShareTicket: true
        });
        wx.setKeepScreenOn({
          keepScreenOn: true
        });
        wx.onMemoryWarning(function(res) {
          EventMgr_1.default.ins.send(BaseConst_1.PlatformEvenType.OnMemoryWarning);
        });
        this._videoMap = new Map();
        this._onShow = this._showCallBack.bind(this);
        this._onHide = this._hideCallBack.bind(this);
        this.onShow();
        this.onHide();
      }
      Wechat.prototype.init = function(o) {
        this.options = o;
        o && o.adIds && o.adIds.Interstitial && this._createInterstitialAd(o.adIds.Interstitial);
        o && o.adIds && o.adIds.Video && this._createInterstitialAd(o.adIds.Interstitial);
      };
      Wechat.prototype.exit = function() {
        wx.exitMiniProgram({});
      };
      Wechat.prototype.authorize = function() {
        return __awaiter(this, void 0, Promise, function() {
          return __generator(this, function(_a) {
            return [ 2, this.getUserInfo() ];
          });
        });
      };
      Wechat.prototype.login = function() {
        var _this = this;
        return new Promise(function(resolve, reject) {
          wx.login({
            success: function(codeObj) {
              return __awaiter(_this, void 0, void 0, function() {
                return __generator(this, function(_a) {
                  resolve({
                    code: codeObj.code
                  });
                  return [ 2 ];
                });
              });
            },
            fail: function(e) {
              Log_1.Log.e("WeChat Login Error : ", e);
              resolve(null);
            }
          });
        });
      };
      Wechat.prototype.getTopBangPosition = function() {
        var top = this.getSystemInfoSync().safeArea.top;
        0 != top && (top = 2 * (top - 20));
        return top;
      };
      Wechat.prototype.getMenuButtonBoundingClientRect = function() {
        var result = null;
        if (wx.getMenuButtonBoundingClientRect) {
          var rect = wx.getMenuButtonBoundingClientRect();
          var dpr = cc.view.getDevicePixelRatio();
          var vsp = cc.v2(Math.ceil(cc.view.getCanvasSize().width / dpr), Math.ceil(cc.view.getCanvasSize().height / dpr));
          var vs = cc.view.getVisibleSize();
          var t = vsp.x / cc.view.getVisibleSize().width;
          result = cc.rect(Math.ceil(rect.left / t - .5 * vs.width), Math.ceil(.5 * vs.height - rect.bottom / t), Math.ceil(rect.width / t), Math.ceil(rect.height / t));
        }
        return result;
      };
      Wechat.prototype.getSystemInfoSync = function() {
        this.systemInfo || (this.systemInfo = wx.getSystemInfoSync());
        return this.systemInfo;
      };
      Wechat.prototype.getLaunchOptionsSync = function() {
        this.launchOptions = wx.getLaunchOptionsSync();
      };
      Wechat.prototype.onShow = function() {
        wx.onShow(this._onShow);
        this._onShow(wx.getLaunchOptionsSync());
        wx.onShareAppMessage(function() {
          return {
            title: [ "\u68a6\u5e7b\u6d77\u5c9b\u7684\u65c5\u884c,\u4e00\u5b9a\u8981\u548c\u6700\u7231\u7684\u4eba\u53bb", "\u5feb\u6765\u548c\u5c0f\u91ce\u4e00\u8d77\u6316\u6d77\u5e95\u7684\u5b9d\u77f3\u5427" ][Util_1.Util.Tool.rangeInt(0, 1)],
            imageUrl: [ Paths_1.default.ShareImgPath + "level_share_25.png", Paths_1.default.ShareImgPath + "level_share_45.png" ][Util_1.Util.Tool.rangeInt(0, 1)],
            query: "timeStamp=" + Date.parse(new Date().toString()) + "&uid=" + M_1.default.runtime.UserId
          };
        });
      };
      Wechat.prototype.offShow = function() {
        wx.offShow(this._onShow);
      };
      Wechat.prototype.onHide = function() {
        wx.onHide(this._onHide);
      };
      Wechat.prototype.offHide = function() {
        wx.offHide(this._onHide);
      };
      Wechat.prototype.onNetworkStatusChange = function() {
        wx.onNetworkStatusChange(this._netWorkStatusChanged);
      };
      Wechat.prototype.getUserInfo = function() {
        var _this = this;
        return new Promise(function(resolve, reject) {
          _this.userInfo ? resolve(_this.userInfo) : wx.getUserInfo({
            withCredentials: false,
            success: function(res) {
              res && (_this.userInfo = res.userInfo);
              resolve(res.userInfo);
            },
            fail: function(err) {
              return __awaiter(_this, void 0, void 0, function() {
                return __generator(this, function(_a) {
                  Log_1.Log.e("\u6ca1\u6709\u53d6\u5f97\u6388\u6743,\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25!", err);
                  resolve(null);
                  return [ 2 ];
                });
              });
            }
          });
        });
      };
      Wechat.prototype.getPlatfromVersion = function() {
        return this.systemInfo.SDKVersion;
      };
      Wechat.prototype.getFileSystemMgr = function() {
        return wx.getFileSystemManager();
      };
      Wechat.prototype.share = function(text, imgUrl, levelFailAddStep) {
        var _this = this;
        void 0 === levelFailAddStep && (levelFailAddStep = 0);
        cc.log("\u597d\u53cb\u52a9\u529b\u5206\u4eablevelFailAddStep  " + levelFailAddStep);
        return new Promise(function(resolve) {
          _this._shareResolve = resolve;
          wx.shareAppMessage({
            title: text,
            imageUrl: imgUrl,
            query: "timeStamp=" + Date.parse(new Date().toString()) + "&uid=" + M_1.default.runtime.UserId + "&levelAddStep=" + levelFailAddStep
          });
        });
      };
      Wechat.prototype._execShareReward = function(res) {
        if (this._shareResolve && res && res.query) if (res.query.timeStamp) {
          var gap = Date.now() - Number(res.query.timeStamp);
          gap >= 3e3 ? this._shareResolve(true) : this._shareResolve(false);
        } else this._shareResolve(true);
        RuntimeMgr_1.default.ins.IsLogin ? NetMgr_1.default.ins.addFriend(res.query.uid) : RuntimeMgr_1.default.ins.pushOnShowTask(res.query.uid);
      };
      Wechat.prototype.downLoadFile = function(data) {
        return new Promise(function(resolve) {
          wx.downloadFile({
            url: data.url,
            filePath: data.filePath,
            success: function(res) {
              console.error("downLoadFile : ", res);
              console.error("wx.env:", wx.env.USER_DATA_PATH);
              resolve(res);
            },
            fail: function(err) {
              Log_1.Log.e("downLoadFile Err : ", err);
              resolve(null);
            }
          });
        });
      };
      Wechat.prototype.loadRemotPicture = function(url, type) {
        void 0 === type && (type = "jpg");
        return new Promise(function(resolve, reject) {
          if (!url) return resolve(null);
          cc.loader.load({
            url: url,
            type: type
          }, function(err, tex) {
            if (err) {
              Log_1.Log.e(err);
              return resolve(null);
            }
            resolve(new cc.SpriteFrame(tex));
          });
        });
      };
      Wechat.prototype.checkUpdate = function() {
        var updateManager = wx.getUpdateManager();
        if (updateManager) {
          updateManager.onCheckForUpdate(function(res) {
            Log_1.Log.i("onCheckForUpdate: ", res.hasUpdate);
          });
          updateManager.onUpdateReady(function() {
            wx.showModal({
              title: "\u66f4\u65b0\u63d0\u793a",
              content: "\u53d1\u73b0\u65b0\u7248\u672c,\u8bf7\u91cd\u65b0\u6253\u5f00\u6e38\u620f.",
              success: function(res) {
                res.confirm && updateManager.applyUpdate();
              }
            });
          });
          updateManager.onUpdateFailed(function() {});
        }
      };
      Wechat.prototype.unzip = function(path) {
        return false;
      };
      Wechat.prototype.vibrateShort = function() {
        wx.vibrateShort({});
      };
      Wechat.prototype.vibrateLong = function() {
        wx.vibrateLong({});
      };
      Wechat.prototype.showBanner = function(adId) {
        this._bannerAD || this._createBanner(adId);
        this._bannerAD.show().then(function() {}).catch(function(err) {
          console.error("catch show banner error : ", err);
        });
      };
      Wechat.prototype.hideBanner = function() {
        this._bannerAD && this._bannerAD.hide();
      };
      Wechat.prototype.showVideoAd = function(adId) {
        var _this = this;
        return new Promise(function(resolve) {
          _this._videoResolve = resolve;
          var _videoAd = _this._videoMap.get(adId);
          _videoAd || (_videoAd = _this._createVideo(adId));
          var play = function() {
            _videoAd.show().then(function() {}).catch(function(err) {
              console.error("catch show video error : ", err);
              _videoAd.load().then(function() {
                play();
              });
            });
          };
          play();
        });
      };
      Wechat.prototype._createVideo = function(adId) {
        var _videoAd = wx.createRewardedVideoAd({
          adUnitId: adId
        });
        _videoAd.onClose(this._onVideoClose.bind(this));
        _videoAd.onError(this._onVideoError.bind(this));
        _videoAd.load();
        this._videoMap.set(adId, _videoAd);
        return _videoAd;
      };
      Wechat.prototype._onVideoError = function(err) {
        console.error("show video error : ", err);
        this._videoResolve;
      };
      Wechat.prototype._onVideoClose = function(res) {
        this._videoResolve && (res && res.isEnded || void 0 === res ? this._videoResolve(true) : this._videoResolve(false));
      };
      Wechat.prototype.showInterstitialAd = function(adId) {
        this._interstitialAD || this._createInterstitialAd(adId);
        this._interstitialAD.show().then(function() {}).catch(function(err) {
          console.error("catch show Interstitial error : ", err);
        });
      };
      Wechat.prototype._createInterstitialAd = function(adId) {
        this._interstitialAD = wx.createInterstitialAd({
          adUnitId: adId
        });
        this._interstitialAD.onLoad(this._onInterstitialLoad.bind(this));
        this._interstitialAD.onClose(this._onInterstitialClose.bind(this));
        this._interstitialAD.onError(this._onInterstitialError.bind(this));
      };
      Wechat.prototype._onInterstitialClose = function() {
        this._isIntrstitialReady = false;
      };
      Wechat.prototype._onInterstitialError = function(err) {
        console.error("show Interstitial error : ", err);
      };
      Wechat.prototype._onInterstitialLoad = function() {
        this._isIntrstitialReady = true;
      };
      Wechat.prototype._createBanner = function(bannerId) {
        if (this._onBannerError) {
          if (this._bannerAD) {
            this._bannerAD.offError(this._bannerOnError);
            this._bannerAD.offResize(this._bannerOnResize);
          }
        } else {
          this._onBannerError = this._bannerOnError.bind(this);
          this._onBannerResize = this._bannerOnResize.bind(this);
        }
        this._bannerAD = wx.createBannerAd({
          adUnitId: bannerId,
          adIntervals: 30,
          style: {
            left: 10,
            top: 76,
            width: 320
          }
        });
        this._bannerAD.onError(this._onBannerError);
        this._bannerAD.onResize(this._onBannerResize);
      };
      Wechat.prototype._bannerOnError = function(err) {
        console.error("show banner error : ", err);
      };
      Wechat.prototype._bannerOnResize = function() {
        console.error("banner resize : ");
      };
      Wechat.prototype._netWorkStatusChanged = function(res) {
        EventMgr_1.default.ins.send(BaseConst_1.PlatformEvenType.OnNetWorkChanged, res);
      };
      Wechat.prototype._showCallBack = function(res) {
        console.warn("on show!", res.query);
        this.launchOptions = res;
        this._execShareReward(res);
        EventMgr_1.default.ins.send(BaseConst_1.PlatformEvenType.OnShow, res);
      };
      Wechat.prototype._hideCallBack = function() {
        EventMgr_1.default.ins.send(BaseConst_1.PlatformEvenType.OnHide);
      };
      Wechat.prototype.createAuthButton = function(box) {
        var _this = this;
        if (!box) return null;
        return new Promise(function(resolve) {
          var btnSize = cc.size(box.w + 10, box.h + 10);
          var frameSize = cc.view.getFrameSize();
          var winSize = cc.winSize;
          var left = (winSize.width / 2 + box.x - btnSize.width / 2) / winSize.width * frameSize.width;
          var top = (winSize.height / 2 - box.y - btnSize.height / 2) / winSize.height * frameSize.height;
          var width = btnSize.width / winSize.width * frameSize.width;
          var height = btnSize.height / winSize.height * frameSize.height;
          var wxButton = wx.createUserInfoButton({
            type: "text",
            text: "",
            withCredentials: false,
            style: {
              left: left,
              top: top,
              width: width,
              height: height,
              backgroundColor: "",
              color: "#ffffff",
              borderColor: "",
              borderWidth: 0,
              borderRadius: 4,
              textAlign: "center",
              fontSize: 16,
              lineHeight: 0
            }
          });
          wxButton.onTap(function(uinfo) {
            if (uinfo.userInfo) {
              _this.userInfo = uinfo.userInfo;
              resolve(_this.userInfo);
              wxButton.hide();
            } else resolve(null);
          });
        });
      };
      Wechat.prototype.sendMsgToOpenData = function(msg) {
        wx.getOpenDataContext().postMessage(msg);
      };
      Wechat.prototype.uploadDataToWx = function(key, score) {
        wx.setUserCloudStorage({
          KVDataList: [ {
            key: key,
            value: "" + score
          } ],
          success: function(msg) {},
          fail: function(err) {
            console.error("\u5931\u8d25!", err);
          }
        });
      };
      Wechat.prototype.deleteWxDataForKeys = function(keys) {
        "string" === typeof keys && (keys = [ keys ]);
        wx.removeUserCloudStorage({
          keyList: keys
        });
      };
      return Wechat;
    }();
    exports.default = Wechat;
    cc._RF.pop();
  }, {
    "../../../Logic/Data/RuntimeMgr": "RuntimeMgr",
    "../../BaseConst": "BaseConst",
    "../../Utils/Log": "Log",
    "../../Utils/Paths": "Paths",
    "../../Utils/Util": "Util",
    "../EventMgr": "EventMgr",
    "../M": "M",
    "../NetMgr": "NetMgr"
  } ],
  _Guide_level10: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "970f7WMayZF65DZ2893/bvs", "_Guide_level10");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideUtils_1 = require("./GuideUtils");
    var M_1 = require("../Script/Base/Manager/M");
    exports.task = {
      name: "\u5173\u536110 \u7ed3\u675f",
      debug: false,
      autorun: false,
      filename: "_Guide_level10",
      steps: [ {
        guideId: 1001,
        onStart: function(next) {
          var boxData = M_1.default.runtime.getBoxGiftDataByLv(10);
          if (!boxData) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          if (boxData && boxData.received) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "10\u5173\u7ed3\u675f\u5f15\u5bfc\u53bb\u9886\u53d6\u5b9d\u7bb1",
        command: {
          cmd: "text",
          args: "\u592a\u68d2\u4e86\uff01\u6bcf\u8fc710\u5173\u80fd\u6253\u635e\u5230\u4e00\u4e2a\u5b9d\u7bb1\u3002",
          role: 2
        },
        noCheckDone: true,
        mask: true
      }, {
        guideId: 1002,
        desc: "\u624b\u6307\u6307\u5f15\u70b9\u51fb\u5b9d\u7bb1",
        command: {
          cmd: "finger",
          args: "Canvas/boxProgress/box1"
        }
      } ]
    };
    cc._RF.pop();
  }, {
    "../Script/Base/Manager/M": "M",
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level11_1: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "e1292N0NbFI5Z536RjBmDPr", "_Guide_level11_1");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideUtils_1 = require("./GuideUtils");
    var UIMgr_1 = require("../Script/Base/Manager/UIMgr");
    var UIData_1 = require("../Script/Logic/Data/Interface/UIData");
    exports.task = {
      name: "\u5173\u536111 \u4e4b\u540e\u5982\u82e5\u9996\u6b21\u5931\u8d25",
      debug: false,
      autorun: false,
      filename: "_Guide_level11_1",
      steps: [ {
        guideId: 1100001,
        onStart: function(next) {
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "11\u5173\u5f15\u5bfc\u53bb\u4f7f\u7528\u9053\u5177",
        command: {
          cmd: "text",
          args: "\u5931\u8d25\u4e86\u4e0d\u8981\u7d27\uff0c\u9001\u4f60\u4e2a\u3010\u70b8\u5f39\u3011\u9053\u5177\u518d\u6765\u4e00\u628a",
          role: 2
        },
        onEnd: function(next) {
          GuideUtils_1.GuideUtils.checkGuideDone(1100001) || UIMgr_1.default.ins.showUI(UIData_1.UIHudDef.PropDropView, {
            itemId: 100,
            num: 1
          });
          next(GuideUtils_1.EGuideStart.None);
        },
        mask: true,
        delayTime: 2
      } ]
    };
    cc._RF.pop();
  }, {
    "../Script/Base/Manager/UIMgr": "UIMgr",
    "../Script/Logic/Data/Interface/UIData": "UIData",
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level11: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "d0746abwGBFDZPI0a5bMJl8", "_Guide_level11");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideUtils_1 = require("./GuideUtils");
    exports.task = {
      name: "\u5173\u536111 \u5c40\u5185\u9053\u5177\u4f7f\u7528",
      debug: false,
      autorun: false,
      filename: "_Guide_level11",
      steps: [ {
        guideId: 1101,
        onStart: function(next) {
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "11\u5173\u5f15\u5bfc\u53bb\u4f7f\u7528\u9053\u5177",
        command: {
          cmd: "text",
          args: "\u68cb\u76d8\u597d\u50cf\u5f88\u96be\u6d88\u9664\u4e86\uff0c\u8bd5\u8bd5\u65b0\u9053\u5177\u5237\u65b0\u4e00\u4e0b\u68cb\u76d8\u5427\u3002",
          role: 2
        },
        mask: true,
        delayTime: 2
      }, {
        guideId: 1102,
        desc: "\u624b\u6307\u6307\u5f15\u4f7f\u7528\u9053\u5177",
        command: {
          cmd: "finger",
          args: "Canvas/ui/bottom/propsBar/item_102/bg",
          maskType: 1
        }
      } ]
    };
    cc._RF.pop();
  }, {
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level15_rank: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "29d8bvE4mRB+LfgVoxDf1W5", "_Guide_level15_rank");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    exports.task = {
      name: "\u5173\u536115 \u6e38\u620f\u7ed3\u675f\u540e\u53bb\u6392\u884c\u699c",
      debug: false,
      autorun: false,
      filename: "_Guide_level5_rank",
      steps: [ {
        guideId: 1501,
        desc: "\u5173\u536115 \u6e38\u620f\u7ed3\u675f\u540e\u53bb\u6392\u884c\u699c",
        command: {
          cmd: "text",
          args: "\u6211\u4eec\u5df2\u7ecf\u83b7\u5f97\u8db3\u591f\u7684\u79ef\u5206\uff0c\u6765\u770b\u770b\u6211\u4eec\u5728\u5168\u670d\u7684\u6392\u540d\u5427\u3002",
          role: 2
        },
        mask: true
      }, {
        guideId: 1502,
        desc: "\u624b\u6307\u6307\u5f15\u70b9\u51fb\u6392\u884c\u699c",
        command: {
          cmd: "finger",
          args: "Canvas/UI/Bottom/leftBtns/main_icon_phb"
        }
      } ]
    };
    cc._RF.pop();
  }, {} ],
  _Guide_level1: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "84b9biq5ktMyrmxHOKMwthF", "_Guide_level1");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideCondition_1 = require("./GuideCondition");
    var GuideUtils_1 = require("./GuideUtils");
    var GuideData_1 = require("./GuideData");
    exports.task = {
      name: "\u5173\u53611 \u9996\u6b21\u8fdb\u5165\u6e38\u620f",
      debug: false,
      autorun: false,
      filename: "_Guide_level1",
      steps: [ {
        guideId: 1,
        onStart: function(next) {
          var result = GuideCondition_1.GuideCondition.checkLevelFinished(1);
          if (result) {
            GuideData_1.GuideData.pushFinishedTask("_Guide_level1");
            next(GuideUtils_1.EGuideStart.Stop);
          } else next(GuideUtils_1.EGuideStart.None);
        },
        desc: "\u9996\u6b21\u8fdb\u5165\u6e38\u620f",
        command: {
          cmd: "text",
          args: "\u6b22\u8fce\u6765\u5230\u5c0f\u5c9b\uff01\u5148\u6765\u4e00\u5c40\u6e38\u620f\u5427\uff01",
          role: 2
        },
        noCheckDone: true,
        mask: true
      }, {
        guideId: 2,
        desc: "\u70b9\u51fb\u5f00\u59cb\u6e38\u620f",
        command: {
          cmd: "finger",
          args: "UI > Bottom > goMatchBtn"
        },
        if: "-checkLevelFinished",
        param: 1,
        noCheckDone: true
      }, {
        guideId: 3,
        desc: "\u70b9\u51fb\u5f00\u59cb\u5173\u5361\u6309\u94ae",
        command: {
          cmd: "finger",
          args: "UIRoot:SelectShowTarget/btn_green"
        },
        delayTime: .5,
        noCheckDone: true
      } ]
    };
    cc._RF.pop();
  }, {
    "./GuideCondition": "GuideCondition",
    "./GuideData": "GuideData",
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level21: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "96ee6OehGxB066T+hWQ5eks", "_Guide_level21");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideUtils_1 = require("./GuideUtils");
    exports.task = {
      name: "\u5173\u536121 \u5f15\u5bfc\u4f7f\u7528\u9053\u5177",
      debug: false,
      autorun: false,
      filename: "_Guide_level21",
      steps: [ {
        guideId: 2101,
        onStart: function(next) {
          if (GuideUtils_1.GuideUtils.checkGuideDone(2101)) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "\u5173\u536121 \u4f7f\u7528\u9053\u5177",
        command: {
          cmd: "text",
          args: "\u4f7f\u7528\u3010\u6b65\u6570\u3011\u9053\u5177\u53ef\u4ee5\u589e\u52a0\u989d\u5916\u6b65\u6570\uff0c\u63d0\u524d\u505a\u597d\u51c6\u5907",
          role: 2
        },
        mask: true
      }, {
        guideId: 2102,
        desc: "\u624b\u6307\u6307\u5f15\u70b9\u51fb\u9053\u51771",
        command: {
          cmd: "finger",
          args: "UIRoot:SelectShowTarget/propContent/content/prop1",
          maskType: 1
        }
      } ]
    };
    cc._RF.pop();
  }, {
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level30: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "39fc7gYLKBCG6m23j7ITgWA", "_Guide_level30");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideUtils_1 = require("./GuideUtils");
    var M_1 = require("../Script/Base/Manager/M");
    var Event_1 = require("../Script/Logic/Data/Const/Event");
    var EventMgr_1 = require("../Script/Base/Manager/EventMgr");
    exports.task = {
      name: "\u5173\u536130 \u7ae0\u8282\u89e3\u9501\u5f15\u5bfc",
      debug: false,
      autorun: false,
      filename: "_Guide_level30",
      steps: [ {
        guideId: 3001,
        onStart: function(next) {
          EventMgr_1.default.ins.send(Event_1.Event.UI.LevelSceneTouched, false);
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "\u5173\u536130 \u7ae0\u8282\u5f15\u5bfc\u89e3\u9501",
        command: {
          cmd: "text",
          args: "\u4e1b\u6797\u7684\u63a2\u9669\u544a\u4e00\u6bb5\u843d\u4e86\uff0c\u6211\u4eec\u53bb\u770b\u770b\u4e0b\u4e00\u7ae0\u7684\u6d77\u6ee9\u5427",
          role: 2
        },
        onEnd: function(next) {
          M_1.default.tips.show("\u606d\u559c\u7b2c\u4e8c\u7ae0 \u201c\u9633\u5149\u6c99\u6ee9\u201d \u89e3\u9501\u4e86\uff01");
          M_1.default.event.send(Event_1.Event.UI.ChapterUnlock, {
            index: 1,
            play: true
          });
          next(GuideUtils_1.EGuideStart.None);
        },
        mask: true
      } ]
    };
    cc._RF.pop();
  }, {
    "../Script/Base/Manager/EventMgr": "EventMgr",
    "../Script/Base/Manager/M": "M",
    "../Script/Logic/Data/Const/Event": "Event",
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level3_1: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "781acgeGq9DupGyX7A1TVUk", "_Guide_level3_1");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideUtils_1 = require("./GuideUtils");
    var EventMgr_1 = require("../Script/Base/Manager/EventMgr");
    var Event_1 = require("../Script/Logic/Data/Const/Event");
    var MapIslandUtils_1 = require("../Script/Logic/SimulationOperation/View/Map/MapIslandUtils");
    var MoneyManager_1 = require("../Script/Logic/Data/MoneyManager");
    var GuideData_1 = require("./GuideData");
    exports.task = {
      name: "\u5173\u53613 \u5f15\u5bfc\u6d77\u5c9b\u89e3\u9501\u6e38\u8247",
      debug: false,
      autorun: false,
      filename: "_Guide_level3_1",
      steps: [ {
        guideId: 3030002,
        desc: "\u663e\u793a\u5bf9\u8bdd",
        onStart: function(next) {
          if (!MapIslandUtils_1.default.mapLoadFinished) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          var result = MapIslandUtils_1.default.checkBuildFixed(15) && MapIslandUtils_1.default.checkBuildFinished(15);
          if (result) {
            GuideData_1.GuideData.pushFinishedTask("_Guide_level3_1");
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          next(GuideUtils_1.EGuideStart.None);
        },
        command: {
          cmd: "text",
          args: "\u5929\u54ea\uff0c\u5c0f\u5c9b\u7adf\u7136\u53d8\u6210\u8fd9\u4e2a\u6837\u5b50\u4e86\uff0c\u6211\u4e00\u5b9a\u8981\u5c06\u5b83\u8fd8\u539f\u6210\u8fc7\u53bb\u7684\u6837\u5b50\uff01\u4f60\u80fd\u5e2e\u5e2e\u6211\u4e48\uff1f",
          role: 1,
          positionY: -500
        },
        delayTime: 1,
        if: "checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 3030003,
        desc: "\u663e\u793a\u5bf9\u8bdd",
        command: {
          cmd: "text",
          args: "\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u5148\u70b9\u51fb\u4fee\u590d\u6309\u94ae\uff0c\u8fd9\u8258\u8239\u770b\u8d77\u6765\u80fd\u5f88\u5feb\u4fee\u597d\u3002",
          role: 1,
          positionY: -500
        },
        if: "checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 3030004,
        desc: "\u6307\u5f15\u8239\u53ea\u7684\u70b9\u51fb\u4fee\u7406icon",
        onStart: function(next) {
          EventMgr_1.default.ins.send(Event_1.Event.Map.MapTouchMoveEnable, false);
          next(GuideUtils_1.EGuideStart.None);
        },
        command: {
          cmd: "finger",
          args: "Map > Wharf > B15_boat > LockItem",
          type: "MapItem",
          maskType: 1
        },
        if: "checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 3030005,
        onStart: function(next) {
          var result = MapIslandUtils_1.default.checkBuildFixed(15);
          if (result) next(GuideUtils_1.EGuideStart.ConditionNotReach); else {
            var buildConfig = MapIslandUtils_1.default.getBuildConfigById(15);
            var moneyCheck = MoneyManager_1.MoneyManager.CheckMoneyJson(buildConfig.price[0], false, MoneyManager_1.MoneyTipsType.None);
            if (!moneyCheck) {
              next(GuideUtils_1.EGuideStart.Stop);
              return;
            }
            next(GuideUtils_1.EGuideStart.None);
          }
        },
        desc: "\u70b9\u51fb\u8239\u53ea\u7684\u4fee\u7406icon",
        command: {
          cmd: "finger",
          args: "BuildTool/unlock",
          type: "MapUI",
          maskType: 1
        },
        if: "checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 3030006,
        desc: "\u6587\u5b57\u663e\u793a",
        onStart: function(next) {
          var result = MapIslandUtils_1.default.checkBuildFinished(15);
          next(result ? GuideUtils_1.EGuideStart.Stop : GuideUtils_1.EGuideStart.None);
        },
        command: {
          cmd: "text",
          args: "\u7adf\u7136\u67092\u79cd\u6837\u5f0f\u53ef\u4ee5\u9009\u62e9\uff0c\u9009\u4e00\u79cd\u8fdb\u884c\u88c5\u626e\u5427\uff01\u8bb0\u5f97\u70b9\u51fb\u53f3\u8fb9\u7684'\u221a'\u4fdd\u5b58\u4f60\u7684\u9009\u62e9\u54df~",
          role: 1,
          positionY: -500
        },
        if: "checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 3030007,
        desc: "\u70b9\u51fb\u8239\u53eaicon\u7684\u4e24\u4e2a",
        command: {
          cmd: "finger",
          args: "BuildTool/exchange/content",
          type: "MapUI",
          hideFinger: true,
          maskType: 1
        },
        if: "checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 3030008,
        desc: "\u70b9\u51fb\u8239\u53eaicon\u7684\u786e\u5b9a\u6309\u94ae",
        command: {
          cmd: "finger",
          args: "BuildTool/exchange/btn_confirm",
          type: "MapUI"
        },
        if: "checkAtMapScene",
        noCheckDone: true
      } ]
    };
    cc._RF.pop();
  }, {
    "../Script/Base/Manager/EventMgr": "EventMgr",
    "../Script/Logic/Data/Const/Event": "Event",
    "../Script/Logic/Data/MoneyManager": "MoneyManager",
    "../Script/Logic/SimulationOperation/View/Map/MapIslandUtils": "MapIslandUtils",
    "./GuideData": "GuideData",
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level3_2: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "96ff4dC059N/KDA6vr6Zvry", "_Guide_level3_2");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideUtils_1 = require("./GuideUtils");
    var MapIslandUtils_1 = require("../Script/Logic/SimulationOperation/View/Map/MapIslandUtils");
    var MoneyManager_1 = require("../Script/Logic/Data/MoneyManager");
    var GuideData_1 = require("./GuideData");
    exports.task = {
      name: "\u5173\u53613 \u5f15\u5bfc\u6d77\u5c9b\u89e3\u9501\u7801\u5934",
      debug: false,
      autorun: false,
      filename: "_Guide_level3_2",
      steps: [ {
        guideId: 3031001,
        desc: "\u6587\u5b57 ",
        onStart: function(next) {
          var result = MapIslandUtils_1.default.checkBuildFixed(16) || MapIslandUtils_1.default.checkBuildFinished(16);
          if (result) {
            next(GuideUtils_1.EGuideStart.Stop);
            GuideData_1.GuideData.pushFinishedTask("_Guide_level3_2");
          } else next(GuideUtils_1.EGuideStart.None);
        },
        command: {
          cmd: "text",
          args: "\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u6765\u4fee\u7406\u4e00\u4e0b\u5c0f\u7801\u5934\u5427~",
          role: 1,
          positionY: -500
        },
        if: "checkNoDialogUI,checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 3031002,
        desc: "\u6307\u5f15\u4fee\u590d\u5c0f\u7801\u5934",
        onStart: function(next) {
          var result = MapIslandUtils_1.default.checkBuildFixed(16);
          next(result ? GuideUtils_1.EGuideStart.Stop : GuideUtils_1.EGuideStart.None);
        },
        command: {
          cmd: "finger",
          args: "Map > Wharf > B16_xiaomatou > LockItem",
          type: "MapItem",
          maskType: 1
        },
        if: "checkNoDialogUI,checkAtMapScene"
      }, {
        guideId: 3031004,
        desc: "\u70b9\u51fb\u5c0f\u7801\u5934\u7684\u4fee\u7406icon",
        command: {
          cmd: "finger",
          args: "BuildTool/unlock",
          type: "MapUI",
          maskType: 1
        },
        if: "checkAtMapScene"
      }, {
        guideId: 3031005,
        desc: "\u6587\u5b57\u63d0\u793a\u53bb\u6e38\u73a9\u5173\u5361",
        onStart: function(next) {
          var buildConfig = MapIslandUtils_1.default.getBuildConfigById(16);
          var moneyCheck = MoneyManager_1.MoneyManager.CheckMoneyJson(buildConfig.price[0], false, MoneyManager_1.MoneyTipsType.None);
          next(moneyCheck ? GuideUtils_1.EGuideStart.Stop : GuideUtils_1.EGuideStart.None);
        },
        command: {
          cmd: "text",
          args: "\u91d1\u5e01\u4e0d\u592a\u591f\u554a\uff0c\u6d88\u9664\u53ef\u4ee5\u83b7\u5f97\u91d1\u5e01\u548c\u661f\u7ea7\uff0c\u6211\u4eec\u5148\u53bb\u8fdb\u884c\u6d88\u9664\u6e38\u620f\u5427\uff01",
          role: 1,
          positionY: -500
        }
      }, {
        guideId: 3031006,
        desc: "\u70b9\u51fb\u5f00\u59cb\u6e38\u620f\u6309\u94ae",
        command: {
          cmd: "finger",
          args: "UIRoot:SelectShowTarget/btn_green"
        }
      } ]
    };
    cc._RF.pop();
  }, {
    "../Script/Logic/Data/MoneyManager": "MoneyManager",
    "../Script/Logic/SimulationOperation/View/Map/MapIslandUtils": "MapIslandUtils",
    "./GuideData": "GuideData",
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level3: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "f1940T5lnJECZieqjNQ4KW1", "_Guide_level3");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideCondition_1 = require("./GuideCondition");
    var GuideUtils_1 = require("./GuideUtils");
    var EventMgr_1 = require("../Script/Base/Manager/EventMgr");
    var Event_1 = require("../Script/Logic/Data/Const/Event");
    var MapIslandUtils_1 = require("../Script/Logic/SimulationOperation/View/Map/MapIslandUtils");
    var M_1 = require("../Script/Base/Manager/M");
    var UIMgr_1 = require("../Script/Base/Manager/UIMgr");
    var UIData_1 = require("../Script/Logic/Data/Interface/UIData");
    exports.task = {
      name: "\u5173\u53613 \u6e38\u620f\u7ed3\u675f",
      debug: false,
      autorun: false,
      filename: "_Guide_level3",
      steps: [ {
        guideId: 301,
        onStart: function(next) {
          var result = GuideCondition_1.GuideCondition.checkLevel(3) && GuideCondition_1.GuideCondition.checkUIOpen("GameWin");
          if (!result) {
            next(GuideUtils_1.EGuideStart.ConditionNotReach);
            return;
          }
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "\u7b2c\u4e09\u5173\u901a\u5173\u5f15\u5bfc\u5173\u95ed",
        command: {
          cmd: "text",
          args: "\u901a\u5f80\u6d77\u5c9b\u7684\u822a\u9053\u5f00\u901a\u54af\uff01\u6211\u4eec\u4e00\u8d77\u56de\u7237\u7237\u7684\u5c9b\u4e0a\u770b\u671b\u4e00\u4e0b\u4ed6\u5427\uff01",
          role: 1,
          positionY: -500
        },
        delayTime: 2
      }, {
        guideId: 302,
        onStart: function(next) {
          var result = GuideCondition_1.GuideCondition.checkLevel(3) && GuideCondition_1.GuideCondition.checkUIOpen("GameWin");
          if (!result) {
            next(GuideUtils_1.EGuideStart.ConditionNotReach);
            return;
          }
          GuideCondition_1.GuideCondition.checkUIOpen("SelectShowTarget") && UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.SelectShowTarget);
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "\u5173\u95ed\u7bad\u5934",
        command: {
          cmd: "finger",
          args: "UIRoot:GameWin/btn_back"
        },
        if: "checkUIOpen",
        param: "GameWin"
      }, {
        onStart: function(callback) {
          GuideCondition_1.GuideCondition.checkUIOpen("SelectShowTarget") && UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.SelectShowTarget);
          var result = !GuideUtils_1.GuideUtils.checkGuideDone(303) && M_1.default.runtime.getStarCount() == MapIslandUtils_1.default.openMapNeedStar();
          if (result) {
            EventMgr_1.default.ins.send(Event_1.Event.UI.LevelSceneTouched, false);
            setTimeout(function() {
              EventMgr_1.default.ins.send(Event_1.Event.Map.UnLockIsland);
              callback(GuideUtils_1.EGuideStart.None);
            }, 1e3);
          } else callback(GuideUtils_1.EGuideStart.ConditionNotReach);
        },
        guideId: 303,
        desc: "\u6b64\u65f6\u6b63\u5728\u89e3\u9501\u6d77\u5c9b\u6309\u94ae",
        command: {
          cmd: "finger",
          args: "UI > Bottom > goMapBtn"
        },
        if: "checkAtLevelScene"
      } ]
    };
    cc._RF.pop();
  }, {
    "../Script/Base/Manager/EventMgr": "EventMgr",
    "../Script/Base/Manager/M": "M",
    "../Script/Base/Manager/UIMgr": "UIMgr",
    "../Script/Logic/Data/Const/Event": "Event",
    "../Script/Logic/Data/Interface/UIData": "UIData",
    "../Script/Logic/SimulationOperation/View/Map/MapIslandUtils": "MapIslandUtils",
    "./GuideCondition": "GuideCondition",
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_level4: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "12ae3DBMSBEwbBqxddK5KZH", "_Guide_level4");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var GuideCondition_1 = require("./GuideCondition");
    var GuideUtils_1 = require("./GuideUtils");
    var MapIslandUtils_1 = require("../Script/Logic/SimulationOperation/View/Map/MapIslandUtils");
    var MoneyManager_1 = require("../Script/Logic/Data/MoneyManager");
    var UIMgr_1 = require("../Script/Base/Manager/UIMgr");
    var UIData_1 = require("../Script/Logic/Data/Interface/UIData");
    var GuideData_1 = require("./GuideData");
    exports.task = {
      name: "\u5173\u53614 \u6e38\u620f\u7ed3\u675f \u5f15\u5bfc\u4f1a\u7ee7\u7eed\u5f15\u5bfc\u6d77\u5c9b",
      debug: false,
      autorun: false,
      filename: "_Guide_level4",
      steps: [ {
        guideId: 401,
        onStart: function(next) {
          if (!GuideCondition_1.GuideCondition.checkLevelFinished(4)) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          var result = !MapIslandUtils_1.default.checkBuildFixed(15);
          if (result) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          result = MapIslandUtils_1.default.checkBuildFixed(16) && MapIslandUtils_1.default.checkBuildFinished(16);
          if (result) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          result = GuideCondition_1.GuideCondition.checkLevel(4) && GuideCondition_1.GuideCondition.checkUIOpen("GameWin");
          if (!result) {
            next(GuideUtils_1.EGuideStart.ConditionNotReach);
            return;
          }
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "\u7b2c\u56db\u5173\u901a\u5173\u5f15\u5bfc\u5173\u95ed",
        command: {
          cmd: "text",
          args: "\u54c7\uff0c\u8fd9\u4e48\u5feb\u5c31\u901a\u5173\u4e86\uff01\u8ba9\u6211\u4eec\u518d\u53bb\u6d77\u5c9b\u4e0a\u901b\u901b\u5427~",
          role: 1,
          positionY: -500
        },
        if: "checkAtMatch3Scene,checkUIOpen",
        delayTime: 1,
        param: "GameWin"
      }, {
        guideId: 402,
        onStart: function(next) {
          var result = GuideCondition_1.GuideCondition.checkLevel(4) && GuideCondition_1.GuideCondition.checkUIOpen("GameWin");
          if (!result) {
            next(GuideUtils_1.EGuideStart.ConditionNotReach);
            return;
          }
          GuideCondition_1.GuideCondition.checkUIOpen("SelectShowTarget") && UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.SelectShowTarget);
          next(GuideUtils_1.EGuideStart.None);
        },
        desc: "\u5173\u95ed\u7bad\u5934",
        command: {
          cmd: "finger",
          args: "UIRoot:GameWin/btn_back"
        },
        if: "checkUIOpen",
        param: "GameWin"
      }, {
        guideId: 403,
        desc: "\u70b9\u51fb\u53bb\u6d77\u5c9b\u6309\u94ae",
        onStart: function(next) {
          GuideCondition_1.GuideCondition.checkUIOpen("SelectShowTarget") && UIMgr_1.default.ins.closeUI(UIData_1.UIHudDef.SelectShowTarget);
          next(GuideUtils_1.EGuideStart.None);
        },
        command: {
          cmd: "finger",
          args: "UI > Bottom > goMapBtn"
        },
        if: "checkAtLevelScene",
        delayTime: 1
      }, {
        guideId: 404,
        onStart: function(next) {
          if (GuideCondition_1.GuideCondition.checkUIOpen("BuildSuccess")) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          if (!MapIslandUtils_1.default.mapLoadFinished) {
            next(GuideUtils_1.EGuideStart.Stop);
            return;
          }
          var result = MapIslandUtils_1.default.checkBuildFixed(16) && MapIslandUtils_1.default.checkBuildFinished(16);
          if (result) {
            GuideData_1.GuideData.pushFinishedTask("_Guide_level4");
            next(GuideUtils_1.EGuideStart.Stop);
          } else next(GuideUtils_1.EGuideStart.None);
        },
        desc: "\u6587\u5b57 ",
        command: {
          cmd: "text",
          args: "\u518d\u6765\u4fee\u590d\u4e00\u6b21\u5427\uff0c\u8fd9\u6b21\u6211\u4eec\u6709\u8db3\u591f\u7684\u91d1\u5e01\u4e86~",
          role: 1,
          positionY: -500
        },
        if: "checkAtMapScene",
        delayTime: 1,
        noCheckDone: true
      }, {
        guideId: 405,
        desc: "\u6307\u5f15\u4fee\u590d\u5c0f\u7801\u5934",
        onStart: function(next) {
          var result = MapIslandUtils_1.default.checkBuildFixed(16) && MapIslandUtils_1.default.checkBuildFinished(16);
          next(result ? GuideUtils_1.EGuideStart.Stop : GuideUtils_1.EGuideStart.None);
        },
        command: {
          cmd: "finger",
          args: "Map > Wharf > B16_xiaomatou > LockItem",
          type: "MapItem",
          maskType: 1
        },
        if: "checkNoDialogUI,checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 406,
        desc: "\u6307\u5f15\u4fee\u7406\u5c0f\u7801\u5934",
        onStart: function(next) {
          var result = MapIslandUtils_1.default.checkBuildFixed(16);
          if (result) next(GuideUtils_1.EGuideStart.ConditionNotReach); else {
            var buildConfig = MapIslandUtils_1.default.getBuildConfigById(16);
            var moneyCheck = MoneyManager_1.MoneyManager.CheckMoneyJson(buildConfig.price[0], false, MoneyManager_1.MoneyTipsType.None);
            if (!moneyCheck) {
              next(GuideUtils_1.EGuideStart.Stop);
              return;
            }
            next(GuideUtils_1.EGuideStart.None);
          }
        },
        command: {
          cmd: "finger",
          args: "BuildTool/unlock",
          type: "MapUI",
          maskType: 1
        },
        if: "checkNoDialogUI,checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 407,
        desc: "\u70b9\u51fb\u7801\u5934icon\u7684\u4e24\u4e2a",
        command: {
          cmd: "finger",
          args: "BuildTool/exchange/content",
          type: "MapUI",
          hideFinger: true,
          maskType: 1
        },
        if: "checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 408,
        desc: "\u70b9\u51fb\u7801\u5934icon\u7684\u786e\u5b9a\u6309\u94ae",
        command: {
          cmd: "finger",
          args: "BuildTool/exchange/btn_confirm",
          type: "MapUI"
        },
        if: "checkAtMapScene",
        noCheckDone: true
      }, {
        guideId: 409,
        desc: "\u7ed3\u675f\u8bed",
        command: {
          cmd: "text",
          args: "\u5c0f\u5c9b\u7684\u91cd\u5efa\u4efb\u91cd\u800c\u9053\u8fdc\u554a\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u52a0\u6cb9\u5427\uff01",
          role: 1,
          positionY: -500
        },
        if: "checkAtMapScene"
      } ]
    };
    cc._RF.pop();
  }, {
    "../Script/Base/Manager/UIMgr": "UIMgr",
    "../Script/Logic/Data/Interface/UIData": "UIData",
    "../Script/Logic/Data/MoneyManager": "MoneyManager",
    "../Script/Logic/SimulationOperation/View/Map/MapIslandUtils": "MapIslandUtils",
    "./GuideCondition": "GuideCondition",
    "./GuideData": "GuideData",
    "./GuideUtils": "GuideUtils"
  } ],
  _Guide_test: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "c2494y7ly5NTZCVSjRYZreh", "_Guide_test");
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    exports.task = {
      name: "\u6d4b\u8bd5\u5f15\u5bfc",
      debug: false,
      autorun: false,
      steps: [ {
        onStart: function(callback) {
          callback("condition_not_reach");
        },
        guideId: 10000001,
        desc: "\u9996\u6b21\u8fdb\u5165\u6e38\u620f",
        command: {
          cmd: "text",
          args: "\u6b22\u8fce\u6765\u5230\u5c0f\u5c9b\uff01\u5148\u6765\u4e00\u5c40\u6e38\u620f\u5427\uff01",
          role: 2
        }
      }, {
        guideId: 10000002,
        desc: "\u70b9\u51fb\u5f00\u59cb\u6e38\u620f",
        command: {
          cmd: "finger",
          args: "UI > Bottom > goMatchBtn"
        },
        delayTime: .5
      } ]
    };
    cc._RF.pop();
  }, {} ],
  async: [ function(require, module, exports) {
    (function(process, global) {
      "use strict";
      cc._RF.push(module, "6d82dgHLHdIt6GZToxWGahT", "async");
      "use strict";
      function _typeof(obj) {
        "@babel/helpers - typeof";
        _typeof = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function _typeof(obj) {
          return typeof obj;
        } : function _typeof(obj) {
          return obj && "function" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
        };
        return _typeof(obj);
      }
      !function(n, t) {
        "object" == ("undefined" === typeof exports ? "undefined" : _typeof(exports)) && "undefined" != typeof module ? t(exports) : "function" == typeof define && define.amd ? define([ "exports" ], t) : t(n.async = n.async || {});
      }(void 0, function(n) {
        function t(n, t) {
          t |= 0;
          for (var e = Math.max(n.length - t, 0), r = Array(e), u = 0; u < e; u++) r[u] = n[t + u];
          return r;
        }
        function e(n) {
          var t = _typeof(n);
          return null != n && ("object" == t || "function" == t);
        }
        function r(n) {
          setTimeout(n, 0);
        }
        function u(n) {
          return function(e) {
            var r = t(arguments, 1);
            n(function() {
              e.apply(null, r);
            });
          };
        }
        function i(n) {
          return ct(function(t, r) {
            var u;
            try {
              u = n.apply(this, t);
            } catch (n) {
              return r(n);
            }
            e(u) && "function" == typeof u.then ? u.then(function(n) {
              o(r, null, n);
            }, function(n) {
              o(r, n.message ? n : new Error(n));
            }) : r(null, u);
          });
        }
        function o(n, t, e) {
          try {
            n(t, e);
          } catch (n) {
            lt(c, n);
          }
        }
        function c(n) {
          throw n;
        }
        function f(n) {
          return st && "AsyncFunction" === n[Symbol.toStringTag];
        }
        function a(n) {
          return f(n) ? i(n) : n;
        }
        function l(n) {
          return function(e) {
            var r = t(arguments, 1), u = ct(function(t, r) {
              var u = this;
              return n(e, function(n, e) {
                a(n).apply(u, t.concat(e));
              }, r);
            });
            return r.length ? u.apply(this, r) : u;
          };
        }
        function s(n) {
          var t = mt.call(n, bt), e = n[bt];
          try {
            n[bt] = void 0;
            var r = !0;
          } catch (n) {}
          var u = gt.call(n);
          return r && (t ? n[bt] = e : delete n[bt]), u;
        }
        function p(n) {
          return St.call(n);
        }
        function h(n) {
          return null == n ? void 0 === n ? Lt : kt : Ot && Ot in Object(n) ? s(n) : p(n);
        }
        function y(n) {
          if (!e(n)) return !1;
          var t = h(n);
          return t == xt || t == Et || t == wt || t == At;
        }
        function v(n) {
          return "number" == typeof n && n > -1 && n % 1 == 0 && n <= Tt;
        }
        function d(n) {
          return null != n && v(n.length) && !y(n);
        }
        function m() {}
        function g(n) {
          return function() {
            if (null !== n) {
              var t = n;
              n = null, t.apply(this, arguments);
            }
          };
        }
        function b(n, t) {
          for (var e = -1, r = Array(n); ++e < n; ) r[e] = t(e);
          return r;
        }
        function j(n) {
          return null != n && "object" == _typeof(n);
        }
        function S(n) {
          return j(n) && h(n) == _t;
        }
        function k() {
          return !1;
        }
        function L(n, t) {
          return t = null == t ? Nt : t, !!t && ("number" == typeof n || Qt.test(n)) && n > -1 && n % 1 == 0 && n < t;
        }
        function O(n) {
          return j(n) && v(n.length) && !!me[h(n)];
        }
        function w(n) {
          return function(t) {
            return n(t);
          };
        }
        function x(n, t) {
          var e = Vt(n), r = !e && Pt(n), u = !e && !r && Wt(n), i = !e && !r && !u && Oe(n), o = e || r || u || i, c = o ? b(n.length, String) : [], f = c.length;
          for (var a in n) !t && !xe.call(n, a) || o && ("length" == a || u && ("offset" == a || "parent" == a) || i && ("buffer" == a || "byteLength" == a || "byteOffset" == a) || L(a, f)) || c.push(a);
          return c;
        }
        function E(n) {
          var t = n && n.constructor, e = "function" == typeof t && t.prototype || Ee;
          return n === e;
        }
        function A(n, t) {
          return function(e) {
            return n(t(e));
          };
        }
        function T(n) {
          if (!E(n)) return Ae(n);
          var t = [];
          for (var e in Object(n)) Be.call(n, e) && "constructor" != e && t.push(e);
          return t;
        }
        function B(n) {
          return d(n) ? x(n) : T(n);
        }
        function F(n) {
          var t = -1, e = n.length;
          return function() {
            return ++t < e ? {
              value: n[t],
              key: t
            } : null;
          };
        }
        function I(n) {
          var t = -1;
          return function() {
            var e = n.next();
            return e.done ? null : (t++, {
              value: e.value,
              key: t
            });
          };
        }
        function _(n) {
          var t = B(n), e = -1, r = t.length;
          return function() {
            var u = t[++e];
            return e < r ? {
              value: n[u],
              key: u
            } : null;
          };
        }
        function M(n) {
          if (d(n)) return F(n);
          var t = It(n);
          return t ? I(t) : _(n);
        }
        function U(n) {
          return function() {
            if (null === n) throw new Error("Callback was already called.");
            var t = n;
            n = null, t.apply(this, arguments);
          };
        }
        function z(n) {
          return function(t, e, r) {
            function u(n, t) {
              if (f -= 1, n) c = !0, r(n); else {
                if (t === Bt || c && f <= 0) return c = !0, r(null);
                i();
              }
            }
            function i() {
              for (;f < n && !c; ) {
                var t = o();
                if (null === t) return c = !0, void (f <= 0 && r(null));
                f += 1, e(t.value, t.key, U(u));
              }
            }
            if (r = g(r || m), n <= 0 || !t) return r(null);
            var o = M(t), c = !1, f = 0;
            i();
          };
        }
        function P(n, t, e, r) {
          z(t)(n, a(e), r);
        }
        function V(n, t) {
          return function(e, r, u) {
            return n(e, t, r, u);
          };
        }
        function q(n, t, e) {
          function r(n, t) {
            n ? e(n) : ++i !== o && t !== Bt || e(null);
          }
          e = g(e || m);
          var u = 0, i = 0, o = n.length;
          for (0 === o && e(null); u < o; u++) t(n[u], u, U(r));
        }
        function D(n) {
          return function(t, e, r) {
            return n(Ie, t, a(e), r);
          };
        }
        function R(n, t, e, r) {
          r = r || m, t = t || [];
          var u = [], i = 0, o = a(e);
          n(t, function(n, t, e) {
            var r = i++;
            o(n, function(n, t) {
              u[r] = t, e(n);
            });
          }, function(n) {
            r(n, u);
          });
        }
        function C(n) {
          return function(t, e, r, u) {
            return n(z(e), t, a(r), u);
          };
        }
        function $(n, t) {
          for (var e = -1, r = null == n ? 0 : n.length; ++e < r && !1 !== t(n[e], e, n); ) ;
          return n;
        }
        function W(n) {
          return function(t, e, r) {
            for (var u = -1, i = Object(t), o = r(t), c = o.length; c--; ) {
              var f = o[n ? c : ++u];
              if (!1 === e(i[f], f, i)) break;
            }
            return t;
          };
        }
        function N(n, t) {
          return n && Ve(n, t, B);
        }
        function Q(n, t, e, r) {
          for (var u = n.length, i = e + (r ? 1 : -1); r ? i-- : ++i < u; ) if (t(n[i], i, n)) return i;
          return -1;
        }
        function G(n) {
          return n !== n;
        }
        function H(n, t, e) {
          for (var r = e - 1, u = n.length; ++r < u; ) if (n[r] === t) return r;
          return -1;
        }
        function J(n, t, e) {
          return t === t ? H(n, t, e) : Q(n, G, e);
        }
        function K(n, t) {
          for (var e = -1, r = null == n ? 0 : n.length, u = Array(r); ++e < r; ) u[e] = t(n[e], e, n);
          return u;
        }
        function X(n) {
          return "symbol" == _typeof(n) || j(n) && h(n) == De;
        }
        function Y(n) {
          if ("string" == typeof n) return n;
          if (Vt(n)) return K(n, Y) + "";
          if (X(n)) return $e ? $e.call(n) : "";
          var t = n + "";
          return "0" == t && 1 / n == -Re ? "-0" : t;
        }
        function Z(n, t, e) {
          var r = -1, u = n.length;
          t < 0 && (t = -t > u ? 0 : u + t), e = e > u ? u : e, e < 0 && (e += u), u = t > e ? 0 : e - t >>> 0, 
          t >>>= 0;
          for (var i = Array(u); ++r < u; ) i[r] = n[r + t];
          return i;
        }
        function nn(n, t, e) {
          var r = n.length;
          return e = void 0 === e ? r : e, !t && e >= r ? n : Z(n, t, e);
        }
        function tn(n, t) {
          for (var e = n.length; e-- && J(t, n[e], 0) > -1; ) ;
          return e;
        }
        function en(n, t) {
          for (var e = -1, r = n.length; ++e < r && J(t, n[e], 0) > -1; ) ;
          return e;
        }
        function rn(n) {
          return n.split("");
        }
        function un(n) {
          return Xe.test(n);
        }
        function on(n) {
          return n.match(mr) || [];
        }
        function cn(n) {
          return un(n) ? on(n) : rn(n);
        }
        function fn(n) {
          return null == n ? "" : Y(n);
        }
        function an(n, t, e) {
          if (n = fn(n), n && (e || void 0 === t)) return n.replace(gr, "");
          if (!n || !(t = Y(t))) return n;
          var r = cn(n), u = cn(t), i = en(r, u), o = tn(r, u) + 1;
          return nn(r, i, o).join("");
        }
        function ln(n) {
          return n = n.toString().replace(kr, ""), n = n.match(br)[2].replace(" ", ""), n = n ? n.split(jr) : [], 
          n.map(function(n) {
            return an(n.replace(Sr, ""));
          });
        }
        function sn(n, t) {
          var e = {};
          N(n, function(n, t) {
            function r(t, e) {
              var r = K(u, function(n) {
                return t[n];
              });
              r.push(e), a(n).apply(null, r);
            }
            var u, i = f(n), o = !i && 1 === n.length || i && 0 === n.length;
            if (Vt(n)) u = n.slice(0, -1), n = n[n.length - 1], e[t] = u.concat(u.length > 0 ? r : n); else if (o) e[t] = n; else {
              if (u = ln(n), 0 === n.length && !i && 0 === u.length) throw new Error("autoInject task functions require explicit parameters.");
              i || u.pop(), e[t] = u.concat(r);
            }
          }), qe(e, t);
        }
        function pn() {
          this.head = this.tail = null, this.length = 0;
        }
        function hn(n, t) {
          n.length = 1, n.head = n.tail = t;
        }
        function yn(n, t, e) {
          function r(n, t, e) {
            if (null != e && "function" != typeof e) throw new Error("task callback must be a function");
            if (s.started = !0, Vt(n) || (n = [ n ]), 0 === n.length && s.idle()) return lt(function() {
              s.drain();
            });
            for (var r = 0, u = n.length; r < u; r++) {
              var i = {
                data: n[r],
                callback: e || m
              };
              t ? s._tasks.unshift(i) : s._tasks.push(i);
            }
            f || (f = !0, lt(function() {
              f = !1, s.process();
            }));
          }
          function u(n) {
            return function(t) {
              o -= 1;
              for (var e = 0, r = n.length; e < r; e++) {
                var u = n[e], i = J(c, u, 0);
                0 === i ? c.shift() : i > 0 && c.splice(i, 1), u.callback.apply(u, arguments), null != t && s.error(t, u.data);
              }
              o <= s.concurrency - s.buffer && s.unsaturated(), s.idle() && s.drain(), s.process();
            };
          }
          if (null == t) t = 1; else if (0 === t) throw new Error("Concurrency must not be zero");
          var i = a(n), o = 0, c = [], f = !1, l = !1, s = {
            _tasks: new pn(),
            concurrency: t,
            payload: e,
            saturated: m,
            unsaturated: m,
            buffer: t / 4,
            empty: m,
            drain: m,
            error: m,
            started: !1,
            paused: !1,
            push: function push(n, t) {
              r(n, !1, t);
            },
            kill: function kill() {
              s.drain = m, s._tasks.empty();
            },
            unshift: function unshift(n, t) {
              r(n, !0, t);
            },
            remove: function remove(n) {
              s._tasks.remove(n);
            },
            process: function process() {
              if (!l) {
                for (l = !0; !s.paused && o < s.concurrency && s._tasks.length; ) {
                  var n = [], t = [], e = s._tasks.length;
                  s.payload && (e = Math.min(e, s.payload));
                  for (var r = 0; r < e; r++) {
                    var f = s._tasks.shift();
                    n.push(f), c.push(f), t.push(f.data);
                  }
                  o += 1, 0 === s._tasks.length && s.empty(), o === s.concurrency && s.saturated();
                  var a = U(u(n));
                  i(t, a);
                }
                l = !1;
              }
            },
            length: function length() {
              return s._tasks.length;
            },
            running: function running() {
              return o;
            },
            workersList: function workersList() {
              return c;
            },
            idle: function idle() {
              return s._tasks.length + o === 0;
            },
            pause: function pause() {
              s.paused = !0;
            },
            resume: function resume() {
              !1 !== s.paused && (s.paused = !1, lt(s.process));
            }
          };
          return s;
        }
        function vn(n, t) {
          return yn(n, 1, t);
        }
        function dn(n, t, e, r) {
          r = g(r || m);
          var u = a(e);
          Or(n, function(n, e, r) {
            u(t, n, function(n, e) {
              t = e, r(n);
            });
          }, function(n) {
            r(n, t);
          });
        }
        function mn() {
          var n = K(arguments, a);
          return function() {
            var e = t(arguments), r = this, u = e[e.length - 1];
            "function" == typeof u ? e.pop() : u = m, dn(n, e, function(n, e, u) {
              e.apply(r, n.concat(function(n) {
                var e = t(arguments, 1);
                u(n, e);
              }));
            }, function(n, t) {
              u.apply(r, [ n ].concat(t));
            });
          };
        }
        function gn(n) {
          return n;
        }
        function bn(n, t) {
          return function(e, r, u, i) {
            i = i || m;
            var o, c = !1;
            e(r, function(e, r, i) {
              u(e, function(r, u) {
                r ? i(r) : n(u) && !o ? (c = !0, o = t(!0, e), i(null, Bt)) : i();
              });
            }, function(n) {
              n ? i(n) : i(null, c ? o : t(!1));
            });
          };
        }
        function jn(n, t) {
          return t;
        }
        function Sn(n) {
          return function(e) {
            var r = t(arguments, 1);
            r.push(function(e) {
              var r = t(arguments, 1);
              "object" == ("undefined" === typeof console ? "undefined" : _typeof(console)) && (e ? console.error && console.error(e) : console[n] && $(r, function(t) {
                console[n](t);
              }));
            }), a(e).apply(null, r);
          };
        }
        function kn(n, e, r) {
          function u(n) {
            if (n) return r(n);
            var e = t(arguments, 1);
            e.push(i), c.apply(this, e);
          }
          function i(n, t) {
            return n ? r(n) : t ? void o(u) : r(null);
          }
          r = U(r || m);
          var o = a(n), c = a(e);
          i(null, !0);
        }
        function Ln(n, e, r) {
          r = U(r || m);
          var u = a(n), i = function i(n) {
            if (n) return r(n);
            var o = t(arguments, 1);
            return e.apply(this, o) ? u(i) : void r.apply(null, [ null ].concat(o));
          };
          u(i);
        }
        function On(n, t, e) {
          Ln(n, function() {
            return !t.apply(this, arguments);
          }, e);
        }
        function wn(n, t, e) {
          function r(n) {
            return n ? e(n) : void o(u);
          }
          function u(n, t) {
            return n ? e(n) : t ? void i(r) : e(null);
          }
          e = U(e || m);
          var i = a(t), o = a(n);
          o(u);
        }
        function xn(n) {
          return function(t, e, r) {
            return n(t, r);
          };
        }
        function En(n, t, e) {
          Ie(n, xn(a(t)), e);
        }
        function An(n, t, e, r) {
          z(t)(n, xn(a(e)), r);
        }
        function Tn(n) {
          return f(n) ? n : ct(function(t, e) {
            var r = !0;
            t.push(function() {
              var n = arguments;
              r ? lt(function() {
                e.apply(null, n);
              }) : e.apply(null, n);
            }), n.apply(this, t), r = !1;
          });
        }
        function Bn(n) {
          return !n;
        }
        function Fn(n) {
          return function(t) {
            return null == t ? void 0 : t[n];
          };
        }
        function In(n, t, e, r) {
          var u = new Array(t.length);
          n(t, function(n, t, r) {
            e(n, function(n, e) {
              u[t] = !!e, r(n);
            });
          }, function(n) {
            if (n) return r(n);
            for (var e = [], i = 0; i < t.length; i++) u[i] && e.push(t[i]);
            r(null, e);
          });
        }
        function _n(n, t, e, r) {
          var u = [];
          n(t, function(n, t, r) {
            e(n, function(e, i) {
              e ? r(e) : (i && u.push({
                index: t,
                value: n
              }), r());
            });
          }, function(n) {
            n ? r(n) : r(null, K(u.sort(function(n, t) {
              return n.index - t.index;
            }), Fn("value")));
          });
        }
        function Mn(n, t, e, r) {
          var u = d(t) ? In : _n;
          u(n, t, a(e), r || m);
        }
        function Un(n, t) {
          function e(n) {
            return n ? r(n) : void u(e);
          }
          var r = U(t || m), u = a(Tn(n));
          e();
        }
        function zn(n, t, e, r) {
          r = g(r || m);
          var u = {}, i = a(e);
          P(n, t, function(n, t, e) {
            i(n, t, function(n, r) {
              return n ? e(n) : (u[t] = r, void e());
            });
          }, function(n) {
            r(n, u);
          });
        }
        function Pn(n, t) {
          return t in n;
        }
        function Vn(n, e) {
          var r = Object.create(null), u = Object.create(null);
          e = e || gn;
          var i = a(n), o = ct(function(n, o) {
            var c = e.apply(null, n);
            Pn(r, c) ? lt(function() {
              o.apply(null, r[c]);
            }) : Pn(u, c) ? u[c].push(o) : (u[c] = [ o ], i.apply(null, n.concat(function() {
              var n = t(arguments);
              r[c] = n;
              var e = u[c];
              delete u[c];
              for (var i = 0, o = e.length; i < o; i++) e[i].apply(null, n);
            })));
          });
          return o.memo = r, o.unmemoized = n, o;
        }
        function qn(n, e, r) {
          r = r || m;
          var u = d(e) ? [] : {};
          n(e, function(n, e, r) {
            a(n)(function(n, i) {
              arguments.length > 2 && (i = t(arguments, 1)), u[e] = i, r(n);
            });
          }, function(n) {
            r(n, u);
          });
        }
        function Dn(n, t) {
          qn(Ie, n, t);
        }
        function Rn(n, t, e) {
          qn(z(t), n, e);
        }
        function Cn(n, t) {
          if (t = g(t || m), !Vt(n)) return t(new TypeError("First argument to race must be an array of functions"));
          if (!n.length) return t();
          for (var e = 0, r = n.length; e < r; e++) a(n[e])(t);
        }
        function $n(n, e, r, u) {
          var i = t(n).reverse();
          dn(i, e, r, u);
        }
        function Wn(n) {
          var e = a(n);
          return ct(function(n, r) {
            return n.push(function(n, e) {
              if (n) r(null, {
                error: n
              }); else {
                var u;
                u = arguments.length <= 2 ? e : t(arguments, 1), r(null, {
                  value: u
                });
              }
            }), e.apply(this, n);
          });
        }
        function Nn(n) {
          var t;
          return Vt(n) ? t = K(n, Wn) : (t = {}, N(n, function(n, e) {
            t[e] = Wn.call(this, n);
          })), t;
        }
        function Qn(n, t, e, r) {
          Mn(n, t, function(n, t) {
            e(n, function(n, e) {
              t(n, !e);
            });
          }, r);
        }
        function Gn(n) {
          return function() {
            return n;
          };
        }
        function Hn(n, t, e) {
          function r(n, t) {
            if ("object" == _typeof(t)) n.times = +t.times || i, n.intervalFunc = "function" == typeof t.interval ? t.interval : Gn(+t.interval || o), 
            n.errorFilter = t.errorFilter; else {
              if ("number" != typeof t && "string" != typeof t) throw new Error("Invalid arguments for async.retry");
              n.times = +t || i;
            }
          }
          function u() {
            f(function(n) {
              n && l++ < c.times && ("function" != typeof c.errorFilter || c.errorFilter(n)) ? setTimeout(u, c.intervalFunc(l)) : e.apply(null, arguments);
            });
          }
          var i = 5, o = 0, c = {
            times: i,
            intervalFunc: Gn(o)
          };
          if (arguments.length < 3 && "function" == typeof n ? (e = t || m, t = n) : (r(c, n), 
          e = e || m), "function" != typeof t) throw new Error("Invalid arguments for async.retry");
          var f = a(t), l = 1;
          u();
        }
        function Jn(n, t) {
          qn(Or, n, t);
        }
        function Kn(n, t, e) {
          function r(n, t) {
            var e = n.criteria, r = t.criteria;
            return e < r ? -1 : e > r ? 1 : 0;
          }
          var u = a(t);
          _e(n, function(n, t) {
            u(n, function(e, r) {
              return e ? t(e) : void t(null, {
                value: n,
                criteria: r
              });
            });
          }, function(n, t) {
            return n ? e(n) : void e(null, K(t.sort(r), Fn("value")));
          });
        }
        function Xn(n, t, e) {
          var r = a(n);
          return ct(function(u, i) {
            function o() {
              var t = n.name || "anonymous", r = new Error('Callback function "' + t + '" timed out.');
              r.code = "ETIMEDOUT", e && (r.info = e), f = !0, i(r);
            }
            var c, f = !1;
            u.push(function() {
              f || (i.apply(null, arguments), clearTimeout(c));
            }), c = setTimeout(o, t), r.apply(null, u);
          });
        }
        function Yn(n, t, e, r) {
          for (var u = -1, i = iu(uu((t - n) / (e || 1)), 0), o = Array(i); i--; ) o[r ? i : ++u] = n, 
          n += e;
          return o;
        }
        function Zn(n, t, e, r) {
          var u = a(e);
          Ue(Yn(0, n, 1), t, u, r);
        }
        function nt(n, t, e, r) {
          arguments.length <= 3 && (r = e, e = t, t = Vt(n) ? [] : {}), r = g(r || m);
          var u = a(e);
          Ie(n, function(n, e, r) {
            u(t, n, e, r);
          }, function(n) {
            r(n, t);
          });
        }
        function tt(n, e) {
          var r, u = null;
          e = e || m, Ur(n, function(n, e) {
            a(n)(function(n, i) {
              r = arguments.length > 2 ? t(arguments, 1) : i, u = n, e(!n);
            });
          }, function() {
            e(u, r);
          });
        }
        function et(n) {
          return function() {
            return (n.unmemoized || n).apply(null, arguments);
          };
        }
        function rt(n, e, r) {
          r = U(r || m);
          var u = a(e);
          if (!n()) return r(null);
          var i = function i(e) {
            if (e) return r(e);
            if (n()) return u(i);
            var o = t(arguments, 1);
            r.apply(null, [ null ].concat(o));
          };
          u(i);
        }
        function ut(n, t, e) {
          rt(function() {
            return !n.apply(this, arguments);
          }, t, e);
        }
        var it, ot = function ot(n) {
          var e = t(arguments, 1);
          return function() {
            var r = t(arguments);
            return n.apply(null, e.concat(r));
          };
        }, ct = function ct(n) {
          return function() {
            var e = t(arguments), r = e.pop();
            n.call(this, e, r);
          };
        }, ft = "function" == typeof setImmediate && setImmediate, at = "object" == ("undefined" === typeof process ? "undefined" : _typeof(process)) && "function" == typeof process.nextTick;
        it = ft ? setImmediate : at ? process.nextTick : r;
        var lt = u(it), st = "function" == typeof Symbol, pt = "object" == ("undefined" === typeof global ? "undefined" : _typeof(global)) && global && global.Object === Object && global, ht = "object" == ("undefined" === typeof self ? "undefined" : _typeof(self)) && self && self.Object === Object && self, yt = pt || ht || Function("return this")(), vt = yt.Symbol, dt = Object.prototype, mt = dt.hasOwnProperty, gt = dt.toString, bt = vt ? vt.toStringTag : void 0, jt = Object.prototype, St = jt.toString, kt = "[object Null]", Lt = "[object Undefined]", Ot = vt ? vt.toStringTag : void 0, wt = "[object AsyncFunction]", xt = "[object Function]", Et = "[object GeneratorFunction]", At = "[object Proxy]", Tt = 9007199254740991, Bt = {}, Ft = "function" == typeof Symbol && Symbol.iterator, It = function It(n) {
          return Ft && n[Ft] && n[Ft]();
        }, _t = "[object Arguments]", Mt = Object.prototype, Ut = Mt.hasOwnProperty, zt = Mt.propertyIsEnumerable, Pt = S(function() {
          return arguments;
        }()) ? S : function(n) {
          return j(n) && Ut.call(n, "callee") && !zt.call(n, "callee");
        }, Vt = Array.isArray, qt = "object" == _typeof(n) && n && !n.nodeType && n, Dt = qt && "object" == ("undefined" === typeof module ? "undefined" : _typeof(module)) && module && !module.nodeType && module, Rt = Dt && Dt.exports === qt, Ct = Rt ? yt.Buffer : void 0, $t = Ct ? Ct.isBuffer : void 0, Wt = $t || k, Nt = 9007199254740991, Qt = /^(?:0|[1-9]\d*)$/, Gt = "[object Arguments]", Ht = "[object Array]", Jt = "[object Boolean]", Kt = "[object Date]", Xt = "[object Error]", Yt = "[object Function]", Zt = "[object Map]", ne = "[object Number]", te = "[object Object]", ee = "[object RegExp]", re = "[object Set]", ue = "[object String]", ie = "[object WeakMap]", oe = "[object ArrayBuffer]", ce = "[object DataView]", fe = "[object Float32Array]", ae = "[object Float64Array]", le = "[object Int8Array]", se = "[object Int16Array]", pe = "[object Int32Array]", he = "[object Uint8Array]", ye = "[object Uint8ClampedArray]", ve = "[object Uint16Array]", de = "[object Uint32Array]", me = {};
        me[fe] = me[ae] = me[le] = me[se] = me[pe] = me[he] = me[ye] = me[ve] = me[de] = !0, 
        me[Gt] = me[Ht] = me[oe] = me[Jt] = me[ce] = me[Kt] = me[Xt] = me[Yt] = me[Zt] = me[ne] = me[te] = me[ee] = me[re] = me[ue] = me[ie] = !1;
        var ge = "object" == _typeof(n) && n && !n.nodeType && n, be = ge && "object" == ("undefined" === typeof module ? "undefined" : _typeof(module)) && module && !module.nodeType && module, je = be && be.exports === ge, Se = je && pt.process, ke = function() {
          try {
            return Se && Se.binding && Se.binding("util");
          } catch (n) {}
        }(), Le = ke && ke.isTypedArray, Oe = Le ? w(Le) : O, we = Object.prototype, xe = we.hasOwnProperty, Ee = Object.prototype, Ae = A(Object.keys, Object), Te = Object.prototype, Be = Te.hasOwnProperty, Fe = V(P, 1 / 0), Ie = function Ie(n, t, e) {
          var r = d(n) ? q : Fe;
          r(n, a(t), e);
        }, _e = D(R), Me = l(_e), Ue = C(R), ze = V(Ue, 1), Pe = l(ze), Ve = W(), qe = function qe(n, e, r) {
          function u(n, t) {
            j.push(function() {
              f(n, t);
            });
          }
          function i() {
            if (0 === j.length && 0 === v) return r(null, y);
            for (;j.length && v < e; ) {
              var n = j.shift();
              n();
            }
          }
          function o(n, t) {
            var e = b[n];
            e || (e = b[n] = []), e.push(t);
          }
          function c(n) {
            var t = b[n] || [];
            $(t, function(n) {
              n();
            }), i();
          }
          function f(n, e) {
            if (!d) {
              var u = U(function(e, u) {
                if (v--, arguments.length > 2 && (u = t(arguments, 1)), e) {
                  var i = {};
                  N(y, function(n, t) {
                    i[t] = n;
                  }), i[n] = u, d = !0, b = Object.create(null), r(e, i);
                } else y[n] = u, c(n);
              });
              v++;
              var i = a(e[e.length - 1]);
              e.length > 1 ? i(y, u) : i(u);
            }
          }
          function l() {
            for (var n, t = 0; S.length; ) n = S.pop(), t++, $(s(n), function(n) {
              0 === --k[n] && S.push(n);
            });
            if (t !== h) throw new Error("async.auto cannot execute tasks due to a recursive dependency");
          }
          function s(t) {
            var e = [];
            return N(n, function(n, r) {
              Vt(n) && J(n, t, 0) >= 0 && e.push(r);
            }), e;
          }
          "function" == typeof e && (r = e, e = null), r = g(r || m);
          var p = B(n), h = p.length;
          if (!h) return r(null);
          e || (e = h);
          var y = {}, v = 0, d = !1, b = Object.create(null), j = [], S = [], k = {};
          N(n, function(t, e) {
            if (!Vt(t)) return u(e, [ t ]), void S.push(e);
            var r = t.slice(0, t.length - 1), i = r.length;
            return 0 === i ? (u(e, t), void S.push(e)) : (k[e] = i, void $(r, function(c) {
              if (!n[c]) throw new Error("async.auto task `" + e + "` has a non-existent dependency `" + c + "` in " + r.join(", "));
              o(c, function() {
                i--, 0 === i && u(e, t);
              });
            }));
          }), l(), i();
        }, De = "[object Symbol]", Re = 1 / 0, Ce = vt ? vt.prototype : void 0, $e = Ce ? Ce.toString : void 0, We = "\\ud800-\\udfff", Ne = "\\u0300-\\u036f", Qe = "\\ufe20-\\ufe2f", Ge = "\\u20d0-\\u20ff", He = Ne + Qe + Ge, Je = "\\ufe0e\\ufe0f", Ke = "\\u200d", Xe = RegExp("[" + Ke + We + He + Je + "]"), Ye = "\\ud800-\\udfff", Ze = "\\u0300-\\u036f", nr = "\\ufe20-\\ufe2f", tr = "\\u20d0-\\u20ff", er = Ze + nr + tr, rr = "\\ufe0e\\ufe0f", ur = "[" + Ye + "]", ir = "[" + er + "]", or = "\\ud83c[\\udffb-\\udfff]", cr = "(?:" + ir + "|" + or + ")", fr = "[^" + Ye + "]", ar = "(?:\\ud83c[\\udde6-\\uddff]){2}", lr = "[\\ud800-\\udbff][\\udc00-\\udfff]", sr = "\\u200d", pr = cr + "?", hr = "[" + rr + "]?", yr = "(?:" + sr + "(?:" + [ fr, ar, lr ].join("|") + ")" + hr + pr + ")*", vr = hr + pr + yr, dr = "(?:" + [ fr + ir + "?", ir, ar, lr, ur ].join("|") + ")", mr = RegExp(or + "(?=" + or + ")|" + dr + vr, "g"), gr = /^\s+|\s+$/g, br = /^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m, jr = /,/, Sr = /(=.+)?(\s*)$/, kr = /((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;
        pn.prototype.removeLink = function(n) {
          return n.prev ? n.prev.next = n.next : this.head = n.next, n.next ? n.next.prev = n.prev : this.tail = n.prev, 
          n.prev = n.next = null, this.length -= 1, n;
        }, pn.prototype.empty = function() {
          for (;this.head; ) this.shift();
          return this;
        }, pn.prototype.insertAfter = function(n, t) {
          t.prev = n, t.next = n.next, n.next ? n.next.prev = t : this.tail = t, n.next = t, 
          this.length += 1;
        }, pn.prototype.insertBefore = function(n, t) {
          t.prev = n.prev, t.next = n, n.prev ? n.prev.next = t : this.head = t, n.prev = t, 
          this.length += 1;
        }, pn.prototype.unshift = function(n) {
          this.head ? this.insertBefore(this.head, n) : hn(this, n);
        }, pn.prototype.push = function(n) {
          this.tail ? this.insertAfter(this.tail, n) : hn(this, n);
        }, pn.prototype.shift = function() {
          return this.head && this.removeLink(this.head);
        }, pn.prototype.pop = function() {
          return this.tail && this.removeLink(this.tail);
        }, pn.prototype.toArray = function() {
          for (var n = Array(this.length), t = this.head, e = 0; e < this.length; e++) n[e] = t.data, 
          t = t.next;
          return n;
        }, pn.prototype.remove = function(n) {
          for (var t = this.head; t; ) {
            var e = t.next;
            n(t) && this.removeLink(t), t = e;
          }
          return this;
        };
        var Lr, Or = V(P, 1), wr = function wr() {
          return mn.apply(null, t(arguments).reverse());
        }, xr = Array.prototype.concat, Er = function Er(n, e, r, u) {
          u = u || m;
          var i = a(r);
          Ue(n, e, function(n, e) {
            i(n, function(n) {
              return n ? e(n) : e(null, t(arguments, 1));
            });
          }, function(n, t) {
            for (var e = [], r = 0; r < t.length; r++) t[r] && (e = xr.apply(e, t[r]));
            return u(n, e);
          });
        }, Ar = V(Er, 1 / 0), Tr = V(Er, 1), Br = function Br() {
          var n = t(arguments), e = [ null ].concat(n);
          return function() {
            var n = arguments[arguments.length - 1];
            return n.apply(this, e);
          };
        }, Fr = D(bn(gn, jn)), Ir = C(bn(gn, jn)), _r = V(Ir, 1), Mr = Sn("dir"), Ur = V(An, 1), zr = D(bn(Bn, Bn)), Pr = C(bn(Bn, Bn)), Vr = V(Pr, 1), qr = D(Mn), Dr = C(Mn), Rr = V(Dr, 1), Cr = function Cr(n, t, e, r) {
          r = r || m;
          var u = a(e);
          Ue(n, t, function(n, t) {
            u(n, function(e, r) {
              return e ? t(e) : t(null, {
                key: r,
                val: n
              });
            });
          }, function(n, t) {
            for (var e = {}, u = Object.prototype.hasOwnProperty, i = 0; i < t.length; i++) if (t[i]) {
              var o = t[i].key, c = t[i].val;
              u.call(e, o) ? e[o].push(c) : e[o] = [ c ];
            }
            return r(n, e);
          });
        }, $r = V(Cr, 1 / 0), Wr = V(Cr, 1), Nr = Sn("log"), Qr = V(zn, 1 / 0), Gr = V(zn, 1);
        Lr = at ? process.nextTick : ft ? setImmediate : r;
        var Hr = u(Lr), Jr = function Jr(n, t) {
          var e = a(n);
          return yn(function(n, t) {
            e(n[0], t);
          }, t, 1);
        }, Kr = function Kr(n, t) {
          var e = Jr(n, t);
          return e.push = function(n, t, r) {
            if (null == r && (r = m), "function" != typeof r) throw new Error("task callback must be a function");
            if (e.started = !0, Vt(n) || (n = [ n ]), 0 === n.length) return lt(function() {
              e.drain();
            });
            t = t || 0;
            for (var u = e._tasks.head; u && t >= u.priority; ) u = u.next;
            for (var i = 0, o = n.length; i < o; i++) {
              var c = {
                data: n[i],
                priority: t,
                callback: r
              };
              u ? e._tasks.insertBefore(u, c) : e._tasks.push(c);
            }
            lt(e.process);
          }, delete e.unshift, e;
        }, Xr = D(Qn), Yr = C(Qn), Zr = V(Yr, 1), nu = function nu(n, t) {
          t || (t = n, n = null);
          var e = a(t);
          return ct(function(t, r) {
            function u(n) {
              e.apply(null, t.concat(n));
            }
            n ? Hn(n, u, r) : Hn(u, r);
          });
        }, tu = D(bn(Boolean, gn)), eu = C(bn(Boolean, gn)), ru = V(eu, 1), uu = Math.ceil, iu = Math.max, ou = V(Zn, 1 / 0), cu = V(Zn, 1), fu = function fu(n, e) {
          function r(t) {
            var e = a(n[i++]);
            t.push(U(u)), e.apply(null, t);
          }
          function u(u) {
            return u || i === n.length ? e.apply(null, arguments) : void r(t(arguments, 1));
          }
          if (e = g(e || m), !Vt(n)) return e(new Error("First argument to waterfall must be an array of functions"));
          if (!n.length) return e();
          var i = 0;
          r([]);
        }, au = {
          apply: ot,
          applyEach: Me,
          applyEachSeries: Pe,
          asyncify: i,
          auto: qe,
          autoInject: sn,
          cargo: vn,
          compose: wr,
          concat: Ar,
          concatLimit: Er,
          concatSeries: Tr,
          constant: Br,
          detect: Fr,
          detectLimit: Ir,
          detectSeries: _r,
          dir: Mr,
          doDuring: kn,
          doUntil: On,
          doWhilst: Ln,
          during: wn,
          each: En,
          eachLimit: An,
          eachOf: Ie,
          eachOfLimit: P,
          eachOfSeries: Or,
          eachSeries: Ur,
          ensureAsync: Tn,
          every: zr,
          everyLimit: Pr,
          everySeries: Vr,
          filter: qr,
          filterLimit: Dr,
          filterSeries: Rr,
          forever: Un,
          groupBy: $r,
          groupByLimit: Cr,
          groupBySeries: Wr,
          log: Nr,
          map: _e,
          mapLimit: Ue,
          mapSeries: ze,
          mapValues: Qr,
          mapValuesLimit: zn,
          mapValuesSeries: Gr,
          memoize: Vn,
          nextTick: Hr,
          parallel: Dn,
          parallelLimit: Rn,
          priorityQueue: Kr,
          queue: Jr,
          race: Cn,
          reduce: dn,
          reduceRight: $n,
          reflect: Wn,
          reflectAll: Nn,
          reject: Xr,
          rejectLimit: Yr,
          rejectSeries: Zr,
          retry: Hn,
          retryable: nu,
          seq: mn,
          series: Jn,
          setImmediate: lt,
          some: tu,
          someLimit: eu,
          someSeries: ru,
          sortBy: Kn,
          timeout: Xn,
          times: ou,
          timesLimit: Zn,
          timesSeries: cu,
          transform: nt,
          tryEach: tt,
          unmemoize: et,
          until: ut,
          waterfall: fu,
          whilst: rt,
          all: zr,
          allLimit: Pr,
          allSeries: Vr,
          any: tu,
          anyLimit: eu,
          anySeries: ru,
          find: Fr,
          findLimit: Ir,
          findSeries: _r,
          forEach: En,
          forEachSeries: Ur,
          forEachLimit: An,
          forEachOf: Ie,
          forEachOfSeries: Or,
          forEachOfLimit: P,
          inject: dn,
          foldl: dn,
          foldr: $n,
          select: qr,
          selectLimit: Dr,
          selectSeries: Rr,
          wrapSync: i
        };
        n["default"] = au, n.apply = ot, n.applyEach = Me, n.applyEachSeries = Pe, n.asyncify = i, 
        n.auto = qe, n.autoInject = sn, n.cargo = vn, n.compose = wr, n.concat = Ar, n.concatLimit = Er, 
        n.concatSeries = Tr, n.constant = Br, n.detect = Fr, n.detectLimit = Ir, n.detectSeries = _r, 
        n.dir = Mr, n.doDuring = kn, n.doUntil = On, n.doWhilst = Ln, n.during = wn, n.each = En, 
        n.eachLimit = An, n.eachOf = Ie, n.eachOfLimit = P, n.eachOfSeries = Or, n.eachSeries = Ur, 
        n.ensureAsync = Tn, n.every = zr, n.everyLimit = Pr, n.everySeries = Vr, n.filter = qr, 
        n.filterLimit = Dr, n.filterSeries = Rr, n.forever = Un, n.groupBy = $r, n.groupByLimit = Cr, 
        n.groupBySeries = Wr, n.log = Nr, n.map = _e, n.mapLimit = Ue, n.mapSeries = ze, 
        n.mapValues = Qr, n.mapValuesLimit = zn, n.mapValuesSeries = Gr, n.memoize = Vn, 
        n.nextTick = Hr, n.parallel = Dn, n.parallelLimit = Rn, n.priorityQueue = Kr, n.queue = Jr, 
        n.race = Cn, n.reduce = dn, n.reduceRight = $n, n.reflect = Wn, n.reflectAll = Nn, 
        n.reject = Xr, n.rejectLimit = Yr, n.rejectSeries = Zr, n.retry = Hn, n.retryable = nu, 
        n.seq = mn, n.series = Jn, n.setImmediate = lt, n.some = tu, n.someLimit = eu, n.someSeries = ru, 
        n.sortBy = Kn, n.timeout = Xn, n.times = ou, n.timesLimit = Zn, n.timesSeries = cu, 
        n.transform = nt, n.tryEach = tt, n.unmemoize = et, n.until = ut, n.waterfall = fu, 
        n.whilst = rt, n.all = zr, n.allLimit = Pr, n.allSeries = Vr, n.any = tu, n.anyLimit = eu, 
        n.anySeries = ru, n.find = Fr, n.findLimit = Ir, n.findSeries = _r, n.forEach = En, 
        n.forEachSeries = Ur, n.forEachLimit = An, n.forEachOf = Ie, n.forEachOfSeries = Or, 
        n.forEachOfLimit = P, n.inject = dn, n.foldl = dn, n.foldr = $n, n.select = qr, 
        n.selectLimit = Dr, n.selectSeries = Rr, n.wrapSync = i, Object.defineProperty(n, "__esModule", {
          value: !0
        });
      });
      cc._RF.pop();
    }).call(this, require("_process"), "undefined" !== typeof global ? global : "undefined" !== typeof self ? self : "undefined" !== typeof window ? window : {});
  }, {
    _process: 1
  } ],
  "console.save": [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "0439296jzBBe4ZEufwWAxRe", "console.save");
    "use strict";
    function _typeof(obj) {
      "@babel/helpers - typeof";
      _typeof = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function _typeof(obj) {
        return typeof obj;
      } : function _typeof(obj) {
        return obj && "function" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
      };
      return _typeof(obj);
    }
    (function(console) {
      console.save = function(data, filename) {
        if (!data) {
          console.error("Console.save: No data");
          return;
        }
        filename || (filename = "console.json");
        "object" === _typeof(data) && (data = JSON.stringify(data, void 0, 4));
        var blob = new Blob([ data ], {
          type: "text/json"
        }), e = document.createEvent("MouseEvents"), a = document.createElement("a");
        a.download = filename;
        a.href = window.URL.createObjectURL(blob);
        a.dataset.downloadurl = [ "text/json", a.download, a.href ].join(":");
        e.initMouseEvent("click", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
        a.dispatchEvent(e);
      };
    })(console);
    cc._RF.pop();
  }, {} ],
  test: [ function(require, module, exports) {
    "use strict";
    cc._RF.push(module, "4900dcJSf5K0YAvZGM4iW7q", "test");
    "use strict";
    var __extends = this && this.__extends || function() {
      var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf || {
          __proto__: []
        } instanceof Array && function(d, b) {
          d.__proto__ = b;
        } || function(d, b) {
          for (var p in b) b.hasOwnProperty(p) && (d[p] = b[p]);
        };
        return extendStatics(d, b);
      };
      return function(d, b) {
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype = null === b ? Object.create(b) : (__.prototype = b.prototype, new __());
      };
    }();
    var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
      var c = arguments.length, r = c < 3 ? target : null === desc ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
      if ("object" === typeof Reflect && "function" === typeof Reflect.decorate) r = Reflect.decorate(decorators, target, key, desc); else for (var i = decorators.length - 1; i >= 0; i--) (d = decorators[i]) && (r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r);
      return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __awaiter = this && this.__awaiter || function(thisArg, _arguments, P, generator) {
      return new (P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e) {
            reject(e);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e) {
            reject(e);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : new P(function(resolve) {
            resolve(result.value);
          }).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator = this && this.__generator || function(thisArg, body) {
      var _ = {
        label: 0,
        sent: function() {
          if (1 & t[0]) throw t[1];
          return t[1];
        },
        trys: [],
        ops: []
      }, f, y, t, g;
      return g = {
        next: verb(0),
        throw: verb(1),
        return: verb(2)
      }, "function" === typeof Symbol && (g[Symbol.iterator] = function() {
        return this;
      }), g;
      function verb(n) {
        return function(v) {
          return step([ n, v ]);
        };
      }
      function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
          if (f = 1, y && (t = 2 & op[0] ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 
          0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          (y = 0, t) && (op = [ 2 & op[0], t.value ]);
          switch (op[0]) {
           case 0:
           case 1:
            t = op;
            break;

           case 4:
            _.label++;
            return {
              value: op[1],
              done: false
            };

           case 5:
            _.label++;
            y = op[1];
            op = [ 0 ];
            continue;

           case 7:
            op = _.ops.pop();
            _.trys.pop();
            continue;

           default:
            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (6 === op[0] || 2 === op[0])) {
              _ = 0;
              continue;
            }
            if (3 === op[0] && (!t || op[1] > t[0] && op[1] < t[3])) {
              _.label = op[1];
              break;
            }
            if (6 === op[0] && _.label < t[1]) {
              _.label = t[1];
              t = op;
              break;
            }
            if (t && _.label < t[2]) {
              _.label = t[2];
              _.ops.push(op);
              break;
            }
            t[2] && _.ops.pop();
            _.trys.pop();
            continue;
          }
          op = body.call(thisArg, _);
        } catch (e) {
          op = [ 6, e ];
          y = 0;
        } finally {
          f = t = 0;
        }
        if (5 & op[0]) throw op[1];
        return {
          value: op[0] ? op[1] : void 0,
          done: true
        };
      }
    };
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var EventMgr_1 = require("./Base/Manager/EventMgr");
    var HttpRequest_1 = require("./Base/Network/HttpRequest");
    var Socket_1 = require("./Base/Network/Socket");
    var Event_1 = require("./Logic/Data/Const/Event");
    var GameTableMgr_1 = require("./Base/Manager/GameTableMgr");
    var RuntimeMgr_1 = require("./Logic/Data/RuntimeMgr");
    var BaseConst_1 = require("./Base/BaseConst");
    var Level_1 = require("./Logic/Data/Interface/Level");
    var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
    var test = function(_super) {
      __extends(test, _super);
      function test() {
        var _this = null !== _super && _super.apply(this, arguments) || this;
        _this.ws = null;
        return _this;
      }
      test.prototype.onLoad = function() {
        return __awaiter(this, void 0, void 0, function() {
          var result;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              console.error("onload");
              return [ 4, Level_1.default.ins.getLvCfgData() ];

             case 1:
              result = _a.sent();
              console.error(result);
              return [ 2 ];
            }
          });
        });
      };
      test.prototype.start = function() {
        this._testGetTable();
        this._testPlayerMgr();
        EventMgr_1.default.ins.register(Event_1.Event.UI.UpdateCurrency, function(type, count) {
          console.error(type, count);
        }, this);
      };
      test.prototype._testLoadLv = function() {
        return __awaiter(this, void 0, void 0, function() {
          var data;
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              return [ 4, Level_1.default.ins.getLvCfgData() ];

             case 1:
              data = _a.sent();
              console.error(data);
              return [ 2 ];
            }
          });
        });
      };
      test.prototype._testPlayerMgr = function() {};
      test.prototype._testGetTable = function() {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              return [ 4, GameTableMgr_1.GameTableMgr.ins.execute() ];

             case 1:
              _a.sent();
              return [ 2 ];
            }
          });
        });
      };
      test.prototype._testSound = function() {
        this.scheduleOnce(function() {
          EventMgr_1.default.ins.send(Event_1.Event.Sound.PlayBGM);
        }, 1);
      };
      test.prototype._initEvent = function() {
        EventMgr_1.default.ins.register("1", this.test1, this);
        EventMgr_1.default.ins.register("1", this.test2, this);
      };
      test.prototype._websocketTest = function() {
        return __awaiter(this, void 0, void 0, function() {
          return __generator(this, function(_a) {
            switch (_a.label) {
             case 0:
              this.ws = new Socket_1.default("ws://192.168.91.102:3001");
              return [ 4, this.ws.connect() ];

             case 1:
              _a.sent();
              this.ws.send("hello ws");
              return [ 2 ];
            }
          });
        });
      };
      test.prototype.onCloseWS = function() {
        this.ws.disconnect();
      };
      test.prototype._requestTest = function() {
        var url = "http://19.8.91.102:3000/";
        var req = new HttpRequest_1.HttpRequest(url, HttpRequest_1.HttpRequest.METHOD.GET);
        req.execute().then(function(result) {
          console.warn(result);
        });
      };
      test.prototype.test2 = function() {
        console.warn("test2");
      };
      test.prototype.test1 = function() {
        console.warn("test1");
      };
      test.prototype.test3 = function() {
        console.warn("test3");
      };
      test.prototype.onTouchTestBtn = function() {
        EventMgr_1.default.ins.send("1");
        EventMgr_1.default.ins.unRegister("1", this.test1, this);
      };
      test.prototype.onTouchAddCoinOrDiamon = function(event, customStr) {
        var type = BaseConst_1.CurrencyId.Coin;
        1 == customStr && (type = BaseConst_1.CurrencyId.Diamond);
        RuntimeMgr_1.default.ins.addCurrency(type, 100);
        this._testLoadLv();
      };
      test = __decorate([ ccclass ], test);
      return test;
    }(cc.Component);
    exports.default = test;
    cc._RF.pop();
  }, {
    "./Base/BaseConst": "BaseConst",
    "./Base/Manager/EventMgr": "EventMgr",
    "./Base/Manager/GameTableMgr": "GameTableMgr",
    "./Base/Network/HttpRequest": "HttpRequest",
    "./Base/Network/Socket": "Socket",
    "./Logic/Data/Const/Event": "Event",
    "./Logic/Data/Interface/Level": "Level",
    "./Logic/Data/RuntimeMgr": "RuntimeMgr"
  } ]
}, {}, [ "GodCommand", "GodFinger", "GodGuide", "GodText", "GuideCondition", "GuideData", "GuideUtils", "LoadGuide", "Locator", "_Guide_level1", "_Guide_level10", "_Guide_level11", "_Guide_level11_1", "_Guide_level15_rank", "_Guide_level21", "_Guide_level3", "_Guide_level30", "_Guide_level3_1", "_Guide_level3_2", "_Guide_level4", "_Guide_test", "async", "Apps", "BaseConst", "Button", "SlideButton", "SpinePlayerCtrl", "TTMask", "DataPool", "CacheMgr", "DailyTaskMgr", "DeviceMgr", "EventMgr", "GameTableMgr", "M", "NetMgr", "NodePoolMgr", "AdManager", "AdsIdConfig", "IPlatform", "InitAD", "KSADApi", "PlatformAdApi", "AdLogUtil", "Webapp", "Wechat", "PlatformMgr", "ReportMgr", "ShareMgr", "StorageMgr", "BaseTable", "BytesTable", "UIMgr", "Tips", "View", "HttpRequest", "NetBase", "Sequence", "Socket", "ShaderHelper", "ShaderTime", "BoxRewardInfo", "ChapterInfo", "ChapterStory", "DailyTaskInfo", "HotelCfg", "HotelRoomCfg", "IslandUnlockCfg", "LevelUpReward", "PropInfo", "ShareCfg", "ShopInfo", "SlotBonusCfg", "Titles", "UIBase", "DLogId", "LRUCache", "Log", "MemoryDetector", "NumberUtils", "Paths", "RoadUtil", "SingletonFactory", "Util", "console.save", "ActionCtrl", "AudioCtrl", "Common", "CommonEnums", "CommonInterfaces", "GroupAnimatCtrl", "BagCtrl", "BagGridItemCtrl", "BoxGiftCtrl", "BoxOpenCtrl", "BoxTipsCtrl", "BuyPowerCtrl", "BuyPropPanel", "DialogPanel", "GameFailEncouragePanel", "MenuPanel", "MoreCoin", "OverHightLightCtrl", "SelectLevelCtrl", "SettingViewCtrl", "StoryTalkPanel", "TempLoadingPanel", "CustomTaskItem", "DailyItem", "DailyTaskPanel", "TimerTaskItem", "NotifyPanel", "NotifyRewardItemCtrl", "ShopPanel", "ShopToolsItemCtrl", "Constant", "Event", "TimeConfig", "Level", "ILevel", "ITutorial", "Tutorial", "UIData", "MoneyManager", "PlayerInfo", "RuntimeMgr", "FriendRankCtrl", "FriendRankItemCtrl", "GuestPanelCtrl", "OnLineGuestCtrl", "VistItemCtrl", "HotelData", "HotelManager", "HotelMapCtrl", "HotelRoomCtrl", "HotelUiCtrl", "HotelViewCtrl", "ItemZIndex", "RoomBuyCtrl", "RoomDetailCtrl", "RoomDetailItemCtrl", "RoomSlotCtrl", "RoomSlotDetailItemCtrl", "RoomFinishView", "LoadingScene", "LockCtrl", "RotatingCtrl", "TaskCtrl", "MainCtrl", "BombModel", "CellBase", "CellModel", "CollectModel", "EnergyModel", "GameModel", "GameTaskModel", "GroundCellModel", "GroundModel", "MultipleGridColModel", "PropModel", "SpecialCell", "Conveyer", "Girl", "Mushroom", "UpGroundCellModel", "UpGroundModel", "CrabModel", "GnomeModel", "MultipleGridColBase", "TurtlesModel", "ResCtrl", "BaseItemView", "BaseView", "BasicCellViewCtrl", "PlaneCtrl", "Tuituji", "EffLayerCtrl", "GroundViewCtrl", "ItemBasicCellCtrl", "ItemGroundCtrl", "ItemUpgroundCtrl", "Match3TutorialCtrl", "TouchHintCtrl", "TutorialBorderCtrl", "TutorialBubbleCtrl", "CollectItemCtrl", "InfoPanelCtrl", "MainUiCtrl", "PropCtrl", "PropItemCtrl", "SelectPropCtrl", "UpGroundViewCtrl", "JumpUtils", "BuildSuccess", "BuildTool", "CloudView", "BuildCloud", "BuildingLock", "MapBgScript", "DiningHall", "Exchange", "MapCamera", "MapIslandManager", "MapIslandUtils", "MapScene", "ShowBuildTool", "TrafficSystem", "Walk", "TalkPanel", "CommonRewardView", "GMView", "ChapterItemCtrl", "LevelMapCtrl", "LevelMarkItem", "RankItemCtrl", "RankPanelCtrl", "SelectChapterCtrl", "LevelGoMapBtn", "PropDropView", "test" ]);