System.register("chunks:///_virtual/Box.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var i,t,r,n,o,c,a,p,s;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,c=e._decorator,a=e.Sprite,p=e.SpriteFrame,s=e.Component}],execute:function(){var l,u,f,h,y,b,m;o._RF.push({},"259c6AT5zJAxbbuVP8MiD8g","Box",void 0);var S=c.ccclass,x=c.property;e("Box",(l=S("Box"),u=x(a),f=x([p]),l((b=i((y=function(e){function i(){for(var i,t=arguments.length,o=new Array(t),c=0;c<t;c++)o[c]=arguments[c];return i=e.call.apply(e,[this].concat(o))||this,r(i,"iconSprite",b,n(i)),r(i,"iconSpriteFrames",m,n(i)),i.index=0,i.col=0,i.raw=0,i.type=1,i}return t(i,e),i.prototype.init=function(e,i,t,r){this.index=e,this.col=i,this.raw=t,this.type=r,this.iconSprite.spriteFrame=this.iconSpriteFrames[r-1]},i}(s)).prototype,"iconSprite",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=i(y.prototype,"iconSpriteFrames",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h=y))||h));o._RF.pop()}}}));

System.register("chunks:///_virtual/RoomEscape",["./Box.ts","./RoomEscapeView.ts","./Stone.ts"],(function(){"use strict";return{setters:[null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/RoomEscapeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUIForm.ts","./Box.ts","./Stone.ts","./UIManager.ts","./GameUIConfig.ts","./GEventManager.ts","./AdManager.ts"],(function(t){"use strict";var e,i,o,n,s,a,r,l,h,c,u,f,m,p,d,g,b,v,T,x,B,C,L,N,y,A,w,R,D,E,P,_;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,a=t._decorator,r=t.Prefab,l=t.Node,h=t.Label,c=t.NodePool,u=t.PhysicsSystem2D,f=t.Animation,m=t.v3,p=t.UITransform,d=t.Sprite,g=t.Collider2D,b=t.Contact2DType,v=t.tween,T=t.Tween,x=t.NodeEventType,B=t.instantiate,C=t.RigidBody2D,L=t.Vec2,N=t.UIOpacity},function(t){y=t.default},function(t){A=t.Box},function(t){w=t.Stone},function(t){R=t.default},function(t){D=t.UIID},function(t){E=t.GEventManager,P=t.Event_Name},function(t){_=t.default}],execute:function(){var I,S,O,U,z,G,M,k,W,F,V,H,Y,K,Z,j,Q,q,J,X,$,tt,et,it,ot,nt,st,at,rt,lt,ht;s._RF.push({},"13a6ffkoQ5PLavhZOerW7ZG","RoomEscapeView",void 0);var ct=a.ccclass,ut=a.property,ft=function(t,e,i,o,n,s){void 0===n&&(n=null),void 0===s&&(s=null),this.index=void 0,this.col=void 0,this.raw=void 0,this.pos=void 0,this.box=void 0,this.block=void 0,this.index=t,this.col=e,this.raw=i,this.pos=o,this.box=n,this.block=s};t("RoomEscapeView",(I=ct("RoomEscapeView"),S=ut(r),O=ut(l),U=ut(r),z=ut(l),G=ut(r),M=ut(l),k=ut(l),W=ut(l),F=ut(h),V=ut(h),H=ut(l),Y=ut(l),K=ut(l),Z=ut(l),I((q=e((Q=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s))||this,o(e,"stonePrefab",q,n(e)),o(e,"stonesNode",J,n(e)),o(e,"boxPrefab",X,n(e)),o(e,"boxsNode",$,n(e)),o(e,"blockPrefab",tt,n(e)),o(e,"blocksNode",et,n(e)),o(e,"bottomNode",it,n(e)),o(e,"scoreProgress",ot,n(e)),o(e,"scoreLabel",nt,n(e)),o(e,"leftTimeLabel",st,n(e)),o(e,"roleLine",at,n(e)),o(e,"tuiziLine",rt,n(e)),o(e,"OneLineTipNode",lt,n(e)),o(e,"WorningeffectNode",ht,n(e)),e.score=0,e.goal=100,e.stonesPool=new c("StonePool"),e.col=9,e.raw=9,e.boxDatas=[],e.leftTime=100,e.maxTime=100,e.lockBox=null,e.stoneNum=250,e.isRemoveOneLine=!1,e.isfirstAddTimeTip=!0,e.propnum=0,e.isGameOver=!1,e}i(e,t);var s=e.prototype;return s.onEnable=function(){E.on(P.GAME_RETURN_HALL,this.GameBackHome,this),E.on(P.WATER_CLICK_RESTART,this.onBtnRestart,this),E.on(P.WATER_CLICK_CONTINUE,this.onBtnContinue,this),E.on(P.WATER_TIME_UP_ADD_TIME,this.onBtnAddTipTime,this),E.on(P.GAME_AGAIN_LEVEL,this.onBtnRestart,this)},s.onDisable=function(){E.off(P.GAME_RETURN_HALL,this.GameBackHome,this),E.off(P.WATER_CLICK_RESTART,this.onBtnRestart,this),E.off(P.WATER_CLICK_CONTINUE,this.onBtnContinue,this),E.off(P.WATER_TIME_UP_ADD_TIME,this.onBtnAddTipTime,this),E.off(P.GAME_AGAIN_LEVEL,this.onBtnRestart,this)},s.start=function(){u.instance.enable=!0,this.ColliderEvents(),this.TouchEvents()},s.update=function(t){},s.init=function(){this.scheduleOnce(this.BeginGame.bind(this),.3)},s.BeginGame=function(){this.boxsNode.removeAllChildren(),this.blocksNode.removeAllChildren(),this.leftTime=100,this.score=0,this.goal=100,this.isGameOver=!1,this.leftTimeLabel.string=""+this.leftTime,this.isfirstAddTimeTip=!0,this.propnum=0,this.WorningeffectNode.getComponent(f).stop(),this.WorningeffectNode.active=!1,this.OneLineTipNode.active=!1,this.updateProgress(),this.roleLine.getChildByName("men").setPosition(m(-1*this.roleLine.getComponent(p).width,0,0)),this.tuiziLine.getChildByName("tuizi").setPosition(m(this.tuiziLine.getComponent(p).width,0,0)),this.tuiziLine.getComponent(d).fillRange=1,this.roleLine.getComponent(d).fillRange=1,this.schedule(this.updateTime,1),this.boxDatas=[],this.isRemoveOneLine=!1,this.initBoxDatas(),this.clearStones(),this.clearBoxes(),this.resetBlocks(),this.createStones(),this.createBoxes()},s.ColliderEvents=function(){this.bottomNode.getComponent(g).on(b.BEGIN_CONTACT,this.onBeginContact,this)},s.onBeginContact=function(t,e){var i=this,o=e.node;if("stone"==o.name){var n=o.getComponent(w);if(n.removed)return;n.removed=!0,v(o).delay(.1).call((function(){i.stonesPool.put(o)})).start(),this.score+=1,this.score>=this.goal&&0==this.isGameOver&&this.showSuccessPanel(),this.updateProgress()}},s.updateProgress=function(){T.stopAllByTarget(this.scoreProgress.getComponent(d)),v(this.scoreProgress.getComponent(d)).to(.1,{fillRange:0==this.score?0:Math.max(.05,this.score/this.goal)}).start(),this.scoreLabel.string=this.score+","+this.goal},s.updateRole=function(){T.stopAllByTarget(this.roleLine.getComponent(d)),T.stopAllByTarget(this.roleLine.getChildByName("men")),T.stopAllByTarget(this.tuiziLine.getChildByName("tuizi")),T.stopAllByTarget(this.tuiziLine.getComponent(d)),v(this.roleLine.getComponent(d)).to(1,{fillRange:this.leftTime/this.maxTime}).start(),v(this.roleLine.getChildByName("men")).to(1,{position:m(this.leftTime/this.maxTime*this.roleLine.getComponent(p).width*-1,0,0)}).start(),v(this.tuiziLine.getChildByName("tuizi")).to(1,{position:m(this.leftTime/this.maxTime*this.tuiziLine.getComponent(p).width,0,0)}).start(),v(this.tuiziLine.getComponent(d)).to(1,{fillRange:this.leftTime/this.maxTime}).start()},s.TouchEvents=function(){this.node.on(x.TOUCH_START,this.onTouchStart,this),this.node.on(x.TOUCH_MOVE,this.onTouchMove,this),this.node.on(x.TOUCH_END,this.onTouchEnd,this),this.node.on(x.TOUCH_CANCEL,this.onTouchEnd,this)},s.onTouchStart=function(t){var e=t.getUILocation();this.lockBox=this.getIndexBox(e),this.lockBox&&1==this.isRemoveOneLine&&(this.ClearOneLine(this.lockBox.raw),this.lockBox=null)},s.onTouchMove=function(t){if(this.lockBox){var e=t.getUILocation(),i=this.getIndexBox(e);return i&&i!=this.lockBox?(this.moveBox(this.lockBox,i),void(this.lockBox=null)):void 0}},s.onTouchEnd=function(t){this.lockBox=null},s.getIndexBox=function(t){for(var e=0;e<this.boxDatas.length;e++)for(var i=this.boxDatas[e],o=0;o<i.length;o++){var n=i[o].box;if(n&&n.getComponent(p).getBoundingBoxToWorld().contains(t))return n}return null},s.moveBox=function(t,e){var i=this,o=e.col-t.col,n=e.raw-t.raw;if(!(Math.abs(o)>1||Math.abs(n)>1||0!=o&&0!=n)){var s=this.boxDatas[t.raw][t.col],a=this.boxDatas[e.raw][e.col],r=t.node,l=e.node,h=r.getSiblingIndex(),c=.2;v(this).call((function(){i.setBoxData(s,e),i.setBoxData(a,t),r.setSiblingIndex(i.boxsNode.children.length-1),v(r).to(c,{position:a.pos}).start(),v(l).to(c,{position:s.pos}).start()})).delay(c).call((function(){var o=i.getRemoveBoxDatas(a,t.type),n=i.getRemoveBoxDatas(s,e.type);if(o||n){if(o)for(var u=function(t){var e=o[t],i=e.box;if(i){v(i.node.getComponent(N)).to(.2,{opacity:0}).start(),v(i.node).to(.2,{scale:m(1.2,1.2,1.2)}).call((function(){i.node.removeFromParent()})).start(),e.box=null}e.block.getComponent(C).enabled=!1},f=0;f<o.length;f++)u(f);if(n)for(var p=function(t){var e=n[t],i=e.box;if(i){v(i.node.getComponent(N)).to(.2,{opacity:0}).start(),v(i.node).to(.2,{scale:m(1.2,1.2,1.2)}).call((function(){i.node.removeFromParent()})).start(),e.box=null}e.block.getComponent(C).enabled=!1},d=0;d<n.length;d++)p(d);_.getInstance().phoneVibrate(!1)}else i.setBoxData(s,t),i.setBoxData(a,e),r.setSiblingIndex(h),v(r).to(c,{position:s.pos}).start(),v(l).to(c,{position:a.pos}).start()})).start()}},s.setBoxData=function(t,e){t.box=e,e.index=t.index,e.col=t.col,e.raw=t.raw},s.getRemoveBoxDatas=function(t,e){var i=t.col,o=t.raw,n=[];n.push(t);for(var s=[],a=!0,r=!0,l=1;l<=this.raw&&(a||r);l++){if(a){var h=o-l;if(h<0)a=!1;else{var c=this.boxDatas[h][i];c.box&&c.box.type==e?s.push(c):a=!1}}if(r){var u=o+l;if(u>=this.raw)r=!1;else{var f=this.boxDatas[u][i];f.box&&f.box.type==e?s.push(f):r=!1}}}if(s.length>1)for(var m=0;m<s.length;m++)n.push(s[m]);for(var p=[],d=!0,g=!0,b=1;b<=this.col&&(d||g);b++){if(d){var v=i+b;if(v>=this.col)d=!1;else{var T=this.boxDatas[o][v];T.box&&T.box.type==e?p.push(T):d=!1}}if(g){var x=i-b;if(x<0)g=!1;else{var B=this.boxDatas[o][x];B.box&&B.box.type==e?p.push(B):g=!1}}}if(p.length>1)for(var C=0;C<p.length;C++)n.push(p[C]);return n.length>2?n:null},s.initBoxDatas=function(){this.boxDatas=[];for(var t=0,e=0;e<this.raw;e++){for(var i=[],o=315-50*e,n=0;n<this.col;n++){var s=m(50*n-315,o,0),a=new ft(t,n,e,s,null,this.createBlock(s));i.push(a),t+=1}this.boxDatas.push(i)}},s.createBlock=function(t){var e=B(this.blockPrefab);return e.parent=this.blocksNode,e.position=t,e.getComponent(C).enabled=!0,e},s.updateTime=function(){this.leftTime-=1,this.leftTimeLabel.string=""+this.leftTime,this.updateRole(),10==this.leftTime&&(1==this.isfirstAddTimeTip&&(this.unschedule(this.updateTime),R.GetInstance().ShowUIForms(D.AddTimeTip),this.isfirstAddTimeTip=!1),this.WorningeffectNode.active=!0,this.WorningeffectNode.getComponent(f).play()),this.leftTime<=0&&(this.leftTime=0,this.leftTimeLabel.string=""+this.leftTime,0==this.isGameOver&&this.showFailPanel())},s.createStones=function(){for(var t=-260,e=380,i=0;i<this.stoneNum;i++)this.createStone(m(t,e,0)),(t+=30)>=200&&(t=-260,e+=30),e>=500&&(e=380)},s.getStoneNode=function(){if(this.stonesPool.size()<1){var t=B(this.stonePrefab),e=this.getRandomNUM(0,2);t.scale=0==e?m(.4,.4,.4):m(.5,.5,.5),this.stonesPool.put(t)}return this.stonesPool.get()},s.createStone=function(t){var e=this.getStoneNode();e.parent=this.stonesNode,e.position=t;var i=e.getComponent(w);i.removed=!1;var o=i.rb2d;o.linearVelocity=L.ZERO,o.angularVelocity=0,o.enabled=!0},s.createBoxes=function(){for(var t=0;t<this.boxDatas.length;t++)for(var e=this.boxDatas[t],i=0;i<e.length;i++){var o=e[i],n=[1,2,3,4],s=this.getRandomNUM(0,n.length),a=n[s];for(n.splice(s,1);this.getRemoveBoxDatas(o,a)&&n.length>0;)a=n[s=this.getRandomNUM(0,n.length)],n.splice(s,1);o.box=this.createBox(o,a)}},s.createBox=function(t,e){var i=B(this.boxPrefab);i.parent=this.boxsNode,i.position=t.pos;var o=i.getComponent(A);return o.init(t.index,t.col,t.raw,e),o},s.clearStones=function(){for(var t=this.stonesNode.children,e=t.length-1;e>=0;e--){var i=t[e];T.stopAllByTarget(i),this.stonesPool.put(i)}},s.clearBoxes=function(){for(var t=0;t<this.boxDatas.length;t++)for(var e=this.boxDatas[t],i=0;i<e.length;i++){var o=e[i].box;o&&o.node.removeFromParent()}},s.resetBlocks=function(){for(var t=0;t<this.boxDatas.length;t++)for(var e=this.boxDatas[t],i=0;i<e.length;i++){e[i].block.getComponent(C).enabled=!0}},s.getRandomNUM=function(t,e){return Math.floor(Math.random()*(e-t))+t},s.onBtnClearOneLine=function(){E.emit(P.GAME_PLAY_SOUNDS,"bubble"),this.propnum,this.isRemoveOneLine=!0,this.OneLineTipNode.active=!0},s.ClearOneLine=function(t){for(var e=this,i=function(i){var o=e.boxDatas[t][i],n=o.box;if(n){v(n.node.getComponent(N)).to(.2,{opacity:0}).start(),v(n.node).to(.2,{scale:m(1.2,1.2,1.2)}).call((function(){n.node.removeFromParent()})).start(),o.box=null,n.node.removeFromParent()}o.block.getComponent(C).enabled=!1},o=0;o<this.col;o++)i(o);this.isRemoveOneLine=!1,this.OneLineTipNode.active=!1},s.closeOneLineTip=function(){E.emit(P.GAME_PLAY_SOUNDS,"bubble"),this.isRemoveOneLine=!1,this.OneLineTipNode.active=!1,this.propnum+=1},s.onBtnUpdatebox=function(){E.emit(P.GAME_PLAY_SOUNDS,"bubble");for(var t=0;t<this.raw;t++)for(var e=0;e<this.col;e++){var i=this.boxDatas[t][e],o=i.box;if(o){var n=[1,2,3,4],s=this.getRandomNUM(0,n.length),a=n[s];for(n.splice(s,1);this.getRemoveBoxDatas(i,a)&&n.length>0;)a=n[s=this.getRandomNUM(0,n.length)],n.splice(s,1);o.init(i.index,i.col,i.raw,a)}}},s.onBtnAddTime=function(){this.leftTime+=60,this.leftTimeLabel.string=""+this.leftTime,this.leftTime>this.maxTime&&(this.maxTime=this.leftTime)},s.onBtnPause=function(){E.emit(P.GAME_PLAY_SOUNDS,"bubble"),this.unschedule(this.updateTime),R.GetInstance().ShowUIForms(D.SettingUI)},s.onBtnContinue=function(){this.schedule(this.updateTime,1)},s.onBtnRestart=function(){this.unschedule(this.updateTime),T.stopAllByTarget(this.roleLine.getComponent(d)),T.stopAllByTarget(this.roleLine.getChildByName("men")),T.stopAllByTarget(this.tuiziLine.getChildByName("tuizi")),T.stopAllByTarget(this.tuiziLine.getComponent(d)),T.stopAllByTarget(this.scoreProgress.getComponent(d)),this.BeginGame()},s.GameBackHome=function(){this.unschedule(this.updateTime),T.stopAllByTarget(this.roleLine.getComponent(d)),T.stopAllByTarget(this.roleLine.getChildByName("men")),T.stopAllByTarget(this.tuiziLine.getChildByName("tuizi")),T.stopAllByTarget(this.tuiziLine.getComponent(d)),T.stopAllByTarget(this.scoreProgress.getComponent(d)),R.GetInstance().CloseUIForms(D.RoomEscapeView)},s.onBtnAddTipTime=function(){this.leftTime+=60,this.leftTimeLabel.string=""+this.leftTime,this.WorningeffectNode.getComponent(f).stop(),this.WorningeffectNode.active=!1,this.schedule(this.updateTime,1)},s.showSuccessPanel=function(){E.emit(P.GAME_PLAY_SOUNDS,"success"),this.unschedule(this.updateTime),this.isGameOver=!0,this.WorningeffectNode.getComponent(f).stop(),this.WorningeffectNode.active=!1,R.GetInstance().ShowUIForms(D.WinUI,{isWin:!0,level:1})},s.showFailPanel=function(){E.emit(P.GAME_PLAY_SOUNDS,"fail"),this.isGameOver=!0,this.WorningeffectNode.getComponent(f).stop(),this.WorningeffectNode.active=!1,R.GetInstance().ShowUIForms(D.WinUI,{isWin:!1,level:1})},e}(y)).prototype,"stonePrefab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(Q.prototype,"stonesNode",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(Q.prototype,"boxPrefab",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(Q.prototype,"boxsNode",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=e(Q.prototype,"blockPrefab",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=e(Q.prototype,"blocksNode",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e(Q.prototype,"bottomNode",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=e(Q.prototype,"scoreProgress",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=e(Q.prototype,"scoreLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e(Q.prototype,"leftTimeLabel",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=e(Q.prototype,"roleLine",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=e(Q.prototype,"tuiziLine",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt=e(Q.prototype,"OneLineTipNode",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ht=e(Q.prototype,"WorningeffectNode",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=Q))||j));s._RF.pop()}}}));

System.register("chunks:///_virtual/Stone.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var t,r,n,i,o,c,l,a,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,c=e._decorator,l=e.RigidBody2D,a=e.Collider2D,u=e.Component}],execute:function(){var s,p,d,f,y,b,g;o._RF.push({},"b81259CavVAgZVWJnwSgZs6","Stone",void 0);var v=c.ccclass,h=c.property;e("Stone",(s=v("Stone"),p=h(l),d=h(a),s((b=t((y=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return t=e.call.apply(e,[this].concat(o))||this,n(t,"rb2d",b,i(t)),n(t,"c2d",g,i(t)),t.removed=!1,t}return r(t,e),t.prototype.start=function(){},t}(u)).prototype,"rb2d",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=t(y.prototype,"c2d",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=y))||f));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/RoomEscape', 'chunks:///_virtual/RoomEscape'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});